define.activity&&(define.activity.definitionModifier=function(a,b,c){define.Class(a,c),resource.getResources(["W.Commands","W.TPA"],function(c){Array.each(b,function(b){c.W.Commands.executeCommand("WViewerCommands.Activity.Register",{name:b,className:a})})})}),define.Class("tpa.viewer.classes.Activity",function(a){a.resources(["W.TPA","W.Utils","W.Config"]),a.utilize(["core.managers.serverfacade.WixRESTClient"]),a.binds(["_activityIdHandler","_hsHandler","_metasiteIdHandler","_activityTypeHandler","_sourceIdHandler","_activityLocationHandler","_additionalInfoUrlHandler","_activityInfoHandler","_contactUpdateHandler"]),a.methods({initialize:function(){this._paramsHandlers={},this._requestParamsHandlers={};var a=this.imports.WixRESTClient;this._restClient=new a,this.setRequestParamHandler("activity-id",this._activityIdHandler),this.setRequestParamHandler("metasite-id",this._metasiteIdHandler),this.setRequestParamHandler("hs",this._hsHandler),this.setParamHandler("dateTime",this._dateTimeHandler),this.setParamHandler("activityType",this._activityTypeHandler),this.setParamHandler("sourceId",this._sourceIdHandler),this.setParamHandler("activityLocation",this._activityLocationHandler),this.setParamHandler("additionalInfoUrl",this._additionalInfoUrlHandler),this.setParamHandler("activityInfo",this._activityInfoHandler),this.setParamHandler("contactUpdate",this._contactUpdateHandler)},report:function(){var a={payload:{},params:{}},b=this;Object.keys(this._paramsHandlers).forEach(function(c){a.payload[c]=b._paramsHandlers[c]()}),Object.keys(this._requestParamsHandlers).forEach(function(c){a.params[c]=b._requestParamsHandlers[c]()}),this._send(a)},_send:function(a){var b=this.resources.W.Config.isPremiumUser()?"":location.pathname,c=location.origin+b+"/_api/app-integration-bus-web/com.wixpress.activity/1/activity",d=this._getQuery(a.params),e={};this._restClient.post(c+d,a.payload,e)},_getQuery:function(a){var b=[];return Object.keys(a).forEach(function(c){b.push(c+"="+a[c])}),"?"+b.join("&")},setParamHandler:function(a,b){a&&b&&(this._paramsHandlers[a]=b)},setRequestParamHandler:function(a,b){a&&b&&(this._requestParamsHandlers[a]=b)},_metasiteIdHandler:function(){return this.resources.W.Config.getMetaSiteId()},_hsHandler:function(){return this.resources.W.TPA.getHS()},_dateTimeHandler:function(){return(new Date).toISOString()},_activityTypeHandler:function(){return"activityType"},_sourceIdHandler:function(){return"sourceId"},_activityLocationHandler:function(){return location.href},_additionalInfoUrlHandler:function(){return"additionalInfoUrl"},_activityInfoHandler:function(){return"activityInfo"},_contactUpdateHandler:function(){return"contactUpdate"},_activityIdHandler:function(){return this.resources.W.Utils.getGUID()}})}),define.activity&&define.activity("tpa.viewer.classes.CotactFormActivity",["ContactForm"],function(a){a.inherits("tpa.viewer.classes.Activity"),a.methods({initialize:function(a){this.parent(a),this._fields=a,this.setRequestParamHandler("component-name",this._componentNameHandler)},_componentNameHandler:function(){return"contactForm"},_activityTypeHandler:function(){return"contact/contact-form"},_sourceIdHandler:function(){return"ContactForm"},_activityInfoHandler:function(){var a={fields:[]},b=this;return Object.keys(this._fields).forEach(function(c){a.fields.push({name:c,value:b._fields[c]})}),a},_contactUpdateHandler:function(){var a={name:{first:"John",last:"Doe"},emails:[{label:"main",value:"john.doe@nowhere.com"}]},b=this._fields.name.split(" ");return a.name.first=b[0],a.name.last=b[1],a.emails[0].value=this._fields.email,a}})}),define.component("tpa.viewer.components.Accordion",function(a){a.inherits("tpa.viewer.components.TPAGallery"),a.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"photos"},commandParameterDataRef:"SELF"}]},indexName:"Accordion",isTpa:!1}),a.methods({initialize:function(a,b,c){this.parent(a,b,c),this.styleProps={titleColor:"color1",descColor:"color2"}}})}),define.component("tpa.viewer.components.Impress",function(a){a.inherits("tpa.viewer.components.TPAGallery"),a.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"photos"},commandParameterDataRef:"SELF"}]},indexName:"Impress",isTpa:!1}),a.methods({})}),define.component("tpa.viewer.components.Masonry",function(a){a.inherits("tpa.viewer.components.TPAGallery"),a.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"photos"},commandParameterDataRef:"SELF"}]},indexName:"Masonry",isTpa:!1}),a.methods({})}),define.component("tpa.viewer.components.Strip",function(a){a.inherits("tpa.viewer.components.TPAGallery"),a.traits(["tpa.viewer.traits.TPAFullWidthComponent"]),a.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"photos"},commandParameterDataRef:"SELF"}]},indexName:"Strip",isTpa:!1}),a.methods({initialize:function(a,b,c){this.initFullWidthContainer(),this.parent(a,b,c),this.styleProps={titleColor:"color1",dsecriptionColor:"color2",backgroundColor:"color3"}}})}),define.component("tpa.viewer.components.StripSlider",function(a){a.inherits("tpa.viewer.components.TPAGallery"),a.traits(["tpa.viewer.traits.TPAFullWidthComponent"]),a.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"photos"},commandParameterDataRef:"SELF"}]},indexName:"StripSlider",isTpa:!1}),a.methods({initialize:function(a,b,c){this.initFullWidthContainer(),this.parent(a,b,c)}})}),define.component("tpa.viewer.components.TPABase",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["scriptLoader","W.Config","W.TPA","W.Viewer","W.Commands"]),b.traits(["tpa.viewer.traits.TPAHandlers"]),b.skinParts({iframe:{type:"htmlElement"}}),b.binds(["_handlePageNavigationChange","_onIframeLoad"]),b.fields({_renderTriggers:[Constants.DisplayEvents.DISPLAY_CHANGED],MIN_SIZE:{w:10,h:10},EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"APPS_SETTINGS_APPS",command:"WEditorCommands.OpenTPASettingsDialog"}],dblClick:{label:"APPS_SETTINGS_APPS",command:"WEditorCommands.OpenTPASettingsDialog"}},_Events:{EDIT_MODE_CHANGE:"WPreviewCommands.WEditModeChanged",PAGE_NAVIGATION_CHANGE:"pageTransitionEnded",SITE_PUBLISHED:"WEditorCommands.Publish",COMPONENT_DELETED:"COMPONENT_DELETED",APP_MESSAGE:"SETTINGS_UPDATED",WINDOW_PLACEMENT_CHANGED:"WINDOW_PLACEMENT_CHANGED"},isTpa:!0}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._initialized=!1,this._appIsAlive=!1,this.baseUrlParams=["instance","section-url","target","width","viewMode","locale","cacheKiller","compId"],this.setMinW(this.MIN_SIZE.w),this.setMinH(this.MIN_SIZE.h),this.addEvent("resizeEnd",this._onResizeEnd),this._startTime=new Date},isUnderMobileView:function(){try{return this.resources.W.Viewer.getViewerMode&&this.resources.W.Viewer.getViewerMode()!==Constants.ViewerTypesParams.TYPES.DESKTOP}catch(a){return!1}},isVisible:function(){return!0},isPremiumApp:function(){return!!this._appData&&!!this._appData.vendorProductId},isDemoMode:function(){return!!this._appData&&!!this._appData.demoMode},_onAllSkinPartsReady:function(){this._skinParts.iframe.addEvent("load",this._onIframeLoad),this.addEventListeners()},_onIframeLoad:function(){this._loadTime=(new Date).getMilliseconds()-this._startTime.getMilliseconds(),this.injects().TPA.reportLoadStart(this)},setIFrameSrc:function(a){a?this.isVisible()&&(this._startTime=new Date,this._iframe.src=a):this.onError()},setUrl:function(a){this._iframe&&(this._iframe.src=a)},onError:function(){this.showErrorPage(),LOG.reportError(wixErrors.APPS_OPEN_TIMEOUT,this._appData.appDefinitionName,"showAppNotAvailable",this._appData.appDefinitionId)},showErrorPage:function(){this._skinParts.iframe.removeEvent("load",this._onIframeLoad),this.setUrl(this.resources.W.Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/appNotResponding.html")},render:function(){this._renderIframe()},onDataInitialized:function(){},onPageVisibilityChange:function(a,b){a&&this.fireEvent(this._Events.PAGE_NAVIGATION_CHANGE,b._compId)},addEventListeners:function(){this.resources.W.Commands.registerCommandListenerByName(this._Events.EDIT_MODE_CHANGE,this,function(){this.handleAddEventListener.apply(this,[this._Events.EDIT_MODE_CHANGE])}),this.resources.W.Viewer.addEvent(this._Events.PAGE_NAVIGATION_CHANGE,this._handlePageNavigationChange),"site"!==this.resources.W.Viewer.getViewMode()&&window.parent.W.Commands.registerCommandListenerByName(this._Events.SITE_PUBLISHED,this,function(){this.handleAddEventListener.apply(this,[this._Events.SITE_PUBLISHED])})},passAppMessage:function(a){this.handleAddEventListener(this._Events.APP_MESSAGE,a)},passWindowPlacement:function(a){this.handleAddEventListener(this._Events.WINDOW_PLACEMENT_CHANGED,a)},handleAddEventListener:function(a,b){var c,d={intent:"addEventListener",eventType:"",params:{}};switch(a){case"WPreviewCommands.WEditModeChanged":c="EDIT_MODE_CHANGE",d.params={editMode:this._getCurrentEditMode()};break;case"pageTransitionEnded":c="PAGE_NAVIGATION_CHANGE",d.params=this._getPageParameters(b);break;case"WEditorCommands.Publish":c="SITE_PUBLISHED";break;case this._Events.COMPONENT_DELETED:c=a;break;case this._Events.APP_MESSAGE:c=a,d.params=b;break;case this._Events.WINDOW_PLACEMENT_CHANGED:c=a,d.params=b}if(d.eventType=c,this._skinParts.iframe){var e="";try{e=JSON.stringify(d)}catch(f){return}this._skinParts.iframe.contentWindow.postMessage(e,"*")}},setQueryParams:function(a){this._queryParams=a},isAppAlive:function(){return this._appIsAlive},getAppDefinitionId:function(){return this._appDefinitionId},getApplicationId:function(){return this._data&&this._data.get("applicationId")},getAppData:function(){return this._appData},getSectionURL:function(){return this.injects().TPA.getSectionURL(this._applicationId)},disposeRegisteredTPA:function(){this.handleAddEventListener.apply(this,[this._Events.COMPONENT_DELETED]),this.resources.W.Viewer.removeEvent(this._Events.PAGE_NAVIGATION_CHANGE,this._handlePageNavigationChange),this.injects().TPA.getComponentRegistrar().unregister(this),this._view.setStyle("display","none"),this._isSelectable=!1},dispose:function(a){a?this.parent():(this.disposeRegisteredTPA(),setTimeout(function(){this.dispose(!0)}.bind(this),500))},refreshAppData:function(){this._extractAppData()},getPanelInfo:function(a){this._appData.panelInfo?a(this._appData.panelInfo):this.resources.W.TPA.getAppMarketData(this._appData.appDefinitionId,function(b){this._setPanelInfo(b),a(this._appData.panelInfo)}.bind(this))},_setPanelInfo:function(a){a&&(this._appData.panelInfo={},this._appData.panelInfo.title=a.title,this._appData.panelInfo.price=a.price,this._appData.panelInfo.features=a.features,this._appData.panelInfo.upgradeBenefits=a.upgradeBenefits,this._appData.panelInfo.supportInfo=a.supportInfo)},_handlePageNavigationChange:function(a){var b=$$("#"+a)[0].getLogic(),c=b.getPageComponents().map(function(a){return a._compId}).indexOf(this._compId)>-1;(this.getIsDisplayed()||c)&&this.handleAddEventListener(this._Events.PAGE_NAVIGATION_CHANGE,b)},_getPageParameters:function(a){var b={pageName:a._data._data.title,pageId:a._compId,pageUrl:""},c=this._getSiteBaseUrl();return b.pageUrl=""!==c?c+"#!"+b.pageName+"/"+b.pageId:"",b},_getCurrentEditMode:function(){return"PREVIEW"==window.top.W.Editor.getEditMode()?"preview":"editor"},_addCustomQueryString:function(a){if(this._queryParams){var b="";return Object.each(this._queryParams,function(a,c){b+="&"+c+"="+encodeURIComponent(a)}),delete this._queryParams,a+b}return a},_onDataChange:function(){this._initializeWithData()},_extractAppData:function(){if(this._applicationId=this._data.get("applicationId"),this._appData=this.resources.W.Viewer.getAppDataHandler().getAppData(this._applicationId),this._appData||"site"===this.resources.W.Viewer.getViewMode())this._appDefinitionId=this._appData.appDefinitionId;else if(this._appDefinitionId=this._data.get("appDefinitionId"),this._appDefinitionId){var a=this.isWidget?W.AppStoreManager.TPA_WIDGET:W.AppStoreManager.TPA_SECTION,b=this._data.get("widgetId");window.parent.W.AppStoreManager.provisionApp(a,this._appDefinitionId,b,function(a){this.injects().Preview.getPreviewManagers().Viewer.getAppDataHandler().registerAppData(a),this.forceRender()}.bind(this))}},_initializeWithData:function(){this._initialized||(this._extractAppData(),this.resources.W.Viewer.isPublicMode()&&LOG.reportEvent(wixEvents.APPS_FLOW_APP_LOADED_ON_VIEWER,{g1:this._appDefinitionId+" "+window.location.href,i1:this._applicationId}),this.injects().TPA.getComponentRegistrar().register(this),this._initialized=!0,this.onDataInitialized(this._appData))},_editModeChanged:function(a){this._editMode=a},_onResize:function(){this.isRendered()&&this._initialized&&this.parent()},_onResizeEnd:function(){this._appIsAlive&&this._skinParts&&this._renderIfReady(),this._wCheckForSizeChangeAndFireAutoSized(3)},_changeSize:function(a,b){var c=this.getWidth(),d=this.getHeight(),e=a.x||a.w||a.width,f=a.y||a.h||a.height;e&&e!=c&&this.setWidth(e,!1,!f&&b),f&&f!=d&&this.setHeight(f,!1,b),this._wCheckForSizeChangeAndFireAutoSized(1)},forceRender:function(){if(this.getIsDisplayed()){this._iframe||(this._iframe=this._skinParts.iframe);var a=this._getUrl();this.setIFrameSrc(a)}},_renderIframe:function(){this._iframe?this._updateIframe():this._createIframe()},_createIframe:function(){this._iframe=this._skinParts.iframe,this._updateIframe()},_updateIframe:function(){this._iframe&&this._setBasicIframeParams()},_setBasicIframeParams:function(){var a=this._getUrl();this._urlEquals(this._iframe.src,a)||this.setIFrameSrc(a)},buildUrl:function(a,b,c){return this.resources.W.TPA.getURLBuilder().buildStateLessUrl(a,b,c,c._appData)},_urlEquals:function(a,b){if(!a||!b)return!1;var c=["cacheKiller","width","viewMode"],d=this._removeURLParams(a,c),e=this._removeURLParams(b,c);return d===e},_removeURLParams:function(a,b){var c=a.split("?");if(c.length>=2){for(var d=c[1].split(/[&;]/g),e=0;e<b.length;e++)for(var f=encodeURIComponent(b[e])+"=",g=d.length;g-->0;)0===d[g].indexOf(f,0)&&d.splice(g,1);return d.length>0?c[0]+"?"+d.join("&"):c[0]}return a},getIFrame:function(){return this._iframe},getFriendlyName:function(){return this._appData&&this._appData.appDefinitionName||""}})}),define.component("tpa.viewer.components.TPAComponent",function(a){var b=a;b.inherits("tpa.viewer.components.TPABase"),b.resources(["W.Events","topology"]),b.binds(["_postMessageToIframe"]),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}},isTpa:!1,externalHtmlPath:"TPAComponent.html"}),b.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c)},_onDataChange:function(a,b){if(this._skinParts){if(void 0!==this._propertiesSchemaName&&a._dataType===this._propertiesSchemaName)return this._sendPropertiesChangeMessage(a,b);this._postMessageToIframeThrottled()}},_postMessageToIframeThrottled:function(a){var b=this;clearTimeout(this._postMessageTimeout),this._postMessageTimeout=setTimeout(function(){b._postMessageToIframe()},a||150)},_postMessageToIframe:function(){var a=this;this._getMessageData(function(b){a._onBeforePostMessage(b),a.handleAddEventListener(a._Events.APP_MESSAGE,b)})},_sendPropertiesChangeMessage:function(){this._postMessageToIframeThrottled()},_onIframeLoad:function(){this._postMessageToIframe()},handleAppStateChanged:function(a){var b="string"==typeof a?a:a.state;try{b=JSON.parse(b)}catch(c){b={}}b.cmd&&this[b.cmd+"Command"]&&this[b.cmd+"Command"].apply(this,b.args)},_onBeforePostMessage:function(){},_getMessageData:function(){},_getUrl:function(){var a=this.resources.W.TPA.getURLBuilder().buildStateLessUrl(this.resources.topology.tpa+"/external/"+this.externalHtmlPath,["viewMode","locale"],this,{});return a},dispose:function(){this.disposeRegisteredTPA(),this.parent(!0)}})}),define.component("tpa.viewer.components.TPAFixedWidget",function(a){var b=a;b.inherits("tpa.viewer.components.TPAWidget"),b.resources(["W.Utils"]),b.statics({DEFAULT_COORDINATES:{top:"auto",left:"auto",bottom:"auto",right:"auto"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._$top="auto",this._$left="auto",this._$bottom="auto",this._$right="auto"},initComponentLayout:function(){this._view.setStyle("visibility","visible"),this.removeEvent(Constants.ComponentEvents.READY_FOR_RENDER,this.initComponentLayout);var a=["x","y","width","height"],b=0;for(b;b<a.length;b++){var c=a[b],d=this._view.get(c);if(null!=d&&""!==d){var e="set"+c.capitalize();this[e](d,!0)}}this._view.setStyle("position","fixed"),this.saveCurrentDimensions(),this.saveCurrentCoordinates()},getLayoutMode:function(){return"FIXED"},_setCssPosition:function(a,b){var c="auto"==a||!a&&isNaN(a),d=["top","left","bottom","right"],e="px";if(!d.contains(b))return this.resources.W.Utils.debugTrace("fixedPositionComponent","_setCssPostion",b+" passed as "+a),void 0;if(a&&a.split&&(e=a.split(parseInt(a,10)).join(""),"%"!==e&&(e="px")),a=c?"auto":parseInt(a,10),this["_$"+b]!=a){if(!c&&isNaN(a))return this.resources.W.Utils.debugTrace("fixedPositionComponent","set"+b,"NaN passed as value"),void 0;this["_$"+b]=a+e,this._view.setStyle(b,a+e),"left"==b&&(this._$x=c||"%"==e?this._view.getPosition().x:a),"top"==b&&(this._$y=c||"%"==e?this._view.getPosition().y:a),this.onMovement()}},setX:function(a){this.setLeft(a),this.setRight("auto")},setY:function(a){this.setTop(a),this.setBottom("auto")},getRight:function(){return this._$right},setRight:function(a){this._setCssPosition(a,"right")},getBottom:function(){return this._$bottom},setBottom:function(a){this._setCssPosition(a,"bottom")},getLeft:function(){return this._$left},setLeft:function(a){if(this._setCssPosition(a,"left"),"50%"===a){var b=this.getWidth()/2;this._view.setStyle("margin-left",-b)}},setTop:function(a){if(this._setCssPosition(a,"top"),"50%"===a){var b=this.getHeight()/2;this._view.setStyle("margin-top",-b)}},getTop:function(){return this._$top},setWidth:function(a,b,c){var d,e,f=a;this._isPercent(a)&&(d=parseFloat(a)/100,e=window.getSize().x,f=Math.round(e*d)),this.parent(f,b,c)},setHeight:function(a,b,c){var d,e,f=a;this._isPercent(a)&&(d=parseFloat(a)/100,e=window.getSize().y,f=Math.round(e*d)),this.parent(f,b,c)},setPosition:function(a,b,c,d){this.setTop(a),this.setLeft(b),this.setBottom(c),this.setRight(d)},setCoordinates:function(a){return a=Object.merge(this.DEFAULT_COORDINATES,a||{}),this._changeSize({width:a.x,height:a.y},!0),this.setPosition(a.top,a.left,a.bottom,a.right),a},_onAutoSized:function(){this.fireEvent("autoSizeChange")},_isPercent:function(a){return"string"==typeof a&&"%"==a.split(parseFloat(a)).join("")}})}),define.component("tpa.viewer.components.TPAGallery",function(a){a.inherits("tpa.viewer.components.TPAComponent"),a.resources(["W.Data","W.Commands","W.Viewer","W.TPA","W.Theme"]),a.dataTypes(["ImageList"]),a.binds(["_imageItemChange","_onThemeChange"]),a.propertiesSchemaType("SlideShowGalleryProperties"),a.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"TPA3DCarousel"},commandParameterDataRef:"SELF"}]},indexName:"Gallery",styleProps:{},isTpa:!1}),a.methods({initialize:function(a,b,c){this.parent(a,b,c),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.MediaZoom.Close",this,this._onMediaZoomClosed),this.baseUrlParams=["viewMode","locale","compId"]},_onAllSkinPartsReady:function(){this._registerToThemeChanged(),this.parent()},_onBeforePostMessage:function(){var a=this._getAllImagesDataItems();a.forEach(function(a){a.removeEvent(Constants.DataEvents.DATA_CHANGED,this._imageItemChange),a.addEvent(Constants.DataEvents.DATA_CHANGED,this._imageItemChange)},this)},_imageItemChange:function(){this._postMessageToIframeThrottled(1500)},_getAllImagesDataItems:function(){var a=this.getDataItem().getData();return a.items.map(function(a){return this.resources.W.Data.getDataByQuery(a)},this)},_onMediaZoomClosed:function(){this.handleAddEventListener(this._Events.APP_MESSAGE,{cmd:"zoomClosed"})},_getUrl:function(){var a,b=location.search.match(/devGallery=([^&]+)/);return b&&b[1]?(b=b[1],a=b+"/"+this.indexName+".html"):a=this.resources.topology.tpa+"/external/"+this.indexName+"/"+this.indexName+".html",this.injects().TPA.getURLBuilder().buildStateLessUrl(a,this.baseUrlParams,this,{})},_capitaliseFirstLetter:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},_getStyleProps:function(){var a=this._style.getProperties(),b={};for(var c in this.styleProps)if(b[c]=a[this.styleProps[c]],"color"==this._style.getPropertyType(this.styleProps[c])){var d="alpha"+this._capitaliseFirstLetter(c);b[d]=this._style.getPropertyExtraParamValue(this.styleProps[c],"alpha")}return b},_getMessageData:function(a){for(var b=this.getDataItem()._data,c=this.getComponentProperties(),d=this._getStyleProps(),e={items:[],props:_.clone(c.getData())},f=0;f<b.items.length;f++)e.items[f]=this.resources.W.Data.getDataByQuery(b.items[f])._data;_.merge(e.props,d),a(this.transformDataBeforeSend(e))},_zoom:function(a){a=a||0;var b=this.getDataItem();this.injects().Commands.executeCommand("WViewerCommands.OpenZoom",{itemsList:b,currentIndex:a,getDisplayerDivFunction:this.resources.W.Viewer.getDefaultGetZoomDisplayerFunction("Image"),getHashPartsFunction:this.resources.W.Viewer.getDefaultGetHashPartsFunction("Image")})},zoomCommand:function(a){this._zoom(a)},dispose:function(){var a=this._getAllImagesDataItems();a.forEach(function(a){a.removeEvent(Constants.DataEvents.DATA_CHANGED,this._imageItemChange)},this),this.resources.W.Theme.removeEvent(Constants.DataEvents.DATA_CHANGED,this._onThemeChange),this.resources.W.Commands.unregisterListener(this),this.parent()},_rgbToHex:function(a,b,c){a=parseInt(a,10),b=parseInt(b,10),c=parseInt(c,10);for(var d=((1<<24)+(a<<16)+(b<<8)+c).toString(16).slice(1),e=d.toString();e.length<6;)e="0"+e;return"#"+e},transformColorsBeforeSend:function(a,b){for(var c=0;c<b.length;++c){var d=a.props[b[c]],e=this.resources.W.Theme.getProperty(d),f=this._rgbToHex(e._r,e._g,e._b);a.props[b[c]]=f}return a},_onThemeChange:function(){var a=this;clearTimeout(this.themeTimeoutTicket),this.themeTimeoutTicket=setTimeout(function(){a._postMessageToIframe()},100)},_registerToThemeChanged:function(){Object.keys(this.styleProps).length>0&&this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onThemeChange)},transformDataBeforeSend:function(a){return this.transformColorsBeforeSend(a,Object.keys(this.styleProps))}})}),define.component("tpa.viewer.components.TPAModal",function(a){a.binds(["_onDispose"]),a.inherits("tpa.viewer.components.TPAWidget"),a.statics({DEFAULT_URL:"http://sslstatic.wix.com/services/js-sdk/1.16.0/html/modal.html"}),a.skinParts({blockingLayer:{type:"htmlElement"},dialog:{type:"htmlElement"},x:{type:"htmlElement"}}),a.methods({initialize:function(a,b,c){this.parent(a,b,c),c=c||{},this._rawUrl=c.url||this.DEFAULT_URL,this._url=null,this._width=c.width,this._height=c.height,this.isVolatile=!0,this._onClose=c.onClose},getAcceptableDataTypes:function(){return["TPAWidget","TPA"]},_onAllSkinPartsReady:function(){this._skinParts.x.addEvent("click",this._onDispose),this._skinParts.blockingLayer.addEvent("click",this._onDispose)},render:function(){if(this._width>0){var a=this._width/2;this._skinParts.dialog.setStyles({width:this._width,"margin-left":-a})}if(this._height>0){var b=this._height/2;this._skinParts.dialog.setStyles({height:this._height,"margin-top":-b})}this.parent()},_getUrl:function(){var a=this._url;return a||(a=W.TPA.getURLBuilder().buildStateLessUrl(this._rawUrl,["instance","section-url","target","viewMode","locale","cacheKiller"],this,this._appData)),a},_onDispose:function(){this._onClose&&this._onClose(),this._view.dispose()},_onEditModeChanged:function(){this._onDispose()},handleCloseWindow:function(a){this._onClose&&this._onClose(a.msgData),this.dispose()},setHeight:function(a,b,c){if(c!==!1&&(c=!0),a=parseInt(a,10),isNaN(a))return W.Utils.debugTrace("WbaseComp","setHeight","NaN passed as value"),void 0;a=this._limitHeight(a);var d=this._skinParts.dialog;(this._$height!=a||b)&&(this._$height=a,d.setStyle("height",this._$height+"px"),this.flushPhysicalHeightCache(),c&&this._onResize())}})}),define.component("tpa.viewer.components.TPAPlaceholder",function(a){var b=a;b.inherits("wysiwyg.viewer.components.WPhoto"),b.skinParts({img:{type:"core.components.image.ImageNew",dataRefField:"*"}}),b.fields({propertiesSchemaName:"WPhotoProperties",EDITOR_META_DATA:{general:{title:"App Placeholder",settings:!0,design:!1},custom:[{label:"SIDE_BTN_MARKET",command:"WEditorCommands.Market",commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.Market",commandParameterDataRef:"SELF"}}})}),define.component("tpa.viewer.components.TPAPopup",function(a){a.inherits("tpa.viewer.components.TPAFixedWidget"),a.resources([]),a.binds(["_onResize","_onDispose"]),a.statics({FIXED_OFFSET:2,MIN_EDGE_SIZE:50}),a.methods({initialize:function(a,b,c){this.parent(a,b,c),c=c||{},this._rawUrl=c.url,this._url=null,this._popupSize=c.popupSize?c.popupSize:{x:c.width,y:c.height},this._origin=c.origin||"",this._placement=c.placement||"CENTER",this._openPosition=c.openPosition||{top:0,left:0},this._openSize=c.openSize,this.isVolatile=!0,this._origPopupSize=this._popupSize,this._onClose=c.onClose},getAcceptableDataTypes:function(){return["TPAWidget","TPA"]},_onAllSkinPartsReady:function(){this._skinParts.x&&this._skinParts.x.addEvent("click",this._onDispose)},render:function(){this.parent();var a=this.calcCoordinates();this.setCoordinates(a)},calcCoordinates:function(){var a={};switch(this._origin){case"RELATIVE":a=Object.merge(this._getRelativeCoords(),this._popupSize),a=this._applyRelativeOffsets(a),a=this._validateRelativeCoordinates(a);break;case"FIXED":a=this._calcCoordinatesFixedPosition();break;default:a=this._calcCoordinatesFixedPosition()}return a.x||(a.x=200),a.y||(a.y=200),a=this._validateMinSize(a),a=this._validateNegtaivePosition(a)},_calcCoordinatesFixedPosition:function(){var a={};return a=Object.merge(this._getFixedCoords(),this._popupSize),a=this._applyFixedOffsets(a),a=this._validateFixedCoordinates(a)},_validateMinSize:function(a){return(a.x<=this.MIN_EDGE_SIZE||a.y<=this.MIN_EDGE_SIZE)&&(a=this._fallbackToCenterMin(a)),a},_validateNegtaivePosition:function(a){return("number"==typeof a.top&&a.top<0||"number"==typeof a.left&&a.left<0||"number"==typeof a.bottom&&a.bottom<0||"number"==typeof a.right&&a.right<0)&&(a=this._fallbackToCenterMin(a)),a},_validateFixedCoordinates:function(a){var b=window.getWidth(),c=window.getHeight();return a.x>=b&&(a.y=b-2*this.FIXED_OFFSET),a.y>=c&&(a.y=c-2*this.FIXED_OFFSET),a},_validateRelativeCoordinates:function(a){return a=this._validateMaxSizeLimit(a),this._isTop()||this._isBottom()?a=this._getVerticalCroppedCoords(a):this._isCenter()&&(a=this._getHorizontalCroppedCoords(a)),this._getFixedWidthHeightCoords(a)},_getFixedWidthHeightCoords:function(a){for(var b in a)a[b]<0&&"x"!=b&&"y"!=b&&(("top"===b||"botom"===b)&&(a.y=a.y+a[b]),("right"===b||"left"===b)&&(a.x=a.x+a[b]),a[b]=0);return a},_fallbackToCenterMin:function(a){return a.top="50%",a.left="50%",a.x=this._origPopupSize.x,a.y=this._origPopupSize.y,this._validateMaxSizeLimit(a)},_getVerticalCroppedCoords:function(a){var b,c,d=window.getWidth(),e=window.getHeight();return this._isTop()?(b=this._openPosition.y>this._popupSize.y,b||(a.y=this._openPosition.y-2*this.FIXED_OFFSET,a.top=this.FIXED_OFFSET)):this._isBottom()&&(b=e-(this._openPosition.y+this._openSize.y)>this._popupSize.y,b||(a.y=e-(this._openPosition.y+this._openSize.y)-2*this.FIXED_OFFSET)),this._isRight()?(c=d-(this._openPosition.x+this._openSize.x)>this._popupSize.x,c||(a.x=d-(this._openPosition.x+this._openSize.x)-10)):this._isLeft()?(c=d-(this._openPosition.x-this._popupSize.x)>this._popupSize.x,c||(a.x=d-this._openPosition.x,a.left=this._openPosition.x-a.x)):this._isCenter()&&(c=d-this._openPosition.x>this._popupSize.x,c||(a.x=d-this._openPosition.x),a.left=a.left=this._openPosition.x-a.x/2+this._openSize.x/2),a},_applyRelativeOffsets:function(a){return this._isTop()&&(a.top-=this.FIXED_OFFSET),this._isBottom()&&(a.top+=this.FIXED_OFFSET),this._isLeft()&&(a.left-=this.FIXED_OFFSET),this._isRight()&&(a.left+=this.FIXED_OFFSET),a},_applyFixedOffsets:function(a){return this._isTop()&&(a.top+=this.FIXED_OFFSET),this._isBottom()&&(a.top+=this.FIXED_OFFSET),this._isLeft()&&(a.left+=this.FIXED_OFFSET),this._isRight()&&(a.left+=this.FIXED_OFFSET),a},_getHorizontalCroppedCoords:function(a){var b,c=window.getWidth();return this._isRight()?(b=c-(this._openPosition.x+this._openSize.x)>this._popupSize.x,b||(a.x=c-(this._openPosition.x+this._openSize.x)-10)):this._isLeft()&&(b=c-(this._openPosition.x-this._popupSize.x)>this._popupSize.x,b||(a.x=c-this._openPosition.x,a.left=this._openPosition.x-a.x)),a},_validateMaxSizeLimit:function(a){var b=window.getWidth()/2,c=window.getHeight()/2;return a.x=a.x%b==a.x?a.x:b,a.y=a.y%c==a.y?a.y:c,a},_onDispose:function(){this._onClose&&this._onClose(),this._view.dispose()},_onEditModeChanged:function(){this._onDispose()},_getFixedCoords:function(){var a={};switch(this._placement){case"TOP_LEFT":a={left:0,top:0};break;case"TOP_RIGHT":a={right:0,top:0};break;case"BOTTOM_RIGHT":a={right:0,bottom:0};break;case"BOTTOM_LEFT":a={left:0,bottom:0};break;case"TOP_CENTER":a={top:0,left:"50%"};break;case"CENTER_RIGHT":a={top:"50%",right:0};break;case"BOTTOM_CENTER":a={bottom:0,left:"50%"};break;case"CENTER_LEFT":a={left:0,top:"50%"};break;default:a={top:"50%",left:"50%"}}return a},_getRelativeCoords:function(){var a={},b=this._openPosition,c=this._openSize,d=this._popupSize,e=b.x,f=b.y,g=c.x,h=c.y,i=d.x,j=d.y;switch(this._placement){case"TOP_LEFT":a={top:f-j,left:e-i};break;case"TOP_RIGHT":a={top:f-j,left:e+g};break;case"BOTTOM_RIGHT":a={top:f+h,left:e+g};break;case"BOTTOM_LEFT":a={top:f+h,left:e-i};break;case"TOP_CENTER":a={top:f-j,left:this._getRelativeCenterLeft(e,g,i)};break;case"CENTER_RIGHT":a={top:this._getRelativeCenterTop(f,h,j),left:e+g};break;case"BOTTOM_CENTER":a={top:f+h,left:this._getRelativeCenterLeft(e,g,i)};break;case"CENTER_LEFT":a={top:this._getRelativeCenterTop(f,h,j),left:e-i};break;default:a={top:this._getRelativeCenterTop(f,h,j),left:this._getRelativeCenterLeft(e,g,i)}}return a},_getRelativeCenterTop:function(a,b,c){return a+b/2-c/2},_getRelativeCenterLeft:function(a,b,c){return a+b/2-c/2},_getUrl:function(){var a=this._url;return a||(a=W.TPA.getURLBuilder().buildStateLessUrl(this._rawUrl,["instance","section-url","target","viewMode","locale","cacheKiller"],this,this._appData)),a},_onResize:function(){this.parent()},handleCloseWindow:function(a){this._onClose&&this._onClose(a.msgData),this.dispose()},_isTop:function(){return this._placement.indexOf("TOP")>=0},_isBottom:function(){return this._placement.indexOf("BOTTOM")>=0},_isLeft:function(){return this._placement.indexOf("LEFT")>=0},_isRight:function(){return this._placement.indexOf("RIGHT")>=0},_isCenter:function(){return this._placement.indexOf("CENTER")>=0}})}),define.component("tpa.viewer.components.TPASection",function(a){var b=a;b.inherits("tpa.viewer.components.TPABase"),b.dataTypes(["TPA"]),b.methods({isPage:!0,initialize:function(a,b,c){this.parent(a,b,c),this._nodeReady=!1,this._sectionWebUrlParams=this.baseUrlParams.slice(),this._sectionDeviceUrlParams=this.baseUrlParams.concat(["deviceType"])},render:function(){this.parent()},isVisible:function(){return this._nodeReady
},onPageVisibilityChange:function(a){a===!0&&this._nodeReady===!1&&(this._nodeReady=!0,this._renderIframe())},onDataInitialized:function(a){var b=a.sectionRefreshOnWidthChange;b||this.removeEvent("resizeEnd",this._onResizeEnd)},buildUrl:function(a,b,c){return this.resources.W.TPA.getURLBuilder().buildStateFullUrl(a,b,c,c._appData)},_getWebUrl:function(){return this.buildUrl(this._appData.sectionUrl,this._sectionWebUrlParams,this)},_getMobileUrl:function(){return this.buildUrl(this._appData.sectionMobileUrl,this._sectionDeviceUrlParams,this)},_getUrl:function(){var a;return this._initialized?(a=this.isUnderMobileView()?this._getMobileUrl():this._getWebUrl(),this._addCustomQueryString(a)):""},handleAppStateChanged:function(a){var b="string"==typeof a?a:a.state;this.injects().Utils.hash.setHashExtData(b)},isDeleteable:function(){return!1},isDeleteableRecurse:function(){return!1},isDuplicatable:function(){return!1},canMoveToOtherScope:function(){return!1},isContainable:function(){return!1}})}),define.component("tpa.viewer.components.TPAWidget",function(a){var b=a;b.inherits("tpa.viewer.components.TPABase"),b.dataTypes(["TPAWidget"]),b.methods({isWidget:!0,initialize:function(a,b,c){this.parent(a,b,c),this._isSelectable=!0,this._widgetWebUrlParams=this.baseUrlParams.slice(),this._widgetDeviceUrlParams=this.baseUrlParams.concat(["deviceType"])},getWidgetId:function(){return this._data.get("widgetId")},onDataInitialized:function(){var a=this.getWidgetId(),b=this.resources.W.Viewer.getAppDataHandler(),c=b.getWidgetProperty(this._applicationId,a,"refreshOnWidthChange");c||this.removeEvent("resizeEnd",this._onResizeEnd)},_getWidgetData:function(){var a=this.getWidgetId();return this.resources.W.Viewer.getAppDataHandler().getWidgetData(this._applicationId,a)},_getWebUrl:function(){return this.buildUrl(this._getWidgetData().widgetUrl,this._widgetWebUrlParams,this)},_getMobileUrl:function(){return this.buildUrl(this._getWidgetData().mobileUrl,this._widgetDeviceUrlParams,this)},_getUrl:function(){var a;return a=this.isUnderMobileView()?this._getMobileUrl():this._getWebUrl(),this._addCustomQueryString(a)},handleAppStateChanged:function(){},handleClosePopup:function(){},isSelectable:function(){return this._isSelectable},isDeleteableRecurse:function(){return!0}})}),define.component("tpa.viewer.components.Thumbnails",function(a){a.inherits("tpa.viewer.components.TPAGallery"),a.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"photos"},commandParameterDataRef:"SELF"}]},indexName:"Thumbnails",isTpa:!1}),a.methods({initialize:function(a,b,c){this.parent(a,b,c),this.styleProps={textColor:"color1",textBackgroundColor:"color2"}}})}),define.experiment.newComponent("tpa.viewer.components.TPA3DCarousel.TPA3DGallery.New",function(a){a.inherits("tpa.viewer.components.TPAGallery"),a.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"TPA3DGallery"},commandParameterDataRef:"SELF"}]},isTpa:!1}),a.methods({_getUrl:function(){var a=this.injects().TPA.getURLBuilder().buildStateLessUrl(this.resources.topology.tpa+"/external/Carousel/TPA3DCarousel.html",["viewMode","locale"],this,{});return a}})}),define.experiment.newComponent("tpa.viewer.components.TPA3DGallery.TPA3DGallery.New",function(a){a.inherits("tpa.viewer.components.TPAGallery"),a.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"TPA3DGallery"},commandParameterDataRef:"SELF"}]},isTpa:!1}),a.methods({_getUrl:function(){var a=this.injects().TPA.getURLBuilder().buildStateLessUrl(this.resources.topology.tpa+"/external/Slicebox/TPA3DGallery.html",["viewMode","locale"],this,{});return a}})}),define.experiment.newComponent("tpa.viewer.components.TPAMusicGallery.TPA3DGallery.New",function(a){a.inherits("tpa.viewer.components.TPAGallery"),a.methods({_getUrl:function(){var a=this.injects().TPA.getURLBuilder().buildStateLessUrl(this.resources.topology.tpa+"/external/jqueryuicoverflow/index.html",["viewMode","locale"],this,{});return a}})}),define.experiment.component("tpa.viewer.components.TPABase.TPAExtensions.New",function(a,b){var c=a,d=b;c.statics({EXTENSIONS_FOOTER_HEIGHT:50}),c.methods({_onAllSkinPartsReady:d.after(function(){this._hasExtensions()&&this.EDITOR_META_DATA.custom.push({label:"TPA_APP_EXTENSIONS",command:"WEditorCommands.OpenTPAAppExtensionsDialog",commandParameter:this._appData})}),_hasExtensions:function(){return this._appData.widgets&&(this.isWidget&&Object.keys(this._appData.widgets).length>1||!this.isWidget&&Object.keys(this._appData.widgets).length>0)}})}),define.experiment.component("tpa.viewer.components.TPAFixedWidget.TPAGlued.New",function(a,b){var c=a;c.methods({isFixedPositioned:function(){return!0},_setCssPosition:function(a,b){var c="auto"==a||!a&&isNaN(a),d=["top","left","bottom","right"],e="number"==typeof a?"px":"";if(!d.contains(b))return W.Utils.debugTrace("fixedPositionComponent","_setCssPostion",b+" passed as "+a),void 0;if(!c&&a&&a.split&&(e=a.split(parseInt(a,10)).join(""),"%"!==e&&(e="px")),a=c?"auto":parseInt(a,10),this["_$"+b]!=a){if(!c&&isNaN(a))return W.Utils.debugTrace("fixedPositionComponent","set"+b,"NaN passed as value"),void 0;this["_$"+b]=a+e,this._view.setStyle(b,a+e),"left"==b&&(this._$x=c||"%"==e?this._view.getPosition().x:a),"top"==b&&(this._$y=c||"%"==e?this._view.getPosition().y:a),this.onMovement()}},_isLeftPositioned:function(){return"auto"!==this.getLeft()},_isHorizCentred:function(){return"50%"===this.getLeft()},_isVertCentred:function(){return"50%"===this.getTop()},_isRightPositioned:function(){return"auto"!==this.getRight()},_isTopPositioned:function(){return"auto"!==this.getTop()},_isSideCentered:function(){return this._isVertCentred()&&(this._isLeftPositioned()||this._isRightPositioned())},_isBottomPositioned:function(){return"auto"!==this.getBottom()}})}),define.experiment.newComponent("tpa.viewer.components.TPAGluedWidget.TPAGlued.New",function(a){var b=a;b.inherits("tpa.viewer.components.TPAFixedWidget"),b.statics({DEF_PLACEMENT:"BOTTOM_RIGHT",DEF_WIDTH:200,DEF_HEIGHT:200,TOP_STICKY_AREA:120,SIDE_STICKY_AREA:300,CENTER_MARGIN_VALUE:0}),b.propertiesSchemaType("TPAGluedProperties"),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1,disableMoveForward:!0,disableMoveBackward:!0},custom:[{label:"APPS_SETTINGS_APPS",command:"WEditorCommands.OpenTPASettingsDialog"}],dblClick:{label:"APPS_SETTINGS_APPS",command:"WEditorCommands.OpenTPASettingsDialog"}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[];var d=this;resource.getResourceValue("W.Viewer",function(a){a.isSiteReady()?d._makeRoomForAd():a.addEvent("SiteReady",function(){d._makeRoomForAd()})})},render:function(){this.setCoordinates(this._coordinates),this.parent()},initComponentLayout:function(){this.parent(),this._view.addClass("Z-FIXED-COMPS");var a=this;resource.getResourceValue("W.Viewer",function(b){b.isPublicMode()&&a._addTransitionClass()})},_addTransitionClass:function(){this._view.addClass("TransitionSize"),this._skinParts.iframe.addClass("TransitionSize")},_removeTransitionClass:function(){this._view.removeClass("TransitionSize"),this._skinParts.iframe.removeClass("TransitionSize")},setCoordinates:function(a){this.parent(this._coordinates||a),this._setMarginOffset()},setPlacment:function(a,b,c){var d=this.getComponentProperties(),e=a||this._placement||this.DEF_PLACEMENT;this._placement!==e?(this._placement=a||this._placement||this.DEF_PLACEMENT,this._horizontalMargin=this.CENTER_MARGIN_VALUE,this._verticalMargin=this.CENTER_MARGIN_VALUE):(this._horizontalMargin=+c||0,this._verticalMargin=+b||0),d.set("placement",this._placement),d.set("horizontalMargin",this._horizontalMargin),d.set("verticalMargin",this._verticalMargin),this._coordinates=this._getGluedWidgetCoordinates(),this.setCoordinates(this._coordinates)},_setMarginOffset:function(a){var b=a?a.width:this.getWidth(),c=a?a.height:this.getHeight();this._isHorizCentred()?this._handleHorizontalCentredPlacement(b):this._isVertCentred()?this._handleVerticalCenteredPlacement(c):this._view.setStyle("margin","0px")},_pxToPrecentWidth:function(a){return 100*(a/window.getSize().x)},_pxToPrecentHeight:function(a){return 100*(a/window.getSize().y)},_setTopBottomMargin:function(a,b,c){var d=this._view.style;d.top=a,d.bottom=b,d.margin=c},_setLeftRightMargin:function(a,b,c){var d=this._view.style;d.left=a,d.right=b,d.margin=c},_verticalRelativePlacement:function(a,b){var c=a/2,d=this._pxToPrecentHeight(b-2*this.TOP_STICKY_AREA)/2,e=0-c-this._verticalMargin*c,f=d*this._verticalMargin+50+"%";this._setTopBottomMargin(f,"auto",e+"px 0 0 0")},_bottomStickyVerticalPlacement:function(){var a=this._verticalMargin-1,b=(1-a)*this.TOP_STICKY_AREA;this._setTopBottomMargin("auto",b+"px","0")},_topStickyVerticalPlacement:function(){var a=-1*this._verticalMargin-1,b=(1-a)*this.TOP_STICKY_AREA;this._setTopBottomMargin(b+"px","auto","0")},_horizontalRelativePlacement:function(a,b){var c=a/2,d=this._pxToPrecentWidth(b-2*this.SIDE_STICKY_AREA)/2,e=0-c-this._horizontalMargin*c,f=d*this._horizontalMargin+50+"%";this._setLeftRightMargin(f,"auto","0 0 0 "+e+"px")},_rightStickyHorizontalPlacement:function(){var a=this._horizontalMargin-1,b=(1-a)*this.SIDE_STICKY_AREA;this._setLeftRightMargin("auto",b+"px","0")},_leftStickyHorizontalPlacement:function(){var a=-1*this._horizontalMargin-1,b=(1-a)*this.SIDE_STICKY_AREA;this._setLeftRightMargin(b+"px","auto","0")},_handleVerticalCenteredPlacement:function(a){var b=window.getSize().y;return this._verticalMargin>=-1&&this._verticalMargin<=1?this._verticalRelativePlacement(a,b):this._verticalMargin>1&&this._verticalMargin<=2?this._bottomStickyVerticalPlacement():this._verticalMargin<-1&&this._verticalMargin>=-2?this._topStickyVerticalPlacement():void 0},_handleHorizontalCentredPlacement:function(a){var b=window.getSize().x;return this._horizontalMargin>=-1&&this._horizontalMargin<=1?this._horizontalRelativePlacement(a,b):this._horizontalMargin>1&&this._horizontalMargin<=2?this._rightStickyHorizontalPlacement():this._horizontalMargin<-1&&this._horizontalMargin>=-2?this._leftStickyHorizontalPlacement():void 0},getFullPlacementData:function(){return{placement:this._placement,verticalMargin:this._verticalMargin,horizontalMargin:this._horizontalMargin}},handleResizeWindow:function(a){var b={width:a.msgData.width,height:a.msgData.height};this._changeSize(b,!0),this._setMarginOffset(b),this._setTransitionEndCallback(a.callback,400)},_setTransitionEndCallback:function(a,b){setTimeout(function(){try{a()}catch(b){}},b)},onDataInitialized:function(){var a=this.getComponentProperties(),b=this._appData.widgets[this.getWidgetId()];this._placement=this.DEF_PLACEMENT;try{this._placement=a.get("placement")||b.gluedOptions.placement||this.DEF_PLACEMENT}catch(c){this._placement=this.DEF_PLACEMENT}this._setInitPlacementData(a,b),this._coordinates=this._getGluedWidgetCoordinates()},_setInitPlacementData:function(a,b){var c=a.get("horizontalMargin"),d=a.get("verticalMargin");""===c?(a.set("horizontalMargin",b.gluedOptions.horizontalMargin),this._horizontalMargin=b.gluedOptions.horizontalMargin):this._horizontalMargin=+c,""===d?(a.set("verticalMargin",b.gluedOptions.verticalMargin),this._verticalMargin=b.gluedOptions.verticalMargin):this._verticalMargin=+d},_getGluedWidgetCoordinates:function(){var a,b,c=this.getWidgetId(),d=this._appData.widgets[c];"site"===viewMode?(a=this._view.getAttribute("width")||this.DEF_WIDTH,b=this._view.getAttribute("height")||this.DEF_HEIGHT):(a=d.defaultWidth||this.DEF_WIDTH,b=d.defaultHeight||this.DEF_HEIGHT);var e="auto",f="auto",g="auto",h="auto";switch(this._placement){case"TOP_LEFT":f=0,e=0;break;case"TOP_RIGHT":h=0,e=0;break;case"BOTTOM_RIGHT":h=0,g=0;break;case"BOTTOM_LEFT":f=0,g=0;break;case"TOP_CENTER":e=0,f="50%";break;case"CENTER_RIGHT":e="50%",h=0;break;case"BOTTOM_CENTER":g=0,f="50%";break;case"CENTER_LEFT":f=0,e="50%";break;default:e=0,f="50%"}return{x:a,y:b,top:e,left:f,bottom:g,right:h}},_needToMakeRoomForAd:function(){return!(this._isSideCentered()||this._isHorizCentred()&&this._isTopPositioned())},_makeRoomForAd:function(){if(this._needToMakeRoomForAd()){var a=document.getElementById("wixFooter"),b=a?a.$logic.getAdHeight():{footer:46,top:26};this._isTopPositioned()?this.setY(b.top):this._setCssPosition(b.footer,"bottom")}},_resetAdRePosition:function(){this._needToMakeRoomForAd()&&(this._isTopPositioned()?this.setY(0):this._setCssPosition(0,"bottom"))},_editModeChanged:function(a){console.log("_editModeChanged",a),"PREVIEW"===a?this._makeRoomForAd():this._resetAdRePosition(),"PREVIEW"===a?this._addTransitionClass():this._removeTransitionClass()},canMoveBack:function(){return!1},canMoveForward:function(){return!1},isMultiSelectable:function(){return!1},canMoveToOtherScope:function(){return!0},isDraggable:function(){return!1},isDuplicatable:function(){return!1},getShowOnAllPagesChangeability:function(){return!1},getX:function(){var a=0;return this._isLeftPositioned()?this._isHorizCentred()&&(a=this._view.getPosition().x):this._isRightPositioned()&&(a=this._view.getPosition().x),a},getY:function(){var a=0;return this._isTopPositioned()?this._isVertCentred()&&(a=this._view.getPosition().y):this._isBottomPositioned()&&(a=this._view.getPosition().y),a},getSelectableX:function(){return this.getX()},getSelectableY:function(){return this.getY()},_getPageMargin:function(){var a=this.resources.W.Viewer.getSiteNode(),b=a.getSize();return(window.innerWidth-b.x)/2},_getPageSize:function(){var a=this.resources.W.Viewer.getSiteNode();return a.getSize()},isHorizontallyMovable:function(){return!1},isVerticallyMovable:function(){return!1}})}),define.experiment.newComponent("tpa.viewer.components.TPALinkedinFollow.LinkedinFollow.New",function(a,b){var c=a;c.inherits("tpa.viewer.components.TPAComponent"),c.propertiesSchemaType("TPALinkedinFollowProperties"),c.statics({_linkedinFollowMargins:16,_linkedinFollowWidth:85,_linkedinFollowHeight:20,_counterBesideWidth:53,_counterAboveHeight:42}),c.fields({EDITOR_META_DATA:{general:{title:"LinkedIn Follow",settings:!0,design:!1}},isTpa:!1}),c.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this._resizableSides=[],this._iframeCacheKiller=0},_onDataChange:function(){this.render()},_getUrl:function(){return this._iframeCacheKiller=this._iframeCacheKiller?0:1,this.resources.topology.wysiwyg+"/html/external/linkedinfollow.html?"+this._iframeCacheKiller},_postMessageToIframe:function(){var a=this.getComponentProperties(),b={companyName:a.get("companyName"),dataId:a.get("dataId"),dataCounter:a.get("dataCounter"),language:a.get("language")};this._resizeEditBox(a),this.handleAddEventListener(this._Events.APP_MESSAGE,b)},_resizeEditBox:function(a){var b=this._calculateDimensions(a.get("dataCounter"));this.setWidth(b.width),this.setHeight(b.height)},_calculateDimensions:function(a){var b={};switch(a){case"right":b.width=this._linkedinFollowWidth+this._counterBesideWidth,b.height=this._linkedinFollowHeight;break;case"top":b.width=this._linkedinFollowWidth,b.height=this._linkedinFollowHeight+this._counterAboveHeight;break;default:b.width=this._linkedinFollowWidth,b.height=this._linkedinFollowHeight}return b.width=b.width+this._linkedinFollowMargins,b.height=b.height+this._linkedinFollowMargins,{width:b.width,height:b.height}}})}),define.experiment.Class("tpa.common.managers.TPAManager.TPAScript.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Classes"])),c.fields({worksStack:[]}),c.methods({runScript:function(a,b){this.resources.W.Classes.getClass("wysiwyg.common.managers.scripting.ScriptingWorkerWrapper",function(c){var d=new c(b);this.worksStack[d.getCompId()]=d,d.run(a)}.bind(this))},handlePostMessage:function(a,b){if("string"==typeof a.data){var c="";try{c=JSON.parse(a.data)}catch(d){return}var e=c.type;c&&c.intent&&(c.intent===this.TPA_MESSAGE&&e?this._handleTPAMessage(c,e,b):c.intent===this.APP_MARKET_MESSAGE?this._handleAppMarketMessage(c):c.intent===this.TPA_MESSAGE2&&e&&this._handleTPAMessage2(c,this.getCallerContext(this)))}},getCallerContext:function(a){var b={getCaller:function(a){var b=$(a);return b&&b.getLogic()},sendToCaller:function(b,c){var d=JSON.stringify({intent:a.TPA_RESPONSE,compId:b.compId,callId:b.callId,type:b.type,res:c,status:!0});this.getIFrame().contentWindow.postMessage(d,"*")}};return b},_handleTPAMessage2:function(a,b){var c=b.getCaller(a.compId);if(c)if(Object.contains(this.MessageTypes,a.type)){var d=this._getHandlerFunctionName(a.type),e=c[d];"function"==typeof e?e.call(c,{msgData:a.data,callback:b.sendToCaller.bind(c,a)}):LOG.reportError("Handler function not found - "+a.type,"tpa.viewer.managers.TPA","handlePostMessage2")}else LOG.reportError("Unknown post message type - "+a.type,"tpa.viewer.managers.TPA","handlePostMessage")}})}),define.experiment.component("tpa.viewer.components.TPAPlaceholder.Staff.Wix",function(a){a.fields({propertiesSchemaName:"WPhotoProperties",EDITOR_META_DATA:{general:{title:"App Placeholder",settings:!0,design:!1},custom:[{label:"PHOTO_REPLACE_IMAGE",command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"photos"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.Market",commandParameterDataRef:"SELF"}}})}),define.experiment.newClass("tpa.viewer.managers.TPAWorkerWrapper.TPAScript.New",function(a){var b=a;b.traits(["tpa.viewer.traits.TPAHandlers"]),b.resources(["W.TPA","topology"]),b.statics({TPA_SCRIPT_WORKER:"TPA_Script_Worker",API_URL:"http://wysiwyg.pita.wixpress.com/js-sdk/1.17.0/js/Wix.js"}),b.methods({initialize:function(a){this.forceIframe=a,this.compId=this._createCompId(),this.iframePolyfill()},getCompId:function(){return this.compId},iframePolyfill:function(){(!window.Worker||this.forceIframe)&&(window.Worker=function(a){var b=function(b,c){var d=this,e=function(){f(),h()},f=function(){window.addEventListener?window.addEventListener("message",j,!1):window.attachEvent("onmessage",j)},g=function(){window.removeEventListener?window.removeEventListener("message",j,!1):window.detachEvent("onmessage",j)},h=function(){d.iframeEl=document.createElement("iframe"),d.iframeEl.style.visibility="hidden",d.iframeEl.style.display="none",d.iframeEl.style.width="1px",d.iframeEl.style.height="1px",d.iframeEl.id=c,d.iframeEl.src=[a,"/html/external/worker-iframe.html?compId=",c].join(""),document.body.appendChild(d.iframeEl)},i=function(){d.postMessage(JSON.stringify({compId:c,blob:b}))},j=function(a){var b;try{b=JSON.parse(a.data)}catch(e){return}b.compId===c&&(b.ready?i():b.terminate?d.terminate():b.error&&d.onerror?d.onerror.call(this,b.error):d.onmessage&&d.onmessage.call(this,a))};this.postMessage=function(a){d.iframeEl.contentWindow.postMessage(a,"*")},this.terminate=function(){document.body.removeChild(d.iframeEl),g()},e()};return b}(this.resources.topology.wysiwyg))},run:function(a){var b=this._createBlob(a);this.worker=new Worker(b,this.compId),this.worker.onmessage=this._handlePostMessage.bind(this),this.worker.onerror=this._handlePostMessageError.bind(this)},terminate:function(){this.worker.terminate()},_createBlob:function(a){var b=['wix_sdk_globals ={ compId:"{compId}", workerMode:true };','importScripts("{api}");',"{script}"].join("");return a=this._isUrl(a)?['importScripts("',a,'");'].join(""):["(",a.toString(),")();"].join(""),b=b.substitute({compId:this.compId,api:this.API_URL,script:a}),window.Blob&&!this.forceIframe?window.URL.createObjectURL(new Blob([b])):b},_handlePostMessage:function(a){var b=JSON.parse(a.data);switch(b.intent){case this.resources.W.TPA.TPA_MESSAGE2:this._handleTPAScript(b);break;case this.TPA_SCRIPT_WORKER:this._handleWorkerNativeFunctions(b)}},_handlePostMessageError:function(a){alert("Error: Line "+a.lineno+" in "+a.filename+": "+a.message)},_handleTPAScript:function(a){this.resources.W.TPA._handleTPAMessage2(a,this.getCallerContext())},getCallerContext:function(){var a=this,b={getCaller:function(){return a},sendToCaller:function(b,c){a.worker.postMessage(JSON.stringify({intent:a.resources.W.TPA.TPA_RESPONSE,compId:a.compId,callId:b.callId,type:b.type,res:c,status:!0}))}};return b},_getHandlerFunctionName:function(a){return"handle"+a.capitalize()},_handleWorkerNativeFunctions:function(a){switch(a.func){case"console":console[a.method](a.message);break;case"alert":alert(a.message)}},_isUrl:function(a){var b=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return b.test(a)},_createCompId:function(){return"TPAScript-xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"==a?b:8|3&b;return c.toString(16)})}})}),define.skin("tpa.viewer.skins.TPAModalSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"bg-block",type:Constants.SkinParamTypes.BG_COLOR,mutators:["alpha",75],defaultValue:"#555555"},{id:"tdr",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"},{id:"shd",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"4px 4px 15px rgba(0, 0, 0, 0.4)"},{id:"rd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"3px"}]),b.html('<div skinPart="blockingLayer"></div><div skinpart="dialog"><div skinpart="frameWrap"><iframe skinpart="iframe" src="about:blank" width="100%" height="100%" webkitAllowFullScreen="true" mozallowfullscreen="true" allowfullscreen="allowfullscreen" frameborder="0" scrolling="no" ></iframe><div skinpart="x"></div></div></div>'),b.css(["{ position:fixed; width:100%; height:100%; }","%blockingLayer% { [bg-block]; position:fixed; top:0; bottom:0; left:0; right:0; width:100%; height:100%; overflow:hidden; z-index: 999;}","%dialog% { position:fixed; top: 50%; left:50%; width: 200px; height: 200px; margin-top:-100px; margin-left:-100px; z-index: 1000}%","%frameWrap% { overflow:hidden; background:#fff;  width:100%; height:100%; position: relative; z-index: 1001; [shd] [rd] }","%iframe% { position:absolute; width:100%; height:100%; [rd]}","%x% {position:absolute;  z-index: 1002; top:10px; right:10px; cursor:pointer; background:transparent url([tdr]popup_close_x.png) no-repeat right top; height:24px; width:24px; }"])}),define.skin("tpa.viewer.skins.TPAPopupSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"bg-block",type:Constants.SkinParamTypes.BG_COLOR,mutators:["alpha",75],defaultValue:"#555555"},{id:"tdr",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"},{id:"shd",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"4px 4px 15px rgba(0, 0, 0, 0.4)"},{id:"rd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"3px"}]),b.html('<div skinpart="frameWrap"><div skinpart="x"></div><iframe skinpart="iframe" src="about:blank" width="100%" height="100%" webkitAllowFullScreen="true" mozallowfullscreen="true" allowfullscreen="allowfullscreen" frameborder="0" scrolling="no" style="z-index: 1000;"></iframe></div>'),b.css(["{ background:#fff; overflow:hidden; z-index:999; [shd] [rd] }"," iframe { position: absolute}","%x% {position:absolute; z-index: 1001; top:10px; right:10px; cursor:pointer; background:transparent url([tdr]popup_close_x.png) no-repeat right top; height:24px; width:24px; }"])}),function(){var a=function(a){a.inherits("mobile.core.skins.BaseSkin"),a.html('<iframe  skinpart="iframe" src="about:blank" width="100%" height="100%" webkitAllowFullScreen="true" mozallowfullscreen="true" allowfullscreen="allowfullscreen" frameborder="0" scrolling="no" ></iframe>'),a.css(["{ overflow:hidden; }"," iframe { position: absolute; }"])},b=function(a){a.inherits("mobile.core.skins.BaseSkin"),a.html('<iframe  skinpart="iframe" src="about:blank" width="100%" height="100%" webkitAllowFullScreen="true" mozallowfullscreen="true" allowfullscreen="allowfullscreen" frameborder="0" scrolling="no" ></iframe>'),a.css(["{ overflow:hidden; }"," iframe { position: absolute; }"]),a.skinParams([{id:"color1",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_15"},{id:"color2",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_15"},{id:"color3",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_15"},{id:"color4",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_15"},{id:"color5",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_15"}])};define.skin("tpa.viewer.skins.TPAWidgetSkin",a),define.skin("tpa.viewer.skins.TPA3DGallerySkin",a),define.skin("tpa.viewer.skins.TPA3DCarouselSkin",a),define.skin("tpa.viewer.skins.TPAMasonrySkin",b),define.skin("tpa.viewer.skins.TPAAccordionSkin",b),define.skin("tpa.viewer.skins.TPAImpressSkin",b),define.skin("tpa.viewer.skins.TPAStripSkin",b),define.skin("tpa.viewer.skins.TPAStripSliderSkin",b),define.skin("tpa.viewer.skins.TPAThumbnailsSkin",b)}(),define.Class("tpa.viewer.traits.TPAFullWidthComponent",function(a){a.methods({initFullWidthContainer:function(){this.isFullWidthContainer||(this.isFullWidthContainer=!0,this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.BOTTOM],this._moveDirections=[Constants.BaseComponent.MoveDirections.VERTICAL],this._onScreenResize=this._onScreenResize.bind(this),window.addEventListener("resize",this._onScreenResize,!1))},destroyFullWidthContainer:function(){this.isFullWidthContainer=!1,window.removeEventListener("resize",this._onScreenResize,!1)},isContainable:function(a){return instanceOf(a,this.constructor)},_onScreenResize:function(){clearTimeout(this._resizeTimeoutTickt);var a=this;this._resizeTimeoutTickt=setTimeout(function(){a.getIsDisplayed()&&a.setContainerWidth()},20)},setX:function(){},getX:function(){return 0},setContainerWidth:function(){this._view.style.overflow="visible";var a=this._view.getOffsets().x,b=window.getWidth(),c=this._skinParts.iframe.style;c.position="absolute",c.left=0-a+"px",c.width=b+"px"},getSelectableX:function(){var a=parseInt(this._skinParts.iframe.style.left,10);return a},getSelectableWidth:function(){var a=$(document).getSize().x;return a},render:function(){this.parent(),this.setContainerWidth()},dispose:function(a){this.destroyFullWidthContainer(),this.parent(a)}})}),define.Class("tpa.viewer.traits.TPAHandlers",function(a){var b=a;b.inherits("tpa.common.traits.TPAHandlersBase"),b.statics({DEFAULTS:{POPUP_COORDINATES:{NORMAL:{top:"auto",left:"auto",bottom:"auto",right:"auto",width:500,height:500},MODAL:{top:"50%",left:"50%",bottom:"auto",right:"auto",width:500,height:500}}}}),b.resources(["W.Components","W.Data"]),b.binds(["handleSiteInfo"]),b.methods({initialize:function(){this._datam=this.resources.W.Data},handleHeightChanged:function(a){var b="number"==typeof a?a:a.msgData.height;this.handleChangeAppSize({height:b})},handleChangeAppSize:function(a){(this.injects().Viewer.isPublicMode()||"PREVIEW"===this.injects().Viewer.getEditorMode())&&(a.width=null,a.w=null,a.x=null),this._changeSize(a)},handleAppSettingsClose:function(a){this.handleCloseWindow(a)},handleOpenPopup:function(a){var b,c,d,e,f,g=this.resources.W.Viewer.getSiteNode();c="tpa.viewer.components.TPAPopup",d="tpa.viewer.skins.TPAPopupSkin",f=this._data,e=this._getPopupArgs(a.msgData||a,a.callback),b=this.resources.W.Components.createComponent(c,d,f,e,null,null),b.insertInto(g)},handleOpenModal:function(a){var b=this.resources.W.Viewer.getSiteNode();this._clearModals(b);var c,d,e,f,g,h=a.msgData||a;d="tpa.viewer.components.TPAModal",e="tpa.viewer.skins.TPAModalSkin",g=this._data,f={url:h.url,width:h.width,height:h.height,onClose:a.callback},c=this.resources.W.Components.createComponent(d,e,g,f,null,null),c.insertInto(b)},handleGetSitePages:function(a){var b=this.resources.W.Data.getDataByQuery("#MAIN_MENU"),c=b.getItems()||[],d=this._getSitePages(c);a.callback(d)},handleNavigateToPage:function(a){a.msgData.pageId&&"editor"!==this.resources.W.Viewer.getViewMode()&&this.resources.W.Viewer.goToPage(a.msgData.pageId)},handleSmRequestLogin:function(a){var b=this.injects().SiteMembers;b.isServiceProvisioned()&&(b.isApiReady()?this.injects().Commands.executeCommand("WViewerCommands.SiteMembers.Open",{form:"login",authCallback:a.callback,initiator:this.getAppDefinitionId()||"TPA"}):this.callLater(this.handleSmRequestLogin,a))},handleSmCurrentMember:function(a){var b=this.injects().SiteMembers;b.getMemberDetails(function(b){a.callback(b)},function(){a.callback(null)})},handleScrollBy:function(a){var b=this._getTopWindow();b.scrollBy(a.msgData.x,a.msgData.y)},handleScrollTo:function(a){var b=this._getTopWindow();b.scrollTo(a.msgData.x,a.msgData.y)},_clearModals:function(a){var b=a.getChildren("[comp=tpa.viewer.components.TPAModal]");b.dispose()},_handleOpenPopup:function(a,b,c){var d=this.resources.W.Viewer.getSiteNode();this._clearModals(d);var e,f,g,h,i;f="tpa.viewer.components.TPAPopup",g="tpa.viewer.skins.TPAPopupSkin",i=this._data,h={url:a,width:c.width,height:c.height},e=this.resources.W.Components.createComponent(f,g,i,h,null,null),e.insertInto(d)},_getPopupArgs:function(a,b){return this.isPage?"FIXED":a.position.origin,{dataItem:this._data,url:a.url,origin:a.position.origin,placement:a.position.placement,openPosition:this._view.getPosition(),openSize:this._view.getSize(),popupSize:{x:a.width||200,y:a.height||200},onClose:b}},_getModalCoords:function(a,b){return Object.merge(this.DEFAULTS.POPUP_COORDINATES.MODAL,{width:a,height:b}||{})},_getMetadataParameter:function(a,b){var c=$$("meta["+(b||"name")+"='"+a+"']"),d="";if(c&&c.length>0){var e=c.get("content");e.length>0&&(d=e[0])}return d},_getTopWindow:function(){var a=window;return"preview"===this.resources.W.Viewer.getViewMode()&&(a=window.parent),a}})});