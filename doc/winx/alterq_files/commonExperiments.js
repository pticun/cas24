define.experiment.newComponent("wysiwyg.common.components.horizontalsitemenu.viewer.HorizontalSiteMenu.NBC_SiteMenu.New",function(a,b){var c=a,d=b;c.inherits("wysiwyg.common.components.menuitem.viewer.MenuItem"),c.propertiesSchemaType("HorizontalMenuProperties"),c.dataTypes(["MenuItemDataSchema"]),c.binds(["_onPagesDataChange"]),c.skinParts(d.inherit()),c.methods({initialize:function(a,b,c){this.parent(a,b,c),this._isHorizontal=!1,this._isRootItem=!0},getMenuData:function(){return this.resources.W.Data.getDataByQuery("#MAIN_MENU")},getHrefValue:function(a){return a.get("refId")},_onRender:function(a){this.parent(a),this._updateComponentAccordingToProperties()},_updateComponentAccordingToProperties:function(){var a=this.getComponentProperties();this._skinParts.subMenu.onMenuPropertiesChange(a)},_onPagesDataChange:function(a){var b=this._findChangedItem(a.item);if(a.item=b.item,a.parentItem){var c=this._findChangedItem(a.parentItem);a.parentItem=c.item}var d=this.getDataItem().get("items");switch(a.cause){case"DELETE":return d.splice(b.index,1),this._skinParts.subMenu.deleteItem(a.item),void 0;case"CREATED_AND_ADDED":var e=a.parentItem?d[c.index].get("items"):d;return e.push(a.item),this._skinParts.subMenu.addItem(a.item),void 0;case"MOVE":var f=d;return a.parentItem&&(f=d[c.index].get("items")),d.splice(b.index,1),f.splice(a.newIndex,0,a.item),this._skinParts.subMenu.moveItem(),void 0}}})}),define.resource("horizontalsitemenuSkinMap",{"wysiwyg.common.components.horizontalsitemenu.viewer.skins.HorizontalSiteMenuSkin":{description:"Basic",iconUrl:"/images/wysiwyg/skinIcons/xxx.png",hidden:!1,index:0}}),define.skin("wysiwyg.common.components.horizontalsitemenu.viewer.skins.HorizontalSiteMenuSkin",function(a){var b=a;b.inherits("core.managers.skin.BaseSkin2"),b.iconParams({description:"Basic",iconUrl:"/images/wysiwyg/skinIcons/xxx.png",hidden:!1,index:0}),b.skinParams([]),b.compParts({mainButton:{skin:"wysiwyg.common.components.menuitembutton.viewer.skins.MenuItemButtonSkin"},subMenu:{skin:"wysiwyg.common.components.menuitemlist.viewer.skins.MenuItemListSkin"}}),b.skinParams([]),b.html('<div skinpart="mainButton"></div><div skinpart="subMenu"></div>'),b.css([])}),define.experiment.component("wysiwyg.viewer.components.inputs.NumberInput.EcomExp3.New",function(a){var b=a;b.methods({_onDataChange:function(a,b,c,d){if("text"==b){this._prevValue=d.text,this._origValue=c.text;var e=this._skinParts.input;e.set("value",this._origValue),this._valueChanged=!0}this.parent(a,b,c)}})}),define.experiment.component("wysiwyg.common.components.inputs.OptionsListInput.RichText2.New",function(a){var b=a;b.methods({_changeSelectedItem:function(a){this._selectedItem&&this._selectedItem.setSelected(!1),a&&(this._selectedItem=a,this._selectedItem.setSelected(!0),this._selectedItem.getViewNode().focus())}})}),define.experiment.component("wysiwyg.common.components.inputs.OptionsListInput.RichTextToolbar.New",function(a){var b=a;b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._sequencer=new this.imports.ComponentSequencer,c&&(this._sequencer.resolveItem=function(){var a={comp:c.compType,skin:c.compSkin};return c.compStyleId&&(a.styleId=c.compStyleId),a})}})}),define.experiment.component("wysiwyg.viewer.components.inputs.TextInput.RichTextToolbar.New",function(a,b){var c=a,d=b;c.skinParts({input:{type:"htmlElement"},errorMessage:{type:"htmlElement",optional:!0}}),c.methods({initialize:d.before(function(a,b,c){c&&c.shouldRenderOnDisplay&&this.startRenderingComponentOnDisplay()}),startRenderingComponentOnDisplay:function(){this._renderTriggers.indexOf(Constants.DisplayEvents.DISPLAY_CHANGED)<0&&this._renderTriggers.push(Constants.DisplayEvents.DISPLAY_CHANGED)},_onAllSkinPartsReady:function(){var a=this._skinParts.input;this.addEvent("inputChanged",function(a){this.getDataItem().set("text",a.value)}.bind(this)),this._listenToInput(),this._placeholder&&this._setPlaceholder(this._placeholder),this._isPasswordField&&a.set("type","password"),this.setLabel(this._label)},setError:function(a){this.setValidationState(!1),this._skinParts.errorMessage&&this._skinParts.errorMessage.set("text",a)},setPlaceholder:function(a){this._skinParts.input.set("placeholder",a),window.Modernizr&&!window.Modernizr.input.placeholder&&this._placeholderPolyFill()},render:function(){var a=this._skinParts.input,b=a.get("value"),c=this.getDataItem().get("text");b!=c&&a.set("value",c)},selectText:function(){this._skinParts.input.select()}})}),define.experiment.newComponent("wysiwyg.common.components.menuitem.viewer.MenuItem.NBC_SiteMenu.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.binds(["_onMouseOver","_onMouseOut"]),b.dataTypes(["MenuItemDataSchema"]),b.skinParts({mainButton:{type:"wysiwyg.common.components.menuitembutton.viewer.MenuItemButton",dataRefField:"*"},subMenu:{type:"wysiwyg.common.components.menuitemlist.viewer.MenuItemList",hookMethod:"_setSubMenuData"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._isFirstDataChange=!0,this._isRootItem=!1},_onDataChange:function(a,b,c){this._isRootItem&&this._isFirstDataChange&&this._handleFirstDataChange(),this.parent(a,b,c)},_handleFirstDataChange:function(){this._isFirstDataChange=!1;var a=this.getMenuData();a.addEvent(Constants.DataEvents.DATA_CHANGED,this._onPagesDataChange),this.setDataItem(this._createDataItem(a))},getHrefValue:function(a){return a.get("link").get("href")},_createItemsData:function(a){var b=[];return _(a).forEach(function(a){b.push(this._createDataItem(a))},this),b},_onRender:function(a){this._areAllSkinPartsReady(a)&&this._onAllSkinPartsReady()},_areAllSkinPartsReady:function(a){return a.data.invalidations.getInvalidationByType("skinChange")},_onAllSkinPartsReady:function(){var a,b;this._isRootItem?(a="relative",b="none"):(a="absolute",this._isHorizontal=!0,this._closeDropDown()),this._setStyle(a,b),this._addListeners()},_findChangedItem:function(a){var b,c=this.getHrefValue(a),d=this.getDataItem().get("items");return b=_(d).map(function(a,b){return{item:a,index:b}}).find(function(a){return a.item.get("link").get("href")===c}),b||{item:this._createDataItem(a),index:d.length}},_createDataItem:function(a){var b=this.getHrefValue(a),c=this.resources.W.Data.createDataItem({type:"Link",href:b}),d=W.Utils.getUniqueId(),e={type:"MenuItemDataSchema",items:this._createItemsData(a.get("items")),link:c,id:d};return this.resources.W.Data.createDataItem(e)},_setStyle:function(a,b){var c=this._isHorizontal?"inline-block":"block";this.getViewNode().setStyle("display",c),this._skinParts.subMenu.getViewNode().setStyle("subMenuPosition",a),b&&this._skinParts.mainButton.getViewNode().setStyle("display",b)},_addListeners:function(){this.addEvent("mouseover",this._onMouseOver),this.addEvent("mouseout",this._onMouseOut)},_setSubMenuData:function(a){var b={type:"list",items:this._data.get("items")};return a.dataItem=this.resources.W.Data.createDataItem(b),a},_onMouseOver:function(){var a=this._data.get("items");a.length&&this._openDropDown()},_onMouseOut:function(){this._closeDropDown()},_openDropDown:function(){var a=this._isHorizontal?"block":"inline-block";this._skinParts.subMenu._view.setStyle("display",a)},_closeDropDown:function(){this._skinParts.subMenu._view.setStyle("display","none")}})}),define.experiment.newDataSchema("MenuItemDataSchema.NBC_SiteMenu.New",function(){return{text:"string",link:"object",items:"list"}}),define.resource("menuitemSkinMap",{"wysiwyg.common.components.menuitem.viewer.skins.MenuItemSkin":{description:"Basic",iconUrl:"/images/wysiwyg/skinIcons/xxx.png",index:0}}),define.skin("wysiwyg.common.components.menuitem.viewer.skins.MenuItemSkin",function(a){var b=a;b.inherits("core.managers.skin.BaseSkin2"),b.iconParams({description:"Basic",iconUrl:"/images/wysiwyg/skinIcons/xxx.png",index:0}),b.compParts({mainButton:{skin:"wysiwyg.common.components.menuitembutton.viewer.skins.MenuItemButtonSkin"},subMenu:{skin:"wysiwyg.common.components.menuitemlist.viewer.skins.MenuItemListSkin"}}),b.skinParams([]),b.html('<div skinpart="mainButton"></div><div skinpart="subMenu"></div>'),b.css([])}),define.experiment.newComponent("wysiwyg.common.components.menuitembutton.viewer.MenuItemButton.NBC_SiteMenu.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.resources(["W.Viewer"]),b.binds(["_onSelectionChanged"]),b.dataTypes(["MenuItemDataSchema"]),b.skinParts({label:{type:"htmlElement"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.addEvent("click",this._onSelectionChanged)},_onRender:function(a){this._hasDataChanged(a)&&this._skinParts.label.set("html",this._getButtonLabel())},_hasDataChanged:function(a){return a.data.invalidations.getInvalidationByType("dataChange")},_getButtonLabel:function(){var a=this._data.get("link").get("href").substring(1),b=this.resources.W.Viewer.getPagesData()[a];return b&&b.get("title")},_onSelectionChanged:function(){var a=this._data.get("link").get("href").substring(1);this.resources.W.Viewer.goToPage(a)}})}),define.resource("menuitembuttonSkinMap",{"wysiwyg.common.components.menuitembutton.viewer.skins.MenuItemButtonSkin":{},"wysiwyg.common.components.menuitembutton.viewer.skins.PointerSiteMenuButtonSkin":{}}),define.skin("wysiwyg.common.components.menuitembutton.viewer.skins.MenuItemButtonSkin",function(a){var b=a;b.inherits("core.managers.skin.BaseSkin2"),b.skinParams([{id:"fnt",type:Constants.SkinParamTypes.FONT,defaultTheme:"font_5"},{id:"c",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_5"}]),b.html('<div skinPart="bg"></div><div skinPart="label"></div>'),b.css(["{ cursor:pointer; color:[c]; [fnt] }",":hover  { color:#f00; }","{border: solid 1px red; margin: 0;}","{padding: 5px;}"])}),define.skin("wysiwyg.common.components.menuitembutton.viewer.skins.PointerSiteMenuButtonSkin",function(a){var b=a;b.inherits("core.managers.skin.BaseSkin2"),b.skinParams([{id:"fnt",type:Constants.SkinParamTypes.FONT,defaultTheme:"font_1"},{id:"txt",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_15"},{id:"txth",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_15"},{id:"txts",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_15"},{id:"pad",type:Constants.SkinParamTypes.SIZE,mutators:["increase",10],defaultValue:"5px"},{id:"bgh",type:Constants.SkinParamTypes.BG_COLOR,defaultTheme:"color_17"},{id:"bgs",type:Constants.SkinParamTypes.BG_COLOR,defaultTheme:"color_18"},{id:"trans",type:Constants.SkinParamTypes.TRANSITION,defaultValue:"background-color 0.4s ease 0s"},{id:"trans2",type:Constants.SkinParamTypes.TRANSITION,defaultValue:"color 0.4s ease 0s"}]),b.html('<div class="back"><div skinPart="bg"><div skinPart="label"></div></div></div></div>'),b.css(["{cursor:pointer; }","%.back%{ height:100%; }","%bg%{ background-color:transparent; [trans] }","%label%{ padding: 0 [pad]; color:[txt]; [fnt] [trans2] }",":hover %bg%{ [bgh] [trans] }",":hover %label%{ color:[txth]; [trans2] }","[state=selected] %bg%{ [bgs] [trans] }","[state=selected] %label%{ color:[txts]; [trans2] }"])}),define.experiment.newComponent("wysiwyg.common.components.menuitemlist.viewer.MenuItemList.NBC_SiteMenu.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.resources(["W.Viewer","W.Data"]),b.dataTypes(["list"]),b.utilize(["wysiwyg.viewer.utils.ComponentSequencer"]),b.traits(["wysiwyg.common.components.menuitemlist.viewer.handlers.MenuItemListEventsHandler","wysiwyg.common.components.menuitemlist.viewer.handlers.MenuItemListStyleHandler"]),b.binds(["_onMouseOver","_onMouseOut","_onMouseClick"]),b.states({buttonsAlignment:["buttons-align-right","buttons-align-left","buttons-align-center","buttons-stretch"],textAlignment:["text-align-right","text-align-left","text-align-center"]}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._isHorizontal=!0;var d="wysiwyg.common.components.menuitem.viewer.MenuItem",e="wysiwyg.common.components.menuitem.viewer.skins.MenuItemSkin";this._sequencer=new this.imports.ComponentSequencer,this._sequencer.resolveItem=function(){return{comp:d,skin:e}}},_onRender:function(a){if(this._areAllSkinPartsReady(a)){var b=this.getDataItem().get("items");this._sequencer.createComponents(this.getViewNode(),b)}},_areAllSkinPartsReady:function(a){return a.data.invalidations.getInvalidationByType("skinChange")},onMenuPropertiesChange:function(a){_(a.getSchema()).forEach(function(b,c){this._handlePropertyChange(a,c,a.get(c))},this)},deleteItem:function(a){var b=this.getListButtonElements(),c=a.get("link").get("href"),d=_(b).find(function(a){return a.$logic.getDataItem().get("link").get("href")===c});d&&d.$logic.exterminate()},addItem:function(a){var b=this.getDataItem().get("items");this._sequencer.createComponent(this.getViewNode(),a,b.indexOf(a),b)},moveItem:function(){var a=this.getDataItem().get("items");this._sequencer.createComponents(this.getViewNode(),a)},getListButtonElements:function(){var a=this.getViewNode();return a&&a.getChildren()}})}),define.experiment.newClass("wysiwyg.common.components.menuitemlist.viewer.handlers.MenuItemListEventsHandler.NBC_SiteMenu.New",function(a){var b=a;b.methods({initialize:function(){this._clickCatcher="wysiwyg.common.components.menuitembutton.viewer.MenuItemButton",this._singleItemCompType="wysiwyg.common.components.menuitem.viewer.MenuItem",this._registerEventListeners()},_registerEventListeners:function(){var a=this;this._sequencer.addEvent("productionFinished",function(b){a.fireEvent("optionListInputReady",b)}),this.getViewNode().addEvent("mouseover",this._onMouseOver),this.getViewNode().addEvent("mouseout",this._onMouseOut),this.getViewNode().addEvent("click",this._onMouseClick)},_onMouseOver:function(a){if(a.target!=this._view){var b=this._getTargetComponent(a.target);b.fireEvent("mouseover")}},_onMouseOut:function(a){if(a.target!=this._view){var b=this._getTargetComponent(a.target);this._isNotDescendantOf(a.event.toElement,b._view)&&b.fireEvent("mouseout")}},_onMouseClick:function(a){if(a.target!=this._view){var b=this._getTargetComponent(a.target,this._clickCatcher);b.fireEvent("click")}},_getTargetComponent:function(a,b){for(var c=b||this._singleItemCompType,d=a.$logic;!d||d.$className!==c;)a=a.parentNode,d=a.$logic;return d},_isNotDescendantOf:function(a,b){return!b.contains(a)}})}),define.experiment.newClass("wysiwyg.common.components.menuitemlist.viewer.handlers.MenuItemListStyleHandler.NBC_SiteMenu.New",function(a){var b=a;b.methods({_handlePropertyChange:function(a,b,c){if(a.get("stretchButtonsToMenuWidth")&&"alignButtons"===b)return this.setState("buttons-stretch","buttonsAlignment"),void 0;switch(b){case"alignButtons":return this.setState("buttons-align-"+c,"buttonsAlignment"),void 0;case"alignText":return this.setState("text-align-"+c,"textAlignment"),void 0;case"stretchButtonsToMenuWidth":if(c)this.setState("buttons-stretch","buttonsAlignment"),this._setButtonsWidthForStretchMode();else{var d=a.get("alignButtons");this.setState("buttons-align-"+d,"buttonsAlignment"),this._setButtonsWidthForNoStretchMode()}return}},_setButtonsWidthForStretchMode:function(){var a,b=this.getListButtonElements(),c=b.length;this._buttonsWidthBeforeStretch={},_.forEach(b,function(b){a=b.$logic.getComponentId(),this._buttonsWidthBeforeStretch[a]=b.getWidth(),b.setStyle("width",100/c+"%")},this)},_setButtonsWidthForNoStretchMode:function(){var a,b,c=this.getListButtonElements();this._buttonsWidthBeforeStretch&&(_.forEach(c,function(c){b=c.$logic.getComponentId(),a=this._buttonsWidthBeforeStretch[b],a&&c.setStyle("width",a)},this),this._buttonsWidthBeforeStretch=null)}})}),define.resource("menuitemlistSkinMap",{"wysiwyg.common.components.menuitemlist.viewer.skins.MenuItemListSkin":{description:"Basic",iconUrl:"/images/wysiwyg/skinIcons/xxx.png",index:0},"wysiwyg.common.components.menuitemlist.viewer.skins.PointerSiteMenuSkin":{description:"Basic",iconUrl:"/images/wysiwyg/skinIcons/xxx.png",index:1}}),define.skin("wysiwyg.common.components.menuitemlist.viewer.skins.MenuItemListSkin",function(a){var b=a;b.inherits("core.managers.skin.BaseSkin2"),b.iconParams({description:"Basic",iconUrl:"/images/wysiwyg/skinIcons/xxx.png",index:0}),b.skinParams([]),b.css(["{cursor:pointer; position:relative; border: solid 1px black; padding: 0; margin: 0;}",'[state~="buttons-align-left"] {text-align: left;}','[state~="buttons-align-center"] {text-align: center;}','[state~="buttons-align-right"] {text-align: right;}','[state~="text-align-left"]>* {text-align: left;}','[state~="text-align-center"]>* {text-align: center;}','[state~="text-align-right"]>* {text-align: right;}','[state~="buttons-stretch"] {text-align: justify;}','[state~="buttons-stretch"]:after {content: ""; width: 100%; display: inline-block;}','[state~="buttons-stretch"]>* {float: left; box-sizing: border-box;}'])}),define.skin("wysiwyg.common.components.menuitemlist.viewer.skins.PointerSiteMenuSkin",function(a){var b=a;b.inherits("core.managers.skin.BaseSkin2"),b.iconParams({description:"Basic",iconUrl:"/images/wysiwyg/skinIcons/xxx.png",index:1}),b.compParts({moreButton:{skin:"wysiwyg.viewer.skins.menubutton.PointerMenuButtonSkin",styleGroup:"inherit"},buttonsContainer:{skin:"wysiwyg.editor.skins.richtext.DropDownOptionListSkin"}}),b.skinParams([{id:"bg",type:Constants.SkinParamTypes.BG_COLOR,defaultTheme:"color_11"},{id:"brd",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultTheme:"color_15"},{id:"pos",type:Constants.SkinParamTypes.OTHER,defaultValue:"position:absolute; top:0; bottom:0; left:0; right:0;"}]),b.html('<div class="back"></div><div skinPart="buttonsContainer"></div><div skinPart="moreButton"></div><div skinPart="moreContainer"></div>'),b.css(["%buttonsContainer% { position:relative; }","%.back%{ [bg] [pos] margin-bottom:13px; border-bottom:solid 1px [brd]; }","%moreContainer%{ position: absolute; z-index: 99999;}","%moreContainer% > * { margin-top: 10px; }"])}),define.experiment.newComponent("wysiwyg.common.components.quickcomponent.viewer.QuickComponent.QuickComponent.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.traits(["wysiwyg.common.components.traits.LinkableComponent"]),b.propertiesSchemaType("ButtonProperties"),b.dataTypes(["SiteButton1"]),b.states({button:["up","pressed"],alignment:["center","left","right"]}),b.binds(["hasInvalidations","_setLabelAccordingToData","_setVerticalAlignment","_setHorizontalAlignment","_addEventOn","_onClick","_onMouseDown","_onMouseUp"]),b.skinParts({link:{type:"htmlElement"}}),b.methods({isRenderNeeded:function(a){var b=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.DATA_CHANGE,this.INVALIDATIONS.WIDTH_REQUEST,this.INVALIDATIONS.HEIGHT_REQUEST,this.INVALIDATIONS.PART_SIZE,this.INVALIDATIONS.SIZE];return a.isInvalidated(b)},_onRender:function(a){if(this.hasInvalidations(a,["SKIN_CHANGE"])){var b=this.getViewNode();this._addEventOn(b,Constants.CoreEvents.MOUSE_DOWN,this._onMouseDown),this._addEventOn(b,Constants.CoreEvents.MOUSE_UP,this._onMouseUp),this._addEventOn(b,Constants.CoreEvents.CLICK,this._onClick)}this.hasInvalidations(a,["SKIN_CHANGE","DATA_CHANGE","WIDTH_REQUEST"])&&(this.getDataItem()&&this._setLabelAccordingToData(),this._setHorizontalAlignment()),this.hasInvalidations(a,["SKIN_CHANGE","SIZE","PART_SIZE"])&&this._setVerticalAlignment()},hasInvalidations:function(a,b){for(var c=a.data.invalidations,d=0;d<b.length;++d){var e=b[d],f=this.INVALIDATIONS[e];if(c.getInvalidationByType(f))return!0}return!1},_setLabelAccordingToData:function(){var a=this.getDataItem().get("label");this._skinParts.link.set("html",a)},_setVerticalAlignment:function(){this._setLineHeight()},_setLineHeight:function(){var a=this._skinParts.link,b=parseInt(a.getStyle("font-size"),10),c=this.getHeight(),d=parseInt(a.getStyle("max-height"),10),e=parseInt(a.getStyle("min-height"),10);b>c&&this.setHeight(b),0/0!==d&&e>d&&this.setHeight(d),a.setStyle("line-height",this.getHeight())},_setHorizontalAlignment:function(){var a=this._skinParts.link,b=this.getComponentProperty("align"),c=this.getComponentProperty("margin");a.setStyle("text-align",b),a.setStyle("padding","0 "+c+"px"),a.setStyle("margin","0 -"+c+"px"),this._skinParts.view.setStyle("padding","0 "+c+"px"),this.setState(b,"alignment")},getWidth:function(){return this.getPhysicalWidth()},_onClick:function(a){this.fireEvent(Constants.CoreEvents.CLICK,a)},_onMouseDown:function(a){this.setState("pressed"),this.fireEvent(Constants.CoreEvents.MOUSE_DOWN,a)},_onMouseUp:function(){this.setState("up")},_eventList:[],_addEventOn:function(a,b,c){a.addEvent(b,c),this._eventList.push({name:b,target:a,handler:c})}})}),define.experiment.newDataSchema("SiteButton1.QuickComponent.New",function(){return{"extends":"Link",label:{type:"string","default":"MY BUTTON"},videoId:"string",videoType:"string",option:{isMandatory:"boolean","value:":"string"},label1:{type:"string","default":"HI"},label2:{type:"string","default":"HELLO"}}}),define.experiment.newDataSchema("ButtonProperties.QuickComponent.New",function(){return{align:{type:"string","enum":["left","center","right"],"default":"center",description:"alignment of the menu"},margin:{type:"number","default":10,description:"text left and right margins"}}}),define.resource("quickcomponentSkinMap",{"wysiwyg.common.components.quickcomponent.viewer.skins.QuickButtonShadowLeftSkin":{description:"Shadow Left Button",iconUrl:"/images/wysiwyg/skinIcons/buttons/buttondefault.png",hidden:!1,index:1},"wysiwyg.common.components.quickcomponent.viewer.skins.QuickComponentSkin":{description:"Basic Button",iconUrl:"/images/wysiwyg/skinIcons/buttons/buttondefault.png",hidden:!1,index:0}}),define.skin("wysiwyg.common.components.quickcomponent.viewer.skins.QuickButtonShadowLeftSkin",function(a){var b=a;b.inherits("core.managers.skin.BaseSkin2"),b.iconParams({description:"Shadow Left Button",iconUrl:"/images/wysiwyg/skinIcons/buttons/buttondefault.png",hidden:!1,index:1}),b.skinParams([{id:"tdr",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"},{id:"brw",type:Constants.SkinParamTypes.SIZE,defaultValue:"0"},{id:"brd",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultTheme:"color_15"},{id:"brdh",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultTheme:"color_15"},{id:"bg",type:Constants.SkinParamTypes.BG_COLOR,defaultTheme:"color_17"},{id:"bgh",type:Constants.SkinParamTypes.BG_COLOR,defaultTheme:"color_18"},{id:"txth",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_15"},{id:"txt",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_15"},{id:"rd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0"},{id:"fnt",type:Constants.SkinParamTypes.FONT,defaultTheme:"font_5"},{id:"shd",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 1px 4px rgba(0, 0, 0, 0.6);"},{id:"trans1",type:Constants.SkinParamTypes.TRANSITION,defaultValue:"border-color 0.4s ease 0s ,background-color 0.4s ease 0s"},{id:"trans2",type:Constants.SkinParamTypes.TRANSITION,defaultValue:"color 0.4s ease 0s"},{id:"pos",type:Constants.SkinParamTypes.OTHER,defaultValue:"position:absolute; top:0; bottom:0; left:0; right:0;"}]),b.html(['<div class="shd"></div><a skinPart="link"><span skinPart="label"></span></a>']),b.css(["%link% { [rd][pos][bg][trans1] [shd] border:solid [brd] [brw]; cursor:pointer !important; }","%label% { [fnt][trans2] color:[txt]; white-space:nowrap; margin:-[brw] [brw] 0 [brw]; display:inline-block; position:relative;}","%.shd%  { position:absolute; bottom:-26px; left:-20px; width:165px; height:26px; background:url([tdr]liftedshadow_medium.png) no-repeat 0 0;}",":hover %link% { [bgh] border-color:[brdh]; [trans1] }",":hover %label% { color:[txth]; [trans2] }"])}),define.skin("wysiwyg.common.components.quickcomponent.viewer.skins.QuickComponentSkin",function(a){var b=a;b.inherits("core.managers.skin.BaseSkin2"),b.iconParams({description:"Basic Button",iconUrl:"/images/wysiwyg/skinIcons/buttons/buttondefault.png",hidden:!1,index:0}),b.skinParams([{id:"brw",type:Constants.SkinParamTypes.SIZE,defaultValue:"0"},{id:"brd",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultTheme:"color_15"},{id:"brdh",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultTheme:"color_15"},{id:"bg",type:Constants.SkinParamTypes.BG_COLOR,defaultTheme:"color_17"},{id:"bgh",type:Constants.SkinParamTypes.BG_COLOR,defaultTheme:"color_18"},{id:"txth",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_15"},{id:"txt",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_15"},{id:"rd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0"},{id:"fnt",type:Constants.SkinParamTypes.FONT,defaultTheme:"font_5"},{id:"shd",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 1px 4px rgba(0, 0, 0, 0.6);"},{id:"trans1",type:Constants.SkinParamTypes.TRANSITION,defaultValue:"border-color 0.4s ease 0s ,background-color 0.4s ease 0s"},{id:"trans2",type:Constants.SkinParamTypes.TRANSITION,defaultValue:"color 0.4s ease 0s"},{id:"pos",type:Constants.SkinParamTypes.OTHER,defaultValue:"position:absolute; top:0; bottom:0; left:0; right:0;"}]),b.html('<a skinPart="link"><span skinPart="label"></span></a>'),b.css(["%link% { [rd][pos][bg][trans1] [shd] border:solid [brd] [brw]; cursor:pointer !important; }","%label% { [fnt][trans2] color:[txt]; white-space:nowrap; margin:-[brw] [brw] 0 [brw]; display:inline-block; position:relative;}",":hover %link% { [bgh] border-color:[brdh]; [trans1] }",":hover %label% { color:[txth]; [trans2] }"])}),define.experiment.Class("wysiwyg.common.components.traits.LinkableComponent.PostSignupUrlParam.New",function(a,b){var c=a;c.methods({_handleSpecialCases:function(a,b){switch(b.removeEvents("click"),a){case this.linkType.LOGIN:b.addEvent("click",function(){if(window.animateForm){var a=this.getDataItem(),b=a.get("text");if(b){b=JSON.parse(b);var c=b.postLoginUrl,d=b.postSignupUrl,e=b.type,f="HTML";if(-1!==d.indexOf("ifcontext")){var g=this.resources.W.Utils.getQueryStringParamsAsObject(),h="";_.forOwn(g,function(a,b){"ifcontext"===b.toLowerCase()&&(h=a.replace("#",""),d=/^[a-zA-Z0-9]+$/.test(h)?d.replace("{ifcontext}",h):d.replace("{ifcontext}","illegalContextValue"))})}var i=window.userApi?window.userApi.isSessionValid():!1;i?c&&(window.location.href=c):window.animateForm.callForm([d,c,e,f])}}}.bind(this));break;case this.linkType.ADMIN_LOGIN:b.setStyle("cursor","pointer"),b.addEvent("click",function(){this.injects().Commands.executeCommand("WViewerCommands.AdminLogin.Open")}.bind(this))}}})}),define.experiment.Class("wysiwyg.common.components.traits.LinkableComponent.ViewerRefactor.New",function(a,b){var c=a,d=b;c.resources(d.customizeField(function(a){var b=a.filter(function(a){return"W.Viewer"!==a});return b.push("W.Config"),b})),c.methods({_linkableComponentRender:function(){this._componentOriginalRender&&this._componentOriginalRender();var a=this.resources.W.Utils.linkUtils,b=this.getDataItem();a.renderLinks.call(this,b,this._skinParts.link),this.resources.W.Config.isPreviewMode()&&a.linkableComponentEditModeChanged.call(this,"PREVIEW",b,this._skinParts.link)}})}),define.experiment.Class("wysiwyg.common.utils.TextMigrationHandler.RichTextMigrationStudio.New",function(a){var b=a;b.methods({migrateComponent:function(a){this._changeData(a),this._changeSkin(a);var b=a.getDataItem();if(b&&b.get("text")){var c=this.migrateText(b.get("text"),null,null);return this._hasStyleOverrides&&a.getViewNode().addClass("hasOverrides"),c}return null},migrateText:function(a,b,c){if(this._hasStyleOverrides=!1,b=b||"p",c=c||"font_8","string"!==typeOf(a))return null;if(""===a)return'<{0} class="{1}"></{0}>'.substitute([b,c]);var d=new Element("div");return d.set("html",a),this._hasStyleOverrides=this._stylesMigration.migrateElement(d,b,c),this._simpleMigration.migrateElement(d),d.get("html")}})}),define.experiment.Class("wysiwyg.common.utils.TextStylesMigration.RichTextMigrationStudio.New",function(a){var b=a;b.methods({migrateElement:function(a,b,c){this._hasStyleOverrides=!1;var d=[],e=this._domHelper.collectionToArray(a.childNodes);return e.forEach(function(a){if(this._domHelper.isBlockElement(a)){d.length>0&&(this._applyStyleOnElements(d,b,c),d=[]);var e=!this._changeableTagList.contains(a.tagName.toLowerCase())||this._domHelper.hasBlockElementChildren(a);e?this.migrateElement(a,b,c):this._applyStyleOnBlock(a,b,c)}else d.push(a)},this),d.length>0&&this._applyStyleOnElements(d,b,c),this._hasStyleOverrides},_moveInlineStyleFromOriginalElementToBlockParentElement:function(a,b){var c=this._viewer.theme.getProperty(b),d="core.utils.css.Font"===c.getOriginalClassName();return d&&(a=this._setBlockElementTagAccordingToStyle(a,b)),a},_removeStyleClassesReplaceWithInline:function(a,b){b.map(function(b){var c=this._stylesHelper.getElementStyleClass(b);if(c==a)0===b.childNodes.length?b.destroy():this._removeStyleFromSpan(b,a);else{this._domHelper.removeClass(b,c),0===b.getProperty("class").length&&b.removeAttribute("class");var d=this._setStyleOverrides(a,c,b);d&&(this._hasStyleOverrides=!0)}},this)},_removeStyleFromSpan:function(a,b){a.removeClass(b),this._domHelper.isElementHasAttributes(a)||this._domHelper.replaceElementWithItsChildren(a)},_setStyleOverrides:function(a,b,c){var d=!1,e=this._stylesHelper.getStyleDelta(a,b),f=c;Object.forEach(e,function(a,b){f.setStyle(b,a),d=!0});var g=this._stylesHelper.getColorDelta(a,b);return g?(g.isRef?(f.addClass(g.value),d=!0):(f.setStyle("color",g.value),d=!0),d):d}})}),define.experiment.dataSchema("ContactForm.ContactFormRefactor.New",function(){return{toEmailAddress:{type:"string","default":""},bccEmailAddress:{type:"string","default":""},nameFieldLabel:{type:"string","default":"name Field Label"},emailFieldLabel:{type:"string","default":"email Field Label"},phoneFieldLabel:{type:"string","default":"phone Field Label"},addressFieldLabel:{type:"string","default":"address Field Label"},subjectFieldLabel:{type:"string","default":"subject Field Label"},messageFieldLabel:{type:"string","default":"message Field Label"},submitButtonLabel:{type:"string","default":"submit Button Label"},successMessage:{type:"string","default":"success Message"},errorMessage:{type:"string","default":"error Message"},textDirection:{type:"string","default":"left","enum":["left","right"]},validationErrorMessage:{type:"string","default":"validation Error Message"}}}),define.experiment.newDataSchema("DocumentMedia.DocumentMedia.New",function(){return{"extends":"Image",linkTitle:"string",fileName:"string"}}),define.experiment.newDataSchema("FacebookLikeBoxDataSchema.FacebookLikeBox.New",function(){return{url:{type:"string","default":"wix",description:"Facebook page address"},showFaces:{type:"boolean","default":"true",description:"Show profile photos in the plugin"},colorScheme:{type:"string",colorSchemes:[{name:"light",code:"light"},{name:"dark",code:"dark"}],"default":"light",description:"The color scheme of the plugin. Note that the background is always transparent to match your background color. This setting changes the foreground colors to work well on light or dark backgrounds."},showStream:{type:"boolean","default":"true",description:"Show the profile stream for the public profile"},showBorder:{type:"boolean","default":"true",description:"Show a border around the plugin"},showHeader:{type:"boolean","default":"true",description:'Show the "Find us on Facebook" bar at top. Only shown when either stream or faces are present'}}}),define.experiment.newDataSchema("FacebookShareButton.FacebookShare.New",function(){return{urlChoice:{type:"string","enum":["Current page","Site"],"default":"Current page",description:"Share: current/site url"},label:{type:"string","default":"Share",description:""}}}),define.experiment.newDataSchema("GooglemapEmbeddedDataSchema.GoogleMapEmbedded.New",function(){return{address:{type:"string","default":"10 West 18th St. New york, NY 10011",description:"Address"},addressInfo:{type:"string","default":"Wix Lounge NYC",description:"Address Description"},mapType:{type:"string",mapTypes:[{name:"NORMAL",code:"m"},{name:"TERRAIN",code:"p"},{name:"SATELLITE",code:"k"},{name:"HYBRID",code:"h"}],"default":"NORMAL",description:"map Type"},hostLanguage:{type:"string",languages:[{name:"Basque",code:"eu"},{name:"Catalan",code:"ca"},{name:"Croatian",code:"hr"},{name:"Czech",code:"cs"},{name:"Danish",code:"da"},{name:"Dutch",code:"nl"},{name:"English",code:"en"},{name:"Finnish",code:"fi"},{name:"French",code:"fr"},{name:"German",code:"de"},{name:"Galacian",code:"gl"},{name:"Greek",code:"el"},{name:"Hindi",code:"hi"},{name:"Indonesian",code:"id"},{name:"Italian",code:"it"},{name:"Japanese",code:"ja"},{name:"Norwegian",code:"no"},{name:"Nyorsk",code:"nn"},{name:"Portuguese",code:"pt"},{name:"Rhaeto-Romance",code:"rm"},{name:"Russian",code:"ru"},{name:"Serbian",code:"sr"},{name:"Slovak",code:"sk"},{name:"Slovenian",code:"sl"},{name:"Spanish",code:"es"},{name:"Swedish",code:"sv"},{name:"Thai",code:"th"},{name:"Turkish",code:"tr"},{name:"Ukrainian",code:"uk"},{name:"Vietnamese",code:"vi"}],"default":"English",description:"Host Language"},zoomLevel:{type:"string","default":"14",description:"Zoom Level"},showInformationWindow:{type:"boolean","default":"true",description:"Toggle Information Window Display"}}
}),define.experiment.newDataSchema("HtmlComponent.RefreshFrameOnTransition.New",function(){return{sourceType:"string",url:"string",freezeFrame:"boolean"}}),define.experiment.newDataSchema("ItunesButton.ItunesButton.New",function(){return{downloadUrl:{type:"string","default":"",description:"Insert band URL"}}}),define.experiment.newDataSchema("PinterestFollow.PinterestFollowComponent.New",function(){return{urlChoice:{type:"string","default":"pinterest/",description:""},label:{type:"string","default":"Pinterest",description:""}}}),define.experiment.dataSchema("SiteButton.LinkRefData.New",function(){return{link:{type:"ref","default":null},label:{type:"string","default":"MY BUTTON"}}}),define.experiment.newDataSchema("SiteButton.NBC_SiteButton.New",function(){return{"extends":"Link",label:{type:"string","default":"MY BUTTON"}}}),define.experiment.newDataSchema("VKShareButton.VKShare.New",function(){return{style:{type:"string","enum":["Button","ButtonWithoutCounter","Link","LinkWithoutIcon","Icon"],"default":"Button",description:"the layout of the button"},text:{type:"string","default":"Share",description:"the text of the Button"}}}),define.experiment.Class("wysiwyg.common.managers.LayoutManager.ContainerResizeConstraints.New",function(a){var b=a;b.methods({_getContainerMarginHeight:function(a){return a.getPhysicalHeight()-a.getInlineContentContainer().getSize().y},_getAnchoredH:function(a){var b=a.fromComp.getPhysicalHeight(),c=a.fromComp.getY()+b;return a.locked?c+=a.distance:this.resources.W.Viewer.isPageComponent(a.toComp.getOriginalClassName())||(c+=this.DEFAULT_MARGIN),a.type==a.ANCHOR_BOTTOM_BOTTOM?c-=a.toComp.getY():a.type==a.ANCHOR_BOTTOM_PARENT&&a.toComp.getInlineContentContainer&&this._isInlineContentNonZeroSize(a.toComp)&&(c+=this._getContainerMarginHeight(a.toComp)),c},getComponentMinResizeHeight:function(a){if(a.getHorizontalGroup()){var b=this._findAnchorToComp(a.getHorizontalGroup(),a);return this.getHGroupMinBottom(a.getHorizontalGroup())-a.getY()+b.distance}if(a.getChildComponents){var c=this._getContainerContentHeight(a);return a.getInlineContentContainer&&(c+=this._getContainerMarginHeight(a)),c}return 0},_getContainerContentHeight:function(a){for(var b=0,c=a.getChildComponents(),d=0,e=0;e<c.length;e++)c[e]&&c[e].getLogic&&(d=this._getCompBottom(c[e].getLogic())),b=Math.max(d,b);return b}})}),define.experiment.Class("wysiwyg.common.managers.LayoutManager.ViewerRefactor.New",function(a){var b=a;b.methods({deserializeAnchor:function(a,b){var c=new this._AnchorClass;return c.distance=a.distance||0,c.topToTop=a.topToTop||0,c.originalValue=a.originalValue||0,c.type=a.type,c.toComp=this.resources.W.Viewer.getCompLogicById(a.targetComponent),c.fromComp=b,c.locked=a.locked||!1,c},notifyPositionChanged:function(a,b){var c=a.getLastCoordinates(),d=a.getCurrentCoordinates(),e=a.getLastDimensions(),f=a.getCurrentDimensions(),g=[a.getComponentId()],h=g.map(function(a){return this.resources.W.Viewer.getCompLogicById(a)}.bind(this));if(h[0]){var i=this._getSiblingsYSortedArray(h[0]),j=i.map(function(a){return a.getComponentId()}.bind(this)),k={data:{changedComponentIds:g,ySortedElementIds:j,oldCoordinates:c,newCoordinates:d,oldDimensions:e,newDimensions:f}};this.resources.W.Utils.areObjectsEqual(d,c)&&this.resources.W.Utils.areObjectsEqual(f,e)||this.fireEvent(b,k)}}})}),define.experiment.newClass("wysiwyg.common.managers.ScriptingManager.EditorScripting.New",function(a,b){var c=a;c.inherits("bootstrap.managers.BaseManager"),c.resources(["W.Commands","BrowserUtils","W.Viewer"]),c.utilize(["wysiwyg.common.managers.scripting.ScriptingWorkerWrapper","wysiwyg.common.managers.scripting.ScriptingSimpleModeHandler"]),c.binds(["_onPageNavigation"]),c.methods({initialize:function(){this._scripts=[],this._pageIdsLoaded=[],this._hasScripts=!1,this._isPreviewMode=!1,this._simpleModeHandler=new this.imports.ScriptingSimpleModeHandler;var a=this.resources.BrowserUtils.getQueryParams();this._enable=a.scripting&&!a.scripting[0]?!1:!0,this.resources.W.Commands.registerCommandAndListener("WPreviewCommands.BeforeWEditModeChanged",this,this._onEditModeChanged),this.resources.W.Commands.registerCommandAndListener("WViewerCommands.ComponentNameChanged",this,this._onComponentNameChanged),this.resources.W.Viewer.addEvent("pageTransitionStarted",this._onPageNavigation)},_onPageNavigation:function(a){if(this._hasScripts&&(this.resources.W.Viewer.isPublicMode()||this._isPreviewMode)&&!_.contains(this._pageIdsLoaded,a)){var b=[];0===this._pageIdsLoaded.length&&b.push.apply(b,this.getMasterComponents(this.resources.W.Viewer.getSiteNode().getLogic()));var c=this.resources.W.Viewer.getCompByID(a);c&&c.getLogic&&(this._pageIdsLoaded.push(a),b.push.apply(b,c.getLogic().getContainerComponents([])),_.forEach(b,function(a){this.runScript(a.getComponentNameOrID())}.bind(this)))}},getMasterComponents:function(a,b){b=b||[];var c=a.getChildComponents();return _.forEach(c,function(a){var c=a.getLogic();c&&!this.resources.W.Viewer.isPageComponent(c.className)&&(b.push(c),c.isInstanceOfClass("core.components.Container")&&this.getMasterComponents(c,b))}.bind(this)),b},_createWorker:function(){this._worker&&this.terminateWorker(),this._worker=new this.imports.ScriptingWorkerWrapper,this._worker.run()},getScript:function(a){return this._scripts[a]},getSimpleModeScriptParams:function(a){return this._simpleModeHandler.getSimpleModeScriptParams(a)},getScriptWithSimpleMode:function(a){var b=this.getScript(a),c=this._simpleModeHandler.getScriptWithSimpleMode(a);return b&&c&&(b+=c),b},getAllScripts:function(){return this._scripts},_onEditModeChanged:function(a){if("PREVIEW"===a){this._isPreviewMode=!0;var b=this.resources.W.Viewer.getCurrentPageId();_.contains(this._pageIdLoaded,b)||this._onPageNavigation(b)}else this._worker&&(this._isPreviewMode=!1,this._pageIdsLoaded=[],this._worker&&(this._worker.revertActions(),this.terminateWorker(),this._worker=null))},_onComponentNameChanged:function(a){var b=this._scripts[a.oldName];b&&(this._scripts[a.newName]=b,this._scripts[a.oldName]=null,delete this._scripts[a.oldName])},registerScript:function(a,b){b?(this._scripts[a]=b,b=this._simpleModeHandler.registerSimpleModeParamsFromScript(a,b),this._scripts[a]=b,this._hasScripts=!0):this.unRegisterScript(a)},unRegisterScript:function(a){this._scripts[a]=null,delete this._scripts[a]},registerSimpleModeScriptParams:function(a,b){this._simpleModeHandler.registerSimpleModeScriptParams(a,b)},registerScriptAndRun:function(a,b){this.registerScript(a,b),this.runScript(a)},runScript:function(a){this._enable&&this._scripts[a]&&(this._worker||this._createWorker(),this._worker.executeScript(a,this._scripts[a]))},runAllScripts:function(){this._enable&&Object.keys(this._scripts).forEach(this.runScript.bind(this))},terminateWorker:function(){this._worker&&(this._worker.terminate(),this._worker=null)},getEnable:function(){return this._enable},setEnable:function(a){this._enable=a}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.CustomSiteWidth.New",function(a,b){var c=a,d=b;c.methods({_registerCommands:d.after(function(){var a=this.resources.W.Commands;a.registerCommandAndListener("WViewerCommands.UpdateDocWidth",this,this._updateDocWidth)}),_updateDocWidth:function(a){if(a)return this._setDocWidth(a),void 0;var b=this.injects().Utils.getQueryParam("siteWidthInPixels");if(b)return this._setDocWidth(b),void 0;var c=this._siteStructureData.get("renderModifiers");if(c&&c.siteWidth)return this._docWidth=c.siteWidth,void 0;switch(window.rendererModel&&window.rendererModel.applicationType){case"HtmlFacbook":this._docWidth=520;break;case"HtmlWeb":this._docWidth=980;break;default:this._docWidth=980}},_setDocWidth:function(a){this._docWidth=_.parseInt(a),this._siteStructureData.set("siteWidthInPixels",this._docWidth);var b=this._siteStructureData.get("renderModifiers");b?_.extend(this._siteStructureData.get("renderModifiers"),{siteWidth:this._docWidth}):this._siteStructureData.setFields({siteWidth:this._docWidth}),this._siteStructureData.markDataAsDirty()}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.FixMissingSkins.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Data"])),c.methods({setSite:d.before(function(a){this.resources.W.Data.getDataByQuery("#SKINS",function(b){var c=b.getData().components;this._fixMissingSkinsInCompNodes(a,c)}.bind(this))}),_fixMissingSkinsInCompNodes:function(a,b){var c=a.getElements("[comp]");c.forEach(function(a){var c=a.getAttribute("comp"),d=a.getAttribute("skin"),e=!d||"mobile.core.skins.InlineSkin"==d;if(e){var f=b[c];f&&(a.setAttribute("skin",f[0]),d||LOG.reportError(wixErrors.NO_SKIN,"WViewManager","_fixMissingSkinsInCompNodes",{c1:c,c2:d}))}})}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.FixViewport.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Config"])),c.methods({setSite:d.after(function(){this.resources.W.Config.mobileConfig.isMobile()&&this._setMobileSite()}),_setMobileSite:function(){this.setViewportAttribute("minimum-scale","0.25"),this.setViewportAttribute("maximum-scale","1.2"),window.WQuickActions&&window.WQuickActions.delayedFixZoom()},setViewportAttribute:function(a,b){for(var c=document.getElementById("wixMobileViewport"),d=c.getAttribute("content"),e=d.split(/ *,/),f="",g=!1,h=0;h<e.length;h++){var i=e[h];if(i.indexOf(a)>-1){if(g=!0,!b)continue;i=i.replace(/\ *=.*/,"="+b)}f+=i+","}f=f.substring(0,f.length-1),g||!b?c.setAttribute("content",f):c.setAttribute("content",f+","+a+"="+b)}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.MobileEcomViews.New",function(a,b){var c=a;c.methods({_initZoomIfNeeded:function(a,b){if(W.Config.mobileConfig.isMobile()&&this._zoomComp&&("wysiwyg.viewer.components.MobileMediaZoom"===this._zoomComp.getLogic().$className?a.itemsList&&"ImageList"!==a.itemsList.getType()&&"list"!==a.itemsList.getType()&&(this._zoomComp.destroy(),this._zoomComp=null):a.itemsList&&"ImageList"===a.itemsList.getType()&&"list"!==a.itemsList.getType()&&(this._zoomComp.destroy(),this._zoomComp=null)),this._zoomComp)b&&b(this._zoomComp.getLogic());else{var c=this._getZoomCompSettings(a);this._zoomComp=W.Components.createComponent(c.comp,c.skin,null,null,function(a){a.getViewNode().insertInto(this._siteNode)}.bind(this),b)}},_getZoomCompSettings:function(){var a,b;return W.Config.mobileConfig.isMobile()?(a="wysiwyg.viewer.skins.MobileMediaZoomSkin",b="wysiwyg.viewer.components.MobileMediaZoom"):(a="wysiwyg.viewer.skins.MediaZoomSkin",b="wysiwyg.viewer.components.MediaZoom"),{comp:b,skin:a}}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.MobileSiteWidth.New",function(a,b){var c=a,d=b;c.binds(d.merge(["_handleMobileRotation"])),c.resources(d.merge(["W.Config"])),c.methods({_setMobileSite:function(){this.getDocWidth()===Constants.ViewerTypesParams.DOC_WIDTH.MOBILE?(this._handleMobileRotation(),window.addEventListener("orientationchange",this._handleMobileRotation,!1)):(this.setViewportAttribute("minimum-scale","0.25"),this.setViewportAttribute("maximum-scale","1.2"))},_handleMobileRotation:function(){var a=document.getElementById("wixMobileViewport"),b=Constants.ViewerTypesParams.DOC_WIDTH.MOBILE,c=this.resources.W.Config.mobileConfig.getMobileScreenHeight(),d=this.resources.W.Config.mobileConfig.getMobileScreenWidth(),e=1,f=this.resources.W.Config.mobileConfig.isPortrait();e=f?d/b:c/b;var g=b+1;this._setViewPortTag(a,g,e),setTimeout(function(){this._setViewPortTag(a,b,e)}.bind(this),50)},_setViewPortTag:function(a,b,c){a.setAttribute("content","width="+b+","+"initial-scale="+c+","+"user-scalable="+"no"+", maximum-scale="+c),window.WQuickActions&&window.WQuickActions.delayedFixZoom()}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.MobileZoom.New",function(a,b){var c=a;c.methods({setZoomData:function(a){this._initZoomIfNeeded(a,function(b){this._zoomComp=b.getViewNode(),this._setZoomDataInner(a)}.bind(this))},_initZoomIfNeeded:function(a,b){if(W.Config.mobileConfig.isMobile()&&this._zoomComp&&("wysiwyg.viewer.components.MobileMediaZoom"===this._zoomComp.getLogic().$className?a.itemsList&&"ImageList"!==a.itemsList.getType()&&(this._zoomComp.destroy(),this._zoomComp=null):a.itemsList&&"ImageList"===a.itemsList.getType()&&(this._zoomComp.destroy(),this._zoomComp=null)),this._zoomComp)b&&b(this._zoomComp.getLogic());else{var c=this._getZoomCompSettings(a);this._zoomComp=W.Components.createComponent(c.comp,c.skin,null,null,function(a){a.getViewNode().insertInto(this._siteNode)}.bind(this),b)}},_getZoomCompSettings:function(a){var b,c;return W.Config.mobileConfig.isMobile()&&(a.itemsList&&"ImageList"===a.itemsList.getType()||!a.itemsList&&"string"===typeOf(a.item))?(b="wysiwyg.viewer.skins.MobileMediaZoomSkin",c="wysiwyg.viewer.components.MobileMediaZoom"):(b="wysiwyg.viewer.skins.MediaZoomSkin",c="wysiwyg.viewer.components.MediaZoom"),{comp:c,skin:b}},_getZoomDisplayerCompSettings:function(){var a,b;return W.Config.mobileConfig.isMobile()?(a="wysiwyg.viewer.skins.displayers.MobileMediaZoomDisplayerSkin",b="wysiwyg.viewer.components.MobileMediaZoomDisplayer"):(a="wysiwyg.viewer.skins.displayers.MediaZoomDisplayerSkin",b="wysiwyg.viewer.components.MediaZoomDisplayer"),{comp:b,skin:a}},setViewportAttribute:function(a,b){for(var c=document.getElementById("wixMobileViewport"),d=c.getAttribute("content"),e=d.split(/ *,/),f="",g=!1,h=0;h<e.length;h++){var i=e[h];if(i.indexOf(a)>-1){if(g=!0,!b)continue;i=i.replace(/\ *=.*/,"="+b)}f+=i+","}f=f.substring(0,f.length-1),g?c.setAttribute("content",f):c.setAttribute("content",f+","+a+"="+b)}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.RichTextMigrationStudio.New",function(a,b){var c=a,d=b;c.utilize(d.merge(["wysiwyg.common.utils.TextMigrationHandler"])),c.methods({_wasMasterMigrated:!1,migrateAllRenderedTextComps:function(){this._textMigrationHandler=this._textMigrationHandler||new this.imports.TextMigrationHandler;var a=[];if(this._wasMasterMigrated){var b=this.getCurrentPageNode(),c=b&&b.$logic;c&&(a=c.getPageComponents())}else{var d=this.getSiteNode();a=d.getElements("[comp]").map(function(a){return a.$logic}),this._wasMasterMigrated=!0}return this._migrateTextComponents(a)},_migrateTextComponents:function(a){var b=a.filter(function(a){return"wysiwyg.viewer.components.WRichText"===a.getOriginalClassName()&&"StyledText"!==a.getDataItem().getType()});return this._textMigrationHandler=this._textMigrationHandler||new this.imports.TextMigrationHandler,b.forEach(function(a){var b=this._textMigrationHandler.migrateComponent(a);a.getDataItem().set("text",b)},this),b.length}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.ViewerRefactor.New",function(a,b){var c=a,d=b;c.inherits("bootstrap.managers.BaseManager"),c.utilize(["wysiwyg.managers.appdata.AppDataHandler","wysiwyg.common.managers.viewer.SiteView","wysiwyg.common.managers.viewer.HashChangeHandler","wysiwyg.common.managers.ViewerZoomHandler","wysiwyg.common.managers.SiteMemebersTemp","wysiwyg.viewer.managers.pages.data.DataResolverFactory","wysiwyg.common.managers.viewer.MobileViewHandler","wysiwyg.viewer.utils.PageConfigurationRepository"]),c.traits(["wysiwyg.common.managers.ConfigTemp","wysiwyg.common.managers.ScriptLoaderTemp","wysiwyg.common.managers.ViewerProxy"]),c.resources(["W.Utils","W.Commands"]),c.fields({_isPreview:!1,_appDataHandler:null,_currentViewerName:null}),c.binds(["_onPageNavigation","_onSiteViewReady"]),c.statics({SCREEN_RESIZE_EVENT:d.remove(),FIXED_CONTAINER_ID:"FIXED_CONTAINER"}),c.methods({initialize:function(){this._initMembers(),this._registerPageConfiguration(),this.parent(),this._isReady=!0;var a=W.Utils.getQueryParam("isEdited");"true"===a&&this.setPreviewMode(!0),this._registerCommands(),this.addHeightChangeCallback(function(){return W.Layout.getComponentMinResizeHeight(this.getSiteNode().getLogic())}.bind(this)),this.addEvent("pageTransitionEnded",this._onPageNavigation)},_initMembers:function(){this._currentPageId=this.resources.W.Utils.hash.getHash(),this._currentPageExtData=null,this._fixedContainer=this._addFixedItemsContainer(this.FIXED_CONTAINER_ID),this._zoomHandler=new this.imports.ViewerZoomHandler(this,this._fixedContainer),this._siteMembersHandler=new this.imports.SiteMemebersTemp(this,this._fixedContainer),this._mobileHandler=new this.imports.MobileViewHandler,this._hashChangeHandler=new this.imports.HashChangeHandler(this,this._zoomHandler,this._siteMembersHandler),this._dataResolver=(new this.imports.DataResolverFactory).getDataResolver(),this._pageConfigurationRepository=new this.imports.PageConfigurationRepository,this._loadedViewers={},this._activeViewer_=null},_registerPageConfiguration:function(){this._pageConfigurationRepository.registerPageType("Page",function(a){return a.type}),this._pageConfigurationRepository.registerConfig("Page",{})},initiateSite:function(){var a=this,b=function(b){var c=b?Constants.ViewerTypesParams.TYPES.MOBILE:Constants.ViewerTypesParams.TYPES.DESKTOP;a.switchViewer(c,!0,Constants.ViewerTypesParams.DOC_WIDTH[c]),b&&a._mobileHandler.setMobileSite(c),a._activeViewer_.initiateSite()};W.Config.mobileConfig.isMobile()?this._dataResolver.isStructureExists(Constants.ViewerTypesParams.TYPES.MOBILE).then(b):b(!1)},getCurrentPageId:function(){return this._currentPageId},_setCurrentPageId_:function(a){this._currentPageId=a},getDefaultGetZoomDisplayerFunction:function(a){return this._zoomHandler.getDefaultGetZoomDisplayerFunction(a)},getDefaultGetHashPartsFunction:function(a){return this._zoomHandler.getDefaultGetHashPartsFunction(a)},removeZoomElement:function(){return this._zoomHandler.removeZoomElement()},setPageAsNotValidated:function(a){return this._siteMembersHandler.setPageAsNotValidated(a)},_getDataResolver_:function(){return this._dataResolver},setViewportAttribute:function(a,b){this._mobileHandler.setViewportAttribute(a,b)},getPageConfigurationRepository:function(){return this._pageConfigurationRepository},switchViewer:function(a,b,c){this._activeViewer_&&(this._activeViewer_.getSiteNode().$logic.collapse(),this.removeEventPropagation());var d=this._loadedViewers[a];this._currentViewerName=a,d&&b&&d.dispose(),(!d||b)&&(this._loadedViewers[a]=new this.imports.SiteView(this,this._dataResolver),this._loadedViewers[a].addEvent("SiteReady",this._onSiteViewReady),this._loadedViewers[a]._updateDocWidth(c)),this._activeViewer_=this._loadedViewers[a],this._activeViewer_.getSiteNode()&&(this._activeViewer_.getSiteNode().$logic.uncollapse(),this._activeViewer_.isSiteReady()&&this._onSiteViewReady()),this.propagateEvents()},_onSiteViewReady:function(){this._activeViewer_.removeEvent("SiteReady",this._onSiteViewReady),this._currentPageId=this._currentPageId||this.getHomePageId();var a=this.resources.W.Utils.hash.getHashParts().extData;this._activeViewer_.changePageWithTransition(this._currentPageId),this._activeViewer_._onPageExtraDataChange_(a,this._currentPageId,!1),W.Commands.executeCommand("WViewerCommands.SelectedPageChanged",this._currentPageId)},getViewerMode:function(){return this._currentViewerName},getSiteView:function(a){return this._loadedViewers[a]},_registerCommands:function(){var a=this.resources.W.Commands;a.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onEditModeChanged)},goToPage:function(a,b){var c=W.Data.getDataByQuery("#"+a);c&&this._siteMembersHandler.checkRequireLogin(c,function(){this._hashChangeHandler._setUrlHashToPage(a,b)}.bind(this))},_addFixedItemsContainer:function(a){var b=new Element("div",{id:a});return document.body.adopt(b),b},getAppDataHandler:function(){return this._appDataHandler||(this._appDataHandler=new this.imports.AppDataHandler),this._appDataHandler},setSite:function(){},_scrollToTopOnPageChange:function(){this._isPageScrollToTopEnabled&&(this._isPreview?(this.getSiteNode().setStyle("top","0px"),$(document.body).setStyle("background-position","0px 0px")):$(document.body).scrollTo(0,0))},setPreviewMode:function(a){this._isPreview=a,a&&document&&document.body&&$(document.body).addClass("prevMode")},enterFullScreenMode:function(){if(!this._isFullScreen){var a=this.getPreviewMode()?$(window.parent.document.body):$(document.body);this._originalBodyOverflow=a.getStyle("overflow"),a.setStyle("overflow","hidden"),this._isFullScreen=!0,this._currentPageExtData=this.resources.W.Utils.hash.getHashParts().extData}},exitFullScreenMode:function(){if(this._isFullScreen){this.getCurrentPageId()?this._hashChangeHandler._setUrlHashToPage(this.getCurrentPageId(),this._currentPageExtData):this.goToHomePage();var a=this.getPreviewMode()?$(window.parent.document.body):$(document.body);a.setStyle("overflow",this._originalBodyOverflow),this._isFullScreen=!1}},_onPageNavigation:function(a){this._setDocumentTitle(a),this.resources.W.Commands.executeCommand("WViewerCommands.MediaZoom.Close")},_setDocumentTitle:function(a){var b="",c=this.getPagesData()[a],d=c.get("pageTitleSEO")||"",e=c.get("title")||"",f=this.getSiteTitleSEO()||"",g=this.isHomePage(a);d?b=d:(b=f,g||(b+=b?" | ":"",b+=e)),b&&(document.title=b)},_onEditModeChanged:function(a){this._editorMode=a},isPageComponent:function(a){return"mobile.core.components.Page"===a||"core.components.Page"===a||"wixapps.integration.components.AppPage"===a},getEditorMode:function(){return this._editorMode},getPreviewMode:function(){return!!this._isPreview},setLinkTipFunc:function(a){this._linkTipFunc=a},getLinkTipFunc:function(){return this._linkTipFunc},setAdData:function(a){this._adData=a},getAdData:function(){return this._adData},clone:function(a){return this.parent(a)},isReady:function(){return this._isReady},getScrollTop:function(){return document.body.scrollTop},getActiveViewerHeightFromCallback:function(){if(!this._heightChangeCallbacks)return 0;var a,b=0;for(a=0;a<this._heightChangeCallbacks.length;a++)b+=this._heightChangeCallbacks[a]();return b},createElement:function(a,b){return new Element(a,b)},addPage:function(a){this._dataResolver.addPage(a)},removePage:function(a){this._dataResolver.removePage(a)},getSiteTitleSEO:d.remove(),isPremiumUser:d.remove(),_updateDocWidth:d.remove(),_pageTransition:d.remove(),getDocWidth:d.remove(),indexPages:d.remove(),_getPageElements:d.remove(),getPages:d.remove(),_fixPagesOrderByNewMenuData:d.remove(),_fireScreenResizeEvent:d.remove(),_onSiteReady:d.remove(),_notifySiteReadyForThumbnail:d.remove(),_getHeightFromCallback:d.remove(),getSiteHeight:d.remove(),setAdHeight:d.remove(),getLinkablePagesData:d.remove(),siteHeightChanged:d.remove(),_postHeightMessage:d.remove(),addOrientationEvent:d.remove(),getPageGroup:d.remove(),_openAdminLogin:d.remove(),removeMediaZoom:d.remove(),_setMediaZoomDataInner:d.remove(),_onHashChange:d.remove(),_onHashDataItemIdChange:d.remove(),_isPageDataType:d.remove(),_onPageExtraDataChange:d.remove(),_setUrlHashToPage:d.remove(),_handleValidHashChange:d.remove(),_getZoomDisplayerCompSettings:d.remove(),_setZoomData:d.remove(),_setZoomDataInner:d.remove(),_initZoomIfNeeded:d.remove(),_getZoomCompSettings:d.remove(),_closeSiteMembersPopup:d.remove(),_openPasswordLogin:d.remove(),_closePasswordLogin:d.remove(),_changePageFromHash:d.remove(),getPageData:d.remove(),getSiteName:d.remove(),_checkRequireLogin:d.remove(),_onAuthCallback:d.remove(),_getFallbackPage:d.remove(),_setPageValidated:d.remove(),_isProtectedPageValidated:d.remove(),getCompByID:d.remove(),getElementBySelector:d.remove(),getCompLogicBySelector:d.remove(),getCompLogicById:d.remove(),getPagesContainer:d.remove(),getFooterContainer:d.remove(),getHeaderContainer:d.remove(),getPageGroupElement:d.remove()})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.WixAppsPage.New",function(a,b){var c=a,d=b;c.utilize(d.merge(["wysiwyg.viewer.utils.PageConfigurationRepository"])),c.methods({initialize:d.after(function(){this._pageConfigurationRepository=new this.imports.PageConfigurationRepository,this._pageConfigurationRepository.registerPageType("Page",function(a){return a.type}),this._pageConfigurationRepository.registerConfig("Page",{})}),getPageConfigurationRepository:function(){return this._pageConfigurationRepository},isPageComponent:function(a){return"mobile.core.components.Page"===a||"core.components.Page"===a||"wixapps.integration.components.AppPage"===a},_getPageElements:function(a){var b=a.getElements("[comp$=Page]");return _.filter(b,function(a){return this.isPageComponent(a.getAttribute("comp"))}.bind(this))},getAppPages:function(){var a={};return Object.each(W.Viewer.getPages(),function(b){var c=b.getLogic(),d=c.getDataItem(),e=d.getData();if("AppPage"===e.type||"AppBuilderPage"===e.type){var f=d.get("appPageId");a[f]=c}}),a},goToPage:function(a,b){var c=this._pagesData[a];this._checkRequireLogin(c,function(){var c=W.Viewer.getPages()[a],d=c.getLogic(),e=d._data.get("pageUriSEO");W.Utils.hash.setHash(a,e,b)}.bind(this))},_onTransitionFinished:function(){},_changePageFromHash:function(a){if(!this._scrollLock){null!==this._stopAnimation&&this._stopAnimation.stop(),this._scrollToTopOnPageChange();var b=this._getPageDataFromHash(a);if(null!==b){var c=b.get("id");c!=this._currentPageId&&this._checkRequireLogin(b,function(){c&&(("preview"===window.viewMode||"editor"===window.viewMode)&&LOG.reportEvent(wixEvents.USER_MOVED_BETWEEN_PAGES,{c1:b._data&&b._data.pageUriSEO||"no-page-url"}),this._pageTransition(c))}.bind(this))}}},getLinkablePagesData:function(){return Object.filter(this._pagesData,function(a){return"AppPage"!=a.getType()})},_isPageDataType:function(a){return"Page"===a||"AppPage"==a},_onPageExtraDataChange:function(a,b,c){var d=this._getPageDataFromHash(b);switch(d.get("type")){case"Page":if(this.resources.W.TPA.setPageState(b,a),c)return;var e=d.get("tpaApplicationId"),f=this.resources.W.TPA.getComponentRegistrar().getSection(e);f&&f._updateIframe(!0);break;case"AppPage":if(c)return;var g=W.Viewer.getPages()[b],h=g.getLogic();a||(a=""),h.updateParamsFromExtraData(a)}},_setUrlHashToPage:function(a){var b=this._pagesData[a];if(b){var c=W.TPA.getPageState(a);W.Utils.hash.setHash(a,b.get("pageUriSEO"),c)}}})}),define.experiment.newClass("wysiwyg.common.managers.scripting.ScriptingComponentHandler.EditorScripting.New",function(a,b){var c=a;c.resources(["W.Viewer","W.Theme","W.Commands"]),c.statics({PREVIEW_ID:"live-preview-iframe",Events:{CLICK:"click",DBLCLICK:"dblclick",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave"}}),c.methods({initialize:function(a){this._comp=a,this._events={},this._undo={}},handleScript:function(a,b,c){var d=this._getHandlerFunctionName(a),e=this[d];"function"==typeof e&&e.call(this,b,c)},clean:function(){_.forEach(this._events,function(a,b){this._removeEvent(b)}.bind(this)),this._undo=[]},_removeEvent:function(a){this._events[a]&&(this._comp.getViewNode().removeEvent(a,this._events[a]),this._events[a]=null,delete this._events[a])},revertActions:function(){_.forEach(this._undo,function(a,b){a(),this._undo[b]=null,delete this._undo[b]}.bind(this)),this._undo={}},getData:function(){return this._comp.getPosition()},_addUndoAction:function(a,b){this.resources.W.Viewer.isPublicMode()||this._undo[a]||(this._undo[a]=b)},_getHandlerFunctionName:function(a){return"_handle"+a.capitalize()},_handleGetY:function(a,b){b(this._comp.getY())},_handleSetY:function(a,b){this._addUndoAction("setY",function(a){this._comp.setY(a)}.bind(this,this._comp.getY())),this._comp.setY(a.y),b()},_handleGetX:function(a,b){b(this._comp.getX())},_handleSetX:function(a,b){this._addUndoAction("setX",function(a){this._comp.setX(a)}.bind(this,this._comp.getX())),this._comp.setX(a.x),b()},_handleGetWidth:function(a,b){b(this._comp.getWidth())},_handleSetWidth:function(a,b){this._addUndoAction("setWidth",function(a){this._comp.setWidth(a)}.bind(this,this._comp.getWidth())),this._comp.setWidth(a.width),b()},_handleGetHeight:function(a,b){b(this._comp.getHeight())},_handleSetHeight:function(a,b){this._addUndoAction("setHeight",function(a){this._comp.setHeight(a)}.bind(this,this._comp.getHeight())),this._comp.setHeight(a.height),b()},_handleShow:function(a,b){this._comp.show(),b()},_handleHide:function(a,b){this._addUndoAction("hide",function(){this._comp.show()}.bind(this)),this._comp.hide(),b()},_handleToggle:function(a,b){this._comp.getViewNode().isDisplayed()?this._comp.getViewNode().hide():this._comp.getViewNode().show(),b()},_handleFadeIn:function(a,b){this._comp.getViewNode().setStyle("opacity","0"),this._comp.show(),this._comp.getViewNode().tween("opacity",1),b()},_handleFadeOut:function(a,b){this._addUndoAction("fadeOut",function(){this._comp.show(),this._comp.getViewNode().setStyle("opacity","1")}.bind(this)),this._comp.getViewNode().tween("opacity",0),b()},handleSlideIn:function(a,b){this._comp.getViewNode().reveal(),b()},_handleSlideOut:function(a,b){this._addUndoAction("slideOut",function(){this._comp.getViewNode().reveal()}.bind(this)),this._comp.getViewNode().dissolve(),b()},_handleGetPosition:function(a,b){b(this._comp.getPosition())},_handleTweenRun:function(a,b){this._comp.tween&&(this._comp.tween.kill(),TweenLite.killTweensOf(this._comp.getViewNode()),this._comp.tween=null);var c=a.duration||1;delete a.duration,a.onComplete=b,this._comp.tween=TweenLite.to(this._comp.getViewNode(),c,a),this._addUndoAction("tweenRun",function(){this._comp.tween.totalDuration(0),this._comp.tween.reverse(),this._comp.tween.kill(),TweenLite.killTweensOf(this._comp.getViewNode()),this._comp.tween=null}.bind(this))},_handleTweenPause:function(a,b){this._comp.tween&&this._comp.tween.pause(),b()},_handleTweenResume:function(a,b){this._comp.tween&&this._comp.tween.resume(),b()},_handleTweenReverse:function(a,b){this._comp.tween&&this._comp.tween.reverse(),b()},_handleSetStyle:function(a,b){this.resources.W.Theme.getStyle(a.styleId,function(a){this._comp.setStyle(a),b()})},_handleSetData:function(a,b){this._addUndoAction("setData"+a.key,function(a,b){this._comp.getDataItem().set(a,b)}.bind(this,a.key,this._comp.getDataItem().get(a.key))),this._comp.getDataItem().set(a.key,a.value),b()},_handleAddEvent:function(a,b){var c=this.Events[a.eventName];if(c&&!this._events[c]){var d=this._comp.getComponentNameOrID(),e=function(a,b){this.resources.W.Commands.executeCommand("WScriptingCommands.TriggerEvent",{eventName:a,params:null,compId:b},this)}.bind(this,a.eventName,d);this._events[c]=e,this._comp.getViewNode().addEvent(c,e)}b()},_handleRemoveEvent:function(a,b){this._removeEvent(this.Events[a.eventName]),b()}})}),define.experiment.newClass("wysiwyg.common.managers.scripting.ScriptingComponentManager.EditorScripting.New",function(a,b){var c=a;c.resources(["W.Viewer","W.Theme","scriptLoader"]),c.utilize(["wysiwyg.common.managers.scripting.ScriptingComponentHandler"]),c.statics({PREVIEW_ID:"live-preview-iframe",Events:{CLICK:"click",DBLCLICK:"dblclick",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave"}}),c.methods({initialize:function(){this._componets={},"undefined"==typeof TweenLite&&(this.resources.scriptLoader.loadResource({url:"http://cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/CSSPlugin.min.js"}),this.resources.scriptLoader.loadResource({url:"http://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenLite.min.js"}))},handleScript:function(a,b,c,d){var e=this._getComponentHandler(a);e&&e.handleScript(b,c,d)},_getComponentHandler:function(a){return this._componets[a]||this._createComponentHandler(a)},_createComponentHandler:function(a){var b=null,c=this.resources.W.Viewer,d=c.getElementBySelector('div[compName="'+a+'"]');return d||(d=c.getCompByID(a)),d&&d.$logic&&d.$logic.isReady()&&(b=this._componets[a]=new this.imports.ScriptingComponentHandler(d.$logic)),b},revertComponentActions:function(){_.forEach(this._componets,function(a){a.revertActions()})},getComponentData:function(a){var b=this._getComponentHandler(a);return b?b.getData():null},clean:function(){_.forEach(this._componets,function(a,b){a.clean(),this._componets[b]=null,delete this._componets[b]}.bind(this))}})}),define.experiment.newClass("wysiwyg.common.managers.scripting.ScriptingSimpleModeHandler.EditorScripting.New",function(a,b){var c=a;
c.methods({initialize:function(){this._simpleModeParams=[]},getSimpleModeScriptParams:function(a){return this._simpleModeParams[a]},getScriptWithSimpleMode:function(a){var b="",c=this.getSimpleModeScriptParams(a);return c&&(b+="/*simpleModeStart"+JSON.stringify(c)+"simpleModeEnd*/"),b},registerSimpleModeParamsFromScript:function(a,b){return b=b.replace(/\/\*simpleModeStart\{.*\}simpleModeEnd\*\//g,this._onSimpleModeFound.bind(this,a))},_onSimpleModeFound:function(a,b){var c=JSON.parse(b.match(/{.*}/g)[0]);return this.registerSimpleModeScriptParams(a,c),""},registerSimpleModeScriptParams:function(a,b){this._simpleModeParams[a]=b}})}),define.experiment.newClass("wysiwyg.common.managers.scripting.ScriptingWorkerWrapper.EditorScripting.New",function(a){var b=a;b.utilize(["wysiwyg.common.managers.scripting.ScriptingComponentManager","tpa.viewer.traits.TPAHandlers"]),b.resources(["topology","W.Viewer","W.Commands"]),b.binds(["_onPageNavigation","_onSiteReady","_handlePostMessage","_handlePostMessageError"]),b.statics({Intent:{TPA:"TPA2",TPA_RESPONSE:"TPA_RESPONSE",NATIVE:"NativeScript",TRIGGER_EVENT:"TriggerEvent",COMPONENT:"ComponentScript",RUN_SCRIPT:"Run_Script",GET_COMPONENT:"GET_COMPONENT"}}),b.methods({initialize:function(a,b){this._workerId=a||this._createWorkerId(),this._forceIframe=b,this._componentHandler=new this.imports.ScriptingComponentManager,this._tpaHandler=new this.imports.TPAHandlers,this._iframePolyfill(),this._bindEvents()},run:function(a){var b=this._createBlob(a||"");this._worker=new Worker(b,this._workerId),this._worker.onmessage=this._handlePostMessage,this._worker.onerror=this._handlePostMessageError},executeScript:function(a,b){var c=this._componentHandler.getComponentData(a);this._sendMessage({intent:this.Intent.RUN_SCRIPT,workerId:this._workerId,script:b.toString(),compId:a,compData:c})},_onTriggerCommand:function(a){this.triggerEvent(a.eventName,a.params,a.compId)},triggerEvent:function(a,b,c){this._sendMessage({intent:this.Intent.TRIGGER_EVENT,workerId:this._workerId,eventType:a,compId:c,params:b})},terminate:function(){this._worker.terminate(),this._componentHandler.clean(),this._unBindEvents()},_createBlob:function(a){var b=['wix_sdk_globals ={ workerId:"{workerId}", workerMode:true };','importScripts("{api}");',"{script}"].join("");return a&&(a=this._isUrl(a)?['importScripts("',a,'");'].join(""):["(",a.toString(),")();"].join("")),b=b.substitute({workerId:this._workerId,api:this.resources.topology.wysiwyg+"/html/external/scripting/Wix-Scripting.js",script:a}),window.Blob&&!this._forceIframe?window.URL.createObjectURL(new Blob([b])):b},_bindEvents:function(){this.resources.W.Viewer.addEvent("pageTransitionEnded",this._onPageNavigation),this.resources.W.Viewer.addEvent("SiteReady",this._onSiteReady),this.resources.W.Commands.registerCommandAndListener("WScriptingCommands.TriggerEvent",this,this._onTriggerCommand)},_unBindEvents:function(){this.resources.W.Viewer.removeEvent("pageTransitionEnded",this._onPageNavigation),this.resources.W.Viewer.removeEvent("SiteReady",this._onSiteReady),this.resources.W.Commands.getCommand("WScriptingCommands.TriggerEvent").unregisterListener(this)},_onPageNavigation:function(a){this.triggerEvent("PAGE_NAVIGATION",{pageId:a})},_onSiteReady:function(){this.triggerEvent("SITE_READY")},getWorkerId:function(){return this._workerId},_iframePolyfill:function(){(!window.Worker||this._forceIframe)&&(window.Worker=function(a){var b=function(b,c){function d(){e(),g()}function e(){window.addEventListener?window.addEventListener("message",i,!1):window.attachEvent("onmessage",i)}function f(){window.removeEventListener?window.removeEventListener("message",i,!1):window.detachEvent("onmessage",i)}function g(){j.iframeEl=document.createElement("iframe"),j.iframeEl.style.visibility="hidden",j.iframeEl.style.display="none",j.iframeEl.style.width="1px",j.iframeEl.style.height="1px",j.iframeEl.id=c,j.iframeEl.src=[a,"/html/external/scripting/worker-iframe.html?workerId=",c].join(""),document.body.appendChild(j.iframeEl)}function h(){j.iframeEl.contentWindow.postMessage(JSON.stringify({workerId:c,blob:b}),"*")}function i(a){var b;try{b=JSON.parse(a.data)}catch(d){return}b.workerId===c&&(b.initialized?h():b.ready?(k=!0,l.forEach(function(a){j.postMessage(a)}.bind(j)),l=[]):b.terminate?j.terminate():b.error&&j.onerror?j.onerror.call(this,b.error):j.onmessage&&j.onmessage.call(this,a))}var j=this,k=!1,l=[];this.postMessage=function(a){k?j.iframeEl.contentWindow.postMessage(a,"*"):l.push(a)},this.terminate=function(){j.iframeEl&&(document.body.removeChild(j.iframeEl),j.iframeEl=null),f()},d()};return b}(this.resources.topology.wysiwyg))},revertActions:function(){this._componentHandler.revertComponentActions()},_handlePostMessage:function(a){var b=JSON.parse(a.data);if(b&&b.workerId===this._workerId)switch(b.intent){case this.Intent.TPA:this._handleTPAScript(b);break;case this.Intent.NATIVE:this._handleWorkerNativeFunctions(b);break;case this.Intent.COMPONENT:this._handleComponentMessage(b);break;case this.Intent.GET_COMPONENT:this._handleGetComponent(b)}},_handleGetComponent:function(a){var b=this._componentHandler.getComponentData(a.data.compId);this._sendMessage({intent:this.Intent.GET_COMPONENT,workerId:this._workerId,compId:a.data.compId,compData:b,callId:a.callId})},_handlePostMessageError:function(a){alert("Error: Line "+a.lineno+" in "+a.filename+": "+a.message),console.log(a)},_handleTPAScript:function(a){var b=this._getHandlerFunctionName(a.type),c=this._tpaHandler[b];"function"==typeof c&&c.call(this._tpaHandler,{msgData:a.data,callback:this._sendToCaller.bind(this,a)})},_handleComponentMessage:function(a){this._componentHandler.handleScript(a.compId,a.type,a.data,this._sendToCaller.bind(this,a),this)},_sendToCaller:function(a,b){this._sendMessage({intent:this.Intent.TPA_RESPONSE,workerId:this._workerId,callId:a.callId,type:a.type,res:b})},_sendMessage:function(a){this._worker.postMessage(JSON.stringify(a))},_handleWorkerNativeFunctions:function(a){switch(a.func){case"console":console[a.method](a.message);break;case"alert":alert(a.message)}},_getHandlerFunctionName:function(a){return"handle"+a.capitalize()},_isUrl:function(a){var b=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return b.test(a)},_createWorkerId:function(){return"WorkerScript-xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"==a?b:8|3&b;return c.toString(16)})}})}),define.experiment.newClass("wysiwyg.common.managers.ConfigTemp.ViewerRefactor.New",function(a){var b=a;b.methods({getSiteTitleSEO:function(){return window.rendererModel.siteTitleSEO},isPremiumUser:function(){var a=window.rendererModel;return a&&a.premiumFeatures?a.premiumFeatures.length>0:!1},getViewMode:function(){return window.viewMode},_isInViewer:function(){return"editor"!==this.getViewMode()},_getSiteViewMode:function(){var a=window.viewMode;return"preview"===a&&window.top===window?"site":a},isPublicMode:function(){return"site"===this._getSiteViewMode()},getSiteName:function(){return window.rendererModel.siteName||""},_getUrlSearchParameters:function(){return window.location.search}})}),define.experiment.newClass("wysiwyg.common.managers.viewer.HashChangeHandler.ViewerRefactor.New",function(a){var b=a;b.binds(["_onHashChange"]),b.resources(["W.Utils","W.Config","W.Commands","W.TPA","W.Data"]),b.methods({initialize:function(a,b,c){this._viewer=a,this._zoomHandler=b,this._siteMembersHandler=c,this.resources.W.Utils.hash.addEvent("change",this._onHashChange)},getCurrentPageId:function(){return this._currentPageId},_onHashChange:function(a){if(a=a||{},this._viewer.isSiteReady()){var b=a.newHash,c=a.extData,d=a.isIdChanged,e=a.isExtDataChanged,f=a.silent,g=this._zoomHandler.isZoomOpened();if("zoom"===b||W.Data.isDataAvailable("#"+b)||(b=this._viewer.getHomePageId()),d&&!f&&b&&("zoom"===b&&(b=c.split("/")[1]),W.Data.getDataByQuery("#"+b,function(a){this._onHashDataItemIdChange(b,a)}.bind(this)),a.isForSureAfterChange&&LOG.reportPageEvent(window.location.href)),e)if(g)this._zoomHandler.showItemInOpenedZoom();else{var h=this._viewer.getCurrentPageId();this._viewer._activeViewer_._onPageExtraDataChange_(c,h,f)}}},_onHashDataItemIdChange:function(a,b){var c=b.getType&&b.getType();return this._isPageDataType(c)&&a?(this._changePageFromHash(b),void 0):("Image"===c?this.resources.W.Commands.executeCommand("WViewerCommands.OpenZoom",{item:"#"+b.get("id"),getDisplayerDivFunction:this._zoomHandler.getDefaultGetZoomDisplayerFunction("Image")},this):"PermaLink"===c&&"ListsApps"===b.get("appType")&&W.Apps.openPermaLink(b),void 0)},_isPageDataType:function(a){return"Page"===a||"AppPage"==a},_changePageFromHash:function(a){if(null!==a&&this._isPageVisible(a)){var b=a.get("id");b!==this._viewer.getCurrentPageId()&&this._siteMembersHandler.checkRequireLogin(a,function(){b&&(this.resources.W.Config.isPreviewMode()&&LOG.reportEvent(wixEvents.USER_MOVED_BETWEEN_PAGES,{c1:a._data&&a._data.pageUriSEO||"no-page-url"}),this._viewer._setCurrentPageId_(b),this._viewer._activeViewer_.changePageWithTransition(b),W.Commands.executeCommand("WViewerCommands.SelectedPageChanged",b))}.bind(this))}},_isPageVisible:function(a){return!a.getMeta("isHidden")||this.resources.W.Config.isPreviewMode()},_setUrlHashToPage:function(a,b){var c=this._viewer.getPageData(a);c&&this.resources.W.Utils.hash.setHash(a,c.get("pageUriSEO"),b)}})}),define.experiment.Class("wysiwyg.common.managers.viewer.MobileViewHandler.FixViewport.New",function(a){var b=a;b.methods({setMobileSite:function(a){this._viewerName=a,this.handleQuickActions(),this.setViewportAttribute("minimum-scale","0.25"),this.setViewportAttribute("maximum-scale","1.2"),window.WQuickActions&&window.WQuickActions.delayedFixZoom()},setViewportAttribute:function(a,b){for(var c=document.getElementById("wixMobileViewport"),d=c.getAttribute("content"),e=d.split(/ *,/),f="",g=!1,h=0;h<e.length;h++){var i=e[h];if(i.indexOf(a)>-1){if(g=!0,!b)continue;i=i.replace(/\ *=.*/,"="+b)}f+=i+","}f=f.substring(0,f.length-1),g||!b?c.setAttribute("content",f):c.setAttribute("content",f+","+a+"="+b)}})}),define.experiment.Class("wysiwyg.common.managers.viewer.MobileViewHandler.MobileSiteWidth.New",function(a,b){var c=a,d=b;c.binds(["_handleMobileRotation"]),c.resources(d.merge(["W.Config"])),c.methods({setMobileSite:function(a){this._viewerName=a,this.handleQuickActions(),this._viewerName===Constants.ViewerTypesParams.TYPES.MOBILE?(this._handleMobileRotation(),window.addEventListener("orientationchange",this._handleMobileRotation,!1)):(this.setViewportAttribute("minimum-scale","0.25"),this.setViewportAttribute("maximum-scale","1.2"))},_handleMobileRotation:function(){var a=document.getElementById("wixMobileViewport"),b=Constants.ViewerTypesParams.DOC_WIDTH.MOBILE,c=this.resources.W.Config.mobileConfig.getMobileScreenHeight(),d=this.resources.W.Config.mobileConfig.getMobileScreenWidth(),e=1,f=this.resources.W.Config.mobileConfig.isPortrait();e=f?d/b:c/b;var g=b+1;this._setViewPortTag(a,g,e),setTimeout(function(){this._setViewPortTag(a,b,e)}.bind(this),50)},_setViewPortTag:function(a,b,c){a.setAttribute("content","width="+b+","+"initial-scale="+c+","+"user-scalable="+"no"+", maximum-scale="+c),window.WQuickActions&&window.WQuickActions.delayedFixZoom()}})}),define.experiment.newClass("wysiwyg.common.managers.viewer.PageManagerTemp.ViewerRefactor.New",function(a){var b=a;b.resources(["W.Utils","W.Data","W.TPA"]),b.methods({goToHomePage:function(){this.goToPage(this.getHomePageId())},isHomePage:function(a){return this._isSiteReady?a===this.getHomePageId():!0},getHomePageId:function(){return this._mainPageData?this._mainPageData.get("id"):void 0},getPageNode:function(a){var b=null;return a&&this._siteNode&&(b=this.injects().Viewer.getCompByID(a)),b},indexPages:function(){var a=this._viewer.getPageGroupElement();if(!a)return this.resources.W.Utils.callLater(this.indexPages,[],this,10);var b={},c=[];this._getPageElements(a).each(function(a){var d=a.get("id")||this.resources.W.Utils.getUniqueId("page");this._prefix&&(d=d.replace(this._prefix,"")),b[d]=a,a.addClass("sitePage");var e=a.get("dataQuery");c.push(e)}.bind(this)),c=this._fixPagesOrderByNewMenuData(c);var d=this._siteStructureData.getData().pages;d=d||[];var e;for(e=0;e<d.length;++e){var f=d[e],g=c.indexOf(f);-1!=g&&(c.splice(g,1),c.splice(e,0,f))}var h=W.Data.isDataChange();this._siteStructureData.set("pages",c),(void 0===this._siteStructureData.get("mainPage")||""===this._siteStructureData.get("mainPage"))&&this._siteStructureData.set("mainPage",c[0]),h&&W.Data.flagDataChange(),this._pages=b},_getPageElements:function(a){var b="[comp=mobile.core.components.Page],[comp=core.components.Page], [wixapps.integration.components.AppPage]";return a.getElements(b)},_fixPagesOrderByNewMenuData:function(a){if(W.Data.isDataAvailable("#MAIN_MENU")){var b=W.Data.getDataByQuery("#MAIN_MENU"),c=b.getAllItems();c=b.getAllItems(),a=c.map(function(a){return a.get("refId")})}return a},getPageData:function(a){return this._pagesData[a]},getPagesData:function(){return this._pagesData},getPages:function(){return this._pages},getLinkablePagesData:function(){return this._pagesData},updatePagesData:function(){this._pagesData={};for(var a in this._pages){var b=this._pages[a].getLogic().getDataItem();this._pagesData[b.get("id")]=b,this._siteStructureData.get("mainPage")==="#"+b.get("id")&&(this._mainPageData=b)}},changePageWithTransition:function(a){this._pageGroupComp&&this._pageGroupComp.getLogic().gotoPage(a)},getNewUniquePageId:function(a){var b;do b=W.Utils.getUniqueId(a+"Page");while(void 0!==this._pages[b]);return b}})}),define.experiment.newClass("wysiwyg.common.managers.ScriptLoaderTemp.ViewerRefactor.New",function(a){var b=a;b.binds(["_loadScript","_onScriptLoaded"]),b.methods({initialize:function(){this._loadedExtJS={},this._pendingExtJS=[]},loadExternalScript:function(a,b,c){return a in this._loadedExtJS?(b(),"ALREADY_LOADED"):a in this._pendingExtJS?(this._pendingExtJS[a].push(b),"PENDING_LOAD"):(this._pendingExtJS[a]=[b],this._loadScript(a,c),"FIRST_LOAD")},_onScriptLoaded:function(a){this._loadedExtJS[a]=!0;for(var b=this._pendingExtJS[a],c=0;c<b.length;c++)b[c]();delete this._pendingExtJS[a]},_loadScript:function(a){var b=document.createElement("script");b.type="text/javascript",b.async=!1,b.readyState?b.onreadystatechange=function(){("loaded"===b.readyState||"complete"===b.readyState)&&(b.onreadystatechange=null,this._onScriptLoaded(a))}.bind(this):b.onload=function(){this._onScriptLoaded(a)}.bind(this),b.src=a;var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})}),define.experiment.newClass("wysiwyg.common.managers.SiteMemebersTemp.ViewerRefactor.New",function(a){var b=a;b.inherits("bootstrap.utils.Events"),b.binds([]),b.resources(["W.Utils","W.Commands"]),b.methods({initialize:function(a,b){this._passwordLogin=null,this._validatedPages=null,this._siteNode=b,this._viewer=a,this._registerCommands()},_registerCommands:function(){var a=this.resources.W.Commands;a.registerCommandAndListener("WViewerCommands.AdminLogin.Open",this,this._openAdminLogin),a.registerCommandAndListener("WViewerCommands.AdminLogin.Close",this,this._closeAdminLogin),a.registerCommandAndListener("WViewerCommands.SiteMembers.Open",this,this._openSiteMembersPopup),a.registerCommandAndListener("WViewerCommands.SiteMembers.Close",this,this._closeSiteMembersPopup),a.registerCommandAndListener("WViewerCommands.PasswordLogin.Open",this,this._openPasswordLogin),a.registerCommandAndListener("WViewerCommands.PasswordLogin.Close",this,this._closePasswordLogin)},setPageAsNotValidated:function(a){this._validatedPages||(this._validatedPages={}),this._validatedPages[a]=!1},_closeAdminLogin:function(){this._closePasswordLogin()},_closePasswordLogin:function(){if(this._passwordLogin){var a=this._passwordLogin.getViewNode(),b=new Fx.Tween(a,{duration:"short",link:"ignore"}),c=function(){b.removeEvent("complete",c),a.removeFromDOM(),delete this._passwordLogin}.bind(this);b.addEvent("complete",c),b.start("opacity","0.0")}},_openAdminLogin:function(a){a||(a={}),a.clazz="wysiwyg.viewer.components.AdminLogin",a.dataItem=W.Data.createDataItem({type:"Text"}),this._openPasswordLogin(a)},_openPasswordLogin:function(a){if(!this._passwordLogin){var b=a&&a.args,c=a&&a.clazz||"wysiwyg.viewer.components.PasswordLogin",d=a&&a.dataItem||null;W.Components.createComponent(c,"wysiwyg.viewer.skins.PasswordLoginSkin",d,b,function(){},function(a){this._passwordLogin=a;var b=a.getViewNode();b.setStyle("opacity","0"),a.getViewNode().insertInto(this._siteNode),a.centerDialog(),new Fx.Tween(b,{duration:"short",link:"ignore"}).start("opacity","1.0")}.bind(this))}},_openSiteMembersPopup:function(a){this.injects().SiteMembers.openSiteMembersPopup(a)},_closeSiteMembersPopup:function(){this.injects().SiteMembers.closeSiteMembersPopup()},checkRequireLogin:function(a,b){var c=this._viewer.isPublicMode()||"PREVIEW"===this._viewer.getEditorMode(),d=a.get("pageSecurity"),e=a.get("id"),f=this._getFallbackPage(e),g=!f;if(c&&d.requireLogin&&!this.injects().SiteMembers.isLoggedIn()&&!this._isProtectedPageValidated(e)){var h="",i=a.get("pageUriSEO"),j=this.resources.W.Utils.hash.getHashPartsString(e,i,h);this.injects().SiteMembers.openSiteMembersPopup({disableCancel:g,hashRedirectTo:"#"+j,openedByPageSecurity:!0,authCallback:function(a){this._onAuthCallback(a,e,f,b)}.bind(this)})}else c&&d.passwordDigest&&!this._isProtectedPageValidated(e)?this.resources.W.Commands.executeCommand("WViewerCommands.PasswordLogin.Open",{args:{digestedPassword:d.passwordDigest,disableCancel:g,authCallback:function(a){this._onAuthCallback(a,e,f,b)}.bind(this)}}):b()},_getFallbackPage:function(a){var b=this._viewer.getCurrentPageId(),c=!!b,d=W.Data.getDataMap().SITE_STRUCTURE.get("mainPage");return d=d?d.replace("#",""):"",c?b:a!=d?d:null},_isProtectedPageValidated:function(a){return this._validatedPages&&this._validatedPages[a]},_onAuthCallback:function(a,b,c,d){a.authResponse?(this._setPageValidated(b),d()):a.data&&a.data.cancel&&(c?location.hash=c:location.reload())},_setPageValidated:function(a){this._validatedPages||(this._validatedPages={}),this._validatedPages[a]=!0}})}),define.experiment.Class("wysiwyg.common.managers.viewer.SiteView.CustomSiteWidth.New",function(a,b){var c=a,d=b;c.methods({initialize:d.after(function(){var a=this.resources.W.Commands;a.registerCommandAndListener("WViewerCommands.UpdateDocWidth",this,this._updateDocWidth)}),_updateDocWidth:function(a){if(a)return this._setDocWidth(a),void 0;var b=this.injects().Utils.getQueryParam("siteWidthInPixels");if(b)return this._setDocWidth(b),void 0;var c=this._siteStructureData.get("renderModifiers");if(c&&c.siteWidth)return this._docWidth=c.siteWidth,void 0;switch(window.rendererModel&&window.rendererModel.applicationType){case"HtmlFacbook":this._docWidth=520;break;case"HtmlWeb":this._docWidth=980;break;default:this._docWidth=980}},_setDocWidth:function(a){this._docWidth=_.parseInt(a),this._siteStructureData.set("siteWidthInPixels",this._docWidth);var b=this._siteStructureData.get("renderModifiers");b?_.extend(this._siteStructureData.get("renderModifiers"),{siteWidth:this._docWidth}):this._siteStructureData.setFields({siteWidth:this._docWidth}),this._siteStructureData.markDataAsDirty()},dispose:d.before(function(){this.resources.W.Commands.unregisterListener(this)})})}),define.experiment.newClass("wysiwyg.common.managers.viewer.SiteView.ViewerRefactor.New",function(a,b){var c=a;c.inherits("bootstrap.utils.Events"),c.utilize(["wysiwyg.viewer.managers.PageManager"]),c.traits(["wysiwyg.common.managers.viewer.PageManagerTemp"]),c.binds(["_fireScreenResizeEvent","_onSiteReady","_notifySiteReadyForThumbnail","_wixifySite"]),c.resources(["W.Utils","W.TPA","W.Commands","W.Config","W.Data"]),c.statics({SCREEN_RESIZE_EVENT:"ScreenResize"}),c.methods({initialize:function(a,b){this._viewer=a,this._viewerName=a.getViewerMode(),this._prefix=Constants.ViewerTypesParams.DOM_ID_PREFIX[this._viewerName]||"",this._pageManager=new this.imports.PageManager(this._viewerName,this._prefix,b),this._initState(),this.initScreenResizeEventPropagation()},initScreenResizeEventPropagation:function(){$(window).addEvent("resize",this._fireScreenResizeEvent)},_initState:function(){this._isSiteReady=!1,this._pages=null,this._pagesData=null,this._mainPageData=null,this._siteStructureData=null,this._isFullScreen=null},isSiteReady:function(){return this._isSiteReady},getPageManager:function(){return this._pageManager},initiateSite:function(){this._pageManager.addEvent(this._pageManager.EVENTS.SITE_LOADED,this._wixifySite),this._pageManager.loadSite()},dispose:function(){this._pageManager.removeEvent(this._pageManager.EVENTS.SITE_LOADED,this._wixifySite),$(window).removeEvent("resize",this._fireScreenResizeEvent),this._pageGroupComp.$logic.removeAllEvents(),this._siteNode.$logic.removeAllEvents(),this.removeAllEvents(),this._siteNode.$logic.dispose()},_wixifySite:function(a){var b=this.resources.W.Config.isPublicMode();this._siteNode=a,this._siteStructureData=W.Data.getDataByQuery("#SITE_STRUCTURE"),a||LOG.reportError(wixErrors.VM_INVALID_SITE_NODE,this.className,"setSite",""),this._siteStructureData||LOG.reportError(wixErrors.VM_INVALID_SITE_DATA,this.className,"setSite",""),this.indexPages(),this._siteNode.addEvent(Constants.ComponentEvents.WIXIFIED,function(){this._siteStructureData.addComponentWithInterest(this.getLogic())}),this._wixifySiteLazily(a,b);var c=this._siteNode.getProperty("comp");c&&c.contains("components.SiteStructure")&&this._siteNode.wixify();var d=this._viewer.getPageGroupElement(),e=this;d&&d.getProperty("comp")&&(this._pageGroupComp=d,this._pageGroupComp.addEvent("pageTransitionEnded",function(a){e.fireEvent("pageTransitionEnded",a)}));var f=$(document.body);this._viewer.getPreviewMode()?f.setStyle("overflow","hidden"):(f.setStyle("overflow-y","scroll"),f.setStyle("overflow-x","auto"))},_wixifySiteLazily:function(a,b){var c=this._getInitComponents(a);this._logViewerRender("master page render"),new Async.Bulk(c,null,{completeEvent:Constants.ComponentEvents.READY,completeCallback:function(){c.removeClass("initHidden"),this.updatePagesData();var a=[];if(b===!1)for(var d in this._pages)a.push(this._pages[d].getLogic());else{var e=this._currentPageId||this.getHomePageId(),f=this.resources.W.Data.getDataByQuery("#"+e);a.push(this._pages[f.get("id")].getLogic())}this._logViewerRender("page render"),new Async.Bulk(a,null,{completeEvent:"contentWixified",completeCallback:function(){this._onSiteReady()}.bind(this)});for(var g=0;g<a.length;++g)a[g].wixifyContent()}.bind(this)}),c.wixify()},_getInitComponents:function(a){var b=this._getMasterComponentBeforeWixify(a);if(b.push(a),window.adData){var c=document.getElementById("wixFooter");c&&!c.$logic&&(this._viewer.setAdData(window.adData),b.push(c))}return b},_onSiteReady:function(){this._logViewerRender("site ready"),this._viewer.setPreviewMode(this._viewer.getPreviewMode()),this._isSiteReady=!0,this.resources.W.Config.mobileConfig.isMobile()&&this._scrollToHideMobileAddressBar(),this._reportBIEvents(),this.fireEvent("SiteReady"),"editor"===window.viewMode&&"#save=1"===window.location.hash&&(window.location.hash="save=0",W.Commands.executeCommand("WEditorCommands.SaveSuccessDialog")),W.Layout.attachSavedAnchors(),this._fireScreenResizeEvent(),this.getSiteNode()&&this.getSiteNode().getLogic&&this.siteHeightChanged(),this.resources.W.Utils.callLater(this._notifySiteReadyForThumbnail)},_logViewerRender:function(a){deployStatus("viewerRender",{step:a,time:LOG.getSessionTime()})},_scrollToHideMobileAddressBar:function(){window.scrollTo(0,1)},getSiteHeight:function(){return this._siteHeight},siteHeightChanged:function(a){this.getSiteNode().getLogic().flushPhysicalHeightCache(),this._siteHeight=this._getHeightFromCallback(),this.fireEvent("resize",this._siteHeight),a||this.getSiteNode().getLogic().setHeight(this._siteHeight),this._postHeightMessage()},_getHeightFromCallback:function(){return this._viewer.getActiveViewerHeightFromCallback()},_postHeightMessage:function(){var a=parent.postMessage?parent:parent.document.postMessage?parent.document:void 0;a&&"undefined"!=typeof a&&a.postMessage(this._siteHeight,"*")},_updateDocWidth:function(a){if(a)return this._docWidth=a,void 0;var b=this._siteStructureData,c=b.get("renderModifiers"),d=this.injects().Utils.getQueryParam("siteWidth");if(d)return this._docWidth=parseInt(d,10),c.siteWidth=this._docWidth,b.markDataAsDirty(),void 0;if(c&&c.siteWidth)return this._docWidth=c.siteWidth,void 0;switch(window.rendererModel.applicationType){case"HtmlFacebook":this._docWidth="520";break;case"HtmlWeb":this._docWidth="980";break;default:this._docWidth=980}},getDocWidth:function(){return this._docWidth||this._updateDocWidth(),this._docWidth},_notifySiteReadyForThumbnail:function(){"true"===this.resources.W.Utils.getQueryParam("siteReadyAlert");var a=this.resources.W.Utils.getQueryParam("siteReadyPost");if(a){var b=new Request.JSON({url:a});b.post({siteReady:!0})}},getSiteNode:function(){return this._siteNode},getCompByID:function(a){var b=a;return this._prefix&&0!==a.indexOf(this._prefix)&&(b=this._prefix+a),$(b)},getMasterComponents:function(){var a=this.getSiteNode().$logic;return this._getMasterComponents(a,[])},_getMasterComponents:function(a,b){var c=a.getChildComponents();return _.forEach(c,function(a){var c=a.getLogic();c&&!this._viewer.isPageComponent(c.className)&&(b.push(c),c.isInstanceOfClass("core.components.Container")&&this._getMasterComponents(c,b))}.bind(this)),b},_getMasterComponentBeforeWixify:function(a,b){b=b||new Elements;var c=a.getChildren();return _.forEach(c,function(a){var c=a.hasAttribute("comp");c&&b.push(a);var d=c&&this._viewer.isPageComponent(a.getAttribute("comp"));d||this._getMasterComponentBeforeWixify(a,b)},this),b},getPageComponents:function(a){a=a||this.getCurrentPageId();var b=this.getCompByID(a).$logic;return b.getPageComponents()},_onPageExtraDataChange_:function(a,b,c){if(!c){var d=W.Data.getDataByQuery("#"+b),e=d.get("type");"Page"===e?this._handleTPAExtraDataChange(d):"AppPage"===e&&this._handleAppsExtraDataChange(b,a)}},_handleTPAExtraDataChange:function(a){var b=a.get("tpaApplicationId"),c=this.resources.W.TPA.getComponentRegistrar().getSection(b);c&&c._updateIframe(!0)},_handleAppsExtraDataChange:function(a,b){var c=W.Viewer.getPages()[a],d=c.getLogic();b||(b=""),d.updateParamsFromExtraData(b)},getCompByIDAddPrefix:function(a){return $(this._prefix+a)},_fireScreenResizeEvent:function(){this.fireEvent(this.SCREEN_RESIZE_EVENT)},_reportBIEvents:function(){switch(window.viewMode){case"preview":LOG.reportEvent(wixEvents.PREVIEW_READY);break;case"site":var a=!window.wixData,b={c1:a};LOG.reportEvent(wixEvents.SITE_READY,b)}}})}),define.experiment.newClass("wysiwyg.common.managers.ViewerProxy.ViewerRefactor.New",function(a){var b=a;b.methods({initialize:function(){this.SCREEN_RESIZE_EVENT="ScreenResize"},_eventHandlers:{},propagateEvents:function(){this.addEventPropagation("pageTransitionEnded"),this.addEventPropagation("SiteReady"),this.addEventPropagation("resize"),this.addEventPropagation(this._activeViewer_.SCREEN_RESIZE_EVENT)},removeEventPropagation:function(){this.removeEvent("resize",this._eventHandlers.resize),this.removeEvent("SiteReady",this._eventHandlers.SiteReady),this.removeEvent("pageTransitionEnded",this._eventHandlers.pageTransitionEnded),this.removeEvent(this._activeViewer_.SCREEN_RESIZE_EVENT,this._eventHandlers[this._activeViewer_.SCREEN_RESIZE_EVENT])},addEventPropagation:function(a){var b=this;this._eventHandlers[a]=function(c){b.fireEvent(a,c)},this._activeViewer_.addEvent(a,this._eventHandlers[a])},indexPages:function(){return this._activeViewer_.indexPages()},getPageData:function(a){return this._activeViewer_.getPageData(a)},getPagesData:function(){return this._activeViewer_.getPagesData()},getPages:function(){return this._activeViewer_.getPages()},getLinkablePagesData:function(){return this._activeViewer_.getLinkablePagesData()},updatePagesData:function(){return this._activeViewer_.updatePagesData()},getNewUniquePageId:function(a){return this._activeViewer_.getNewUniquePageId(a)},goToHomePage:function(){return this._activeViewer_.goToHomePage()},isHomePage:function(a){return a=a||this.getCurrentPageId(),this._activeViewer_.isHomePage(a)},getHomePageId:function(){return this._activeViewer_.getHomePageId()},getCurrentPageNode:function(){return this._activeViewer_.getPageNode(this.getCurrentPageId())},getMasterComponents:function(a){return a in this._loadedViewers?this._loadedViewers[a].getMasterComponents():this._activeViewer_.getMasterComponents()},getPageComponents:function(a,b){return b in this._loadedViewers?this._loadedViewers[b].getPageComponents(a):this._activeViewer_.getPageComponents(a)},isPageLoaded:function(a){return this._activeViewer_.getPageManager().isPageLoaded(a)},loadPageById:function(a,b,c){return this._activeViewer_.getPageManager().loadPageById(a,b,c)},isSiteReady:function(){return this._activeViewer_&&this._activeViewer_.isSiteReady()},getSiteHeight:function(){return this._activeViewer_.getSiteHeight()},siteHeightChanged:function(a){return this._activeViewer_.siteHeightChanged(a)},getDocWidth:function(){return this._activeViewer_.getDocWidth()},getSiteNode:function(){return this._activeViewer_.getSiteNode()},initScreenResizeEventPropagation:function(){return this._activeViewer_.initScreenResizeEventPropagation()},getCompByID:function(a,b){return b in this._loadedViewers?this._loadedViewers[b].getCompByID(a):this._activeViewer_.getCompByID(a)},getElementBySelector:function(a){var b=this.getSiteNode();return b.getElement(a)||null},getCompLogicBySelector:function(a){var b=this.getElementBySelector(a);return b&&b.$logic?b.$logic:null},getCompLogicById:function(a,b){var c=this.getCompByID(a,b);return c&&c.$logic?c.$logic:null},getPageGroup:function(){return this.getPageGroupElement().getLogic()},getPageGroupElement:function(){return this._activeViewer_.getCompByIDAddPrefix("SITE_PAGES")},getPagesContainer:function(){return this._activeViewer_.getCompByIDAddPrefix("PAGES_CONTAINER")},getFooterContainer:function(){return this._activeViewer_.getCompByIDAddPrefix("SITE_FOOTER")},getHeaderContainer:function(){return this._activeViewer_.getCompByIDAddPrefix("SITE_HEADER")}})}),define.experiment.Class("wysiwyg.common.managers.ViewerZoomHandler.MobileEcomViews.New",function(a){var b=a;b.methods({_getZoomCompSettings:function(){var a,b;return W.Config.mobileConfig.isMobile()?(a="wysiwyg.viewer.skins.MobileMediaZoomSkin",b="wysiwyg.viewer.components.MobileMediaZoom"):(a="wysiwyg.viewer.skins.MediaZoomSkin",b="wysiwyg.viewer.components.MediaZoom"),{comp:b,skin:a}}})}),define.experiment.Class("wysiwyg.common.managers.ViewerZoomHandler.MobileZoom.New",function(a){var b=a;b.methods({setZoomData:function(a){this._initZoomIfNeeded(a,function(b){this._zoomComp=b.getViewNode(),this._setZoomDataInner(a)}.bind(this))},_initZoomIfNeeded:function(a,b){if(W.Config.mobileConfig.isMobile()&&this._zoomComp&&("wysiwyg.viewer.components.MobileMediaZoom"===this._zoomComp.getLogic().$className?a.itemsList&&"ImageList"!==a.itemsList.getType()&&(this._zoomComp.destroy(),this._zoomComp=null):a.itemsList&&"ImageList"===a.itemsList.getType()&&(this._zoomComp.destroy(),this._zoomComp=null)),this._zoomComp)b&&b(this._zoomComp.getLogic());else{var c=this._getZoomCompSettings(a);this._zoomComp=W.Components.createComponent(c.comp,c.skin,null,null,function(a){a.getViewNode().insertInto(this._siteNode)}.bind(this),b)}},_getZoomCompSettings:function(a){var b,c;return W.Config.mobileConfig.isMobile()&&(a.itemsList&&"ImageList"===a.itemsList.getType()||!a.itemsList&&"string"===typeOf(a.item))?(b="wysiwyg.viewer.skins.MobileMediaZoomSkin",c="wysiwyg.viewer.components.MobileMediaZoom"):(b="wysiwyg.viewer.skins.MediaZoomSkin",c="wysiwyg.viewer.components.MediaZoom"),{comp:c,skin:b}},_getZoomDisplayerCompSettings:function(){var a,b;
return W.Config.mobileConfig.isMobile()?(a="wysiwyg.viewer.skins.displayers.MobileMediaZoomDisplayerSkin",b="wysiwyg.viewer.components.MobileMediaZoomDisplayer"):(a="wysiwyg.viewer.skins.displayers.MediaZoomDisplayerSkin",b="wysiwyg.viewer.components.MediaZoomDisplayer"),{comp:b,skin:a}}})}),define.experiment.newClass("wysiwyg.common.managers.ViewerZoomHandler.ViewerRefactor.New",function(a){var b=a;b.resources(["W.Commands"]),b.methods({initialize:function(a,b){this._zoomComp=null,this._viewer=a,this._siteNode=b;var c=this.resources.W.Commands;c.registerCommandAndListener("WViewerCommands.OpenZoom",this,this._setZoomData)},getDefaultGetZoomDisplayerFunction:function(a){return"Image"===a?function(a,b,c){var d=this._getZoomDisplayerCompSettings();this.injects().Components.createComponent(d.comp,d.skin,a,{maxWidth:b.x,maxHeight:b.y},null,function(a){c(a.getViewNode())})}.bind(this):void 0},getDefaultGetHashPartsFunction:function(a){return"Image"===a?function(a,b){W.Data.getDataItem(a,function(a){b({id:"zoom",title:a.get("title"),extData:this._viewer.getCurrentPageId()+"/"+a.get("id")})}.bind(this))}.bind(this):void 0},_getZoomDisplayerCompSettings:function(){return{comp:"wysiwyg.viewer.components.MediaZoomDisplayer",skin:"wysiwyg.viewer.skins.displayers.MediaZoomDisplayerSkin"}},_setZoomData:function(a){this._initZoomIfNeeded(function(b){this._zoomComp=b.getViewNode(),this._setZoomDataInner(a)}.bind(this))},removeZoomElement:function(){this._zoomComp&&(this._zoomComp.removeFromDOM(),delete this._zoomComp)},_setZoomDataInner:function(a){a.itemsList?this._zoomComp.getLogic().setGallery(a.itemsList,a.currentIndex,a.getDisplayerDivFunction,a.getHashPartsFunction,a.extraParams):a.item&&this._zoomComp.getLogic().setImage(a.item,a.getDisplayerDivFunction,a.getHashPartsFunction)},_initZoomIfNeeded:function(a){if(this._zoomComp)a&&a(this._zoomComp.getLogic());else{var b=this._getZoomCompSettings();this._zoomComp=W.Components.createComponent(b.comp,b.skin,null,null,function(a){a.getViewNode().insertInto(this._siteNode)}.bind(this),a)}},_getZoomCompSettings:function(){return{comp:"wysiwyg.viewer.components.MediaZoom",skin:"wysiwyg.viewer.skins.MediaZoomSkin"}},isZoomOpened:function(){return this._zoomComp&&this._zoomComp.getLogic&&this._zoomComp.getLogic().isZoomOpened()},showItemInOpenedZoom:function(){this._zoomComp.getLogic().showZoomImage()}})}),define.experiment.newClass("wysiwyg.common.managers.viewer.MobileViewHandler.ViewerRefactor.New",function(a){var b=a;b.utilize(["wysiwyg.viewer.utils.MobileQuickActionsHandler"]),b.methods({setMobileSite:function(a){this._viewerName=a,this.handleQuickActions()},handleQuickActions:function(){var a=new this.imports.MobileQuickActionsHandler;a.handleMobileQuickActions()},setViewportAttribute:function(a,b){for(var c=document.getElementById("wixMobileViewport"),d=c.getAttribute("content"),e=d.split(/ *,/),f="",g=!1,h=0;h<e.length;h++){var i=e[h];if(i.indexOf(a)>-1){if(g=!0,!b)continue;i=i.replace(/\ *=.*/,"="+b)}f+=i+","}f=f.substring(0,f.length-1),g?c.setAttribute("content",f):c.setAttribute("content",f+","+a+"="+b)}})}),define.experiment.newDataSchema("BgImageStripProperties.BgImageStrip.New",function(){return{bgUrl:{type:"string","default":"",description:"Set image background"},bgSize:{type:"string","enum":[{label:"Actual Size",value:"auto"},{label:"Crop       ",value:"cover"},{label:"Fit        ",value:"contain"}],"default":"auto",description:"Set background mode"},bgRepeat:{type:"string","enum":[{label:"No Tiling",value:"no-repeat"},{label:"Tile Horizontal",value:"repeat-x "},{label:"Tile Vertical",value:"repeat-y "},{label:"Tile All",value:"repeat"}],"default":"repeat",description:"Set background tile direction"},bgPosition:{type:"string","enum":["top left","top center","top right","center left","center","center right","bottom left","bottom center","bottom right"],"default":"top left",description:"Set background position"}}}),define.experiment.newDataSchema("ContactFormProperties.ContactFormRefactor.New",function(){return{hidden_emailFieldLabel:{type:"boolean","default":!0},hidden_nameFieldLabel:{type:"boolean","default":!0},hidden_phoneFieldLabel:{type:"boolean","default":!1},hidden_addressFieldLabel:{type:"boolean","default":!1},hidden_subjectFieldLabel:{type:"boolean","default":!0},hidden_messageFieldLabel:{type:"boolean","default":!0},required_emailFieldLabel:{type:"boolean","default":!0},required_nameFieldLabel:{type:"boolean","default":!1},required_phoneFieldLabel:{type:"boolean","default":!1},required_addressFieldLabel:{type:"boolean","default":!1},required_subjectFieldLabel:{type:"boolean","default":!1},required_messageFieldLabel:{type:"boolean","default":!1}}}),define.experiment.newDataSchema("DocumentMediaProperties.DocumentMedia.New",function(){return{showTitle:{type:"boolean","default":!0,description:"Toggle Document Title Display"}}}),define.experiment.newDataSchema("FiveGridLineProperties.NBC_HorizontalLineFullScreenWidth.New",function(){return{isFullScreenModeOn:{type:"boolean","default":!1,description:"Toggle full screen mode"}}}),define.experiment.newDataSchema("ItunesButtonProperties.ItunesButton.New",function(){return{language:{type:"string",languages:[{name:"English",code:"en"},{name:"French",code:"fr"},{name:"German",code:"de"},{name:"Italian",code:"it"},{name:"Japanese",code:"jp"},{name:"Portuguese",code:"pt"},{name:"Russian",code:"ru"},{name:"Polish",code:"pl"},{name:"Spanish",code:"es"}],"default":"en",description:"Language of the button"},openIn:{type:"string","enum":["_self","_blank"],"default":"_blank",description:"Where the link will be opened"}}}),define.experiment.newDataSchema("PinterestPinProperties.PinterestPinComponent.New",function(){return{counterPosition:{type:"string","enum":["above","beside","none"],"default":"beside",description:"the position of the pin counter around the button"}}}),define.experiment.dataSchema("SliderGalleryProperties.SliderAutoPlay.New",function(a){var b=a;return b.merge({autoplayInterval:{type:"number","default":"0",minimum:0,maximum:30,description:"Autoplay interval"},autoplay:{type:"boolean","default":!1,description:""},showAutoplay:{type:"boolean","default":!0,description:""},transDuration:{type:"number",minimum:0,maximum:5,"default":0,description:"Duration of the transition in seconds"},autoPlayDirection:{type:"string","default":"LTR"}})}),define.experiment.newDataSchema("SvgShapeProperties.SvgShapeComponent.New",function(){return{maintainAspectRatio:{type:"boolean","default":!1,description:"Maintain aspect ratio"}}}),define.experiment.newDataSchema("VKShareProperties.VKShare.New",function(){return{rightAngles:{type:"boolean","default":!1,description:"Button Right angles"}}}),define.experiment.newClass("wysiwyg.viewer.responsive.MultiLayoutComponentPropertyHandler.MobileEditor1.New",function(a){var b=a;b.methods({initialize:function(a){this._viewerManagers=a,this._buildComponentsToModifyMap()},_buildComponentsToModifyMap:function(){this._componentsToModify={"wysiwyg.viewer.components.MatrixGallery":{numCols:function(a){return a>2?2:a}}}},modifyComponentProperties:function(a){var b=a.propertyQuery;if(b){var c=a.componentType;this._componentsToModify[c]&&this._viewerManagers.ComponentData.getDataByQuery("#"+b,function(b){var d=Object.clone(b.getData()),e="mobile_"+d.id,f=this._componentsToModify[c];_.forEach(f,function(a,c){var e=a(b.get(c));d[c]=e});var g=this._viewerManagers.ComponentData.addDataItem(e,d);a.propertyQuery=e,g.addComponentWithInterest(W.Preview.getCompLogicById(a.id)),b.addEvent(Constants.DataEvents.DATA_CHANGED,function(a){this._updateComponentProperties(c,g,a)}.bind(this))}.bind(this))}},_updateComponentProperties:function(a,b,c){var d=this._componentsToModify[a];_.forEach(d,function(a,d){var e=a(c.get(d));b.set(d,e)})}})}),define.experiment.newClass("wysiwyg.viewer.responsive.ResponsiveAlgorithm.MobileEditor1.New",function(a,b){var c=a;c.resources(["W.Config"]),c.binds(["_compareByRows","_compareByColumns","_compareByRowsNadav","_compareByAnotherArrayOrder"]),c.utilize(["wysiwyg.viewer.responsive.TextLayoutCalculator","wysiwyg.viewer.responsive.MultiLayoutComponentPropertyHandler"]),c.statics({MOBILE_WIDTH:320,COMPONENT_MOBILE_MARGIN:10,TINY_MENU_SIZE:50,TEXT_MAX_LENGTH_FOR_RESCALING:25,NEIGHBORS:["leftNeighbor","rightNeighbor","topNeighbor","bottomNeighbor"],CHILDREN_TREATMENT_METHOD:{RESCALE_CHILDREN:"rescaleChildren",REORGANIZE_CHILDREN:"resorganizeChildren",BACKGROUND_AND_TEXT_CHILDREN:"backgroundAndTextChildren"}}),c.methods({initialize:function(){this._textLayoutCalculator=new this.imports.TextLayoutCalculator;var a=this;this.resources.W.Config.isEditorMode()?resource.getResourceValue("W.Preview",function(b){a._preview=b,b.getPreviewManagersAsync(a._initViewerClasses,a)}):this._initViewerClasses(W),this._classNameToExtraOperationMapper={},this._componentMobileValidityMapper={},this._registerRegularMenusAsNonMobileComponents()},registerExtraOperationsForComponentClassName:function(a){this._classNameToExtraOperationMapper[a.className]||(this._classNameToExtraOperationMapper[a.className]=[]),this._classNameToExtraOperationMapper[a.className].push(a.callback)},registerIsMobileComponentFunction:function(a){this._componentMobileValidityMapper[a.className]=a.isMobileFunc},_registerRegularMenusAsNonMobileComponents:function(){this.registerIsMobileComponentFunction({className:"wysiwyg.viewer.components.menus.DropDownMenu",isMobileFunc:function(){return!1}}),this.registerIsMobileComponentFunction({className:"wysiwyg.viewer.components.HorizontalMenu",isMobileFunc:function(){return!1}})},_initViewerClasses:function(a){this._viewerManagers=a,this._multiLayoutComponentPropertyHandler=new this.imports.MultiLayoutComponentPropertyHandler(this._viewerManagers)},_convertStructureToMobileLayout:function(a,b,c){this._preProcessStructure(a,b,c),this._analyzeStructure(a),this._updateStructureLayout(a,b),this._postProcessStructure(a,b)},_preProcessStructure:function(a,b,c){this._markTextComponentBlocks(a),this._modifyComponentCharacteristicsToFitMobileLayout(a),this._removeExplicitlyHiddenComponents(a,c),this._removeNonMobileComponents(a),this._markContainersTightlyWrappedByTheirParents(a),this._reparentComponentsOverlayingContainers(a),"masterPage"==b&&this._handleNonHeaderOrFooterMasterPageComponents(a)},_addTinyMenu:function(a){var b=this._getTinyMenuComponent(),c=this._getHeaderComponent(a);this._isTinyMenuExist(a)||this._addComponentsToContainer(c,[b])},_isTinyMenuExist:function(a){var b=this._getHeaderComponent(a);return void 0!=this._getComponentById("TINY_MENU",b.components)},_getHeaderComponent:function(a){for(var b=0;b<a.children.length;b++)if("SITE_HEADER"==a.children[b].id)return a.children[b]},_activateExtraOperationsForComponentClassName:function(a){if(a.id){var b=a.componentType;if(this._classNameToExtraOperationMapper[b])for(var c=0;c<this._classNameToExtraOperationMapper[b].length;c++)this._classNameToExtraOperationMapper[b][c](a)}var d=a.components||a.children;if(d)for(var c=0;c<d.length;c++)this._activateExtraOperationsForComponentClassName(d[c])},_updateStructureLayout:function(a,b){"page"==b?this._updatePageForMobileLayout(a):this._updateHeaderAndFooterForMobileLayout(a)},_analyzeStructure:function(a){this._identifyBackgroundImagesForText(a),this._replaceBackgroundGroupedComponentsToBackgroundVirtualGroups(a),this._identifyOverlayingComponentsAsGroups(a),this._replaceOverlayingGroupedComponentsToVirtualGroups(a),this._identifyComponentClusters(a),this._identifyTextAndItsCorrelatingVisual(a),this._identifyColumns(a),this._identifyPatterns(a),this._joinOrderingRelatedGroups(a),this._addComponentOrder(a),this._updateComponentOrderWithNeighborsInfo(a)},_postProcessStructure:function(a,b){this._replaceBackGroupsToFlatComponents(a),"masterPage"==b&&this._addTinyMenu(a),this._activateExtraOperationsForComponentClassName(a),this._updateAnchors(a),this._cleanUpAlgorithmProperties(a)},_updateAnchors:function(a){this._clearComponentAnchors(a),this._recalculateComponentAnchors(a)},_cleanUpAlgorithmProperties:function(a){delete a.componentsOrder,delete a.neighborGroups,delete a.clusterGroups,delete a.textVisualGroups,delete a.patternGroups,delete a.proportionGroups,delete a.textBackgroundImageGroups,delete a.isText,delete a.blocks,delete a.blockLayout;var b=a.components||a.children;if(b)for(var c=0;c<b.length;c++)this._cleanUpAlgorithmProperties(b[c])},_updateHeaderAndFooterForMobileLayout:function(a){for(var b=0;b<a.children.length;b++){var c=a.children[b];("SITE_FOOTER"==c.id||"SITE_HEADER"==c.id)&&this._rescaleComponentToFitWidth(c,this.CHILDREN_TREATMENT_METHOD.REORGANIZE_CHILDREN,this.MOBILE_WIDTH)}this._updateSiteSegmentLayout(a)},_updateSiteSegmentLayout:function(a){var b=this._getComponentById("SITE_HEADER",a.children),c=this._getComponentById("SITE_FOOTER",a.children),d=this._getComponentById("PAGES_CONTAINER",a.children);b.layout.x=0,d.layout.x=0,d.layout.y=b.layout.y+b.layout.height+this.COMPONENT_MOBILE_MARGIN,c.layout.x=0,c.layout.y=d.layout.y+d.layout.height+this.COMPONENT_MOBILE_MARGIN},_markTextComponentBlocks:function(a){this._isTextComponent(a)&&(a.isText=!0);var b=a.components||a.children;if(b)for(var c=0;c<b.length;c++)this._markTextComponentBlocks(b[c])},_isTextComponent:function(a){return"wysiwyg.viewer.components.WRichText"==a.componentType},_modifyComponentCharacteristicsToFitMobileLayout:function(a){if(this._multiLayoutComponentPropertyHandler.modifyComponentProperties(a),a.components)for(var b=0;b<a.components.length;b++)this._modifyComponentCharacteristicsToFitMobileLayout(a.components[b])},_addBlockLayoutToStructureNadav:function(a){this._identifyOverlayingComponentsAsGroups(a),this._addReverseAnchors(a),this._addComponentOrderColumns(a)},_addReverseAnchors:function(a){var b=a.components||a.children;if(b)for(var c={},d=0;d<b.length;d++){var e=b[d];if(c[e.id]=c[e.id]||[],this._addReverseAnchors(e),e.revereseAnchors=c[e.id],e.layout&&e.layout.anchors)for(var f=0;f<e.layout.anchors.length;f++){var g=e.layout.anchors[f];c[g.targetComponent]=c[g.targetComponent]||[],c[g.targetComponent].push(g)}}},_addComponentOrderColumns:function(a){var b=a.components||a.children;if(!b||0==b.length)return a.componentsOrder=[],void 0;for(var c=0;c<b.length;c++)this._addComponentOrderColumns(b[c]);var d=this._cloneJSON(a),e=d.components||d.children;e.sort(this._compareByRowsNadav);for(var f=[],g=[];e.length;)f.push(this.createColumn(e[0],e));for(var c=0;c<f.length;c++)this.flattenColumn(f[c],g);a.componentsOrder=g},_compareByRowsNadav:function(a,b){if(this._hasSufficientYOverLap(a,b)&&!this._hasSufficientXOverLap(a,b)){if(a.layout.x<b.layout.x)return-1;if(a.layout.x>b.layout.x)return 1}return a.layout.y<b.layout.y?-1:a.layout.y>b.layout.y?1:0},flattenColumn:function(a,b){for(var c=0;c<a.children.length;c++)"column"==a.children[c].type?this.flattenColumn(a.children[c],b):b.push(a.children[c].id)},createColumn:function(a,b){b.splice(b.indexOf(a),1);var c={children:[a],type:"column"};return this._continueColumn(c,b),c},_continueColumn:function(a,b){var c=a.children[a.children.length-1],d=c.layout.anchors;if(d)if(d&&1==d.length){if("BOTTOM_TOP"==d[0].type&&d[0].distance<70){var e=this._getCompIndexByID(b,d[0].targetComponent);if(-1==e)return;var f=b[e];1==this._bottomTopCount(f.revereseAnchors)&&(a.children.push(f),b.splice(e,1),this._continueColumn(a,b))}}else{for(var g=[],h=0;h<d.length;h++){if("BOTTOM_TOP"!=d[h].type||d[h].distance>70)return;var e=this._getCompIndexByID(b,d[h].targetComponent);if(-1==e)return;var f=b[e];if(1!=this._bottomTopCount(f.revereseAnchors))return;g.push(f)}for(g.sort(this._compareByColumns),h=0;h<g.length;h++)a.children.push(this.createColumn(g[h],b))}},_bottomTopCount:function(a){for(var b=0,c=0;c<a.length;c++)"BOTTOM_TOP"==a[c].type&&b++;return b},_getCompIndexByID:function(a,b){for(var c=0;c<a.length;c++)if(a[c].id==b)return c;return-1},_removeExplicitlyHiddenComponents:function(a,b){var c=a.components||a.children;if(c)for(var d=0;d<c.length;){var e=c[d];b.contains(e.id)?c.splice(d,1):(this._removeExplicitlyHiddenComponents(e,b),d++)}},_removeNonMobileComponents:function(a){var b=a.components||a.children;if(b){for(var c=0;c<b.length;){var d=b[c];this._isNonMobileComponent(d)||this._isNotRecommndedMobileComponent(d)?this._removeComponentFromContainer(a,d):c++}for(var c=0;c<b.length;c++)this._removeNonMobileComponents(b[c])}},_isNonMobileComponent:function(a){var b=this._componentMobileValidityMapper[a.componentType];return b?!b(a):!1},_isNotRecommndedMobileComponent:function(a){return this._getLineTypes().contains(a.componentType)},_getLineTypes:function(){return["wysiwyg.viewer.components.FiveGridLine","wysiwyg.viewer.components.VerticalLine"]},_getTinyMenuComponent:function(){return{componentType:"wysiwyg.viewer.components.mobile.TinyMenu",id:"TINY_MENU",dataQuery:"#MAIN_MENU",layout:{height:this.TINY_MENU_SIZE,width:this.TINY_MENU_SIZE,x:this.MOBILE_WIDTH-(this.TINY_MENU_SIZE+this.COMPONENT_MOBILE_MARGIN),y:this.COMPONENT_MOBILE_MARGIN},skin:"wysiwyg.viewer.skins.mobile.TinyMenuSkin",styleId:"tm2",type:"Component"}},_replaceBackgroundGroupedComponentsToBackgroundVirtualGroups:function(a){var b=a.components||a.children;if(b&&a.textBackgroundImageGroups){for(var c=0;c<a.textBackgroundImageGroups.length;c++){var d=a.textBackgroundImageGroups[c],e=this._getComponentsFromIds(a,d),f=this._getBackgroundGroupLayout(e),g="background_virtual_group_"+Math.random(),h={componentType:"BACKGROUND_VIRTUAL_GROUP",components:e,id:g,layout:f,originalLayout:f,skin:"undefined",styleId:"undefined",type:"undefined"};this._setTextLayoutRelativeToImage(e),this._removeComponentsFromContainer(a,e),this._addComponentsToContainer(a,[h])}for(var c=0;c<b.length;c++)this._replaceBackgroundGroupedComponentsToBackgroundVirtualGroups(b[c])}},_setTextLayoutRelativeToImage:function(a){for(var b,c,d=0;d<a.length;d++)"wysiwyg.viewer.components.WPhoto"==a[d].componentType&&(b=a[d].layout.x,c=a[d].layout.y);for(var d=0;d<a.length;d++)a[d].layout.x=a[d].layout.x-b,a[d].layout.y=a[d].layout.y-c},_getBackgroundGroupLayout:function(a){for(var b=0;b<a.length;b++)if("wysiwyg.viewer.components.WPhoto"==a[b].componentType)return{x:a[b].layout.x,y:a[b].layout.y,width:a[b].layout.width,height:a[b].layout.height}},_replaceOverlayingGroupedComponentsToVirtualGroups:function(a){if(a.proportionGroups)for(var b=0;b<a.proportionGroups.length;b++){var c=a.proportionGroups[b];if(this._validateGroupCompIds(c,a.components)){var d=this._getComponentsFromIds(a,c),e=this._getGroupLayout(d),f="virtual_group_"+Math.random(),g={componentType:"VIRTUAL_GROUP",components:d,id:f,layout:e,originalLayout:e,skin:"undefined",styleId:"undefined",type:"undefined"};this._shiftGroupComponents(d,e.x,e.y),this._removeComponentsFromContainer(a,d),this._addComponentsToContainer(a,[g])}}var h=a.children||a.components;if(h)for(var b=0;b<h.length;b++)this._replaceOverlayingGroupedComponentsToVirtualGroups(h[b])},_validateGroupCompIds:function(a,b){if(!b)return!1;for(var c=0;c<a.length;c++){for(var d=!1,e=0;e<b.length;e++)b[e].id==a[c]&&(d=!0);if(!d)return!1}return!0},_getComponentsFromIds:function(a,b){for(var c=[],d=0;d<b.length;d++)c.push(this._getComponentFromId(a,b[d]));return c},_getComponentFromId:function(a,b){for(var c=a.components||a.children,d=0;d<c.length;d++)if(c[d].id==b)return c[d];return null},_getGroupLayout:function(a){for(var b=Number.MAX_VALUE,c=Number.MIN_VALUE,d=Number.MAX_VALUE,e=Number.MIN_VALUE,f=0;f<a.length;f++){var g=a[f].layout;b=Math.min(b,g.x),c=Math.max(c,g.x+g.width),d=Math.min(d,g.y),e=Math.max(e,g.y+g.height)}return{x:b,y:d,width:c-b,height:e-d}},_shiftGroupComponents:function(a,b,c){for(var d=0;d<a.length;d++)a[d].layout.x-=b,a[d].layout.y-=c},_markContainersTightlyWrappedByTheirParents:function(a){var b=a.components||a.children;if(b)for(var c=0;c<b.length;c++){var d=b[c];this._isChildContainerAndTightlyWrappedByItsParent(d,a)&&(d.wrappedTightlyByParent=!0),this._markContainersTightlyWrappedByTheirParents(d)}},_removeContainersTightlyWrappedByTheirParents:function(a){var b=a.components||a.children;if(b){for(var c=0;c<b.length;){var d=b[c];d.wrappedTightlyByParent&&(this._shiftGroupComponents(d.components,-1*d.layout.x,-1*d.layout.y),this._addComponentsToContainer(a,d.components),this._removeComponentFromContainer(a,d)),c++}for(var c=0;c<b.length;c++)this._removeContainersTightlyWrappedByTheirParents(b[c])}},_reparentComponentsOverlayingContainers:function(a){var b=a.components||a.children;if(b){for(var c=0;c<b.length;){var d=b[c],e=this._getContainerOverlayingChild(d,b);e&&this._reparentComponent(d,e,a),c++}for(c=0;c<b.length;c++)this._reparentComponentsOverlayingContainers(b[c])}},_getContainerOverlayingChild:function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d.id!=a.id&&this._isContainer(d)&&"PAGES_CONTAINER"!=d.id&&!(this._getSurface(d)<this._getSurface(a))&&this._areComponentsOverlay(d,a,.75))return d}},_getSurface:function(a){return a.layout.width*a.layout.height},_handleNonHeaderOrFooterMasterPageComponents:function(a){for(var b=this._getComponentById("SITE_HEADER",a.children),c=this._getComponentById("SITE_FOOTER",a.children),d=this._getComponentById("PAGES_CONTAINER",a.children),e=0;e<a.children.length;){var f=a.children[e];if(f!=b&&f!=c&&f!=d)if(this._areComponentsOverlay(f,b))this._reparentComponent(f,b,a);else if(this._areComponentsOverlay(f,c))this._reparentComponent(f,c,a);else{var g=this._isHeaderCloserToComponentThanFooter(f,a)?b:c;this._reparentComponent(f,g,a)}else e++}},_reparentComponent:function(a,b,c){this._addComponentsToContainer(b,[a]),this._removeComponentFromContainer(c,a),a.layout.y=a.layout.y-b.layout.y,a.layout.x=a.layout.x-b.layout.x},_getComponentById:function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d.id==a)return d}},_getComponentByIdFromStructure:function(a,b){if(b.id==a)return b;var c=b.components||b.children;if(!c)return null;var d=this._getComponentById(a,c);if(d)return d;for(var e=0;e<c.length;e++){var f=this._getComponentByIdFromStructure(a,c[e]);if(f)return f}return null},_isHeaderCloserToComponentThanFooter:function(a,b){var c=a.layout.y+a.layout.height/2,d=this._getComponentById("SITE_HEADER",b.children),e=this._getComponentById("SITE_FOOTER",b.children),f=Math.abs(c-(d.layout.y+d.layout.height)),g=Math.abs(c-e.layout.y);return g>f},_isChildContainerAndTightlyWrappedByItsParent:function(a,b){if("SITE_PAGES"==a.id)return!1;var c=a.layout,d=b.components||b.children,e=b.layout,f=40;return 1==d.length&&this._isContainer(a)&&c.x<f&&c.y<f&&e.width-(c.x+c.width)<f&&e.height-(c.y+c.height)<f},_isContainer:function(a){var b=["Container","Page"];return b.contains(a.type)},_isVisualComponent:function(a){if(!a)return!1;var b=["wysiwyg.viewer.components.WPhoto","mobile.core.components.Container","wysiwyg.viewer.components.SlideShowGallery","wysiwyg.viewer.components.Video"];return b.contains(a.componentType)},_identifyTextAndItsCorrelatingVisual:function(a){var b=a.components||a.children;if(b){a.textVisualGroups=[];for(var c=0;c<b.length;c++){var d=b[c];if(d.isText){var e=this._getComponentNeighbors(d,b),f=this._findClosestVisualToComponent(e);if(f){var g=[d.id,f.id];a.textVisualGroups.push(g)}}}this._unifyGroups(a.textVisualGroups);for(var c=0;c<b.length;c++)this._identifyTextAndItsCorrelatingVisual(b[c])}},_findClosestVisualToComponent:function(a){for(var b=null,c=Number.MAX_VALUE,d=0;d<this.NEIGHBORS.length;d++){var e=a[this.NEIGHBORS[d]];this._isVisualComponent(e.comp)&&e.distance<c&&(b=e.comp,c=e.distance)}return b},_identifyBlocks:function(a){var b=a.components||a.children;if(b){a.blocks=[],a.blockLayout=[];var c=this._cloneJSON(a),d=c.components||c.children;d.sort(this._compareByRows);for(var e=[],f=0,g=0;g<d.length;g++)if(e.push(d[g].id),g==d.length-1)this._addCurrentBlockData(a,e);else{for(var h=!1,i=f;g>=i;i++)if(this._hasSufficientYOverLap(d[i],d[g+1])){h=!0;break}h||(this._addCurrentBlockData(a,e),e=[],f=g+1)}for(var g=0;g<b.length;g++)this._identifyBlocks(b[g])}},_addCurrentBlockData:function(a,b){var c=this._getComponentsFromIds(a,b),d=this._getGroupLayout(c);a.blockLayout.push(d),a.blocks.push(b)},_removeBlockFromStructure:function(a,b){var c=a.blocks.splice(b,1);this._removeComponentsFromContainer(a,c)},_getComponentBlockIndex:function(a,b){for(var c=0;c<a.blocks.length;c++)if(a.blocks[c].contains(b))return c},_identifyComponentClusters:function(a){a.clusterGroups=[];var b=a.components||a.children;if(b){for(var c=[],d=0;d<b.length;d++){var e=this._getComponentNeighbors(b[d],b);c.push(e)}var f=this._getAverageDistanceBetweenNeighbors(c);f=this._removeOutliersAndRecalculateDistanceAverage(c,f);for(var g=[],d=0;d<b.length;d++){for(var h=[b[d].id],e=c[d],i=.08,j=0;j<this.NEIGHBORS.length;j++){var k=e[this.NEIGHBORS[j]];k.comp&&k.distance/f<i&&h.push(k.comp.id)}h.length>1&&g.push(h)}a.clusterGroups=a.clusterGroups.concat(g),this._unifyGroups(a.clusterGroups);for(var d=0;d<b.length;d++)this._identifyComponentClusters(b[d])}},_unifyGroups:function(a){for(var b=-1;b!==a.length;){b=a.length;for(var c=a.length-1;c>=0;c--)for(var d=c-1;d>=0;d--)if(this._haveCommonElements(a[c],a[d])){this._mergeSecondArrayToFirstOne(a[d],a[c]),a.splice(c,1);break}}},_haveCommonElements:function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(a[c]==b[d])return!0;return!1},_mergeSecondArrayToFirstOne:function(a,b){for(var c=0;c<b.length;c++)a.contains(b[c])||a.push(b[c])},_getAverageDistanceBetweenNeighbors:function(a){for(var b=0,c=0,d=0;d<a.length;d++)for(var e=a[d],f=0;f<this.NEIGHBORS.length;f++){var g=e[this.NEIGHBORS[f]];g.comp&&(b+=g.distance,c++)}return c>0?b/c:-1},_getComponentNeighbors:function(a,b,c){var d=this._getComponentBorders(a),c=c||0,e=null,f=Number.MAX_VALUE,g=null,h=Number.MAX_VALUE,i=null,j=Number.MAX_VALUE,k=null,l=Number.MAX_VALUE;if(b)for(var m=0;m<b.length;m++){var n=b[m];if(a.id!=n.id&&!this._areComponentsOverlay(a,n,.25)){var o,p=this._getComponentBorders(n);this._hasYOverlap(a,n)&&(d.left+c>p.right&&(o=d.left-p.right,f>o&&(e=n,f=o)),d.right-c<p.left&&(o=p.left-d.right,h>o&&(g=n,h=o))),this._hasXOverlap(a,n)&&(d.top+c>p.bottom&&(o=d.top-p.bottom,j>o&&(i=n,j=o)),d.bottom-c<p.top&&(o=p.top-d.bottom,l>o&&(k=n,l=o)))}}return{leftNeighbor:{comp:e,distance:f},rightNeighbor:{comp:g,distance:h},topNeighbor:{comp:i,distance:j},bottomNeighbor:{comp:k,distance:l}}},_getComponentBorders:function(a){var b={left:a.layout.x,right:a.layout.x+a.layout.width,top:a.layout.y,bottom:a.layout.y+a.layout.height};return b},_removeOutliersAndRecalculateDistanceAverage:function(a,b){for(var c=2,d=0;d<a.length;d++)for(var e=a[d],f=0;f<this.NEIGHBORS.length;f++){var g=e[this.NEIGHBORS[f]];g.comp&&g.distance>b*c&&(g.distance=Number.MAX_VALUE,g.comp=null)}return b=this._getAverageDistanceBetweenNeighbors(a)},_identifyColumns:function(){},_identifyPatterns:function(a){var b=a.components||a.children;if(b){for(var c=[],d=0;d<b.length;d++)for(var e=this._getComponentNeighbors(b[d],b,5),f=0;f<this.NEIGHBORS.length;f++){var g=e[this.NEIGHBORS[f]];g.comp&&c.push({comp:b[d],neighbor:g.comp,distance:g.distance,direction:this.NEIGHBORS[f]})}a.patternGroups=a.patternGroups||[];for(var h=this._getPatternsFromNeighbors(c),d=0;d<h.length;d++)a.patternGroups.push([h[d][0].comp.id,h[d][0].neighbor.id]),a.patternGroups.push([h[d][1].comp.id,h[d][1].neighbor.id]);this._unifyGroups(a.patternGroups);for(var d=0;d<b.length;d++)this._identifyPatterns(b[d])}},_joinOrderingRelatedGroups:function(a){var b=a.components||a.children;if(b){a.neighborGroups=a.neighborGroups||[],a.neighborGroups=a.neighborGroups.concat(a.clusterGroups),a.neighborGroups=a.neighborGroups.concat(a.textVisualGroups),a.neighborGroups=a.neighborGroups.concat(a.patternGroups),this._unifyGroups(a.neighborGroups);for(var c=0;c<b.length;c++)this._joinOrderingRelatedGroups(b[c])}},_getPatternsFromNeighbors:function(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c],e=c+1;e<a.length;e++){var f=a[e];this._areNeighborRelationsSimilar(d,f)&&b.push([d,f])}return b},_areNeighborRelationsSimilar:function(a,b){if(a.comp.componentType==a.neighbor.componentType||b.comp.componentType==b.neighbor.componentType)return!1;var c=a.comp.componentType==b.comp.componentType&&a.comp.componentType==b.comp.componentType&&a.comp.id!=b.comp.id&&a.neighbor.id!=b.neighbor.id&&a.neighbor.componentType==b.neighbor.componentType&&a.direction==b.direction&&Math.abs(a.distance-b.distance)<10;return c},_addComponentOrder:function(a){var b=a.components||a.children;if(b){var c=this._cloneJSON(a),d=c.components||c.children;d.sort(this._compareByRows);for(var e=[],f=0;f<d.length;f++)e.push(d[f].id);for(a.componentsOrder=e,f=0;f<b.length;f++)this._addComponentOrder(b[f])}},_updateComponentOrderWithNeighborsInfo:function(a){if(a.neighborGroups&&a.neighborGroups.length>0){this._orderNeighborGroupsAccordingToComponentOrder(a);for(var b=0;b<a.componentsOrder.length;b++)for(var c=!1,d=0;d<a.neighborGroups.length&&!c;d++)for(var e=a.neighborGroups[d],f=0;f<e.length;f++)if(a.componentsOrder[b]==e[f]){c=!0;var g=e.slice(0);for(g.splice(f,1);g.length>0&&b<a.componentsOrder.length-1;){b++;var h=g.indexOf(a.componentsOrder[b]);if(-1==h){var i=g[0];a.componentsOrder.splice(a.componentsOrder.indexOf(i),1),a.componentsOrder.splice(b,0,i)}g.splice(0,1)}break}}var j=a.components||a.children;if(j)for(var b=0;b<j.length;b++)this._updateComponentOrderWithNeighborsInfo(j[b])},_orderNeighborGroupsAccordingToComponentOrder:function(a){for(var b=0;b<a.neighborGroups.length;b++){var c=a.neighborGroups[b];c.sort(this._compareByAnotherArrayOrder(a.componentsOrder))}},_compareByAnotherArrayOrder:function(a){return function(b,c){return a.indexOf(b)<a.indexOf(c)?-1:a.indexOf(b)>a.indexOf(c)?1:0}},_cloneJSON:function(a){return JSON.parse(JSON.stringify(a))},_compareByDistanceFromRoot:function(a,b){var c=Math.sqrt(Math.pow(a.layout.x,2)+Math.pow(a.layout.y,2)),d=Math.sqrt(Math.pow(b.layout.x,2)+Math.pow(b.layout.y,2));return d>c?-1:c>d?1:0},_compareByRows:function(a,b){if(!this._hasSufficientYOverLap(a,b)){if(a.layout.y<b.layout.y)return-1;if(a.layout.y>b.layout.y)return 1}return a.layout.x<b.layout.x?-1:a.layout.x>b.layout.x?1:0},_compareByColumns:function(a,b){if(!this._hasSufficientXOverLap(a,b)){if(a.layout.x<b.layout.x)return-1;if(a.layout.x>b.layout.x)return 1}return a.layout.y<b.layout.y?-1:a.layout.y>b.layout.y?1:0},_hasSufficientYOverLap:function(a,b){if(!this._hasYOverlap(a,b))return!1;var c=this._getYOverlap(a,b),d=Math.min(a.layout.height,b.layout.height);return c/d>.25},_hasSufficientXOverLap:function(a,b){if(!this._hasXOverlap(a,b))return!1;var c=this._getXOverlap(a,b),d=Math.min(a.layout.width,b.layout.width);return c/d>.25},_updatePageForMobileLayout:function(a){this._reorganizeChildren(a,this.MOBILE_WIDTH)},_rescaleComponentIfNeeded:function(a,b,c,d,e){var f=!this._doesComponentWidthFitInRow(a.layout.width,d,c)||this._isEnlargeComponentToFitPageWidth(a,b);if(this._isTextComponent(a)&&this._isRowConflictingWithReservedSpace(b,e)){f=!0;var g=this._getReservedSpaceConflictingWithRow(b,e);c=this._getNonConflictingSpaceInRow(g)}if(f){var h;h="VIRTUAL_GROUP"==a.componentType?this.CHILDREN_TREATMENT_METHOD.RESCALE_CHILDREN:"BACKGROUND_VIRTUAL_GROUP"==a.componentType?this.CHILDREN_TREATMENT_METHOD.BACKGROUND_AND_TEXT_CHILDREN:this.CHILDREN_TREATMENT_METHOD.REORGANIZE_CHILDREN,this._rescaleComponentToFitWidth(a,h,c)}},_reorganizeChildren:function(a,b){this._orderComponentsAccordingToGivenOrder(a);for(var c=[],d=this.COMPONENT_MOBILE_MARGIN,e=this.COMPONENT_MOBILE_MARGIN,f=0,g=a.components||a.children,h=0;h<g.length;h++){var i=g[h];this._breakLineNeeded(i,a,d,e,b)&&(this._centerComponentsOfLastRow(a,c,b,e),c=[],!this._isTextComponent(i)&&this._isRowConflictingWithReservedSpace(a,e)&&(f=Math.max(f,this._getReservedSpaceConflictingWithRow(a,e).height)),0!=f&&(e=e+f+this.COMPONENT_MOBILE_MARGIN),d=this.COMPONENT_MOBILE_MARGIN,this._rescaleComponentIfNeeded(i,a,b,d,e),f=i.layout.height),i.layout.x=d,i.layout.y=e,d=d+i.layout.width+this.COMPONENT_MOBILE_MARGIN,f=Math.max(f,i.layout.height),c.push(i)
}this._centerComponentsOfLastRow(a,c,b,e),this._ensureContainerWrapsChildren(a)},_breakLineNeeded:function(a,b,c,d,e){if(!this._isTextComponent(a)&&this._isRowConflictingWithReservedSpace(b,d)){var f=this._getReservedSpaceConflictingWithRow(b,d);e=this._getNonConflictingSpaceInRow(f)}var g=this._getComponentNeighborList(a,b),h=this._getComponentNeighborsTotalWidth(g),i=g[0]&&g[0].id==a.id,j=this._doesComponentWidthFitInRow(h,c,e),k=this._doesComponentWidthFitInRow(a.layout.width,c,e);return!k||i&&!j},_getReserevedSpaces:function(){return[{name:"tinyMenu",containerId:"SITE_HEADER",height:this.TINY_MENU_SIZE,width:this.TINY_MENU_SIZE,x:this.MOBILE_WIDTH-(this.TINY_MENU_SIZE+this.COMPONENT_MOBILE_MARGIN),y:this.COMPONENT_MOBILE_MARGIN}]},_isRowConflictingWithReservedSpace:function(a,b){return null!==this._getReservedSpaceConflictingWithRow(a,b)},_getReservedSpaceConflictingWithRow:function(a,b){for(var c=this._getReserevedSpaces(),d=0;d<c.length;d++){var e=c[d];if(a.id==e.containerId&&b<e.y+e.height)return e}return null},_getNonConflictingSpaceInRow:function(a){return this.MOBILE_WIDTH-a.width-this.COMPONENT_MOBILE_MARGIN},_ensureContainerWrapsChildren:function(a){var b=a.components||a.children;if(b){for(var c=0,d=0;d<b.length;d++)c=Math.max(c,b[d].layout.y+b[d].layout.height);a.layout&&a.layout.height<c&&(a.layout.height=c)}},_getComponentNeighborList:function(a,b){for(var c=this._findComponentInGroups(a.id,b.neighborGroups||[]),d=[],e=0;e<c.length;e++){var f=this._getComponentFromArray(c[e],b.components);d.push(f)}return d},_getComponentNeighborsTotalWidth:function(a){if(0==a.length)return 0;for(var b=this.COMPONENT_MOBILE_MARGIN,c=0;c<a.length;c++)b+=a[c].layout.width+this.COMPONENT_MOBILE_MARGIN;return b},_findComponentInGroups:function(a,b){for(var c=0;c<b.length;c++)for(var d=0;d<b.length;d++)if(a==b[c][d])return b[c];return[]},_getComponentFromArray:function(a,b){for(var c=0;c<b.length;c++)if(b[c].id==a)return b[c]},_orderComponentsAccordingToGivenOrder:function(a){a.components&&a.components.sort(this._sortByComponentsOrder(a.componentsOrder))},_sortByComponentsOrder:function(a){return function(b,c){var d=a.indexOf(b.id),e=a.indexOf(c.id);return d-e}},_isEnlargeComponentToFitPageWidth:function(a,b){return this._isComponentDirectChildOfSiteSegment(b)&&a.layout.width>.8*(this.MOBILE_WIDTH-2*this.COMPONENT_MOBILE_MARGIN)},_isComponentDirectChildContainerOfPage:function(a,b){return"mobile.core.components.Container"==a.componentType&&"mobile.core.components.Page"==b.componentType},_isComponentDirectChildOfSiteSegment:function(a){return this._isSiteSegment(a)||"mobile.core.components.Page"==a.componentType},_centerComponentsOfLastRow:function(a,b,c,d){if(!this._isRowConflictingWithReservedSpace(a,d)&&0!=b.length){for(var e=0,f=0;f<b.length;f++)e+=b[f].layout.width;for(var g=Math.round((c-e)/(b.length+1)),h=g,f=0;f<b.length;f++)b[f].layout.x=h,h=h+b[f].layout.width+g}},_identifyBackgroundImagesForText:function(a){var b=a.components||a.children;if(b){a.textBackgroundImageGroups=[];for(var c=0;c<b.length;c++)for(var d=c+1;d<b.length;d++)this._areComponentsTextAndBackgroundImage(b[c],b[d])&&a.textBackgroundImageGroups.push([b[c].id,b[d].id]);this._unifyGroups(a.textBackgroundImageGroups);for(var c=0;c<b.length;c++)this._identifyBackgroundImagesForText(b[c])}},_areComponentsTextAndBackgroundImage:function(a,b){var c=a.isText,d=b.isText,e="wysiwyg.viewer.components.WPhoto"==a.componentType,f="wysiwyg.viewer.components.WPhoto"==b.componentType,g=c&&f||d&&e;if(!g)return!1;var h=c?a:b,i=e?a:b;return this._isComponentSuitableForProportionGrouping(h)?!1:this._isFirstComponentSurroundedBySecondComponentTightly(h,i,100)},_isFirstComponentSurroundedBySecondComponentTightly:function(a,b,c){var d=a.layout.y+a.layout.height,e=b.layout.y+b.layout.height,f=a.layout.x+a.layout.width,g=b.layout.x+b.layout.width;return a.layout.x>=b.layout.x&&g>=f&&a.layout.y>=b.layout.y&&e>=d&&a.layout.x-c<=b.layout.x&&f+c>=g},_identifyOverlayingComponentsAsGroups:function(a){if(a.components){a.proportionGroups=a.proportionGroups||[];for(var b=[],c=this._cloneJSON(a),d=c.components||c.children;d.length>0;){var e=this._getOverlayingComponentsWithGivenComponent(d[0],d);if(0!=e.length){this._removeComponentsFromContainer(c,e);for(var f=0;f<e.length;){var g=this._getOverlayingComponentsWithGivenComponent(e[f],d);e=e.concat(g),this._removeComponentsFromContainer(c,g),f++}if(e.length>1){for(var h=[],i=0;i<e.length;i++)h.push(e[i].id);b.push(h)}}else this._removeComponentsFromContainer(c,[d[0]])}a.proportionGroups=a.proportionGroups.concat(b)}var j=a.components||a.children;if(j)for(var k=0;k<j.length;k++)this._identifyOverlayingComponentsAsGroups(j[k])},_getOverlayingComponentsWithGivenComponent:function(a,b){if(!this._isComponentSuitableForProportionGrouping(a))return[];for(var c=[],d=0;d<b.length;d++){var e=b[d];this._isComponentSuitableForProportionGrouping(e)&&this._areComponentsOverlay(a,e,.25)&&c.push(e)}return c},_isComponentSuitableForProportionGrouping:function(a){if("BACKGROUND_VIRTUAL_GROUP"==a.componentType)return!1;if(a.isText){var b=/(<([^>]+)>)/gi,c=this._viewerManagers.Data.getDataByQuery(a.dataQuery).get("text");if(c=c.replace(b,""),c.length>this.TEXT_MAX_LENGTH_FOR_RESCALING)return!1}if(!a.components)return!0;for(var d=!0,e=0;e<a.components.length;e++)d=d&&this._isComponentSuitableForProportionGrouping(a.components[e]);return d},_removeComponentsFromContainer:function(a,b){for(var c=0;c<b.length;c++)this._removeComponentFromContainer(a,b[c])},_removeComponentFromContainer:function(a,b){for(var c=b.id,d=a.components||a.children,e=0;e<d.length;e++)if(d[e].id==c)return d.splice(e,1),void 0},_addComponentsToContainer:function(a,b,c){var d=a.components||a.children;if(d||(d=[]),c)for(var e=b.length-1;e>=0;e--)d.splice(c,0,b[e]);else for(var e=0;e<b.length;e++)d.push(b[e])},_replaceBackGroupsToFlatComponents:function(a){var b=a.components||a.children;if(b){for(var c=[],d=0;d<b.length;){var e=b[d];"VIRTUAL_GROUP"==e.componentType&&(this._shiftGroupComponents(e.components,-1*e.layout.x,-1*e.layout.y),this._addComponentsToContainer(a,e.components,d+1),c.push(e)),"BACKGROUND_VIRTUAL_GROUP"==e.componentType&&(this._updateBackgroundImageTextComponentLayout(e),this._addComponentsToContainer(a,e.components,d+1),c.push(e)),d++}this._removeComponentsFromContainer(a,c);for(var d=0;d<b.length;d++)this._replaceBackGroupsToFlatComponents(b[d])}},_updateBackgroundImageTextComponentLayout:function(a){for(var b=0;b<a.components.length;b++){var c=a.components[b];c.layout.x+=a.layout.x,c.layout.y+=a.layout.y}},_doesComponentWidthFitInRow:function(a,b,c){return b+a+this.COMPONENT_MOBILE_MARGIN<c},_rescaleComponentToFitWidth:function(a,b,c){var d=a.wrappedTightlyByParent?c:c-2*this.COMPONENT_MOBILE_MARGIN,e=a.layout.width/d;this._rescaleComponentHeightIfNeeded(a,e),a.layout.width=d,a.components&&this._applyContainerRescaleOnChildren(a,b,e,d)},_rescaleComponentHeightIfNeeded:function(a,b){this._doesComponentNeedToRescaleItsHeight(a)&&(a.layout.height=Math.round(a.layout.height/b))},_doesComponentNeedToRescaleItsHeight:function(a){var b=["wysiwyg.viewer.components.MatrixGallery","wysiwyg.viewer.components.GoogleMap","wysiwyg.viewer.components.SliderGallery"];return b.contains(a.componentType)?!1:!0},_applyContainerRescaleOnChildren:function(a,b,c,d){b==this.CHILDREN_TREATMENT_METHOD.RESCALE_CHILDREN&&this._rescaleChildren(a,c),b==this.CHILDREN_TREATMENT_METHOD.REORGANIZE_CHILDREN&&this._reorganizeChildren(a,d),b==this.CHILDREN_TREATMENT_METHOD.BACKGROUND_AND_TEXT_CHILDREN&&this._setTextAndBackgroundChildren(a,c)},_setTextAndBackgroundChildren:function(a,b){for(var c=0;c<a.components.length;c++){var d=a.components[c];d.layout.width=Math.round(d.layout.width/b),d.layout.height=Math.round(d.layout.height/b),d.layout.x=Math.round(d.layout.x/b),d.layout.y=Math.round(d.layout.y/b)}},_rescaleChildren:function(a,b){for(var c=0;c<a.components.length;c++){var d=a.components[c],e=d.layout;if(this._rescaleComponentHeightIfNeeded(d,b),e.width=Math.round(e.width/b),e.x=Math.round(e.x/b),e.y=Math.round(e.y/b),d.isText){var f=W.Preview.getCompByID(d.id,Constants.ViewerTypesParams.TYPES.DESKTOP),g=this._textLayoutCalculator.calcAverageCharactersFontSize(f),h=g/b,i=W.Utils.mobile.convertFontSizeToMobile(g,1);d.layout.scale=h/i}d.components&&this._rescaleChildren(d,b)}},_recalculateComponentAnchors:function(a){var b=a.components||a.children;if(b){this._recalculateAnchorsOfContainerAndDirectChildren(a);for(var c=0;c<b.length;c++)this._recalculateComponentAnchors(b[c])}},_recalculateAnchorsOfContainerAndDirectChildren:function(a){a.children?this._setSiteSegmentAnchors(a):a.components&&(this._recalculateComponentAnchorsOfSameLevel(a.components),this._addBottomParentAnchorsToContainer(a),this._removeRedundantBottomParentAnchors(a))},_clearComponentAnchors:function(a){a.layout&&(a.layout.anchors=[]);var b=a.components||a.children;if(b)for(var c=0;c<b.length;c++)this._clearComponentAnchors(b[c])},_setSiteSegmentAnchors:function(a){var b=this._getComponentById("SITE_HEADER",a.children),c=this._getComponentById("SITE_FOOTER",a.children),d=this._getComponentById("PAGES_CONTAINER",a.children);this._addToTopAnchor(b,d,{distance:10,locked:!0,type:"BOTTOM_TOP"}),this._addToTopAnchor(d,c,{distance:10,locked:!0,type:"BOTTOM_TOP"}),c.layout.anchors=c.layout.anchors||[],c.layout.anchors.push({distance:10,locked:!0,originalValue:500,targetComponent:"SITE_STRUCTURE",topToTop:500,type:"BOTTOM_PARENT"})},_isSiteSegment:function(a){var b=["wysiwyg.viewer.components.HeaderContainer","wysiwyg.viewer.components.PagesContainer","wysiwyg.viewer.components.FooterContainer"];return b.contains(a.componentType)},_recalculateComponentAnchorsOfSameLevel:function(a){for(var b=0;b<a.length;b++)for(var c=a[b],d=this._getComponentsBelowComponent(c,a),e=0;e<d.length;e++)this._addToTopAnchor(c,d[e]);this._removeRedundantBottomTopAnchors(a)},_getComponentsBelowComponent:function(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];a.id!=e.id&&this._hasXOverlap(a,e)&&a.layout.y<=e.layout.y&&c.push(e)}return c},_hasYOverlap:function(a,b){return a.layout.y==b.layout.y?!0:this._getYOverlap(a,b)>0},_getYOverlap:function(a,b){var c=a.layout.y<b.layout.y?a:b,d=c==b?a:b,e=c.layout.y+c.layout.height,f=d.layout.y+d.layout.height;return f>e?e-d.layout.y:d.layout.height},_hasXOverlap:function(a,b){return a.layout.x==b.layout.x?!0:this._getXOverlap(a,b)>0},_getXOverlap:function(a,b){var c=a.layout.x<b.layout.x?a:b,d=c==b?a:b,e=c.layout.x+c.layout.width,f=d.layout.x+d.layout.width;return f>e?e-d.layout.x:d.layout.width},_areComponentsOverlay:function(a,b,c){var d=this._hasYOverlap(a,b)&&this._hasXOverlap(a,b);if(!d||!c)return d;var e=this._getXOverlap(a,b)*this._getYOverlap(a,b),f=Math.min(a.layout.width*a.layout.height,b.layout.width*b.layout.height);return e/f>c},_addToTopAnchor:function(a,b,c){var d=b.layout.y+b.layout.height,e=a.layout.y+a.layout.height,f=d>e&&b.layout.y>e/2,g=f?b.layout.y-e:b.layout.y-a.layout.y,h=b.layout.y-a.layout.y,i=g<=this._viewerManagers.Layout.LOCK_THRESHOLD,j=b.layout.y,k=f?"BOTTOM_TOP":"TOP_TOP",l={distance:g,locked:i,originalValue:j,targetComponent:b.id,topToTop:h,type:k};c&&_.assign(l,c),a.layout.anchors.push(l)},_addBottomParentAnchor:function(a,b,c){var d=Math.max(b.layout.height-(a.layout.y+a.layout.height),0),e=a.layout.y,f=d<=this._viewerManagers.Layout.LOCK_THRESHOLD,g=b.layout.height,h={distance:d,locked:f,originalValue:g,targetComponent:b.id,topToTop:e,type:"BOTTOM_PARENT"};c&&_.assign(h,c),a.layout.anchors.push(h)},_removeRedundantBottomTopAnchors:function(a){for(var b=0;b<a.length;b++)for(var c=b+1;c<a.length;c++)for(var d=c+1;d<a.length;d++)this._hasAnchor(a[b],a[c],"BOTTOM_TOP")&&this._hasAnchor(a[c],a[d],"BOTTOM_TOP")&&this._hasAnchor(a[b],a[d],"BOTTOM_TOP")&&this._removeAnchor(a[b],a[d],"BOTTOM_TOP")},_removeRedundantBottomParentAnchors:function(a){for(var b=a.components,c=0;c<b.length;c++)for(var d=0;d<b.length;d++)this._hasAnchor(b[c],a,"BOTTOM_PARENT")&&this._hasAnchor(b[d],a,"BOTTOM_PARENT")&&this._hasAnchor(b[c],b[d],"BOTTOM_TOP")&&this._removeAnchor(b[c],a,"BOTTOM_PARENT")},_hasAnchor:function(a,b,c){for(var d=0;d<a.layout.anchors.length;d++){var e=a.layout.anchors[d];if(e.targetComponent==b.id&&e.type==c)return!0}return!1},_removeAnchor:function(a,b,c){for(var d=null,e=0;e<a.layout.anchors.length;e++){var f=a.layout.anchors[e];f.targetComponent==b.id&&f.type==c&&(d=e)}null!==d&&a.layout.anchors.splice(d,1)},_addBottomParentAnchorsToContainer:function(a){q=this._stringifyDataManagerDataMapForSpecPurposes;for(var b=0;b<a.components.length;b++){var c=a.components[b];this._addBottomParentAnchor(c,a)}},_applyWebStructureModificationsOnMobileStructure:function(a,b,c){this._identifyBlocks(b);var d=this._getComponentIdsDeletedFromWebStructure(a,b);this._deleteComponentsFromMobileStructure(b,d);var e=this._getComponentIdsAddedToWebStructure(a,b,c);this._analyzeStructure(a),this._addComponentsToMobileStructure(b,a,a,e);var f=void 0==b.id;f&&!c.contains("TINY_MENU")&&this._addTinyMenu(b),this._cleanUpAlgorithmProperties(b),this._updateAnchors(b)},_getComponentIdsAddedToWebStructure:function(a,b,c){var d=this._getStructureComponentIds(a,!0),e=this._getStructureComponentIds(b),f=_.difference(d,e),g=_.difference(f,c);return g},_addComponentsToMobileStructure:function(a,b,c,d){var e=c.components||c.children;if(e){for(var f=0;f<c.componentsOrder.length;f++){var g=c.componentsOrder[f];if(d.contains(g)){var h,i=this._getComponentByIdFromStructure(g,c),j=this._getPreviousComponentIdThatAlsoExistInMobile(c,g,a);h=j?this._getContainerOfComponent(j,a):this._getAncestorContainerExistingInMobile(g,b,a),this._insertAddedComponentBetweenBlocks(h,i,j)}}for(var f=0;f<e.length;f++)this._addComponentsToMobileStructure(a,b,e[f],d)}},_getAncestorContainerExistingInMobile:function(a,b,c){for(var d=this._getComponentIdToItsContainerIdMap(b),e=d[a],f=this._getComponentByIdFromStructure(e,c);!f;)e=d[e],f=this._getComponentByIdFromStructure(e,c);return f},_getComponentIdToItsContainerIdMap:function(a){var b={},c=a.components||a.children;if(c)for(var d=0;d<c.length;d++){var e=c[d];b[e.id]=a.id,b=_.merge(b,this._getComponentIdToItsContainerIdMap(e))}return b},_getPreviousComponentIdThatAlsoExistInMobile:function(a,b,c){for(var d=a.componentsOrder.indexOf(b),e=d-1;e>=0;e--){var f=a.componentsOrder[e],g=this._getComponentById(f,a.components||a.children);if(this._getComponentByIdFromStructure(f,c))return f;if("VIRTUAL_GROUP"==g.componentType||"BACKGROUND_VIRTUAL_GROUP"==g.componentType)for(var h=0;h<g.components.length;h++)if(this._getComponentByIdFromStructure(g.componentsOrder[h],c))return g.componentsOrder[h]}return null},_getContainerOfComponent:function(a,b){var c=b.components||b.children;if(!c)return null;for(var d=0;d<c.length;d++)if(c[d].id==a)return b;for(var d=0;d<c.length;d++){var e=this._getContainerOfComponent(a,c[d]);if(e)return e}return null},_insertAddedComponentBetweenBlocks:function(a,b,c){var d;if(c){for(var e=0;e<a.blocks.length;e++)if(a.blocks[e].contains(c)){d=e;break}}else d=-1;var f=Object.clone(b);(b.components||b.children)&&this._clearIdentificationsAndChildrenFromAddedComponent(f),f.layout.x=this.COMPONENT_MOBILE_MARGIN,f.layout.y=d>=0?a.blockLayout[d].y+a.blockLayout[d].height+this.COMPONENT_MOBILE_MARGIN:this.COMPONENT_MOBILE_MARGIN,this._rescaleComponentIfNeeded(f,a,a.layout.width,this.COMPONENT_MOBILE_MARGIN,f.layout.y),this._shiftComponentsLowerThanBlock(a,d,b.layout.height+this.COMPONENT_MOBILE_MARGIN),a.components.push(f),a.blocks.splice(d+1,0,[f.id]),a.blockLayout.splice(d+1,0,f.layout)},_clearIdentificationsAndChildrenFromAddedComponent:function(a){a.blocks=[],a.blockLayout=[],a.components=[],a.componentsOrder=[]},_deleteComponentsFromMobileStructure:function(a,b){var c=a.components||a.children;if(c){var d=_(c).map(function(a){return a.id}).value(),e=_.intersection(b,d),f=this._getComponentsFromIds(a,e);this._removeComponentsFromContainer(a,f),this._updateBlocksAndModifyLayoutIfNeeded(a,e);for(var g=0;g<c.length;g++)this._deleteComponentsFromMobileStructure(c[g],b)}},_updateBlocksAndModifyLayoutIfNeeded:function(a,b){for(var c=0;c<a.blocks.length;c++)a.blocks[c]=_.difference(a.blocks[c],b);for(var c=0;c<a.blocks.length;)0==a.blocks[c].length?(this._shiftUpComponentsLowerThanDeletedBlock(a,c),a.blocks.splice(c,1),a.blockLayout.splice(c,1)):c++},_getComponentIdsDeletedFromWebStructure:function(a,b){var c=this._getStructureComponentIds(a,!0),d=this._getStructureComponentIds(b),e=_.difference(d,c);return e.indexOf("TINY_MENU")>-1&&e.splice(e.indexOf("TINY_MENU"),1),e},_shiftUpComponentsLowerThanDeletedBlock:function(a,b){this._shiftComponentsLowerThanBlock(a,b,-(a.blockLayout[b].height+this.COMPONENT_MOBILE_MARGIN))},_shiftComponentsLowerThanBlock:function(a,b,c){for(var d=b+1;d<a.blocks.length;d++){for(var e=a.blocks[d],f=0;f<e.length;f++){var g=this._getComponentById(e[f],a.components);g.layout.y+=c}a.blockLayout[d].y+=c}},_getStructureComponentIds:function(a,b){var c=[];!a.id||b&&this._isNonMobileComponent(a)||c.push(a.id);var d=a.components||a.children;if(d)for(var e=0;e<d.length;e++)c=c.concat(this._getStructureComponentIds(d[e],b));return c},mergeMobileStructures:function(a,b,c){c=c||[],this._applyWebStructureModificationsOnMobileStructure(a.masterPage,b.masterPage,c),this._addAndDeletePagesInMobileAccoringToWebsite(a.pages,b.pages);for(var d=_.values(b.pages),e=_.values(a.pages),f=0;f<d.length;f++){for(var g=d[f],h=0;h<e.length;h++){var i=e[h];if(g.id==i.id)break}this._applyWebStructureModificationsOnMobileStructure(i,g,c)}return b},_addAndDeletePagesInMobileAccoringToWebsite:function(a,b){this._addPagesToMobile(a,b),this._deletePagesFromMobile(a,b)},_addPagesToMobile:function(a,b){for(var c=_.values(a),d=_.values(b),e=0;e<c.length;e++){var f=c[e].id;this._isComponentIdExistInArrayOfComponents(f,d)||(b[f]=_.cloneDeep(a[f]),this._convertStructureToMobileLayout(b[f],"page",[]))}},_deletePagesFromMobile:function(a,b){for(var c=_.values(a),d=_.values(b),e=0;e<d.length;e++){var f=d[e].id;this._isComponentIdExistInArrayOfComponents(f,c)||delete b[f]}},_isComponentIdExistInArrayOfComponents:function(a,b){for(var c=0;c<b.length;c++){var d=b[c].id;if(a==d)return!0}return!1},getComponentsExistingInWebsiteButNotInMobile:function(a,b){componentsExistingInWebsiteButInMobile=this._getComponentIdsAddedToWebStructure(a.masterPage,b.masterPage,[]);for(var c=_.values(b.pages),d=_.values(a.pages),e=0;e<c.length;e++){for(var f=c[e],g=0;g<d.length;g++){var h=d[g];if(f.id==h.id)break}componentsExistingInWebsiteButInMobile=componentsExistingInWebsiteButInMobile.concat(this._getComponentIdsAddedToWebStructure(h,f,[]))}return componentsExistingInWebsiteButInMobile}})}),define.experiment.Class("wysiwyg.viewer.responsive.ResponsiveAlgorithmAPI.MobileEditor1.New",function(a,b){var c=a;c.resources(["W.Commands"]),c.utilize(["wysiwyg.viewer.responsive.ResponsiveAlgorithm"]),c.methods({initialize:function(){this._responsiveAlgorithm=new this.imports.ResponsiveAlgorithm,this.resources.W.Commands.registerCommandAndListener("WEditorCommands.RegisterExtraOperationsForComponentClassName",this,this.registerExtraOperationsForComponentClassName),this.resources.W.Commands.registerCommandAndListener("WEditorCommands.RegisterIsMobileComponentFunction",this,this.registerIsMobileComponentFunction)},convertStructureToMobileLayout:function(a,b,c){c=c||[],this._responsiveAlgorithm._convertStructureToMobileLayout(a,b,c)},modifyStylesToFitMobileLayout:function(){this._responsiveAlgorithm._modifyStylesToFitMobileLayout()},mergeMobileStructures:function(a,b,c){return this._responsiveAlgorithm.mergeMobileStructures(a,b,c)},registerExtraOperationsForComponentClassName:function(a){this._responsiveAlgorithm.registerExtraOperationsForComponentClassName(a)},registerIsMobileComponentFunction:function(a){return this._responsiveAlgorithm.registerIsMobileComponentFunction(a)},getComponentsExistingInWebsiteButNotInMobile:function(a,b){return this._responsiveAlgorithm.getComponentsExistingInWebsiteButNotInMobile(a,b)}})}),define.experiment.newClass("wysiwyg.viewer.responsive.ResponsiveAlgorithmAPI.ViewerRefactor.New",function(a,b){var c=a;c.methods({initialize:function(){},convertStructureToMobileLayout:function(){},modifyStylesToFitMobileLayout:function(){},mergeMobileStructures:function(a,b){return b},registerExtraOperationsForComponentClassName:function(){},registerIsMobileComponentFunction:function(){},getComponentsExistingInWebsiteButNotInMobile:function(){return[]}})}),define.experiment.newClass("wysiwyg.viewer.responsive.TextLayoutCalculator.MobileEditor1.New",function(a,b){var c=a;c.methods({initialize:function(){},getTextOverallBorders:function(a){var b=this.getEffectiveTextLayout(a);if(!b)return null;for(var c=Number.MAX_VALUE,d=Number.MIN_VALUE,e=Number.MAX_VALUE,f=Number.MIN_VALUE,g=0;g<b.length;g++){var h=b[g];c=Math.min(c,h.top),d=Math.max(d,h.bottom),e=Math.min(e,h.left),f=Math.max(f,h.right)}var i={left:Math.round(a.layout.x+e),right:Math.round(a.layout.x+f),top:Math.round(a.layout.y+c),bottom:Math.round(a.layout.y+d)};return i},getEffectiveTextLayout:function(a){var b=W.Data.getDataByQuery(a.dataQuery).get("text"),c=new Element("div");c.set("html",b),this._wrapTextInSpan(c),c.style.position="absolute",c.style.top="0px",c.style.left="0px",c.style.width=a.layout.width+"px",c.style.height=a.layout.height+"px",c.style["word-wrap"]="break-word",window.document.body.appendChild(c);var d=this._getSpanRects(c);return window.document.body.removeChild(c),d},_shouldWrapInSpan:function(a){return 3===a.nodeType&&("SPAN"!=a.parentElement.nodeName||a.parentElement.childElementCount>1)&&""!=a.data.trim()},_setDefaultStyleIfNeeded:function(a,b,c){""===a.style[b]&&(a.style[b]=c)},_fixRichTextNewSkinStyle:function(a){("P"===a.nodeName||"H1"===a.nodeName||"H2"===a.nodeName||"H3"===a.nodeName||"H4"===a.nodeName||"H5"===a.nodeName||"H6"===a.nodeName)&&(this._setDefaultStyleIfNeeded(a,"line-height","normal"),this._setDefaultStyleIfNeeded(a,"margin",0),this._setDefaultStyleIfNeeded(a,"letter-spacing","normal")),"UL"===a.nodeName&&(this._setDefaultStyleIfNeeded(a,"list-style-type","disc"),this._setDefaultStyleIfNeeded(a,"padding-left","1.3em"),this._setDefaultStyleIfNeeded(a,"margin-left","0.5em"),this._setDefaultStyleIfNeeded(a,"line-height","normal"),this._setDefaultStyleIfNeeded(a,"letter-spacing","normal"),this._setDefaultStyleIfNeeded(a,"list-style-type","circle"),(a.dir="rtl")&&(this._setDefaultStyleIfNeeded(a,"padding-rigth","1.3em"),this._setDefaultStyleIfNeeded(a,"margin-right","0.5em"))),"OL"===a.nodeName&&(this._setDefaultStyleIfNeeded(a,"list-style-type","decimal"),this._setDefaultStyleIfNeeded(a,"padding-left","1.3em"),this._setDefaultStyleIfNeeded(a,"margin-left","0.5em"),this._setDefaultStyleIfNeeded(a,"line-height","normal"),this._setDefaultStyleIfNeeded(a,"letter-spacing","normal"),this._setDefaultStyleIfNeeded(a,"list-style-type","circle"),(a.dir="rtl")&&(this._setDefaultStyleIfNeeded(a,"padding-rigth","1.3em"),this._setDefaultStyleIfNeeded(a,"margin-right","0.5em"))),"LI"===a.nodeName&&(this._setDefaultStyleIfNeeded(a,"color","inherit"),this._setDefaultStyleIfNeeded(a,"font-size","inherit"),this._setDefaultStyleIfNeeded(a,"font-family","inherit"),this._setDefaultStyleIfNeeded(a,"font-style","inherit"),this._setDefaultStyleIfNeeded(a,"font-weight","inherit"),this._setDefaultStyleIfNeeded(a,"font-height","normal"),this._setDefaultStyleIfNeeded(a,"letter-spacing","normal"))},_convert2originalFontStyle:function(a){if(a.hasClass)for(i=0;i<W.Theme.getOriginalFontSizes().length;i++){var b="font_"+i;if(a.hasClass(b)){var c=W.Theme.getProperty(b);return a.style.font=c.getCssValue(),a.style["font-size"]=W.Theme._originalFontValues[i]+"px",void 0}}},_wrapTextInSpan:function(a){this._convert2originalFontStyle(a);for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(this._shouldWrapInSpan(c)){var d=new Element("span");d.set("html",c.data),a.insertBefore(d,c.nextSibling),a.removeChild(c)}else this._fixRichTextNewSkinStyle(c),this._wrapTextInSpan(c)}},_getSpanRects:function(a){var b=_(a.getElements("span")),c=b.filter(function(a){return 1==a.childNodes.length&&3==a.firstChild.nodeType}).map(function(a){return a.getBoundingClientRect()}).value();return c},_drawDivs:function(a,b){b||(b={x:0,y:0}),_.each(a,function(a){var c=new Element("div");c.style.position="absolute",c.style.visibility="visible",c.style.top=a.top+b.y+"px",c.style.left=a.left+b.x+"px",c.style.width=a.width+"px",c.style.height=a.height+"px",c.style.border="1px solid",window.document.body.appendChild(c)})},calcAverageCharactersFontSize:function(a){var b=this._getFontSizeToNumberOfCharactersMap(a);return this._calcAverageFontSize(b)},_calcAverageFontSize:function(a){var b=_.reduce(a,function(a,b,c){return a.count+=b,a.sum+=b*c,a},{count:0,sum:0});return b.sum/b.count},_getFontSizeToNumberOfCharactersMap:function(a,b){var c={};if(a.children)for(var d=0;d<a.children.length;d++){var e=a.children[d],f=this._getNodeFontSize(e,b),g=this._getFontSizeToNumberOfCharactersMap(e,f);this._mergeMaps(g,c),this._addChildNumOfCharactersToMap(e,f,c)}return c},_addOrUpdate:function(a,b,c){a[b]?a[b]+=c:a[b]=c},_mergeMaps:function(a,b){for(key in a)this._addOrUpdate(b,key,a[key])},_addChildNumOfCharactersToMap:function(a,b,c){if(!isNaN(b)){var d=W.Utils.mobile.calcNodeDirectCharacters(a);d>0&&this._addOrUpdate(c,b,d)}},_getNodeFontSize:function(a,b){var c=W.Utils.mobile.getFontSize(a,W.Theme);return isNaN(c)&&(c=b),c}})});
/*
//@ sourceMappingURL=commonExperiments.map.js
*/