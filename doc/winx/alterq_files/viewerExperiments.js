define.experiment.component("wysiwyg.viewer.components.AdminLoginButton.NBC_SiteButton.New",function(a){var b=a;b.dataTypes(["SiteButton"]),b.states({button:["up","pressed"],alignment:["center","left","right"]})}),define.experiment.newComponent("wysiwyg.viewer.components.BgImageStrip.BgImageStrip.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.resources(["W.Config","W.Viewer","topology"]),b.dataTypes(["Image"]),b.skinParts({bg:{type:"htmlElement"}}),b.propertiesSchemaType("BgImageStripProperties"),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._baseUrl=W.Config.getMediaStaticUrl(),this._likeAVirgin=!0,this._docWidth=W.Viewer.getDocWidth(),this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.BOTTOM],this.EDITOR_META_DATA={general:{settings:!0,design:!0}}},_onRender:function(a){return this._likeAVirgin?(this._fixWidth(),this._setBgDefaults(),this._setBgImage(),this._likeAVirgin=!1,void 0):(this.isRendered()&&(a.data.invalidations.isInvalidated([this.INVALIDATIONS.WIDTH_REQUEST])&&this._fixWidth(),a.data.invalidations.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE])&&(this._setBgDefaults(),this._setBgImage()),a.data.invalidations.isInvalidated([this.INVALIDATIONS.DATA_CHANGE])&&this._setBg(a.data.invalidations._invalidations.dataChange)),void 0)},_fixWidth:function(){var a=document.body.clientWidth;this.setWidth(a),this.$view.style.width=a+"px",this.$view.style.left=this.getDiff()+"px"},_setBgDefaults:function(){this._skinParts.bg.style.backgroundPosition=this.getComponentProperty("bgPosition"),this._skinParts.bg.style.backgroundRepeat=this.getComponentProperty("bgRepeat"),this._skinParts.bg.style.backgroundSize=this.getComponentProperty("bgSize")},_setBgImage:function(){var a=this._data.get("uri"),b=this._skinParts.bg;return a&&""!==a?(b.style.backgroundImage="url("+this._baseUrl+a+")",void 0):(b.style.backgroundImage="",void 0)},_setBg:function(a){_.each(a,function(a){"Image"===a.dataItem._dataType?this._setBgImage():this._setBgDefaults()}.bind(this))},getDiff:function(){var a=(this._docWidth-document.body.clientWidth)/2;return a>=0?0:a},isContainable:function(){return!1},isContainer:function(){return!1},getSelectableX:function(){return this.getDiff()},getX:function(){return 0},setX:function(){}})}),define.experiment.component("wysiwyg.viewer.components.ClipArt.MediaGalleryFrame.New",function(a,b){var c=a,d=b;c.binds(d.merge(["_mediaGalleryCallback"])),c.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"CLIP_ART_REPLACE_IMAGE",command:"WEditorCommands.OpenMediaFrame",commandParameter:{galleryConfigID:"clipart",publicMediaFile:"clipart",i18nPrefix:"clipart",selectionType:"single",mediaType:"picture",callback:"_mediaGalleryCallback"}},{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenMediaFrame",commandParameter:{galleryConfigID:"clipart",publicMediaFile:"clipart",i18nPrefix:"clipart",selectionType:"single",mediaType:"picture",callback:"_mediaGalleryCallback"}}}}),c.methods({_mediaGalleryCallback:function(a){this.getDataItem().setFields({title:a.title,description:a.description||"",height:a.height,width:a.width,uri:a.fileName})}})}),define.experiment.component("wysiwyg.viewer.components.ClipArt.MobileEditor1.New",function(a,b){var c=a,d=b;c.fields({EDITOR_META_DATA:d.merge({mobile:{previewImageDataRefField:"*"}})})}),define.experiment.component("wysiwyg.viewer.components.ClipArt.NBC_WPhoto.New",function(a){var b=a;b.dataTypes(["Image"])}),define.experiment.component("wysiwyg.viewer.components.ContactForm.ContactFormRefactor.New",function(a,b){var c=a;c.resources(["W.Config","W.Viewer","topology"]),c.propertiesSchemaType("ContactFormProperties"),c.utilize(["core.managers.serverfacade.WixRESTClient"]),c.inherits("core.components.base.BaseComp"),c.binds(["_onSubmit"]),c.skinParts({notifications:{type:"htmlElement"},name:{type:"htmlElement",optional:!0},subject:{type:"htmlElement",optional:!0},message:{type:"htmlElement",optional:!0},phone:{type:"htmlElement",optional:!0},email:{type:"htmlElement"},address:{type:"htmlElement",optional:!0},submit:{type:"htmlElement"}}),c.states(["left","right"]),c.fields({Resources:b.remove()}),c.methods({initialize:function(a,b,c){this.parent(a,b,c),this._restClient=null,this.EDITOR_META_DATA={general:{settings:!0,design:!0}}},_onAllSkinPartsReady:b.remove(),_onRender:function(a){this.isRenderNeeded(a.data.invalidations)&&(this._setFormFields(),a.data.invalidations.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE])&&this._skinParts.submit.addEvent("click",this._onSubmit),this._isLikeAVirgin()&&(this._restClient=new this.imports.WixRESTClient,this._decryptEmails()))},_setFormFields:function(){this._setMailIfNeeded(document.cookie),_.each(this._data._data,function(a,b){if(!/(Message|toEmail|bccEmail|metaData|id|Error|type)/.test(b)){if("submitButtonLabel"==b)return this._skinParts.submit.innerText=a,void 0;if("textDirection"==b)return this.setState(a),void 0;var c=b.split(/([A-Z])/).shift(),d=this.getComponentProperty("required_"+b),e=!this.getComponentProperty("hidden_"+b),f=this._view.querySelector('label[for="'+c+'"]'),g=this._skinParts[c];g.hidden=e,g.placeholder=a,f.innerText=a,e?(g.required="email"==c,f.style.display="none"):(g.required=d,f.removeAttribute("style"))}}.bind(this))},sendEmail:function(a,b,c){var d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0"),e=this,f=b;d.open("POST",a,!0),d.setRequestHeader("Content-type","application/json"),d.send(JSON.encode(b)),d.onabort=this._showMessage("request aborted",!0),d.ontimeout=this._showMessage("request timeout",!0),d.onerror=this._showMessage("request error",!0),d.onload=function(){return 404==this.status?(e._showMessage("not found 404",!0),c||e.sendEmail(e._getOldServiceUrl(),f,!0),void 0):(e._showMessage(e._data.get("successMessage")),e._cleanForm(),void 0)}},_onSubmit:function(){var a=window.location.origin+"/_api/common-services/notification/invoke?accept=json";return this._setMailIfNeeded(document.cookie)?(this._showMessage("Some Error just happens",!0),void 0):this._isValid()?(this._showMessage("sending..."),this.sendEmail(a,this._formatData()),void 0):(this._showMessage(this._data.get("validationErrorMessage"),1),void 0)},_formatData:function(){var a={},b=this._data.get("toEmailAddress"),c=this._data.get("bccEmailAddress"),d="<b>You have a new message</b><br><br>via: www."+window.location.origin+"<br><br><b>Message details:</b><br><br>",e=_.filter(this._skinParts,function(a){return!a.hidden&&/(textarea|input)/.test(a.nodeName.toLowerCase())}),f=rendererModel.metaSiteId||"dc853130-4fb2-464f-878d-3b6667dc4f97";return _.each(e,function(b){var c=b.getAttribute("skinpart");a[c]=b.value,d+=this._data.get(c+"FieldLabel")+": "+b.value+"<br>"}.bind(this)),d+="<br><b>sent on: </b>"+this._getSendDate()+"<br><i>Thank you for using Wix.com!</i>",data={to:[{address:b,personal:b}],cc:[],bcc:c?[{address:c,personal:c}]:[],from:{address:a.email||"n/a",personal:a.name||"n/a"},subject:a.subject||"n/a",metaSiteId:f,htmlMessage:d,plainTextMessage:a.message||"n/a"}},_showMessage:function(a,b){this._skinParts.notifications.innerText=a,this._skinParts.notifications.className=b?"error":"success"},_cleanForm:function(){_.each(this._skinParts,function(a){/(textarea|input)/.test(a.nodeName.toLowerCase())&&(a.value="")})},_setMailIfNeeded:function(a){if(this._data.get("toEmailAddress"))return!1;var b=_.find(a.split(";"),function(a){return a.match(/wixClient/)}),c=_.find(b.split("|"),function(a){return a.match(/@/)});return"string"!=typeof c?!1:(this._data.set("toEmailAddress",c),this._data.set("bccEmailAddress",c),void 0)},_decryptEmails:function(){var a,b,c,d=window.location.origin+"/html/email/decrypt/",e=W.Config.getSiteId();c="toEmailAddress",a=this._data.get(c),this._isEmptyOrDecryptedEmail(a)||(b=d+a+"/"+e,this._doRequest(b,c)),c="bccEmailAddress",a=this._data.get(c),this._isEmptyOrDecryptedEmail(a)||(b=d+a+"/"+e,this._doRequest(b,c))},_doRequest:function(a,b){var c={},d={onSuccess:this._generateScopedSuccessCallback(b),onError:this._generateScopedErrorCallback(b)};this._restClient.get(a,c,d)},_generateScopedSuccessCallback:function(a){return function(b){this._data.set(a,b.email)}.bind(this)},_generateScopedErrorCallback:function(a){return function(b){({dataFieldName:a,originalMail:this._data.get(a),errorMsg:b}),this._data.set(a,"")}.bind(this)},_isLikeAVirgin:function(){return!this.resources.W.ComponentLifecycle.getComponentInfo(this).isDisplayedBefore},_isValid:function(){if(!/^(([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+|\s*)$/.test(this._skinParts.email.value))return this._skinParts.email.classList.add("error"),!1;this._skinParts.email.classList.remove("error");var a=_.filter(this._skinParts,function(a){return("INPUT"===a.nodeName||"TEXTAREA"===a.nodeName)&&a.hidden!==!0&&a.required!==!1});return _.every(a,function(a){return""!==a.value?(a.removeAttribute("state"),!0):(a.setAttribute("state","error"),!1)})},_isEmptyOrDecryptedEmail:function(a){return!a||a&&a.match(/^(([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+|\s*)$/)},_getSendDate:function(){var a="January,February,March,April,May,June,July,August,September,October,November,December".split(","),b=new Date;return b.getDate()+", "+a[b.getMonth()]+", "+b.getFullYear()},_getOldServiceUrl:function(){var a=W.Config.getServiceTopologyProperty("emailServer"),b=rendererModel.previewMode,c=encodeURIComponent(window.location.origin+window.location.pathname),d="&wixSession="+W.CookiesManager.getCookie("wixSession");return a+(b?"Secured":"")+"?accept=json&contentType=json&appUrl="+c+(b?d:"")}})}),define.experiment.component("wysiwyg.viewer.components.ContactForm.CorsContactForm.New",function(a){var b=a;b.resources(["W.Config"]),b.methods({sendEmail:function(a,b,c,d,e,f,g,h,i){var j={to:a,cc:b,bcc:c,from:d,subject:e,htmlMessage:f,plainTextMessage:g,metaSiteId:h},k=window.location.protocol+"//"+window.location.hostname+"/_api/common-services/notification/invoke?accept=json";this._sendJsonCORS(k,j,i)},_getOldServiceUrl:function(){var a=this.injects(),b=a.Config.getServiceTopologyProperty("emailServer"),c=this._isPreviewMode();c&&(b+="Secured");var d=[];return d.push(b),d.push("?accept=json&contentType=json"),d.push("&appUrl="+encodeURIComponent(window.location.href)),c&&d.push("&wixSession="+a.CookiesManager.getCookie("wixSession")),d.join("")},_sendJsonCORS:function(a,b,c){var d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");d.open("POST",a,!0),d.setRequestHeader("Content-type","application/json"),d.send(JSON.encode(b)),d.onabort=function(){c(!1,"request aborted")},d.ontimeout=function(){c(!1,"request timeout")},d.onerror=function(){c(!1,JSON.parse(d.responseText).errorDescription)};var e=this,f=b,g=c;d.onload=function(){if(404==this.status)return e._sendJsonCORS(e._getOldServiceUrl(),f,g),void 0;var a=JSON.parse(d.responseText);c(a.success,a)}}})}),define.experiment.component("wysiwyg.viewer.components.ContactForm.DecryptContactFormEmail.New",function(a,b){var c=a;c.utilize(["core.managers.serverfacade.WixRESTClient"]),c.methods({_onAllSkinPartsReady:b.after(function(){this._isEditorMode()&&(this._restClient=new this.imports.WixRESTClient,this._decryptEmails())}),_decryptEmails:function(){var a=this._getServiceBaseUrl(),b=W.Config.getSiteId();this.serviceBaseUrl=a.replace("{{siteId}}",b);var c=["toEmailAddress","bccEmailAddress"];_.forEach(c,function(a){var b=this._data.get(a);this._isEmpty(b)||this._isDecryptedEmail(b)||this._doDecryptRequest(a,b)},this)},_doDecryptRequest:function(a,b){var c={},d=this.serviceBaseUrl.replace("{{mail}}",b),e={onSuccess:this._getSuccessCallback(a),onError:this._getErrorCallback(a)};this._restClient.get(d,c,e)},_getSuccessCallback:function(a){return function(b){b.email?this._data.set(a,b.email):this._sendError(a,"Server returned success but no email field in response")}.bind(this)},_getErrorCallback:function(a){return function(b){this._data.set(a,""),this._sendError(a,b)}.bind(this)},_getServiceBaseUrl:function(){var a=window.location.protocol+"//"+window.location.host,b="/html/email/decrypt/{{mail}}/{{siteId}}";return a+b},_sendError:function(a,b){var c={dataFieldName:a,originalMail:this._data.get(a),errorMsg:b};LOG.reportError(wixErrors.CONTACT_FORM_EMAIL_DECRYPT_FAILURE,"wysiwyg.viewer.components.ContactForm.DecryptContactFormEmail.New","_sendError",JSON.stringify(c))},_isEditorMode:function(){var a=W.Viewer;return!a||!a.isPublicMode()},_isEmpty:function(a){return!a},_isDecryptedEmail:function(a){return a.match(/^(([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+|\s*)$/)?!0:!1}})}),define.experiment.newComponent("wysiwyg.viewer.components.FacebookLikeBox.FacebookLikeBox.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.dataTypes(["FacebookLikeBoxDataSchema"]),b.resources(["W.Utils","W.Viewer"]),b.skinParts({likeboxContainer:{type:"htmlElement"},iframe:{type:"htmlElement"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.EDITOR_META_DATA={general:{settings:!0,design:!1},custom:[{label:"FPP_DESIGN_LABEL",command:"WEditorCommands.AdvancedDesign"}]}},_onRender:function(){this._likeboxWidth=this._skinParts.likeboxContainer.getWidth(),this._likeboxHeight=this._skinParts.likeboxContainer.getHeight(),this._skinParts.likeboxContainer.appendChild(this.createIframe())},createIframe:function(){var a=new IFrame({src:this.getSource(),width:this._likeboxWidth,height:this._likeboxHeight,frameBorder:"0",scrolling:"no",frameborder:"0",style:"border:none; overflow:hidden;position:absolute; top:0; bottom:0; left:0; right:0;",allowTransparency:"true"});return this._skinParts.likeboxContainer.empty(),a},getSource:function(){var a="//www.facebook.com/plugins/likebox.php?href=https://www.facebook.com/";return a=a+this.setAddress()+"&width="+this._likeboxWidth+"&height="+this._likeboxHeight+"&colorscheme="+this.setColorScheme()+"&show_faces="+this.setShowFaces()+"&stream="+this.setShowStream()+"&show_border="+this.setShowBorder()+"&header="+this.setShowHeader()},setColorScheme:function(){return this.getDataItem().get("colorScheme")},setShowFaces:function(){return this.getDataItem().get("showFaces")},setShowStream:function(){return this.getDataItem().get("showStream")},setShowBorder:function(){return this.getDataItem().get("showBorder")},setShowHeader:function(){return this.getDataItem().get("showHeader")},setAddress:function(){return this.getDataItem().get("url")}})}),define.experiment.newComponent("wysiwyg.viewer.components.FacebookShare.FacebookShare.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.traits(["wysiwyg.viewer.components.traits.CustomPreviewBehavior"]),b.dataTypes(["FacebookShareButton"]),b.resources(["W.Utils","W.Viewer"]),b.skinParts({facebookShareButton:{type:"htmlElement"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[],this.EDITOR_META_DATA={general:{settings:!0,design:!1}}},_onRender:function(a){var b,c=a.data.invalidations;c.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.DATA_CHANGE])&&(b=this._skinParts.facebookShareButton,this._createClickOverlayForPreviewMode(),this._setShareButtonLabelText(),b.addEvent("click",function(){this.resources.W.Utils.openPopupWindow(this._getUrlToBeShared(),"wix-share-to-facebook","width=635,height=346,scrollbars=no,status=no,toolbar=no,menubar=no,location=no")}.bind(this)))},_getUrlToBeShared:function(){var a=this.getDataItem(),b="Site"===a.get("urlChoice")?this.getSiteUrl():this.getCurrentPageUrl();return"http://www.facebook.com/sharer.php?u="+encodeURIComponent(b)},getSiteUrl:function(){return window.publicModel?window.publicModel.externalBaseUrl:""},getCurrentPageUrl:function(){return window.location.href},_setShareButtonLabelText:function(){var a=this.getDataItem().get("label");this._skinParts.label.set("html",a),""===a?(this._skinParts.label.setStyle("display","none"),this._skinParts.icon.setStyle("border-width","0")):(this._skinParts.label.setStyle("display",""),this._skinParts.icon.setStyle("border-width","1px"))}})}),define.experiment.component("wysiwyg.viewer.components.FiveGridLine.NBC_HorizontalLine.New",function(a,b){var c=a;c.inherits("core.components.base.BaseComp"),c.skinParts({line:{type:"htmlElement"}}),c.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT]},isRenderNeeded:function(a){var b=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.PART_SIZE];return a.isInvalidated(b)},_onRender:function(){var a=this._skinParts.line.$measure.height;this.setHeight(a)}})}),define.experiment.component("wysiwyg.viewer.components.FiveGridLine.NBC_HorizontalLineFullScreenWidth.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.resources(["W.Viewer"]),b.propertiesSchemaType("FiveGridLineProperties"),b.skinParts({line:{type:"htmlElement"}}),b.statics({_currentLineWidth:400,_currentLinePosition:0}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT],this.EDITOR_META_DATA={general:{settings:!0,design:!1}},this._getXOriginal=this.getX,this.getSelectableXOriginal=this.getSelectableX,window.addEventListener("resize",_.bind(this._fixWidth,this),!1)},isRenderNeeded:function(a){var b=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.PART_SIZE,this.INVALIDATIONS.DATA_CHANGE];return a.isInvalidated(b)},_onRender:function(a){var b=this._skinParts.line.$measure.height,c=a.data.invalidations;this.setHeight(b),c.isInvalidated([this.INVALIDATIONS.DATA_CHANGE])&&this._setFullScreenMode()},_fixWidth:function(){var a=document.width,b=(this.resources.W.Viewer.getDocWidth()-document.width)/2,c=this.getComponentProperty("isFullScreenModeOn");c&&(this.setWidth(a),this._setXOriginal(b))},_setFullScreenMode:function(){var a,b,c=this.getComponentProperty("isFullScreenModeOn");c?(this._currentLineWidth=this._skinParts.line.$measure.width,this._currentLinePosition=this._skinParts.line.parentNode.offsetLeft,a=document.width,b=(this.resources.W.Viewer.getDocWidth()-a)/2,this.getX=function(){return 0},this.getSelectableX=function(){return(this.resources.W.Viewer.getDocWidth()-document.width)/2},this.setX=function(){}):(this._currentLineWidth>=document.width&&(this._currentLineWidth=400,this._currentLinePosition=0),a=this._currentLineWidth,b=this._currentLinePosition,this.getX=this._getXOriginal,this.getSelectableX=this.getSelectableXOriginal,this.setX=this._setXOriginal),this.setWidth(a),this._setXOriginal(b)},_setXOriginal:function(a){value=parseInt(a,10),isNaN(value)||(this._setX_(value),this.getRequestDimensions().left=value,this.invalidate(this.INVALIDATIONS.X_REQUEST,{x:value,requestedX:a},!0),this.resources.W.ComponentLifecycle.forceRender())},setWidth:function(a){var b=parseInt(a,10);isNaN(b)||(b=this._limitWidth(b),this._setWidth_(b),this.getRequestDimensions().width=b,this.invalidate(this.INVALIDATIONS.WIDTH_REQUEST,{width:b,requestedWeight:a},!0),this.resources.W.ComponentLifecycle.forceRender())}})}),define.experiment.component("wysiwyg.viewer.components.FiveGridLine.NewBaseCompFiveGridLine.New",function(a){var b=a;b.inherits("core.components.base.BaseComp")}),define.experiment.component("wysiwyg.viewer.components.FooterContainer.ErrorLogOnFooterFucks.New",function(a,b){var c=a;c.methods({initialize:function(a,b,c){this.parent(a,b,c),this.injects().Commands.registerCommandListenerByName("EditorCommands.SiteLoaded",this,this._onSiteLoaded.bind(this))},_onSiteLoaded:function(){this._view.addEventListener&&this._view.addEventListener("DOMNodeRemoved",this._onDOMNodeRemoved.bind(this))},_onDOMNodeRemoved:function(){var a=(new Error).stack;LOG.reportError(wixErrors.FOOTER_DELETED,this.$className,"DOMNodeRemoved",a)},setY:function(a){if(this.parent(a),!this._footerAlreadyReportedError)try{var b=this.injects().Viewer.getHeaderContainer().$logic;if(b){var c=b.getY(),d=this.getY();if(c>d){var e=(new Error).stack;LOG.reportError(wixErrors.FOOTER_HIGHER_THAN_HEADER,this.$className,"setY",e),this._footerAlreadyReportedError=!0}}}catch(f){LOG.reportError(wixErrors.GENERAL_FOOTER_ERROR,this.$className,"setY",f.stack)}}})}),define.experiment.newComponent("wysiwyg.viewer.components.GoogleMapEmbedded.GoogleMapEmbedded.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.dataTypes(["GooglemapEmbeddedDataSchema"]),b.resources(["W.Utils","W.Viewer"]),b.skinParts({mapContainer:{type:"htmlElement"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.EDITOR_META_DATA={general:{settings:!0,design:!1},custom:[{label:"FPP_DESIGN_LABEL",command:"WEditorCommands.AdvancedDesign"}]}},_onRender:function(){this._skinParts.mapContainer.appendChild(this.createIframe())},createIframe:function(){var a=new IFrame({src:this.getSource(),width:"100%",height:"100%",frameBorder:"0"});return this._skinParts.mapContainer.empty(),a},getSource:function(){var a="https://maps.google.com/maps?source=s_q&f=q&ie=UTF8&output=embed";return a=a+"&hl="+this.setHostLanguage()+"&q="+this.setAddress()+"("+this.setDescription()+")"+"&t="+this.setMapType()+"&z="+this.setZoomLevel()+"&iwloc="+this.toggleIWLOC()},setHostLanguage:function(){return this.getDataItem().get("hostLanguage")},setAddress:function(){return this.getDataItem().get("address")},setDescription:function(){return this.getDataItem().get("addressInfo")},setMapType:function(){return this.getDataItem().get("mapType")},setZoomLevel:function(){return this.getDataItem().get("zoomLevel")},toggleIWLOC:function(){return this.getDataItem().get("showInformationWindow")?"A":"B"}})}),define.experiment.component("wysiwyg.viewer.components.HorizontalMenu.PartialComponentPreview.New",function(a,b){var c=a;c.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.SKIN_CHANGE],test:"dooooooode",EDITOR_META_DATA:{general:{settings:!0,design:!0,previewable:!0},custom:[{label:"FPP_NAVIGATE_LABEL",command:"WEditorCommands.Pages"}],dblClick:{command:"WEditorCommands.Pages"},partialView:!0},_moreButtonClicked:!1,_prevButtonsWidth:0,_testOverFlowCount:50,_buttonsPadding:{}})}),define.experiment.component("wysiwyg.viewer.components.HtmlComponent.HtmlComponentRelativePath.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Config"])),c.methods({getIFrameSrc:function(){var a=this._data.get("url"),b=/^(ftps|ftp|http|https):.*$/;return"external"===this.getDataItem().get("sourceType")?(b.test(a)||(a="http://"+a),a):a.indexOf("static.wix.com")>=0&&!b.test(a)?"http://"+a:(0!==a.indexOf("html/")&&b.test(a)||(a=this.resources.W.Config.getServiceTopologyProperty("staticServerUrl")+a),a)}})}),define.experiment.component("wysiwyg.viewer.components.HtmlComponent.RefreshFrameOnTransition.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Viewer","W.Commands"])),c.binds(["_onPageTransitionStarted","_onPageTransitionEnded"]),c.methods({initialize:d.after(function(){this.resources.W.Viewer.getPreviewMode()&&this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onViewModeChanged)}),render:d.before(function(){this.resources.W.Viewer.removeEvent("pageTransitionStarted",this._onPageTransitionStarted),this.resources.W.Viewer.removeEvent("pageTransitionEnded",this._onPageTransitionEnded),this.getDataItem().getData().freezeFrame&&(this.resources.W.Viewer.addEvent("pageTransitionStarted",this._onPageTransitionStarted),this.resources.W.Viewer.addEvent("pageTransitionEnded",this._onPageTransitionEnded))}),_onPageTransitionStarted:function(){this._iframe.set("src","about:blank")},_onPageTransitionEnded:function(){this._setFrameWithSrc(this._iframe)}})}),define.experiment.newComponent("wysiwyg.viewer.components.ItunesButton.ItunesButton.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.dataTypes(["ItunesButton"]),b.propertiesSchemaType("ItunesButtonProperties"),b.resources(["W.Config","W.Utils"]),b.skinParts({downloadButton:{type:"htmlElement"},itunesImg:{type:"htmlElement"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT],this._sizeLimits={minW:110,minH:40,maxW:400,maxH:145},this.EDITOR_META_DATA={general:{settings:!0,design:!1}},this.supportsSVG=Modernizr.svg&&!Browser.ie;var d=this.supportsSVG?"svg":"png",e=this.resources.W.Config.getServiceTopologyProperty("staticThemeUrlWeb")+"/viewer/ItunesButton/",f="iTunesBtn_{{langCode}}.";this.imageBaseUrl=e+f+d},_onRender:function(a){var b=a.data.invalidations,c=this.getDataItem(),d=this.getComponentProperties(),e=d.get("language");this.target=d.get("openIn"),this.downloadUrl=c.get("downloadUrl"),this._setImgSrcByLang(e),b.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE])&&(this._skinParts.downloadButton.addEvent("click",this._clickHandler.bind(this)),this.supportsSVG||(this.setWidth(),this.setHeight()))},_clickHandler:function(){this.downloadUrl&&("_blank"===this.target?this.resources.W.Utils.openPopupWindow(this.downloadUrl):this._navigateInSameWindow(this.downloadUrl))},_navigateInSameWindow:function(a){window.location.href=a},_setImgSrcByLang:function(a){var b=this.imageBaseUrl.replace("{{langCode}}",a.toUpperCase());this._skinParts.itunesImg.setAttribute("src",b)},getHeight:function(){return this._skinParts&&this._skinParts.itunesImg?this._skinParts.itunesImg.getHeight():this.parent()},getWidth:function(){return this._skinParts&&this._skinParts.itunesImg?this._skinParts.itunesImg.getWidth():this.parent()},setWidth:function(a){if(!this.supportsSVG){var b=parseInt(this.$view.style.minWidth,10);this.$view.style.width=b+"px"}this.parent(a||b)},setHeight:function(a){if(!this.supportsSVG){var b=parseInt(this.$view.style.minHeight,10);this.$view.style.height=b+"px"}this.parent(a||b)}})}),define.experiment.component("wysiwyg.viewer.components.LoginButton.SMOwnerLogoutFix.New",function(a,b){var c=a;c.resources(["W.SiteMembers"]),c.methods({_updateTextsAndEvents:function(){var a=this._skinParts,b=this.injects().SiteMembers,c=a.actionTitle,d=a.memberTitle,e=this;this.injects().SiteMembers.isLoggedIn()?(c.set("text",this.SIGN_OUT),c.addEvent("click",this._addLogoutMemberHandler(c)),this.injects().SiteMembers.getMemberDetails(function(a){var b=a.attributes&&a.attributes.name||a.email;d.set("text",this.HELLO+" "+b)}.bind(this)),this.setState("auth")):(c.set("text",this.SIGN_IN),c.addEvent("click",function(){b.openSiteMembersPopup({authCallback:function(a){1==a.authResponse&&e._renderIfReady()}}),c.removeEvent("click",arguments.callee)}.bind(this)),d.set("text",""),this.setState("no_auth"))},_addLogoutMemberHandler:function(a){var b=this,c=function(){var c=b.resources.W.SiteMembers.logout();c&&(a.removeEvent("click",arguments.callee),setTimeout(function(){location.reload()},500))};return c}})}),define.experiment.component("wysiwyg.viewer.components.MatrixGallery.MediaGalleryFrame.New",function(a){var b=a;b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"MatrixGallery",publicMediaFile:"photos",selectionType:"multiple",mediaType:"picture",i18nPrefix:"multiple_images"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"MatrixGallery",publicMediaFile:"photos",selectionType:"multiple",mediaType:"picture",i18nPrefix:"multiple_images"},commandParameterDataRef:"SELF"}}})}),define.experiment.component("wysiwyg.viewer.components.MatrixGallery.MobileEditor1.New",function(a,b){var c=a,d=b;c.fields({EDITOR_META_DATA:d.merge({mobile:{previewImageDataRefField:"*"}})})}),define.experiment.component("wysiwyg.viewer.components.MediaZoom.MediaZoomDispose.New",function(a,b){var c=a;c.methods({_closeZoom:function(){this.collapse(),this.injects().Viewer.exitFullScreenMode(),this.setDataItem(null),this.resetIterator(),this._emptyContainer(this._skinParts.virtualContainer),this._emptyContainer(this._skinParts.itemsContainer),this._skinParts.dialogBox.setStyles({width:"100px"}),this._opened=!1,this.unlock(),this._lastCurrentItem=null},_transitionToCurrentDisplayer:function(a){if(!this._inTransition){this._inTransition=!0,a.setStyle("opacity","0.0");var b=this._skinParts.itemsContainer,c=this,d=function(){c._emptyContainer(b);var d=a.getStyles("width","height"),f=c._getTopGap(d.height.replace("px",""));b.adopt(a),c._emptyContainer(c._skinParts.virtualContainer);var g=new Fx.Morph(c._skinParts.dialogBox,{duration:c.transitionTime,link:"chain"});g.addEvent("complete",function(){var b=new Fx.Tween(a,{duration:c.transitionTime,link:"chain"});b.addEvent("complete",function(){c.unlock(),c._inTransition=!1,b.removeEvent("complete",arguments.callee)}),b.start("opacity","1.0"),g.removeEvent("complete",arguments.callee)}),g.start({width:d.width,"min-height":d.height,"margin-top":f+"px"}),e&&e.removeEvent("complete",arguments.callee)};if(b.hasChildNodes()){var e=new Fx.Tween(b.firstChild,{duration:c.transitionTime,link:"chain",property:"opacity"});e.addEvent("complete",d),e.start("0.0")}else d()}},_changeImageNoTransition:function(a){var b=this._skinParts.itemsContainer,c=this;this._emptyContainer(b);var d=a.getStyles("width","height"),e=c._getTopGap(d.height.replace("px",""));b.adopt(a),this._emptyContainer(c._skinParts.virtualContainer),c._skinParts.dialogBox.setStyles({width:d.width,"min-height":d.height,"margin-top":e+"px"}),c.unlock()},_emptyContainer:function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];c.getLogic?c.getLogic().dispose():c.destroy()}a.empty()}})}),define.experiment.component("wysiwyg.viewer.components.MediaZoomDisplayer.LazyShare.New",function(a,b){var c=a,d=b;c.skinParts(d.merge({lazyShare:{type:"wysiwyg.viewer.components.LazySocialPanel",optional:!1}}))}),define.experiment.component("wysiwyg.viewer.components.MobileMediaZoom.FixViewport.New",function(a,b){var c=a,d=b;c.methods({_setInitZoom:function(){return this._initZoom=this._mobileConfig.getInitZoom(),this._initZoom},setGallery:function(a,b,c,d,e){this.parent(a,b,c,d,e),this._disableZoomAndMagnifier(),setTimeout(this.fixZoom.bind(this),300)},_onOrientationChange:function(){this._currentDisplayer&&this._currentDisplayer.hideContent(),this.showZoomImage(!0),this._setOrientation()},_setZoomModeFontSize:d.remove(),getZoom:d.remove(),_disableZoomAndMagnifier:function(){var a=this._mobileConfig.getZoom();this.resources.W.Viewer.setViewportAttribute("minimum-scale",a),this.resources.W.Viewer.setViewportAttribute("maximum-scale",a)},_renderCurrentDisplayer:function(){for(var a=this._skinParts.virtualContainer,b=0;b<a.childNodes.length;b++)a.childNodes[b].destroy();var c=this;setTimeout(function(){this._getDisplayerDivFunction(this._currentItem,{container:c._skinParts.virtualContainer,x:this._imageMaxWidth,y:this._imageMaxHeight},function(a){a.getParent('[skinpart="virtualContainer"]')||a.insertInto(c._skinParts.virtualContainer),c._changeImageNoTransition(a),c._currentDisplayer=a.getLogic()})}.bind(this),500)}})}),define.experiment.component("wysiwyg.viewer.components.MobileMediaZoom.MobileEcomViews.New",function(a){var b=a;b.methods({_disableScroll:function(){},_disableZoomAndMagnifier:function(){this.resources.W.Viewer.setViewportAttribute("minimum-scale",this._initZoom),this.resources.W.Viewer.setViewportAttribute("maximum-scale",this._initZoom)},_onAllSkinPartsReady:function(){this.parent(),this._mobileConfig.isMobileOrTablet()&&(Hammer(this._view).on("swipeleft",this.gotoNext.bind(this)),Hammer(this._view).on("swiperight",this.gotoPrev.bind(this))),setTimeout(this.fixZoom.bind(this),300);var a=["click","mousedown","touchstart"],b=["mousemove","touchmove"];
this._registerEvents(this._skinParts.xButton,a,function(a){return setTimeout(function(){this._closeZoom(a)}.bind(this),500),this._preventEvent(a)}.bind(this)),this._registerEvents(this._skinParts.buttonPrev,a,function(a){return this.gotoPrev(a),this._preventEvent(a)}.bind(this)),this._registerEvents(this._skinParts.buttonNext,a,function(a){return this.gotoNext(a),this._preventEvent(a)}.bind(this)),this._registerEvents(this._skinParts.xButton,b,this._preventEvent),this._registerEvents(this._skinParts.buttonPrev,b,this._preventEvent),this._registerEvents(this._skinParts.buttonNext,b,this._preventEvent)},_registerEvents:function(a,b,c){_.forEach(b,function(b){a.addEvent(b,c)})}})}),define.experiment.component("wysiwyg.viewer.components.MobileMediaZoom.MobileSiteWidth.New",function(a,b){var c=a,d=b;c.states(d.merge({displayDevice:["desktop","mobile"]})),c.methods({initialize:d.after(function(){var a=this.resources.W.Viewer;a.getDocWidth()===Constants.ViewerTypesParams.DOC_WIDTH.MOBILE?this.setState("mobile","displayDevice"):this.setState("desktop","displayDevice")}),_disableZoomAndMagnifier:function(){if("mobile"!==this.getState("displayDevice")){var a=this.getZoom();this.resources.W.Viewer.setViewportAttribute("minimum-scale",a),this.resources.W.Viewer.setViewportAttribute("maximum-scale",a)}},_enableZoomAndMagnifier:function(){"mobile"!==this.getState("displayDevice")&&(this.resources.W.Viewer.setViewportAttribute("minimum-scale",.25),this.resources.W.Viewer.setViewportAttribute("maximum-scale",1.2))}})}),define.experiment.newComponent("wysiwyg.viewer.components.MobileMediaZoom.MobileZoom.New",function(a){var b=a;b.resources(["W.Viewer"]),b.states({showButtons:["doShowButtons","dontShowButtons"],orientation:["portrait","landscape"]}),b.binds(["_onOrientationChange","_preventEvent","_changeButtonsVisibility","_closeZoom","gotoNext","gotoPrev","_preventTouchStart"]),b.inherits("wysiwyg.viewer.components.MediaZoom"),b.skinParts({blockingLayer:{type:"htmlElement"},dialogBox:{type:"htmlElement"},xButton:{type:"htmlElement"},virtualContainer:{type:"htmlElement"},itemsContainer:{type:"htmlElement"},counter:{type:"htmlElement"},buttonPrev:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Prev"},buttonNext:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Next"}}),b.fields({transitionTime:"short",_inTransition:!1,_lastCurrentItem:null}),b.methods({initialize:function(a,b,c){this._fontSizeCorrectionWhenOpenZoomInPortrait=1.1,this.isVolatile=!0,this.parent(a,b,c);var d=this.injects().Commands;d.registerCommandAndListener("WViewerCommands.MediaZoomDisplayer.PanelTextVisibilityChanged",this,this._changeButtonsVisibility,null,!0),this.addEvent("currentItemChanged",this._handleCurrentItemChange),this.collapse(),this._mobileConfig=this.injects().Config.mobileConfig,this._setInitZoom()},_setInitZoom:function(){return this._initZoom=this._mobileConfig.getMobileScreenWidth()/document.body.offsetWidth,this._initZoom},fixZoom:function(){(!this._initZoom||this._initZoom<0||this._initZoom>5)&&this._setInitZoom();var a=this._initZoom/this._mobileConfig.getZoom();this._skinParts.xButton.style.zoom=a,this._skinParts.buttonPrev.style.zoom=a,this._skinParts.buttonNext.style.zoom=a},_setOrientation:function(){setTimeout(this.fixZoom.bind(this),300)},_onAllSkinPartsReady:function(){this.parent(),this._mobileConfig.isMobileOrTablet()&&(Hammer(this._view).on("swipeleft",this.gotoNext.bind(this)),Hammer(this._view).on("swiperight",this.gotoPrev.bind(this))),setTimeout(this.fixZoom.bind(this),300),this._skinParts.xButton.addEventListener("touchstart",function(a){return this._closeZoom(a),this._preventEvent(a)}.bind(this)),this._skinParts.buttonPrev.addEventListener("touchstart",function(a){return this.gotoPrev(a),this._preventEvent(a)}.bind(this)),this._skinParts.buttonNext.addEventListener("touchstart",function(a){return this.gotoNext(a),this._preventEvent(a)}.bind(this))},_onOrientationChange:function(){this._currentDisplayer.hideContent(),this.showZoomImage(!0),this._setOrientation()},_changeButtonsVisibility:function(a){a?this.setState("doShowButtons","showButtons"):this.setState("dontShowButtons","showButtons")},_closeZoom:function(){this.collapse(),this.injects().Viewer.exitFullScreenMode(),this.setDataItem(null),this.resetIterator(),this._skinParts.virtualContainer.empty(),this._skinParts.itemsContainer.empty(),this._opened=!1,this.unlock(),this._lastCurrentItem=null,this._enableScroll(),window.removeEvent("orientationchange",this._onOrientationChange),this._enableZoomAndMagnifier(),this._refreshQuickActions()},showZoomImage:function(a){if(this._mobileConfig.isMobileOrTablet()&&window.addEvent("orientationchange",this._onOrientationChange),this._disableScroll(),a||this._currentItem&&this._currentItem!=this._lastCurrentItem){var b=this.injects().Utils.getWindowSize(),c=this.getSkin().getParams().first(function(a){return"$marginIncludingArrow"===a.id});this._imageMaxWidth=b.width-2*c.defaultValue,this._imageMaxHeight=b.height-60,this._lastCurrentItem=this._currentItem,this._renderCurrentDisplayer(this._transitionToCurrentDisplayer),this._skinParts.counter.set("text",String(this._currentItemIndex+1)+"/"+String(this._numItems)),this.injects().Viewer.enterFullScreenMode(),this.uncollapse()}},_renderCurrentDisplayer:function(){for(var a=this._skinParts.virtualContainer,b=0;b<a.childNodes.length;b++)a.childNodes[b].destroy();var c=this;setTimeout(function(){this._getDisplayerDivFunction(this._currentItem,{container:c._skinParts.virtualContainer,x:this._imageMaxWidth,y:this._imageMaxHeight},function(a){c._currentDisplayer=a.getLogic(),c._currentDisplayer.setInitZoom&&c._currentDisplayer.setInitZoom(c._initZoom),a.getParent('[skinpart="virtualContainer"]')||a.insertInto(c._skinParts.virtualContainer),c._changeImageNoTransition(a)})}.bind(this),500)},_changeImageNoTransition:function(a){for(var b=this._skinParts.itemsContainer,c=this,d=0;d<b.childNodes.length;d++)b.childNodes[d].destroy();b.empty();var e=a.getStyles("width","height"),f=c._getTopGap(e.height.replace("px",""));b.adopt(a),c._skinParts.virtualContainer.empty(),c._skinParts.dialogBox.setStyles({"min-height":e.height,"margin-top":f+"px"}),c.unlock()},setGallery:function(a,b,c,d,e){this.parent(a,b,c,d,e),this._disableZoomAndMagnifier(),this._setZoomModeFontSize()},_setZoomModeFontSize:function(){var a=this.getZoom(),b=this._initZoom/a,c=8*b;0===window.orientation&&(c*=this._fontSizeCorrectionWhenOpenZoomInPortrait),this._view.setStyle("font-size",c+"px")},getZoom:function(){var a=90===Math.abs(window.orientation)?Math.max(screen.height,screen.width):Math.min(screen.height,screen.width);return a/window.innerWidth},_disableZoomAndMagnifier:function(){var a=this.getZoom();this.resources.W.Viewer.setViewportAttribute("minimum-scale",a),this.resources.W.Viewer.setViewportAttribute("maximum-scale",a)},_enableZoomAndMagnifier:function(){this.resources.W.Viewer.setViewportAttribute("minimum-scale",.25),this.resources.W.Viewer.setViewportAttribute("maximum-scale",1.2)},_refreshQuickActions:function(){window.WQuickActions&&window.WQuickActions.startZooming()},_disableScroll:function(){document.addEvent("touchmove",this._preventEvent)},_preventTouchStart:function(a){console.log(a.type),this._preventEvent(a)},_preventEvent:function(a){return a.preventDefault(),a.stopPropagation(),!1},_enableScroll:function(){document.removeEvent("touchmove",this._preventEvent),document.removeEvent("touchstart",this._preventTouchStart)}})}),define.experiment.component("wysiwyg.viewer.components.MobileMediaZoomDisplayer.FixViewport.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Config"])),c.methods({initialize:d.after(function(){this._mobileConfig=this.resources.W.Config.mobileConfig}),_onAllSkinPartsReady:function(){this.parent(),this.setState("showLimitedDescription","descriptionPresentationMode"),this._skinParts.title.addEvent("touchstart",this._onDescriptionClick.bind(this)),this._skinParts.description.addEvent("touchstart",this._onDescriptionClick.bind(this)),this._skinParts.link.addEvent("touchstart",function(a){a.target.fireEvent("click"),a.stopPropagation()}),this._changeFontSizes(),this._initZoom=this._mobileConfig.getInitZoom(),this.setState("doShowPanelText","showPanelText"),this._setZoomModeFontSize(),Hammer(this._skinParts.imageWrapper).on("tap",this._onImageWrapperClick)},_setZoomModeFontSize:function(){var a=this._mobileConfig.getZoom(),b=this._initZoom/a,c=8*b;0===window.orientation&&(c*=this._fontSizeCorrectionWhenOpenZoomInPortrait),this._view.setStyle("font-size",c+"px")},setInitZoom:d.remove()})}),define.experiment.component("wysiwyg.viewer.components.MobileMediaZoomDisplayer.MobileSiteWidth.New",function(a,b){var c=a,d=b;c.statics({FONT_MULTIPLIER:{DESKTOP_SITE:8,MOBILE_SITE:3}}),c.states(d.merge({displayDevice:["desktop","mobile"]})),c.methods({initialize:d.after(function(){var a=this.resources.W.Viewer;a.getDocWidth()===Constants.ViewerTypesParams.DOC_WIDTH.MOBILE?this.setState("mobile","displayDevice"):this.setState("desktop","displayDevice")}),_setZoomModeFontSize:function(){var a=this._mobileConfig.getZoom(),b=this._initZoom/a,c="desktop"===this.getState("displayDevice")?this.FONT_MULTIPLIER.DESKTOP_SITE:this.FONT_MULTIPLIER.MOBILE_SITE,d=c*b;0===window.orientation&&(d*=this._fontSizeCorrectionWhenOpenZoomInPortrait),this._view.setStyle("font-size",d+"px")},setInitZoom:d.remove()})}),define.experiment.newComponent("wysiwyg.viewer.components.MobileMediaZoomDisplayer.MobileZoom.New",function(a){var b=a;b.inherits("wysiwyg.viewer.components.MediaZoomDisplayer"),b.binds(["_onImageWrapperClick"]),b.resources(["W.Commands"]),b.skinParts({notAllDescriptionPresentedIndicator:{type:"htmlElement",optional:!1},title:{type:"htmlElement",optional:!1},description:{type:"htmlElement",optional:!1},link:{type:"htmlElement",optional:!0},imageWrapper:{type:"htmlElement"},image:{type:"core.components.Image",dataRefField:"*",optional:!1,hookMethod:"_addImageArgs"}}),b.states({link:["showLink","hideLink"],descriptionPresentationMode:["showLimitedDescription","showAllDescription"],showPanelText:["doShowPanelText","dontShowPanelText"],orientation:["portrait","landscape"]}),b.methods({initialize:function(a,b,c){this._fontSizeCorrectionWhenOpenZoomInPortrait=1.1,this.parent(a,b,c);var d=this._getDeviceSize();this._maxWidth=d.width,this._maxHeight=d.height},_onAllSkinPartsReady:function(){this.parent(),this.setState("showLimitedDescription","descriptionPresentationMode"),this._skinParts.title.addEvent("touchstart",this._onDescriptionClick.bind(this)),this._skinParts.description.addEvent("touchstart",this._onDescriptionClick.bind(this)),this._skinParts.link.addEvent("touchstart",function(a){a.target.fireEvent("click"),a.stopPropagation()}),this._changeFontSizes(),Hammer(this._skinParts.imageWrapper).on("tap",this._onImageWrapperClick)},setInitZoom:function(a){this._initZoom=a,this._setZoomModeFontSize(),this.setState("doShowPanelText","showPanelText")},_setZoomModeFontSize:function(){this._initZoom||(this._initZoom=W.Config.mobileConfig.getMobileScreenWidth()/document.body.offsetWidth);var a=this.getZoom(),b=this._initZoom/a,c=8*b;0===window.orientation&&(c*=this._fontSizeCorrectionWhenOpenZoomInPortrait),this._view.setStyle("font-size",c+"px")},getZoom:function(){var a=90===Math.abs(window.orientation)?Math.max(screen.height,screen.width):Math.min(screen.height,screen.width);return a/window.innerWidth},render:function(){this.parent(),this._limitedDescriptionHeight=2*1.14*parseInt(this._skinParts.description.getStyle("font-size"))+"px",this._fullDescriptionHeight=this._skinParts.description.getStyle("height"),this._skinParts.description.setStyle("height",this._limitedDescriptionHeight),this._canDescriptionExpand()||this._skinParts.notAllDescriptionPresentedIndicator.setStyle("visibility","hidden"),this.resources.W.Commands.executeCommand("WViewerCommands.MediaZoomDisplayer.PanelTextVisibilityChanged",!0)},_onDescriptionClick:function(a){if(this._canDescriptionExpand()){var b="showLimitedDescription"==this.getState("descriptionPresentationMode")?"showAllDescription":"showLimitedDescription";this.setState(b,"descriptionPresentationMode");var c="showLimitedDescription"==b?!0:!1;this.resources.W.Commands.executeCommand("WViewerCommands.MediaZoomDisplayer.PanelTextVisibilityChanged",c),this._animateDescriptionHeightTransition(b),this._animateImageWrapperOpacityTransition(b),a.stopPropagation()}},_onImageWrapperClick:function(){if(this._changeButtonsVisibilityTimer)return!0;this._changeButtonsVisibilityTimer=setTimeout(function(){this._changeButtonsVisibilityTimer=null}.bind(this),500);var a="doShowPanelText"==this.getState("showPanelText")?"dontShowPanelText":"doShowPanelText";this.setState(a,"showPanelText");var b="doShowPanelText"==a?!0:!1;this.resources.W.Commands.executeCommand("WViewerCommands.MediaZoomDisplayer.PanelTextVisibilityChanged",b)},_canDescriptionExpand:function(){return parseInt(this._fullDescriptionHeight)>parseInt(this._limitedDescriptionHeight)},_animateDescriptionHeightTransition:function(a){var b=new Fx.Tween(this._skinParts.description,{duration:"short",link:"chain",property:"height"}),c="showLimitedDescription"===a?this._limitedDescriptionHeight:this._fullDescriptionHeight;b.addEvent("complete",function(){"showLimitedDescription"===this.getState("descriptionPresentationMode")?this._skinParts.notAllDescriptionPresentedIndicator.setStyle("visibility","visible"):this._skinParts.notAllDescriptionPresentedIndicator.setStyle("visibility","hidden")}.bind(this)),b.start(c)},_animateImageWrapperOpacityTransition:function(a){var b=new Fx.Tween(this._skinParts.imageWrapper,{duration:"short",link:"chain",property:"opacity"}),c="showLimitedDescription"===a?"1":"0.65";b.start(c)},_getDeviceSize:function(){return{width:window.innerWidth,height:window.innerHeight}},_setCorrectImageSize:function(a){var b=a.y;this._getDisplayerWidth(a.x),this._skinParts.imageWrapper.setStyles({width:"100%",height:b+"px"}),this._skinParts.title.setStyles({"word-wrap":"break-word"}),this._skinParts.description.setStyles({"word-wrap":"break-word"})},hideContent:function(){this._skinParts.image.collapse(),this._skinParts.panel.collapse()},showText:function(){this._skinParts.title.uncollapse(),this._skinParts.description.uncollapse(),this._skinParts.notAllDescriptionPresentedIndicator.uncollapse(),this._skinParts.link.uncollapse()},hideText:function(){this._skinParts.title.collapse(),this._skinParts.description.collapse(),this._skinParts.notAllDescriptionPresentedIndicator.collapse(),this._skinParts.link.collapse()},_changeFontSizes:function(){90==window.orientation||-90==window.orientation?this.setState("landscape","orientation"):this.setState("portrait","orientation")}})}),define.experiment.component("wysiwyg.viewer.components.PageGroup.ContainerNBC.New",function(a){var b=a;b.inherits("core.components.ContainerOBC")}),define.experiment.component("wysiwyg.viewer.components.PageGroup.CustomSiteWidth.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Commands","W.Viewer"])),c.methods({initialize:d.after(function(){this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.UpdateDocWidth",this,this._onUpdateDocWidth)}),_onUpdateDocWidth:function(){this.refreshGrid(),this.render()},_setHorizontalGrid:function(){var a=window.getSize().x,b=this.resources.W.Viewer._siteStructureData.get("renderModifiers").siteWidth,c=a-b,d=-1*(c/2);this._skinParts.gridHeader.setStyle("width",a),this._skinParts.gridFooter.setStyle("width",a),this._skinParts.gridHeader.setStyle("left",d),this._skinParts.gridFooter.setStyle("left",d)}})}),define.experiment.component("wysiwyg.viewer.components.PageGroup.ViewerRefactor.New",function(a,b){var c=a;c.methods({gotoPage:function(a){var b=this.injects().Viewer.getCompByID(a);b!==this._currentPage&&(b.getLogic().setWidth(this.getWidth()),this._setVisiblePageCallId=this.resources.W.Utils.callLater(function(){b.getLogic().wixifyContent(function(){this.actualGotoPage(b)}.bind(this))}.bind(this)))},_setVerticalGrid:function(){var a=this._view.getPosition().y;window.getSize().y;var b=-1*a,c=parseInt(W.Viewer.getSiteNode().getStyle("height"));this._skinParts.gridBodyRight.setStyle("height",c),this._skinParts.gridBodyLeft.setStyle("height",c),this._skinParts.gridBodyRight.setStyle("top",b),this._skinParts.gridBodyLeft.setStyle("top",b)},dispose:function(){this.parent()}})}),define.experiment.component("wysiwyg.viewer.components.PaginatedGridGallery.MobileEditor1.New",function(a,b){var c=a,d=b;c.fields({EDITOR_META_DATA:d.merge({mobile:{previewImageDataRefField:"*"}})})}),define.experiment.newComponent("wysiwyg.viewer.components.PinterestFollow.PinterestFollowComponent.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.resources(["W.Config","topology"]),b.dataTypes(["PinterestFollow"]),b.skinParts({followButtonTag:{type:"htmlElement"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[],this.EDITOR_META_DATA={general:{settings:!0,design:!1}}},_onRender:function(){this._updatePinterestData()},_updatePinterestData:function(){this._setPinterestBtnTxt(),this._setPinterestUrl()},_setPinterestBtnTxt:function(){var a=this._getPinterestBtnTxt();this._skinParts.followButtonTag.innerText=a},_setPinterestUrl:function(){var a=this._getPinterestUrl();this._skinParts.followButtonTag.setAttribute("href",a)},_getPinterestUrl:function(){var a=this.getDataItem(),b=a?a.get("urlChoice"):"",c=b.split("."),d=[];return c.forEach(function(a){("pinterest.com/"!==a&&"http://www.pinterest.com/"!==a&&"www.pinterest.com/"!==a||"http://pinterest.com/"===a)&&d.push(a)}),"//www.pinterest.com/"+d},_getPinterestBtnTxt:function(){var a=this.getDataItem();return a?a.get("label"):""}})}),define.experiment.newComponent("wysiwyg.viewer.components.PinterestPin.PinterestPinComponent.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.traits(["wysiwyg.viewer.components.traits.CustomPreviewBehavior"]),b.utilize(["core.components.image.ImageUrlNew"]),b.resources(["W.Config","topology"]),b.dataTypes(["Image"]),b.binds(["_mediaGalleryCallback"]),b.propertiesSchemaType("PinterestPinProperties"),b.skinParts({pinButton:{type:"htmlElement"}}),b.statics({_pinButtonMargins:16,_pinButtonWidth:40,_pinButtonHeight:20,_pinCountBesideWidth:38,_pinCountAboveHeight:29}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"PHOTO_SELECT_IMAGE",command:"WEditorCommands.OpenMediaFrame",commandParameter:{publicMediaFile:"photos",i18nPrefix:"single_image",selectionType:"single",mediaType:"picture",callback:"_mediaGalleryCallback"}}]}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[],this._imgUtils=new this.imports.ImageUrlNew},_onRender:function(){this._setDefaultImage(),this._calculateDimensions(),this._createIframe(),this._createClickOverlayForPreviewMode()},_setDefaultImage:function(){var a=this.getDataItem();""===a.get("uri")&&a.set("uri","cbe56562e31c4b73ebd02449b9f115c0.png")},_mediaGalleryCallback:function(a){var b;a&&(b=this.getDataItem(),b.set("uri",a.uri),b.set("width",a.width),b.set("height",a.height))},_getImageUrl:function(){var a=this.getDataItem();return this._imgUtils.getImageAbsoluteUrlFromRelativeUrl(a.get("uri"))},_getSiteUrl:function(){return window.location.href},_getImageDesciption:function(){var a=this.getDataItem();return a?a.get("description"):""},_getCounterPosition:function(){var a=this.getComponentProperties();return a?a.get("counterPosition"):"none"},_getIframeUrl:function(){var a=this.resources.topology.wysiwyg+"/html/external/pinterestpin.html";return a+"?media="+this._getImageUrl()+"&url="+encodeURIComponent(this._getSiteUrl())+"&description="+encodeURIComponent(this._getImageDesciption())+"&data-pin-config="+this._getCounterPosition()},_calculateDimensions:function(){var a=this._getCounterPosition(),b={};switch(a){case"beside":b.width=this._pinButtonWidth+this._pinCountBesideWidth,b.height=this._pinButtonHeight;break;case"above":b.width=this._pinButtonWidth,b.height=this._pinButtonHeight+this._pinCountAboveHeight;break;default:b.width=this._pinButtonWidth,b.height=this._pinButtonHeight}return b.width+=this._pinButtonMargins,b.height+=this._pinButtonMargins,{width:b.width+"px",height:b.height+"px"}},_createIframe:function(){var a=this._calculateDimensions();this._iframe=new IFrame({src:this._getIframeUrl(),webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameborder:"0",width:a.width,height:a.height}),this._skinParts.pinButton.empty(),this._iframe.insertInto(this._skinParts.pinButton)}})}),define.experiment.component("wysiwyg.viewer.components.ScreenWidthContainer.ContainerNBC.New",function(a){var b=a;b.inherits("core.components.ContainerOBC")}),define.experiment.component("wysiwyg.viewer.components.ScreenWidthContainer.CustomSiteWidth.New",function(a,b){var c=a,d=b;c.methods({initialize:d.after(function(){this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.UpdateDocWidth",this,this.render)})})}),define.experiment.component("wysiwyg.viewer.components.ScreenWidthContainer.MobileViewerComponents.New",function(a,b){var c=a;c.methods({getSelectableX:function(){if(this.resources.W.Viewer.getViewerMode()!==Constants.ViewerTypesParams.TYPES.DESKTOP)return this.getX();var a=$(document).getSize().x;return this.getX()-(a-this.getWidth())/2},getSelectableWidth:function(){if(this.resources.W.Viewer.getViewerMode()!==Constants.ViewerTypesParams.TYPES.DESKTOP)return this.getWidth();var a=$(document).getSize().x;return a}})}),define.experiment.component("wysiwyg.viewer.components.ScreenWidthContainer.ViewerRefactor.New",function(a,b){var c=a,d=b;c.methods({initialize:d.after(function(){this._isMobileView=this.resources.W.Viewer.getViewerMode()===Constants.ViewerTypesParams.TYPES.MOBILE}),_stretchBackgroundAndCenterContent:function(){var a=this._view,b=$(document).getSize(),c=a.getSize(),d=this.resources.W.Viewer.getDocWidth(),e=this._isMobileView?0:-Math.round((b.x-d)/2),f=this._isMobileView?d:b.x;e>0&&(e=0),this._skinParts.screenWidthBackground.setStyles({position:"absolute",width:f+"px",height:c.y+"px",left:e})}})}),define.experiment.component("wysiwyg.viewer.components.SiteButton.LinkRefData.New",function(a,b){var c=a,d=b;c.resources(["W.Data"]),c.utilize(["core.utils.LinkRenderer"]),c.traits(d.customizeField(function(a){return a.erase("wysiwyg.common.components.traits.LinkableComponent"),a})),c.methods({render:d.after(function(){this._renderLink()}),_onDataChange:d.after(function(){this._isRendered&&this._renderLink()}),_renderLink:function(){var a=this.getDataItem(),b=new this.imports.LinkRenderer,c=a._data.link;if(!c)return b.removeRenderedLinkFrom(this._skinParts.link),void 0;var d=this.resources.W.Data.getDataByQuery("#"+c);d&&b.renderLink(this._skinParts.link,d)}})}),define.experiment.component("wysiwyg.viewer.components.SiteButton.MobileEditor1.New",function(a,b){var c=a,d=b;c.fields({EDITOR_META_DATA:d.merge({mobile:{previewTextDataField:"label"}})})}),define.experiment.component("wysiwyg.viewer.components.SiteButton.MobileViewerComponents.New",function(a,b){var c=a;c.methods({render:function(){this.resources.W.Config.isEditorMode()||W.Viewer.getViewerMode()!==Constants.ViewerTypesParams.TYPES.MOBILE||this._normalizeForMobile();var a=this._data.get("label");this._skinParts.label.set("text",a),this._userSelectedWidth||a||(this._userSelectedWidth=parseInt(this._view.getStyle("width"),10)),this._updateMinimumWidth(),this._updateWidthFromText(),this._updateMinimumHeight(),this._setLineHeight(),this._setTextAlignment(),this._wCheckForSizeChangeAndFireAutoSized(0)},_normalizeForMobile:function(){var a=-1,b=this._skinParts.label,c=parseInt(b.getStyle("font-size"));a=this._convertSizeToMobile(c),-1!=a&&b.setStyle("font-size",a)},_convertSizeToMobile:function(a){return this.getScale(),W.Utils.mobile.convertFontSizeToMobile(a)}})}),define.experiment.component("wysiwyg.viewer.components.SiteButton.NBC_SiteButton.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.resources(["W.Utils"]),b.traits(["wysiwyg.common.components.traits.LinkableComponent"]),b.propertiesSchemaType("ButtonProperties"),b.dataTypes(["SiteButton"]),b.states({button:["up","pressed"],alignment:["center","left","right"]}),b.binds(["hasInvalidations","_setLabelAccordingToData","_setVerticalAlignment","_setHorizontalAlignment","_addEventOn","_onClick","_onMouseDown","_onMouseUp"]),b.skinParts({label:{type:"htmlElement"},link:{type:"htmlElement"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.EDITOR_META_DATA={general:{settings:!0,design:!1},custom:[{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}]}},isRenderNeeded:function(a){var b=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.DATA_CHANGE,this.INVALIDATIONS.WIDTH_REQUEST,this.INVALIDATIONS.HEIGHT_REQUEST,this.INVALIDATIONS.PART_SIZE,this.INVALIDATIONS.SIZE];return a.isInvalidated(b)},_onRender:function(a){if("1.0"===this._data.getMeta("schemaVersion")&&this.isDisplayed()&&(this._setLabelAccordingToData(),this._updateRenderLayoutData()),this.hasInvalidations(a,["SKIN_CHANGE"])){var b=this.getViewNode();this._addEventOn(b,Constants.CoreEvents.MOUSE_DOWN,this._onMouseDown),this._addEventOn(b,Constants.CoreEvents.MOUSE_UP,this._onMouseUp),this._addEventOn(b,Constants.CoreEvents.CLICK,this._onClick)}this.hasInvalidations(a,["SKIN_CHANGE","DATA_CHANGE","WIDTH_REQUEST"])&&(this.getDataItem()&&this._setLabelAccordingToData(),this._setHorizontalAlignment()),this.hasInvalidations(a,["SKIN_CHANGE","SIZE","PART_SIZE"])&&this._setVerticalAlignment()},_updateRenderLayoutData:function(){var a,b,c,d=this.getComponentProperty("margin"),e=this.getComponentProperty("align");return this._data.setMeta("schemaVersion","2.0"),b=parseInt(this._skinParts.label.offsetWidth,10),c=parseInt(this._skinParts.view.getAttribute("width"),10),this._skinParts.view.setStyle("min-width",c),"center"===e?(this.setComponentProperty("margin",0),this._setPadding(0,0),void 0):(a="right"===e?"left":"right",d>c-b?(this.setComponentProperty("align",a),this.setComponentProperty("margin",0),this._skinParts.link.setStyle("text-align",a)):this._skinParts.view.setStyle("min-width",c-d),void 0)},hasInvalidations:function(a,b){for(var c=a.data.invalidations,d=0;d<b.length;++d){var e=b[d],f=this.INVALIDATIONS[e];if(c.getInvalidationByType(f))return!0}return!1},_setLabelAccordingToData:function(){var a=this.getDataItem().get("label");this._skinParts.label.set("text",a)},_setVerticalAlignment:function(){this._setLineHeight()},_setLineHeight:function(){var a=this._skinParts.link,b=parseInt(a.getStyle("font-size"),10),c=this.getHeight(),d=parseInt(a.getStyle("max-height"),10),e=parseInt(a.getStyle("min-height"),10);b>c&&this.setHeight(b),!isNaN(d)&&e>d&&this.setHeight(d),a.setStyle("line-height",this.getHeight())},_setHorizontalAlignment:function(){var a=this.getComponentProperty("align"),b=this.getComponentProperty("margin");switch(this._skinParts.link.setStyle("text-align",a),this._skinParts.view.setStyle("width",this._skinParts.label.getWidth()),a){case"center":this._setPadding(b,b);break;case"left":this._setPadding(0,b);break;case"right":this._setPadding(b,0)}},_setPadding:function(a,b){var c=this._skinParts.link,d=this._skinParts.view;c.setStyle("padding","0 "+a+"px"+" 0 "+b+"px"),d.setStyle("padding","0 "+a+"px"+" 0 "+b+"px"),c.setStyle("margin","0 -"+a+"px"+" 0 -"+b+"px")},getWidth:function(){return this.getPhysicalWidth()},_onClick:function(a){this.fireEvent(Constants.CoreEvents.CLICK,a)},_onMouseDown:function(a){this.setState("pressed"),this.fireEvent(Constants.CoreEvents.MOUSE_DOWN,a)},_onMouseUp:function(){this.setState("up")},_eventList:[],_addEventOn:function(a,b,c){a.addEvent(b,c),this._eventList.push({name:b,target:a,handler:c})}})}),define.experiment.component("wysiwyg.viewer.components.SlideShowGallery.AutoPlayFix.New",function(a,b){var c=a;c.methods({onPageVisibilityChange:function(a){a?this._restartAutoPlay():this._stopAutoPlay()},_stopAutoPlay:function(){null!=this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null)},_restartAutoPlay:function(){this._autoplayOn&&this._galleryItems.length>1&&this._autoplayCallback()}})}),define.experiment.component("wysiwyg.viewer.components.SlideShowGallery.GalleryFlick.New",function(a,b){var c=a;c.methods({_isAllowRender:function(){return!this._locked}})}),define.experiment.component("wysiwyg.viewer.components.SlideShowGallery.MediaGalleryFrame.New",function(a){var b=a;b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"SlideShowGallery",publicMediaFile:"photos",i18nPrefix:"multiple_images",mediaType:"picture",selectionType:"multiple"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"SlideShowGallery",publicMediaFile:"photos",i18nPrefix:"multiple_images",mediaType:"picture",selectionType:"multiple"},commandParameterDataRef:"SELF"}},_currentItemIndex:0,_currentItemRef:"",_prevItemIndex:-1,_numItems:-1,_itemHolder:null,_currentDisplayer:null,_locked:!1,_lastCommand:"",_transitionUtils:null,_displayedImages:[],_imageMode:"",_widthDiff:0,_heightDiff:0,_galleryItems:[],_expandEnabled:!0})}),define.experiment.component("wysiwyg.viewer.components.SlideShowGallery.MobileEditor1.New",function(a,b){var c=a,d=b;c.fields({EDITOR_META_DATA:d.merge({mobile:{previewImageDataRefField:"*"}})})}),define.experiment.component("wysiwyg.viewer.components.SlideShowGallery.NBC_SlideShowGallery.New",function(a,b){var c=a;c.inherits("core.components.base.BaseComp"),c.utilize(["wysiwyg.common.utils.AutoPlay","wysiwyg.viewer.utils.TransitionHandler"]),c.skinParts({itemsContainer:{type:"htmlElement"},buttonPrev:{type:"htmlElement"},buttonNext:{type:"htmlElement"},counter:{type:"htmlElement"},autoplay:{type:"htmlElement"},imageItem:{type:"wysiwyg.viewer.components.Displayer",autoCreate:!1,argObject:{unit:"px"}}}),c.dataTypes(["ImageList"]),c.binds(["_onPrev","_onNext","_zoomOnSelectedDisplayer","gotoNext","_handleAutoPlayEvent","_toggleAutoPlay","_onAnimationDone"]),c.propertiesSchemaType("SlideShowGalleryProperties"),c.states({autoPlay:["autoplayOn","autoplayOff"]}),c.statics({INDEX_INVALIDATIONS:"indexChange",HEIGHT_REQUEST:"heightRequest",WIDTH_REQUEST:"widthRequest",DISPLAYER_POS:{PREVIOUS:0,CURRENT:1,NEXT:2},IMAGE_CLICK_ACTIONS:{ZOOM:"zoomMode",LINK:"goToLink",DISABLED:"disabled"},IMAGE_MODE:{CLIPPED:"clipImage",FLEXIBLE:"flexibleHeight"},ANIMATION_DIRECTION:{FORWARDS:0,BACKWARDS:1},IMAGE_ONCLICK_ACTION_PROPERTY:"galleryImageOnClickAction",IMAGE_MODE_PROPERTY:"imageMode",TRANSITION_PROPERTY:"transition",TRANSITION_DURATION_PROPERTY:"transDuration"}),c.methods({initialize:function(a,b,c){this.parent(a,b,c),this._displayers=[],this._index=0,this._requestedIndex=this._index,this._numberOfDisplayerMoves=0,this._autoPlay=new this.imports.AutoPlay,this._suppressAutoplay=W.Viewer.getPreviewMode()===!0,this._animator=new this.imports.TransitionHandler,this._currentTransition=null,this._isBeingAnimated=!1,this._displayerAnimationDiv=document.createElement("div"),this._displayerAnimationDiv.setStyles({position:"absolute"})},isRenderNeeded:function(a){if(this._isBeingAnimated!==!0){var b=[this.INVALIDATIONS.PART_SIZE,this.INDEX_INVALIDATIONS];return a.isInvalidated(b)||this.parent(a)}},_onRender:function(a){var b=a.data.invalidations;b.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE])&&(this._skinParts.itemsContainer.setStyle("overflow","hidden"),this._skinParts.view.setStyle("overflow","visible"),this._handleRenderingIfSkinChanged()),b.isInvalidated([this.HEIGHT_REQUEST,this.WIDTH_REQUEST])&&this._handleRenderIfResized(b),b.isInvalidated([this.INVALIDATIONS.DATA_CHANGE,this.INDEX_INVALIDATIONS])&&this._handleRenderIfDataOrIndexChanged(b),b.isInvalidated([this.INVALIDATIONS.SIZE])&&this._orderDisplayers(),this._isImageModeFlexible()&&this._resizeGalleryToFitCurrentDisplayer(),this.getComponentProperty("showAutoplay")===!0?this._skinParts.autoplay.show():this._skinParts.autoplay.hide()
},_orderDisplayers:function(){var a=this._skinParts.itemsContainer.$measure.width;this._displayers[0].$view.style.left=-a+"px",this._displayers[1].$view.style.left="0px",this._displayers[2].$view.style.left=a+"px"},_onModeChange:function(a){this._suppressAutoplay="PREVIEW"!==a,this._setAutoPlay()},_setAutoPlay:function(){this._autoPlay.setDelay(this.getComponentProperty("autoplayInterval")),this.getComponentProperty("autoplay")!==!0||this._suppressAutoplay?this._autoPlay.pause():this._autoPlay.play()},_isImageModeFlexible:function(){return this.getComponentProperty(this.IMAGE_MODE_PROPERTY)===this.IMAGE_MODE.FLEXIBLE},_resizeGalleryToFitCurrentDisplayer:function(){var a=this._displayers[1],b=a.getWidth(),c=a.getHeight();this.setWidth(b),this.setHeight(c)},_handleRenderIfDataOrIndexChanged:function(a){if(a.isInvalidated([this.INDEX_INVALIDATIONS])){var b=a.getLastInvalidationByType(this.INDEX_INVALIDATIONS);this._requestedIndex=b.index}a.isInvalidated([this.INVALIDATIONS.DATA_CHANGE])&&(this._setOnDisplayerClickAction(),this._setNavigationPartsVisibility(),this._currentTransition!==this.getComponentProperty(this.TRANSITION_PROPERTY)&&(this._resetDisplayersStyle(),this._currentTransition=this.getComponentProperty(this.TRANSITION_PROPERTY)),this._updateDisplayersData(),this._updateItemsCounter()),this._renderDisplayers()},_resetDisplayersStyle:function(){for(var a=0;a<this._displayers.length;a++){var b=this._displayers[a];b.$view.setStyles({position:"absolute",opacity:"1.0"})}},_setOnDisplayerClickAction:function(){var a=this.getComponentProperty(this.IMAGE_ONCLICK_ACTION_PROPERTY),b=this._skinParts.itemsContainer;b.removeEvents(Constants.CoreEvents.CLICK),a===this.IMAGE_CLICK_ACTIONS.ZOOM?b.on(Constants.CoreEvents.CLICK,this,this._zoomOnSelectedDisplayer):a===this.IMAGE_CLICK_ACTIONS.LINK?b.on(Constants.CoreEvents.CLICK,this,this._goToLinkOnSelectedDisplayer):a===this.IMAGE_CLICK_ACTIONS.DISABLED},_handleRenderingIfSkinChanged:function(){this._exterminateDisplayers(),this._initDisplayers(),this._orderDisplayers(),this._forceDisplayersRender(),this._updateItemsCounter(),this._bindEventHandlers(),this._setNavigationPartsVisibility(),this._resizeDisplayers()},_bindEventHandlers:function(){this._skinParts.buttonPrev.on(Constants.CoreEvents.CLICK,this,this._onPrev),this._skinParts.buttonNext.on(Constants.CoreEvents.CLICK,this,this._onNext),this._skinParts.autoplay.on(Constants.CoreEvents.CLICK,this,this._toggleAutoPlay),this._autoPlay.on(this._autoPlay.AUTOPLAY_EVENT,this,this._handleAutoPlayEvent),W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onModeChange)},_forceDisplayersRender:function(){this._skinParts.itemsContainer.show(),this._displayers.each(function(a){a.render()})},_handleRenderIfResized:function(a){var b=this.getComponentProperty(this.IMAGE_MODE_PROPERTY);if(b===this.IMAGE_MODE.CLIPPED)this._resizeDisplayers();else if(b===this.IMAGE_MODE.FLEXIBLE){var c=a.getLastInvalidationByType(this.WIDTH_REQUEST);null!==c&&this._resizeDisplayersWithAspectRatio(c.width)}},_resizeDisplayersWithAspectRatio:function(a){for(var b=0;b<this._displayers.length;++b)this._displayers[b].setSize(a,-1,this.IMAGE_MODE.FLEXIBLE)},_resizeDisplayers:function(){for(var a=this._skinParts.itemsContainer.$measure,b=a.width,c=a.height,d=0;d<this._displayers.length;++d)null!==b&&this._displayers[d].setWidth(b),null!==c&&this._displayers[d].setHeight(c)},_getDirection:function(a,b){var c=this._getTotalAvailableItems()-1,d=0;return d=0===a&&b===c?-1:a===c&&0===b?1:this._signum(b-a)},getIndex:function(){var a=this.getLastInvalidationByType(this.INDEX_INVALIDATIONS);return a?a.index:this._index},setIndex:function(a){a=this._normalizeIndex(a);var b=this.getIndex();b!==a&&(this._requestedIndex=a,this._numberOfDisplayerMoves+=this._getDirection(b,a),this.invalidate(this.INDEX_INVALIDATIONS,{index:a,oldIndex:b}))},_initDisplayers:function(){for(var a=0;3>a;++a){var b=this.getSkinPartDefinition("imageItem");b.dataQuery=this._getDisplayerDataRef(a);var c=this._createInnerComponent(b);c.setOwner(this),this._displayerAnimationDiv.appendChild(c.$view),this._displayers.push(c)}this._resetDisplayersStyle(),this._skinParts.itemsContainer.appendChild(this._displayerAnimationDiv)},_renderDisplayers:function(){if(0!==a&&0!==this._numberOfDisplayerMoves){var a=this._signum(this._numberOfDisplayerMoves);this._renderDisplayersWithAnimation(a)}},_renderDisplayersWithAnimation:function(a){if(this._isBeingAnimated=!0,Math.abs(this._requestedIndex-this._index)>1){var b=this._getDataItems(),c=b[this._normalizeIndex(this._requestedIndex)];this._displayers[1+a].setDataByQuery(c)}var d=this._displayers[1].$view,e=this._displayers[1+a].$view,f=this.getComponentProperty(this.TRANSITION_DURATION_PROPERTY),g=1===a?this.ANIMATION_DIRECTION.FORWARDS:this.ANIMATION_DIRECTION.BACKWARDS,h=this._animator.getTransition(this.getComponentProperty(this.TRANSITION_PROPERTY));h(d,e,g,f,this._onAnimationDone)},_onAnimationDone:function(){var a=this._signum(this._numberOfDisplayerMoves);this._numberOfDisplayerMoves-=a,this._shiftDisplayers(a),this._index=this._normalizeIndex(this._index+a),this._updateItemsCounter(),this._updateDisplayersData(),this._orderDisplayers(),0!==this._numberOfDisplayerMoves?(this._numberOfDisplayerMoves=a,this._renderDisplayersWithAnimation(a)):this._isBeingAnimated=!1},_shiftDisplayers:function(a){0!==a&&(1===a?this._displayers.push(this._displayers.shift()):-1===a&&this._displayers.unshift(this._displayers.pop()))},_updateDisplayersData:function(){for(var a=0;3>a;++a){var b=this._getDisplayerDataRef(a),c=this._displayers[a];c.setDataByQuery(b)}},_updateItemsCounter:function(){var a=this._index+1,b=this._getTotalAvailableItems(),c=this._getCounterText(a,b);this._skinParts.counter.set("text",c)},_getCounterText:function(a,b){return a+"/"+b},_getDisplayerDataRef:function(a){var b,c=this._getDataItems();switch(a){case this.DISPLAYER_POS.PREVIOUS:b=this._normalizeIndex(this._index-1);break;case this.DISPLAYER_POS.CURRENT:b=this._normalizeIndex(this._index);break;case this.DISPLAYER_POS.NEXT:b=this._normalizeIndex(this._index+1)}return c[b]},_setNavigationPartsVisibility:function(){var a=this.getComponentProperty("showNavigation");a===!0?(this._skinParts.buttonPrev.show(),this._skinParts.buttonNext.show()):(this._skinParts.buttonPrev.hide(),this._skinParts.buttonNext.hide()),this._updateAutoPlayState()},_toggleAutoPlay:function(){var a=this.getComponentProperty("autoplay");a?this._autoPlay.pause():this._autoPlay.play(),this.setComponentProperty("autoplay",!a),this._updateAutoPlayState()},_handleAutoPlayEvent:function(){this._updateAutoPlayState(),this._autoPlay.isPlaying()?(this._autoPlay.setDelay(this.getComponentProperty("autoplayInterval")),this._autoPlay.play()):this._autoPlay.pause(),this.getComponentProperty("reverse")===!0?this._onPrev():this._onNext()},_updateAutoPlayState:function(){this._autoPlay.isPlaying()?this.setState("autoplayOn","autoPlay"):this.setState("autoplayOff","autoPlay")},_onPrev:function(){var a=this._normalizeIndex(this.getIndex()-1);this.setIndex(a)},_onNext:function(){var a=this._normalizeIndex(this.getIndex()+1);this.setIndex(a)},_zoomOnSelectedDisplayer:function(){this._displayers[this._displayers.length-1].zoom()},_goToLinkOnSelectedDisplayer:function(){this._displayers[this._displayers.length-1].goToLink()},_normalizeIndex:function(a){var b=this._getTotalAvailableItems();return this._modulu(a,b)},_modulu:function(a,b){return(a%b+b)%b},_getTotalAvailableItems:function(){var a=this._getDataItems(),b=a.length;return b},_getDataItems:function(){return this._data.get("items")},_signum:function(a){return a>0?1:0>a?-1:0},_exterminateDisplayers:function(){this._displayerAnimationDiv.childNodes=[];for(var a=0;a<this._displayers.length;a+=1)this._displayers[a].dispose();this._displayers=[]},_onAllSkinPartsReady:b.remove()})}),define.experiment.component("wysiwyg.viewer.components.SliderGallery.MediaGalleryFrame.New",function(a){var b=a;b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"SliderGallery",publicMediaFile:"photos",i18nPrefix:"multiple_images",mediaType:"picture",selectionType:"multiple"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"SliderGallery",publicMediaFile:"photos",i18nPrefix:"multiple_images",mediaType:"picture",selectionType:"multiple"},commandParameterDataRef:"SELF"}},_itemHolder:null,_itemWidth:0,_itemHeight:0,_gap:20,_movementSpeed:0,_shiftOffset:0,_shiftOffsetMax:0,_shiftOffsetMin:0,_maxSpeed:.05,_aspectRatio:0,_movementActive:!1,_debugMode:!1,_imageMode:"",_lastUpdate:0/0,_updateMovementFunc:null,_loop:!1,_itemsHolderSize:0,_contentOverflow:!1,_segment:0,_isZoomed:!1})}),define.experiment.component("wysiwyg.viewer.components.SliderGallery.MobileEditor1.New",function(a,b){var c=a,d=b;c.fields({EDITOR_META_DATA:d.merge({mobile:{previewImageDataRefField:"*"}})})}),define.experiment.component("wysiwyg.viewer.components.TwitterFeed.SyncWixify.New",function(a,b){var c=a;c.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this._iframeLoaded=!1,this.addEvent("resizeEnd",this._onResizeEnd),this._minimumTimeBetweenRenders=2e3},_renderFeed:function(a){this.isReady()&&(this._iframe?this._iframeLoaded&&this._postMessageToIframe(a):this._createIframe())},_createIframe:function(a){var b=new IFrame({src:this.resources.W.Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/twfeed.html",width:"100%",height:"100%",webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameBorder:"0",scrolling:"no",events:{load:function(){this._iframeLoaded=!0,this._postMessageToIframe(a)}.bind(this)}});this._iframe=b,this._view.empty(),this._view.grab(b)}})}),define.experiment.component("wysiwyg.viewer.components.TwitterFeed.TwitterAPIpatch.New",function(a,b){var c=a;c.skinParts({label:{type:"htmlElement"},link:{type:"htmlElement"}}),c.methods({_renderFeed:function(){if(this.isReady()){this._iframeLoaded=!0;var a=this._data.get("accountToFollow")||"wix";this._skinParts.label.set("html",a),this._skinParts.link.set("href","https://twitter.com/intent/user?screen_name="+a)}}})}),define.experiment.newComponent("wysiwyg.viewer.components.VKShareButton.VKShare.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.traits(["wysiwyg.viewer.components.traits.CustomPreviewBehavior"]),b.resources(["W.Config","W.Utils","W.Viewer","W.Commands","topology"]),b.propertiesSchemaType("VKShareProperties"),b.dataTypes(["VKShareButton"]),b.skinParts({iframe:{type:"htmlElement"}}),b.binds(["_onPostMessageChangeWidth"]),b.statics({LayoutSize:{Button:{w:100,h:21},ButtonWithoutCounter:{w:64,h:21},Link:{w:50,h:16},LinkWithoutIcon:{w:30,h:16},Icon:{w:36,h:36}}}),b.methods({initialize:function(a,b,c){this._resizableSides=[],this.EDITOR_META_DATA={general:{settings:!0,design:!1}},window.addEventListener("message",this._onPostMessageChangeWidth,!1),this.parent(a,b,c)},_onRender:function(){var a=this.getDataItem(),b=this.LayoutSize[a.get("style")]||this.LayoutSize.Button;this._createClickOverlayForPreviewMode(),this._changeSize(b.w,b.h),this.resources.W.Viewer.isSiteReady()?this._onSiteReady():this.resources.W.Viewer.addEvent("SiteReady",this._onSiteReady.bind(this)),this.parent()},isRenderNeeded:function(a){var b=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.DATA_CHANGE];return a.isInvalidated(b)},_onPostMessageChangeWidth:function(a){var b,c,d;try{d=JSON.parse(a.data)}catch(a){return}this.getID()===d.id&&(b=d.width,c=this.getHeight(),this._changeSize(b,c))},_getIframeUrl:function(){var a=this.resources.topology.wysiwyg+"/html/external/VKShare.html";return a+"?"+Object.toQueryString(this._getUrlParams())},_getUrlParams:function(){var a=this.getDataItem(),b=this._getPageInfo();return{id:this.getID(),url:b.url||"",style:a.get("style"),text:a.get("text")||"Share",rightAngles:!this.getComponentProperty("rightAngles")}},_onSiteReady:function(){this._skinParts.iframe.setAttribute("src",this._getIframeUrl())},_getPageInfo:function(){var a,b,c=this.resources.W.Viewer,d={};return c.isPublicMode()?(a=c.getCurrentPageId())?(b=c.getPageData(a),d={url:this._getPageUrl(b,a)}):d:d},_getImage:function(){return""},_getPageTitle:function(a,b){var c=this.resources.W.Viewer,d="",e=a.get("pageTitleSEO")||"",f=a.get("title")||"",g=c.getSiteTitleSEO()||"",h=c.isHomePage(b);return e?d=e:(d=g,h||(d+=d?" | ":"",d+=f)),d},_getPageDescription:function(a){var b=a.get("descriptionSEO")||"";return b||(b=""),b},_getPageUrl:function(a,b){var c,d,e=this.resources.W.Viewer;return c=window.publicModel.externalBaseUrl||"",e.isHomePage()||(d=a.get("pageUriSEO"),c+="#!"+d+"/"+b),c},_changeSize:function(a,b){a===this.getWidth()&&this.isRendered()||(this.setWidth(a),this._skinParts.iframe.setStyle("width",a+"px")),b===this.getHeight()&&this.isRendered()||(this.setHeight(b),this._skinParts.iframe.setStyle("height",b+"px"))}})}),define.experiment.component("wysiwyg.viewer.components.VerticalLine.NBC_VerticalLine.New",function(a,b){var c=a;c.inherits("core.components.base.BaseComp"),c.skinParts({line:{type:"htmlElement"}}),c.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.BOTTOM]},isRenderNeeded:function(a){var b=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.PART_SIZE];return a.isInvalidated(b)},_onRender:function(){var a=this._skinParts.line.$measure.width;this.setWidth(a)}})}),define.experiment.component("wysiwyg.viewer.components.VerticalLine.RotateImage",function(a,b){var c=a;c.inherits("mobile.core.components.base.RotatableBaseComponent")}),define.experiment.component("wysiwyg.viewer.components.WPhoto.LinkRefData.New",function(a,b){var c=a,d=b;c.resources(["W.Data"]),c.utilize(d.merge(["core.utils.LinkRenderer"])),c.traits(d.customizeField(function(a){return a.erase("wysiwyg.common.components.traits.LinkableComponent"),a})),c.methods({render:function(){this._styleChanged(),this._renderImage(),this._renderLink(),this.parent()},_onDataChange:d.after(function(){this._isRendered&&this._renderLink()}),_renderLink:function(){var a=this.getDataItem(),b=a._data.link,c=new this.imports.LinkRenderer;if(!b)return c.removeRenderedLinkFrom(this._skinParts.link),void 0;var d=this.resources.W.Data.getDataByQuery("#"+b);d&&c.renderLink(this._skinParts.link,d)}})}),define.experiment.component("wysiwyg.viewer.components.WPhoto.MediaGalleryFrame.New",function(a,b){var c=a,d=b;c.binds(d.merge(["_mediaGalleryCallback"])),c.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED,Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"PHOTO_REPLACE_IMAGE",command:"WEditorCommands.OpenMediaFrame",commandParameter:{galleryConfigID:"photos",publicMediaFile:"photos",selectionType:"single",i18nPrefix:"single_image",mediaType:"picture",callback:"_mediaGalleryCallback"}},{label:"PHOTO_EDIT_IMAGE",command:"WEditorCommands.OpenAviaryDialog"},{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenMediaFrame",commandParameter:{galleryConfigID:"photos",publicMediaFile:"photos",selectionType:"single",i18nPrefix:"single_image",mediaType:"picture",callback:"_mediaGalleryCallback"}}}}),c.methods({_mediaGalleryCallback:function(a){this.getDataItem().setFields({title:a.title,description:a.description||"",height:a.height,width:a.width,uri:a.fileName})}})}),define.experiment.component("wysiwyg.viewer.components.WPhoto.MobileViewerComponents.New",function(a,b){var c=a,d=b;c.fields({EDITOR_META_DATA:d.merge({mobile:{previewImageDataRefField:"*"}})})}),define.experiment.component("wysiwyg.viewer.components.WPhoto.NBC_WPhoto.New",function(a,b){var c=a;c.resources(["W.Config"]),c.inherits("core.components.base.BaseComp"),c.methods({initialize:function(a,b,c){this.parent(a,b,c),this._SettingsClass=this.imports.ImageSettings,this._imageSettings=new this.imports.ImageSettings,this._imageDimensions=new this.imports.ImageDimensionsNew,c&&c.props&&this.setComponentProperties(c.props),this._contentPadding={x:0,y:0}},isRenderNeeded:function(a){return a.isInvalidated([this.INVALIDATIONS.PART_SIZE])||this.parent(a)},_onRender:function(a){var b=a.data.invalidations;b.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.PART_SIZE])&&(this._updateFramePadding(),this._updateImageSize(this.getWidth(),this.getHeight())),this._updateImageSettings(),b.isInvalidated([this.INVALIDATIONS.DATA_CHANGE])&&(this._setTitle(),this._checkResizeInFitMode())},setWidth:function(a,b){this.parent(a),this._updateImageSize(a,null),b||(this._changeCropModeInFit(!0),this._skinParts.img.setSettings(this._imageSettings),this._checkResizeInFitMode())},setHeight:function(a,b){this.parent(a),this._updateImageSize(null,a),b||(this._changeCropModeInFit(!1),this._skinParts.img.setSettings(this._imageSettings),this._checkResizeInFitMode())},_changeCropModeInFit:function(a){this.isDisplayed()&&"fitWidth"===this._getDisplayMode()&&(a?this._imageSettings.setCropMode(this._imageSettings.CropModes.FIT_WIDTH):this._imageSettings.setCropMode(this._imageSettings.CropModes.FIT_HEIGHT))},_updateImageSize:function(a,b){if(this._framePadding||this._updateFramePadding(),a){var c=a-this._framePadding.x;this._imageSettings.setWidth(c)}if(b){var d=b-this._framePadding.y;this._imageSettings.setHeight(d)}},_setTitle:function(){var a=this._data.get("title");a&&this._skinParts.view.set("title",a)},_checkResizeInFitMode:function(){var a=this._framePadding;if(this._imageSettings.getCropMode()==this._imageSettings.CropModes.FIT_WIDTH){var b=this._skinParts.img.getSize().y;this.setHeight(b+a.y,!0)}else if(this._imageSettings.getCropMode()==this._imageSettings.CropModes.FIT_HEIGHT){var c=this._skinParts.img.getSize().x;this.setWidth(c+a.x,!0)}},_updateImageSettings:function(){var a=this._getImageCropMode();this._imageSettings.setCropMode(a),this._skinParts.img.setSettings&&this._skinParts.img.setSettings(this._imageSettings)},_updateFramePadding:function(){var a=this.getSkin();this._framePadding={x:parseInt(a.getParamValue("contentPaddingLeft"),10)+parseInt(a.getParamValue("contentPaddingRight"),10),y:parseInt(a.getParamValue("contentPaddingTop"),10)+parseInt(a.getParamValue("contentPaddingBottom"),10)}},_getImageCropMode:function(){var a=this.getComponentProperty("displayMode");return"fitWidthStrict"==a&&(a=this._imageSettings.CropModes.FIT_WIDTH),"fitHeightStrict"==a&&(a=this._imageSettings.CropModes.FIT_HEIGHT),a},_setImageArgs:function(a){return a.argObject={requestExactSize:this.resources.W.Config.isPreviewMode()!==!0},a},_getDisplayMode:function(){return this.getComponentProperty("displayMode")},_isFitMode:function(){var a=["fitWidth","fitWidthStrict","fitHeightStrict"];return a.indexOf(this._getDisplayMode())>=0},render:b.remove()})}),define.experiment.component("wysiwyg.viewer.components.WPhoto.NBC_WPhotoFullScreen.New",function(a,b){var c=a;c.inherits("core.components.base.BaseComp"),c.resources(["W.Config"]),c.fields({initialize:function(a,b,c){this.parent(a,b,c),this._SettingsClass=this.imports.ImageSettings,this._imageSettings=new this.imports.ImageSettings,this._imageDimensions=new this.imports.ImageDimensionsNew,c&&c.props&&this.setComponentProperties(c.props),this._contentPadding={x:0,y:0}},isRenderNeeded:function(a){return a.isInvalidated([this.INVALIDATIONS.PART_SIZE])||this.parent(a)},_onRender:function(a){var b=a.data.invalidations;b.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.PART_SIZE])&&(this._updateFramePadding(),this._updateImageSize(this.getWidth(),this.getHeight())),this._updateImageSettings(),b.isInvalidated([this.INVALIDATIONS.DATA_CHANGE])&&(this._setTitle(),this._checkResizeInFitMode())},setWidth:function(a,b){this.parent(a),this._updateImageSize(a,null),b||(this._changeCropModeInFit(!0),this._skinParts.img.setSettings(this._imageSettings),this._checkResizeInFitMode())},setHeight:function(a,b){this.parent(a),this._updateImageSize(null,a),b||(this._changeCropModeInFit(!1),this._skinParts.img.setSettings(this._imageSettings),this._checkResizeInFitMode())},_changeCropModeInFit:function(a){this.isDisplayed()&&"fitWidth"===this._getDisplayMode()&&(a?this._imageSettings.setCropMode(this._imageSettings.CropModes.FIT_WIDTH):this._imageSettings.setCropMode(this._imageSettings.CropModes.FIT_HEIGHT))},_updateImageSize:function(a,b){if(a){var c=a-this._framePadding.x;this._imageSettings.setWidth(c)}if(b){var d=b-this._framePadding.y;this._imageSettings.setHeight(d)}},_setTitle:function(){var a=this._data.get("title");a&&this._skinParts.view.set("title",a)},_checkResizeInFitMode:function(){var a=this._framePadding;if(this._imageSettings.getCropMode()==this._imageSettings.CropModes.FIT_WIDTH){var b=this._skinParts.img.getSize().y;this.setHeight(b+a.y,!0)}else if(this._imageSettings.getCropMode()==this._imageSettings.CropModes.FIT_HEIGHT){var c=this._skinParts.img.getSize().x;this.setWidth(c+a.x,!0)}},_updateImageSettings:function(){var a=this._getImageCropMode();this._imageSettings.setCropMode(a),this._skinParts.img.setSettings&&this._skinParts.img.setSettings(this._imageSettings)},_updateFramePadding:function(){var a=this.getSkin();this._framePadding={x:parseInt(a.getParamValue("contentPaddingLeft"),10)+parseInt(a.getParamValue("contentPaddingRight"),10),y:parseInt(a.getParamValue("contentPaddingTop"),10)+parseInt(a.getParamValue("contentPaddingBottom"),10)}},_getImageCropMode:function(){var a=this.getComponentProperty("displayMode");return"fitWidthStrict"==a&&(a=this._imageSettings.CropModes.FIT_WIDTH),"fitHeightStrict"==a&&(a=this._imageSettings.CropModes.FIT_HEIGHT),a},_setImageArgs:function(a){return a.argObject={requestExactSize:this.resources.W.Config.isPreviewMode()!==!0},a},_getDisplayMode:function(){return this.getComponentProperty("displayMode")},_isFitMode:function(){var a=["fitWidth","fitWidthStrict","fitHeightStrict"];return a.indexOf(this._getDisplayMode())>=0},render:b.remove()})}),define.experiment.component("wysiwyg.viewer.components.WPhoto.RotateImage",function(a,b){var c=a;c.inherits("mobile.core.components.base.RotatableBaseComponent")}),define.experiment.component("wysiwyg.viewer.components.WRichText.FixAndroidTextSize.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Config"])),c.states({deviceType:["androidMobile"]}),c.methods({initialize:d.after(function(){var a=this.resources.W.Config.mobileConfig;a.isMobile()&&a.isAndroidMobileDevice()&&this.setState("androidMobile","deviceType")})})}),define.experiment.component("wysiwyg.viewer.components.WRichText.MobileViewerComponents.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Utils"])),c.fields({EDITOR_META_DATA:d.merge({mobile:{previewTextDataField:"text"}})}),c.methods({setScale:function(a){this._$scale=parseFloat(a),this._updateText(),this.fireEvent("autoSized")},_updateText:function(){this._loadFontsToViewer();var a=this.getDataItem().get("text");this.getRichTextContainer().set("html",a),this.resources.W.Config.isEditorMode()||W.Viewer.getViewerMode()!==Constants.ViewerTypesParams.TYPES.MOBILE||this._normalizeChildrenForMobile(this.getRichTextContainer())},_normalizeNodeForMobile:function(a){var b=W.Utils.mobile.getFontSize(a,W.Theme);if(!isNaN(b)){var c=this._convertSizeToMobile(b);a.style.fontSize=c+"px"}},_normalizeChildrenForMobile:function(a){if(a.children)for(var b=0;b<a.children.length;b++){var c=a.children[b];this._normalizeChildrenForMobile(c),this._normalizeNodeForMobile(c)}},_convertSizeToMobile:function(a){var b=this.getScale();return W.Utils.mobile.convertFontSizeToMobile(a,b)}})}),define.experiment.component("wysiwyg.viewer.components.WRichText.NBC_WRichText.New",function(a,b){var c=a;c.inherits("core.components.base.BaseComp"),c.methods({isRenderNeeded:function(a){var b=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.DATA_CHANGE];return a.isInvalidated(b)},_onRender:function(){this._updateText(),this._setLinksDataToElements("VIEW")},_sanitizeLink:function(a){var b=a.get("href");b&&0!==b.indexOf("http://")&&0!==b.indexOf("https://")&&0!==b.indexOf("telnet://")&&0!==b.indexOf("ftp://")&&0!==b.indexOf("mailto:")&&(b.indexOf("@")>0?a.set("href","mailto:"+b):(0===b.indexOf("www")||0!==b.indexOf("www")&&0!==b.indexOf("#"))&&a.set("href","http://"+b))},_onAllSkinPartsReady:b.remove(),_onDataChange:b.remove()})}),define.experiment.component("wysiwyg.viewer.components.WSiteStructure.ContainerNBC.New",function(a){var b=a;b.inherits("core.components.ContainerOBC")}),define.experiment.component("wysiwyg.viewer.components.WSiteStructure.CustomSiteWidth.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Commands"])),c.methods({initialize:d.after(function(){this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.UpdateDocWidth",this,this.render)})})}),define.experiment.component("wysiwyg.viewer.components.WSiteStructure.MobileBackground.New",function(a,b){var c=a;c.methods({_handleMobile:function(){this._mobileConfig.isMobileOrTablet()&&(window.addEvent("orientationchange",this._delayedInvalidateBg),this._view.setStyle("overflow","hidden"),this._mobileConfig.isAndroidMobileDevice()&&this._view.setStyle("max-height","10000000000px"),this._bgFixed?this._fixBackgroundForFixedBg():this._fixBackgroundForMobile(),this._view.setStyle("-webkit-text-size-adjust","none"),this._view.setStyle("-moz-text-size-adjust","none"),this._view.setStyle("-ms-text-size-adjust","none"))},_fixBackgroundForFixedBg:function(){for(var a=document.body,b=document.createDocumentFragment();a.firstChild;)a.firstChild===this._bgNode?a.removeChild(this._bgNode):b.appendChild(a.firstChild);this._bgNode.appendChild(b),a.appendChild(this._bgNode),this._fixBgHeight(),window.addEvent("orientationchange",this._fixBgHeight),window.addEvent("resize",this._fixBgHeight)},_fixBgHeight:function(){this._bgNode.style.height=window.innerHeight+"px",this._bgNode.style.overflowY="scroll"},_fixBackgroundForMobile:function(){var a=document.body;a.style["background-image"]=this._bgStyle["background-image"],a.style["background-size"]=this._bgStyle["background-size"],a.style["background-position"]=this._bgStyle["background-position"],a.style["background-repeat"]=this._bgStyle["background-repeat"],a.style["background-color"]=this._bgStyle["background-color"],this._bgFixed&&(a.style["background-attachment"]="fixed"),a.removeChild(this._bgNode)}})}),define.experiment.component("wysiwyg.viewer.components.WSiteStructure.MobileFontsPOC.New",function(a,b){var c=a;c.methods({_handleMobile:function(){this._mobileConfig.isMobileOrTablet()&&(window.addEvent("orientationchange",this._delayedInvalidateBg),this._view.setStyle("overflow","hidden"))}})}),define.experiment.component("wysiwyg.viewer.components.WSiteStructure.ViewerRefactor.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Commands"])),c.methods({initialize:function(a,b,c){this.parent(a,b,c),this._structureState=this.resources.W.Viewer.getViewerMode(),this._mobileConfig=this.resources.W.Config.mobileConfig,this._bgStyle={},this._lastBgStyle={},this._addBgEvents(),this._handleMobileAndTablet(),this.setMaxH(this.MAX_SITE_HEIGHT),this.resources.W.Viewer.getPreviewMode()&&this._view.setStyle("padding-bottom",100)},_onAllSkinPartsReady:function(){var a=this.resources.W.Viewer.getDocWidth();this.setWidth(a),this._structureState===Constants.ViewerTypesParams.TYPES.MOBILE?(this._bgPropertyName="mobileBg",this._createMobileBgNode()):(this._bgPropertyName="siteBg",this._createDesktopBgNode()),this._updateBgProperty(),this._validateBg()},_createDesktopBgNode:function(){this._bgNode=new Element("div",{id:"bgNode"}),this._bgNode.setStyles({position:"absolute",width:"100%"}),document.body.insertBefore(this._bgNode,document.body.firstChild)},_createMobileBgNode:function(){this._bgNode=document.getElementById("mobile_bgNode");var a=!this._bgNode;if(this._bgNode=this._bgNode||new Element("div",{id:"mobile_bgNode"}),a){var b=this._view.getStyle("width");this._bgNode.setStyles({width:b,left:"50%","margin-left":"-160px"})}else this._bgNode.setStyles({display:"block"});document.body.insertBefore(this._bgNode,document.body.firstChild)},_addBgEvents:function(){window.addEvent("scroll",this._delayedInvalidateBg),window.addEvent("resize",this._delayedInvalidateBg),this.resources.W.Theme.addEvent("propertyChange",this._onThemePropertyChange)},render:function(){var a=this.resources.W.Viewer.getDocWidth();this.setWidth(a),this.parent()},_handleMobile:d.remove(),_handleMobileAndTablet:function(){this._mobileConfig.isMobileOrTablet()&&(window.addEvent("orientationchange",this._delayedInvalidateBg),this._view.setStyle("overflow","hidden"),this._mobileConfig.isAndroidMobileDevice()&&this._view.setStyle("max-height","10000000000px"),this._view.setStyle("-webkit-text-size-adjust","none"),this._view.setStyle("-moz-text-size-adjust","none"),this._view.setStyle("-ms-text-size-adjust","none"))},_onThemePropertyChange:function(a){a&&"propertyChange"==a.type&&a.name!=this._bgPropertyName||(this._updateBgProperty(),this._invalidateBg())},_updateBgProperty:function(){this._siteBgDef=this.resources.W.Theme.getProperty(this._bgPropertyName),this._bgFixed="fixed"==this._siteBgDef.getAttachment(),this._structureState===Constants.ViewerTypesParams.TYPES.MOBILE&&(this._bgFixed=!1),this._bgStyle["background-image"]=this._siteBgDef.getUrl(),this._bgStyle["background-size"]=this._siteBgDef.getCssSizeValue(),this._bgStyle["background-position"]=this._siteBgDef.getPosition(),this._bgStyle["background-repeat"]=this._siteBgDef.getRepeatUnified(),this._bgStyle["background-color"]=this._siteBgDef.getColor()},collapse:function(){this._bgNode.setStyle("display","none"),this.parent()},uncollapse:function(){this._bgNode.setStyle("display","block"),this.parent()},_updateSiteBgPosition:function(){return this._mobileConfig.isMobileOrTablet()?(this._handleMobileBgPosition(),void 0):(Modernizr.positionfixed?this._bgStyle.position=this._bgFixed?"fixed":"absolute":this._bgStyle.top=this._bgFixed?document.body.scrollTop+"px":0,void 0)},_handleMobileBgPosition:function(){this._structureState===Constants.ViewerTypesParams.TYPES.MOBILE?this._bgStyle.position="absolute":this._bgStyle.top=this._bgFixed?document.body.scrollTop+"px":0}})}),define.experiment.component("wysiwyg.viewer.components.WixAds.ViewerRefactor.New",function(a,b){var c=a,d=b;c.resources(["W.Config","W.Viewer"]),c.binds(d.merge(["_onViewerModeChange"])),c.methods({initialize:d.after(function(){this.injects().Commands.registerCommandListenerByName("WPreviewCommands.ViewerStateChanged",this,this._onViewerModeChange)}),render:function(){this.parent();var a=this.injects().Viewer.getAdData();this.resources.W.Viewer.getViewerMode()===Constants.ViewerTypesParams.TYPES.MOBILE?(this._removeHeaderAd(),this._removeFooterAd()):this.resources.W.Config.mobileConfig.isMobile()?this._removeFooterAd():(this._setHeaderAd(a),this._setFooterAd(a))},_onViewerModeChange:function(a){var b=a.editMode,c=a.viewerMode||this.resources.W.Viewer.getViewerMode(),d=this._shouldShowAds(b,c);this.setCollapsed(!d)},_shouldShowAds:function(a,b){return this._isInPreviewMode(a)&&!this._isPremium()&&b!==Constants.ViewerTypesParams.TYPES.MOBILE},_setHeaderAd:function(a){this._skinParts.topRectLabel.set("html",a.topLabel),this._skinParts.topRectContent.set("html",a.topContent),this._skinParts.topRectLabel.uncollapse(),this._skinParts.topRectContent.uncollapse()},_setFooterAd:function(a){this._skinParts.footerLabel.set("html",a.footerLabel),this._skinParts.footerLabel.uncollapse()},_removeHeaderAd:function(){this._skinParts.topRectLabel.collapse(),this._skinParts.topRectContent.collapse()},_removeFooterAd:function(){this._skinParts.footerLabel.collapse()
}})}),define.experiment.newComponent("wysiwyg.viewer.components.documentmedia.DocumentMedia.DocumentMedia.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.traits(["wysiwyg.common.components.traits.LinkableComponent","wysiwyg.viewer.components.documentmedia.traits.DocumentSelectionHandler"]),b.propertiesSchemaType("DocumentMediaProperties"),b.dataTypes(["DocumentMedia"]),b.resources(["W.Utils","W.Viewer"]),b.skinParts({documentMediaLink:{type:"htmlElement"},link:{type:"htmlElement"}}),b.binds(["_onDocSelect","_setLabelAccordingToData","_setImageAccordingToData","_toggleTitleDisplay"]),b.states(["loading","normal","rollover"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.EDITOR_META_DATA={general:{settings:!0,design:!1},custom:[{label:"LINK_TO_DOCUMENT",command:"WEditorCommands.ShowDocumentMediaDialog",commandParameter:{callback:this._onDocSelect,galleryConfigID:"documents"}},{label:"PHOTO_REPLACE_IMAGE",command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"photos"}}]}},_onRender:function(){this._setLabelAccordingToData(),this._setImageAccordingToData(),this._toggleTitleDisplay()},_setLabelAccordingToData:function(){var a=this.getDataItem().get("title");this._skinParts.label.set("html",a)},_setImageAccordingToData:function(){this.injects().Theme.getProperty("THEME_DIRECTORY"),this._data&&this._data.get("uri")&&this._skinParts.image.set("src",this._data.get("uri"))},_toggleTitleDisplay:function(){var a=this._skinParts.label;this.getComponentProperty("showDocumentTitle")?a.setStyle("display","block"):a.setStyle("display","none")}})}),define.experiment.newClass("wysiwyg.viewer.components.documentmedia.traits.DocumentSelectionHandler.DocumentMedia.New",function(a){var b=a;b.resources(["W.Config","W.Viewer","W.Commands"]),b.methods({_onDocSelect:function(a){this._rawDataIsOfTypePDF(a.uri)||(a.uri+="?dn="+a.title);var b=this.getDataItem();b.set("linkTitle",a.title),b.set("fileName",a.title),b.set("linkType","DOCUMENT"),b.set("href",serviceTopology.staticDocsUrl+"/"+a.uri),b.set("target","_blank"),b.set("uri",serviceTopology.staticServerUrl+"/"+a.iconURL)},_rawDataIsOfTypePDF:function(a){var b=a.split("."),c=b[b.length-1];return-1!==c.indexOf("pdf")}})}),define.experiment.component("wysiwyg.viewer.components.menus.DropDownMenu.LimitRecursiveDDM.New",function(a,b){var c=a,d=b;c.binds(["_onButtonDataChange","_onThemeChange","_arrangeButtons","_onButtonClick","_onPageChanged","_resetTestOverFlowCount"]),c.methods({_resetTestOverFlowCount:function(){this._testOverFlowCount=5},initialize:d.after(function(){this._resetTestOverFlowCount()}),_testOverFlow:function(){var a=this._getButtonsWidth();this.injects().Utils.clearCallLater(this._overflowID),0==this._prevButtonsWidth&&(this._prevButtonsWidth=a),a!=this._prevButtonsWidth?this._arrangeButtons():this._testOverFlowCount>0&&(this._testOverFlowCount--,this._overflowID=this.callLater(this._testOverFlow,[],100))},_onThemeChange:d.before(function(){this._resetTestOverFlowCount()}),_onResize:d.before(function(){this._resetTestOverFlowCount()}),_onRepeaterReady:function(){this.addEvent(Constants.PropertyEvents.PROPERTY_CHANGED,function(){this._resetTestOverFlowCount(),this._arrangeButtons()}.bind(this)),this._treeConstructionDone=!1,this._arrangeButtonAccordingToData(),this._constructButtonsTree()}})}),define.experiment.component("wysiwyg.viewer.components.menus.DropDownMenu.PartialComponentPreview.New",function(a,b){var c=a;c.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0,previewable:!0},custom:[{label:"FPP_NAVIGATE_LABEL",command:"WEditorCommands.Pages",commandParameter:{galleryConfigID:"pagesPanel"}}],dblClick:{command:"WEditorCommands.Pages"}},_prevButtonsWidth:0,_testOverFlowCount:50,_buttonsPadding:{}})}),define.experiment.component("wysiwyg.viewer.components.menus.DropDownMenu.RenamePages.New",function(a,b){var c=a;c.fields({EDITOR_META_DATA:b.merge({custom:[{label:"FPP_RENAME_PAGES_LABEL",command:"WEditorCommands.Pages",commandParameter:{galleryConfigID:"pagesPanel"}}]})})}),define.experiment.component("wysiwyg.viewer.components.menus.DropDownMenu.safari5menufix.New",function(a){var b=a;b.methods({_initItemsContainer:function(){this._skinParts.itemsContainer.setStyle("text-align",this.getComponentProperty("alignButtons"));var a=this.getHeight()-this._getBorder(this._skinParts.itemsContainer).y-this._getMargin(this._skinParts.itemsContainer).y,b=this.getWidth()-this._getBorder(this._skinParts.itemsContainer).x-this._getMargin(this._skinParts.itemsContainer).x;this._skinParts.itemsContainer.setStyle("height",a+"px"),window.Browser&&window.Browser.safari&&window.Browser.version<6?this._skinParts.itemsContainer.setStyle("width","100%"):this._skinParts.itemsContainer.setStyle("width",b+"px"),this._skinParts.itemsContainer.setStyle("overflow","hidden"),this._skinParts.itemsContainer.setStyle("white-space","normal")}})}),define.experiment.newComponent("wysiwyg.viewer.components.mobile.TinyMenu.MobileViewerComponents.New",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Commands","W.Data","W.Viewer"]),b.skinParts({menuButton:{type:"htmlElement"},menuContainer:{type:"htmlElement"}}),b.dataTypes(["Menu"]),b.fields({EDITOR_META_DATA:{general:{settings:!1,design:!1},mobile:{custom:[{label:"FPP_DESIGN_LABEL",command:"WEditorCommands.ShowMobileMenuPanel"},{label:"FPP_NAVIGATE_LABEL",command:"WEditorCommands.Pages",commandParameter:{galleryConfigID:"pagesPanel"}}]}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[]},render:function(){var a=this._data.getItems();this._asyncGetChildren(a,function(a){var b=this._skinParts.menuContainer;this._clearOldContent(b),this._mainMenu=this._initMenu(a,b)}.bind(this)),this.parent()},_clearOldContent:function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},_applyResponsiveStyling:function(){var a=10,b=this._skinParts.menuContainer,c=this.resources.W.Viewer.getCompByID("SITE_STRUCTURE"),d=_.parseInt(c.getStyle("width"));d-=2*a,b.setStyle("width",d);var e=_.parseInt(this._view.getStyle("left"));e-=a;var f=-1*e;b.setStyle("left",f)},_initMenu:function(a,b){if(a&&!_.isEmpty(a)){var c=this._buildMenu(a,!0);return this._addElement(b,c),this._bindMenuEvents(c),c}},_bindMenuEvents:function(a){this._mainMenu||(this._skinParts.menuButton.addEvent("click",this._toggleMenu.bind(this)),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._closeMainMenu)),a.addEvent("click",function(a){var b=a.target;if(b.className.indexOf("tiny-menu-toggle-items")>-1){var c=b.parentElement;this._toggleClass(c,"tiny-menu-open")}}.bind(this)),this.resources.W.Viewer.getCurrentPageId(),this._setCurrentPageTracking(a)},_toggleMenu:function(){var a=this._skinParts.menuButton;a.className.indexOf("tiny-menu-open")>-1?this._closeMainMenu():this._openMainMenu()},_openMainMenu:function(){var a=this._mainMenu,b=this._skinParts.menuButton;_.forEach(a.children,function(a){var b=a.querySelector(".tiny-menu-current-page");b||$(a).removeClass("tiny-menu-open")}),this._applyResponsiveStyling(a),$(a).addClass("tiny-menu-open"),$(b).addClass("tiny-menu-open")},_closeMainMenu:function(){var a=this._mainMenu,b=this._skinParts.menuButton;$(a).removeClass("tiny-menu-open"),$(b).removeClass("tiny-menu-open")},_buildMenu:function(a,b){var c;return c=new Element("ul"),c.setAttribute("class",b?"tiny-menu-top-menu":"tiny-menu-sub-menu"),this._addItems(a,c),c},_addItems:function(a,b){_.forEach(a,function(a){var c=this._buildItem(a),d=a.children;if(d&&_.isArray(d)&&!_.isEmpty(d)){var e=this._buildToggleButton();this._addElement(c,e);var f=this._buildMenu(d);this._addElement(c,f)}this._addElement(b,c)},this)},_buildItem:function(a){var b=a.name,c=a.id,d=a.children,e=d&&_.isArray(d)&&!_.isEmpty(d),f=new Element("li");e&&f.setAttribute("class","hasChildren");var g=this._buildLink(b,c);return f=this._addElement(f,g)},_buildLink:function(a,b){var c=new Element("a");return c.innerHTML=a,c.setAttribute("data-refid",b),c=this._bindPageNavigation(c,b)},_buildToggleButton:function(){var a=new Element("span");return a.setAttribute("class","tiny-menu-toggle-items"),a},_bindPageNavigation:function(a,b){return a.addEvent("click",function(){this._navigateToPage(b),this._closeMainMenu()}.bind(this)),a},_setCurrentPageTracking:function(a){this.resources.W.Commands.registerCommandAndListener("WViewerCommands.SelectedPageChanged",this,function(b){this._setCurrentPage(a,b)})},_setCurrentPage:function(a,b){var c=a.querySelector(".tiny-menu-current-page");c&&$(c).removeClass("tiny-menu-current-page");var d=a.querySelector("[data-refid="+b+"]");d&&$(d).addClass("tiny-menu-current-page")},_navigateToPage:function(a){0===a.indexOf("#")&&(a=a.substr(1)),this.resources.W.Viewer.goToPage(a)},_asyncGetChildren:function(a,b){if(!_.isArray(a)||_.isEmpty(a))return b([]),void 0;var c=a.length,d=[];_.forEach(a,function(a){this._asyncGetSinglePage(a,function(a){a&&d.push(a),c-=1,1>c&&b(d)})},this)},_asyncGetSinglePage:function(a,b){var c=a.get("refId"),d=a.get("items");this.resources.W.Data.getDataByQuery(c,function(a){var c=a.get("hidePage");if(c)return b(null),void 0;var e=this._getItemData(a);this._asyncGetChildren(d,function(a){e.children=a,b(e)})}.bind(this))},_getItemData:function(a){var b={};return b.id=a.get("id"),b.name=a.get("title"),b.children=[],b},_addElement:function(a,b){return a.appendChild(b),a},_toggleClass:function(a,b){var c;c=a.className.indexOf(b)>-1?a.className.replace(" "+b,""):a.className+" "+b,a.setAttribute("class",c)}})}),define.experiment.component("wysiwyg.viewer.components.sm.SMApplyForMembership.SMForgot_Password.New",function(a,b){var c=a;c.methods({_onFormSuccess:function(){var a=this._emailField._data.get("text"),b="Success! Your member login request has been sent and is awaiting approval. The site administrator will notify you via email ("+a+") once your request has been approved";this._container.showConfirmation({message:b})}})}),define.experiment.component("wysiwyg.viewer.components.sm.SMContainer.SMForgot_Password.New",function(a,b){var c=a,d=b;c.statics({INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",EMAIL_RESET_PASSWORD:"EMAILRESETPASSWORD",RESET_PASSWORD:"RESETPASSWORD"}}),c.methods({initialize:d.after(function(a,b,c){this._shouldCloseContainer=!0,this._formData=c&&c.formData}),_initializeForm:function(a){this._currentForm=a;var b=this._skinParts.title;b.set("html",this._currentForm.getDisplayName());var c=this._skinParts.submitButton;c.set("value",this._currentForm.getButtonLabel());var d=this._skinParts.note,e=this._currentForm.getSubHeaderElement();if(e){var f=e.el,g=e.intent;f.getElements("a").addEvent("click",function(){this.resources.W.SiteMembers.openSiteMembersPopup({intent:g,disableCancel:this._disableCancel,openedByPageSecurity:this._openedByPageSecurity,hashRedirectTo:this._hashRedirectTo,formData:this._formData})}.bind(this)),d.adopt(f.childNodes)}this._addCurrentFormEvents(),this._openedByPageSecurity&&(this.resources.W.Viewer.isPublicMode()||this.resources.W.Config.isInDebugMode()?(this._skinParts.infoTitle.set("text","To view this page, you need to be logged in."),this._skinParts.note.setStyle("float","right"),this._skinParts.infoTitle.setStyle("display","block")):this.showConfirmation({message:"".concat("This page is protected with a member login. Your users will be able to see this page once they are logged in."," To manage your site's members, go to your site in My Account and click Site Members")},function(){this.reportAuthStatusChange(!0),this._closeSMContainer()}.bind(this)))},_createInnerDialog:function(a){return this._assureIntentExists(),this._enrichDefinitionByType(a),a},_assureIntentExists:function(){var a=this.resources.W.SiteMembers;this._intent||(this._intent=a.isNotAuthenticatedWithCookie()?this.INTENTS.LOGIN:this.INTENTS.REGISTER)},_enrichDefinitionByType:function(a){var b=null;switch(this._intent){case this.INTENTS.REGISTER:var c=this.resources.W.SiteMembers.getCollectionType();switch(c){case"Open":b="register";break;case"ApplyForMembership":b="applyForMembership";break;default:b="register"}break;case this.INTENTS.LOGIN:b="login";break;case this.INTENTS.EMAIL_RESET_PASSWORD:b="ResetPasswordEmail";break;case this.INTENTS.RESET_PASSWORD:b="ResetPassword"}return null!==b&&this._enrichDefinitionType(a,b),a},_enrichDefinitionType:function(a,b){a.type="wysiwyg.viewer.components.sm.SM"+b.capitalize(),a.skin="wysiwyg.viewer.skins.sm.SM"+b.capitalize()+"Skin",a.argObject={container:this,formData:this._formData}},_setConfirmationOkCaption:function(a){this._skinParts.okButton.value=a},showConfirmation:function(a,b,c){this.setState("confirm"),this._updateConfirmationDialogTexts(a),this._confirmCallback=b,this._shouldCloseContainer=c,void 0===c&&(this._shouldCloseContainer=!0)},_updateConfirmationDialogTexts:function(a){this._skinParts.confirmationText.set("text",a.message),this._skinParts.confirmationTitleText.set("text",a.title)},_handleConfirmationOk:function(){this._confirmCallback&&this._confirmCallback(),this._shouldCloseContainer&&this._closeSMContainer(),this._shouldCloseContainer=!0},closeAndRedirectTo:function(a){if(this._closeSMContainer(),this._hashRedirectTo){var b=this.resources.W.Utils.hash.getHashParts(this._hashRedirectTo);this.resources.W.Utils.hash.setHash(b.id,b.title,b.extData,!0),window.location.hash=this._hashRedirectTo}a?this._directToUrl(a):this._reload()},_directToUrl:function(a){location.href=a},_reload:function(){location.reload()}})}),define.experiment.component("wysiwyg.viewer.components.sm.SMForm.SMForgot_Password.New",function(a,b){var c=a;c.statics({PASS_MIN_LEN:4,PASS_MAX_LEN:15,ERR_MAP:{GENERAL_ERR:"Server error. try again later.",VAL_ERR_PASSWORD_BLANK:"Password cannot be blank",VAL_ERR_PASSWORD_RETYPE:"Passwords are not the same",VAL_ERR_PASSWORD_LENGTH:"Password length must be between {0} and {1}",VAL_ERR_EMAIL_BLANK:"Email cannot be blank",VAL_ERR_EMAIL_INVALID:"Email is invalid","-19999":"Unknown user","-19995":"Email is already taken","-19972":"Invalid token","-19988":"Validation Error","-19984":"Invalid Session","-19976":"Wrong email or password","-19958":"Your member request is waiting approval from the site owner"},INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",UPDATE_USER:"UPDATE",EMAIL_RESET_PASSWORD:"EMAILRESETPASSWORD",RESET_PASSWORD:"RESETPASSWORD"},LABELS:{EMAIL:"Email",PASSWORD:"Password",RE_PASSWORD:"Retype password",REMEMBER_ME:"Remember Me"}})}),define.experiment.component("wysiwyg.viewer.components.sm.SMForm.SMPasswordPoundCharFix.New",function(a,b){var c=a,d=b;c.statics({ERR_MAP:d.merge({VAL_ERR_NON_ASCII_CHARS:"Password must contain only ASCII characters"})})}),define.experiment.Class("wysiwyg.viewer.components.sm.SMFormValidationHelper.SMPasswordPoundCharFix.New",function(a,b){var c=a,d=b;c.methods({_isAsciiOnlyInput:function(a){for(var b=a.length,c=this.PASS_MAX_LEN,d=0;b>d&&c>d;d++)if(a.charCodeAt(d)>127)return!1;return!0},isPasswordCharsValid:d.remove()})}),define.experiment.component("wysiwyg.viewer.components.sm.SMLogin.SMForgot_Password.New",function(a,b){var c=a;c.inherits("wysiwyg.viewer.components.sm.SMForm"),c.resources(["W.Data","W.SiteMembers","W.Utils"]),c.utilize(["wysiwyg.viewer.components.sm.SMFormValidationHelper"]),c.statics({CAPTIONS:{FORGOT_PASSWORD:"Forgot your password?",LOGIN:"Login",GO:"GO",SIGN_UP:"Or {0}Sign up{1}"}}),c.skinParts({email:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindEmailField"},password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},rememberMe:{type:"wysiwyg.viewer.components.inputs.CheckBoxInput",hookMethod:"_bindCheckBoxDataItem"},forgotPass:{type:"htmlElement"}}),c.methods({initialize:function(a,b,c){this.parent(a,b,c),this._formData=c&&c.formData,this._initEnteredEmail()},_initEnteredEmail:function(){this._enteredEmail=this._formData&&this._formData.enteredEmail||""},_onAllSkinPartsReady:function(){this._emailField=this._skinParts.email,this._passwordField=this._skinParts.password,this._rememberMeField=this._skinParts.rememberMe,this._forgotPasswordField=this._skinParts.forgotPass,this._forgotPasswordField.innerHTML=this.CAPTIONS.FORGOT_PASSWORD,this._forgotPasswordField.addEvent("click",function(){this._closeAndRedirectToEmailReset()}.bind(this)),this._updateEmailWithUserInput()},_updateEmailWithUserInput:function(){var a=this._emailField.getDataItem();a._data.text=this._enteredEmail,this._emailField.setDataItem(a),this._emailField._skinParts.input.value=this._enteredEmail},_closeAndRedirectToEmailReset:function(){this.resources.W.SiteMembers.openSiteMembersPopup({intent:this.INTENTS.EMAIL_RESET_PASSWORD,formData:{enteredEmail:this._emailField._data.get("text")}})},onSubmit:function(){var a=this._emailField._data.get("text"),b=this._passwordField._data.get("text"),c=this._rememberMeField._data.get("value");this._validateFields(a,b)&&this.resources.W.SiteMembers.login(a,b,c,this._onFormSuccess,this._onFormError)},_onFormSuccess:function(){var a=this._removeResetForgotPasswordParameterIfExists();this._container.closeAndRedirectTo(a)},_removeResetForgotPasswordParameterIfExists:function(){var a=window.location.href;return a.indexOf(this.resources.W.SiteMembers.RESET_PASSWORD_KEY_PARAMETER)>=0?this._removeParameterFromUrl(a,this.resources.W.SiteMembers.RESET_PASSWORD_KEY_PARAMETER):a},_removeParameterFromUrl:function(a,b){if(a&&b){var c=a.indexOf(b);if(c>=0){var d=a.substr(c).indexOf("&");return 0>d&&(d=a.length),a.slice(0,c)+a.slice(c+d+"&".length)}}return a},onCancel:function(){this.reportAuthStatusChange(!1,{cancel:!0})},getDisplayName:function(){return this.CAPTIONS.LOGIN},getButtonLabel:function(){return this.CAPTIONS.GO},getSubHeaderElement:function(){var a=new Element("DIV"),b=this.CAPTIONS.SIGN_UP;return b=this._formatString(b,["<a>","</a>"]),a.set("html",b),{el:a,intent:this.INTENTS.REGISTER}},_formatString:function(a,b){var c=0;return b.map(function(b){var d="{"+c+"}";a=a.replace(d,b),c++}),a},_bindCheckBoxDataItem:function(a){return a.dataItem=this.resources.W.Data.createDataItem({value:"false",type:"Boolean"},"Boolean"),a.dataItem.setMeta("isPersistent",!1),a.argObject={label:this.LABELS.REMEMBER_ME},a}})}),define.experiment.component("wysiwyg.viewer.components.sm.SMLogin.SMPasswordPoundCharFix.New",function(a){var b=a;b.methods({onSubmit:function(){var a=this._emailField._data.get("text"),b=this._passwordField._data.get("text"),c=this._rememberMeField._data.get("value");this._validateFields(a,b)&&(b=this.resources.W.Utils.encodeValue(b),this.resources.W.SiteMembers.login(a,b,c,this._onFormSuccess,this._onFormError))},_validatePassword:function(a,b){return a.isBlankPassword(b)?(this._displayErrorOn(this._passwordField,"VAL_ERR_PASSWORD_BLANK"),!1):a.isPasswordLengthValid(b)?!0:(this._displayErrorOn(this._passwordField,"VAL_ERR_PASSWORD_LENGTH",[this.PASS_MIN_LEN,this.PASS_MAX_LEN]),!1)}})}),define.experiment.component("wysiwyg.viewer.components.sm.SMLogin.SiteMembersCommon.New",function(a){var b=a;b.utilize(["wysiwyg.viewer.components.sm.SMFormValidationHelper"]),b.methods({_validateFields:function(a,b){this._passwordField.setValidationState(!0),this._emailField.setValidationState(!0);var c=new this.imports.SMFormValidationHelper,d=this._validateEmail(c,a),e=this._validatePassword(c,b);return d&&e},_validateEmail:function(a,b){return a.isEmailBlank(b)?(this._displayErrorOn(this._emailField,"VAL_ERR_EMAIL_BLANK"),!1):a.isEmailValid(b)?!0:(this._displayErrorOn(this._emailField,"VAL_ERR_EMAIL_INVALID"),!1)},_validatePassword:function(a,b){return a.isBlankPassword(b)?(this._displayErrorOn(this._passwordField,"VAL_ERR_PASSWORD_BLANK"),!1):a.isPasswordLengthValid(b)?!0:(this._displayErrorOn(this._passwordField,"VAL_ERR_PASSWORD_LENGTH",[this.PASS_MIN_LEN,this.PASS_MAX_LEN]),!1)},_displayErrorOn:function(a,b,c){a.setValidationState(!1),this._onFormError({errorCode:b,errorParams:c},a)}})}),define.experiment.component("wysiwyg.viewer.components.sm.SMRegister.SMPasswordPoundCharFix.New",function(a,b){var c=a;c.utilize(["wysiwyg.viewer.components.sm.SMFormValidationHelper"]),c.methods({onSubmit:function(){var a=this._emailField._data.get("text"),b=this._passwordField._data.get("text"),c=this._rePasswordField._data.get("text");this._validateFields(a,b,c)&&(b=this.resources.W.Utils.encodeValue(b),this.resources.W.SiteMembers.register(a,b,this._onFormSuccess,this._onFormError))},_validateFields:function(a,b,c){this._passwordField.setValidationState(!0),this._rePasswordField.setValidationState(!0),this._emailField.setValidationState(!0);var d=new this.imports.SMFormValidationHelper,e=this._validateEmail(d,a),f=this._validatePassword(d,b,c);return e&&f},_validateEmail:function(a,b){return a.isEmailBlank(b)?(this._displayErrorOn(this._emailField,"VAL_ERR_EMAIL_BLANK"),!1):a.isEmailValid(b)?!0:(this._displayErrorOn(this._emailField,"VAL_ERR_EMAIL_INVALID"),!1)},_validatePassword:function(a,b,c){return a.isBlankPassword(b)?(this._displayErrorOn(this._passwordField,"VAL_ERR_PASSWORD_BLANK"),!1):a._isAsciiOnlyInput(b)?a.isPasswordLengthValid(b)?a.doPasswordsMatch(b,c)?!0:(this._displayErrorOn(this._rePasswordField,"VAL_ERR_PASSWORD_RETYPE"),!1):(this._displayErrorOn(this._passwordField,"VAL_ERR_PASSWORD_LENGTH",[this.PASS_MIN_LEN,this.PASS_MAX_LEN]),!1):(this._displayErrorOn(this._passwordField,"VAL_ERR_NON_ASCII_CHARS"),!1)},_displayErrorOn:function(a,b,c){a.setValidationState(!1),this._onFormError({errorCode:b,errorParams:c},a)}})}),define.experiment.newComponent("wysiwyg.viewer.components.sm.SMResetPassword.SMForgot_Password.New",function(a,b){var c=a;c.inherits("wysiwyg.viewer.components.sm.SMForm"),c.binds(["_onSuccessfulReset","_onFailedReset"]),c.resources(["W.SiteMembers"]),c.skinParts({formMessage:{type:"htmlElement"},password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindNewPasswordField"},passwordRetype:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordRetypeField"}}),c.statics({CAPTIONS:{RESET_PASSWORD_MESSAGE:"To set your new password, please enter it in both fields below. ",ENTER_NEW_PASSWORD:"Enter a new password:",RETYPE_PASSWORD:"Type again:",FORM_TITLE:"Reset Password",SUBMIT_BUTTON_LABEL:"GO",CONFIRMATION_BUTTON_CAPTION:"Continue"},MESSAGES:{RESET_SUCCESS:"Youve successfully reset your password.",RESET_FAILED:"Password could not have been changed. Try again later."}}),c.methods({_onAllSkinPartsReady:function(){this._formMessage=this._skinParts.formMessage,this._password=this._skinParts.password,this._passwordRetype=this._skinParts.passwordRetype,this._formMessage.innerText=this.CAPTIONS.RESET_PASSWORD_MESSAGE},onSubmit:function(){this._isPasswordValid()&&this._doPasswordsMatch()&&this._resetPassword()},_resetPassword:function(){var a=this._getTextInputFromField(this._password),b=this.resources.W.SiteMembers;b.resetPassword(a,this._onSuccessfulReset,this._onFailedReset)},_getCurrentSearchURL:function(){return window.location.search},_onSuccessfulReset:function(){this._container._setConfirmationOkCaption(this.CAPTIONS.CONFIRMATION_BUTTON_CAPTION),this._container.showConfirmation({message:this.MESSAGES.RESET_SUCCESS},this._closeAndRedirectToLogin(),!1)},_closeAndRedirectToLogin:function(){var a=this;return function(){a.resources.W.SiteMembers.openSiteMembersPopup({intent:a.INTENTS.LOGIN})}},_onFailedReset:function(){this._container.showConfirmation(this.MESSAGES.RESET_FAILED,this._closeSMContainer)},_isPasswordValid:function(){this._password.setValidationState(!0),this._passwordRetype.setValidationState(!0);var a=this._password._data.get("text");return a?a.length<this.PASS_MIN_LEN||a.length>this.PASS_MAX_LEN?(this._password.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_LENGTH",errorParams:[this.PASS_MIN_LEN,this.PASS_MAX_LEN]},this._password),!1):!0:(this._password.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_BLANK"},this._password),!1)},_doPasswordsMatch:function(){var a=this._getTextInputFromField(this._password),b=this._getTextInputFromField(this._passwordRetype);return this._passwordRetype.setValidationState(!0),a!==b?(this._passwordRetype.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_RETYPE"},this._passwordRetype),!1):!0},_getTextInputFromField:function(a){var b=a._data.get("text");return b},onCancel:function(){this.reportAuthStatusChange(!1,{cancel:!0})},getDisplayName:function(){return this.CAPTIONS.FORM_TITLE},getButtonLabel:function(){return this.CAPTIONS.SUBMIT_BUTTON_LABEL},getSubHeaderElement:function(){return null},_bindNewPasswordField:function(a){return this._bindPasswordField(a,this.CAPTIONS.ENTER_NEW_PASSWORD)},_bindPasswordRetypeField:function(a){return this._bindPasswordField(a,this.CAPTIONS.RETYPE_PASSWORD)},_bindPasswordField:function(a,b){return a.argObject={label:b,passwordField:!0},this._bindTextDataItem(a)}})}),define.experiment.newComponent("wysiwyg.viewer.components.sm.SMResetPasswordEmail.SMForgot_Password.New",function(a,b){var c=a;c.inherits("wysiwyg.viewer.components.sm.SMForm"),c.resources(["W.Data","W.SiteMembers","W.Utils"]),c.statics({CAPTIONS:{FORM_TITLE:"Reset Password",SUBMIT_BUTTON_LABEL:"GO",BACK_TO_LOGIN:"Back to Login",EMAIL_TITLE:"Please enter your email address",CONFIRMATION_TITLE:"Please check your email",CONFIRMATION_MSG:"Weve sent you an email with a link that will allow you to reset your password"}}),c.skinParts({email:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindEmailField"}}),c.methods({initialize:function(a,b,c){this.parent(a,b,c),this._enteredEmail=c&&c.formData&&c.formData.enteredEmail||""},_onAllSkinPartsReady:function(){this._email=this._skinParts.email,this._updateEmailWithUserInput()},_updateEmailWithUserInput:function(){var a=this._email.getDataItem();a._data.text=this._enteredEmail,this._email.setDataItem(a),this._email._skinParts.input.value=this._enteredEmail},_getEmailInput:function(){return this._email._data.get("text")},onSubmit:function(){var a=this._getEmailInput();if(this._isEmailFieldValid(a)){var b=this.resources.W.SiteMembers;b.sendUserPasswordResetEmail(a,this._onFormSuccess,this._onFormError)}},_isEmailFieldValid:function(a){return this._email.setValidationState(!0),a?this.resources.W.Utils.isValidEmail(a)?!0:(this._email.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_EMAIL_INVALID"},this._email),!1):(this._email.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_EMAIL_BLANK"},this._email),!1)},_bindEmailField:function(a){return a.argObject={label:this.CAPTIONS.EMAIL_TITLE},this._bindTextDataItem(a)},_onFormSuccess:function(){this._closeAndRedirectToConfirmationDialog()},_closeAndRedirectToConfirmationDialog:function(){this._container.showConfirmation({title:this.CAPTIONS.CONFIRMATION_TITLE,message:this.CAPTIONS.CONFIRMATION_MSG},this._closeSMContainer)},onCancel:function(){this.reportAuthStatusChange(!1,{cancel:!0})},getDisplayName:function(){return this.CAPTIONS.FORM_TITLE},getButtonLabel:function(){return this.CAPTIONS.SUBMIT_BUTTON_LABEL},getSubHeaderElement:function(){var a=new Element("DIV"),b=this.CAPTIONS.BACK_TO_LOGIN;return a.set("html","<a>"+b+"</a>"),{el:a,intent:this.INTENTS.LOGIN,formData:{enteredEmail:function(){this._email._data.get("text")}.bind(this)}}}})}),define.experiment.newClass("wysiwyg.viewer.components.svgshape.SvgCircleScaler.SvgShapeComponent.New",function(a){var b=a;b.methods({initialize:function(a){this.circleElement=a},scale:function(a,b){var c=this.circleElement.getAttribute("cx"),d=this.circleElement.getAttribute("cy"),e=this.circleElement.getAttribute("r"),f=Math.min(a,b);c&&d&&(this.circleElement.setAttribute("cx",f*parseInt(c,10)),this.circleElement.setAttribute("cy",f*parseInt(d,10)),this.circleElement.setAttribute("r",f*parseInt(e,10)))}})}),define.experiment.newClass("wysiwyg.viewer.components.svgshape.SvgEllipseScaler.SvgShapeComponent.New",function(a){var b=a;b.methods({initialize:function(a){this.ellipseElement=a},scale:function(a,b){var c=this.ellipseElement.getAttribute("cx"),d=this.ellipseElement.getAttribute("cy"),e=this.ellipseElement.getAttribute("rx"),f=this.ellipseElement.getAttribute("ry");c&&e&&(this.ellipseElement.setAttribute("cx",a*parseInt(c,10)),this.ellipseElement.setAttribute("rx",a*parseInt(e,10))),d&&f&&(this.ellipseElement.setAttribute("cy",b*parseInt(d,10)),this.ellipseElement.setAttribute("ry",b*parseInt(f,10)))}})}),define.experiment.newClass("wysiwyg.viewer.components.svgshape.SvgLineScaler.SvgShapeComponent.New",function(a){var b=a;b.methods({initialize:function(a){this.lineElement=a},scale:function(a,b){var c=this.lineElement.getAttribute("x1"),d=this.lineElement.getAttribute("y1"),e=this.lineElement.getAttribute("x2"),f=this.lineElement.getAttribute("y2");c&&d&&e&&f&&(this.lineElement.setAttribute("x1",a*parseInt(c,10)),this.lineElement.setAttribute("x2",a*parseInt(e,10)),this.lineElement.setAttribute("y1",b*parseInt(d,10)),this.lineElement.setAttribute("y2",b*parseInt(f,10)))}})}),define.experiment.newClass("wysiwyg.viewer.components.svgshape.SvgPathParser.SvgShapeComponent.New",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils"]),b.methods({initialize:function(a){this.pathElement=a},getParsedPath:function(){var a=this.pathElement.getAttribute("d"),b=a.match(/[a-z][^a-z]*/gi),c=b.map(function(a){for(a=a.replace(/-/g," -").replace(/,/g," ");-1!==a.indexOf("  ");)a=a.replace(/ {2}/g," ");return[a.substring(0,1),this.trim(a.substring(1))]}.bind(this));return c.map(function(a){var b,c=[];return-1==="QSCL".indexOf(a[0].toUpperCase())||1!==a[1].split(",").length?a:(b=a[1].split(" "),0!==b.length%2?a:(b.forEach(function(a,b,d){0===b%2&&c.push(a+" "+d[b+1])}),[a[0],c.join(",")]))})},stringifyParsedPath:function(a){var b="";return a.forEach(function(a){a.forEach(function(a){b+=a})}),b}})}),define.experiment.newClass("wysiwyg.viewer.components.svgshape.SvgPathScaler.SvgShapeComponent.New",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils","wysiwyg.viewer.components.svgshape.traits.SvgShapeBasicScalers"]),b.utilize(["wysiwyg.viewer.components.svgshape.SvgPathParser"]),b.methods({initialize:function(a){this.pathElement=a,this.parser=new this.imports.SvgPathParser(this.pathElement),this._createScalers()},_createScalers:function(){this._commandScalers={M:this._scalePairString,L:this._scaleMultiplePairStrings,H:this._scaleSingleValueHorizontal,V:this._scaleSingleValueVertical,Z:this._emptyString,C:this._scaleMultiplePairStrings,S:this._scaleMultiplePairStrings,Q:this._scaleMultiplePairStrings,T:this._scalePairString,A:this._scaleArcString}},_emptyString:function(){return""},_scaleAngleValue:function(a){return this._scaleSingleValue(a,this.scaleY/(360*this.scaleX))},_scaleArcString:function(a){var b=a.split(/[\s,]+/);if(7!==b.length)throw new Error("incorrect arc string, should have exactly 7 parameters. (value was "+a);return b[0]=this._scaleSingleValueHorizontal(b[0]),b[1]=this._scaleSingleValueVertical(b[1]),b[2]=this._scaleAngleValue(b[2]),b[5]=this._scaleSingleValueHorizontal(b[5]),b[6]=this._scaleSingleValueVertical(b[6]),b.join(" ")},scale:function(a,b){var c=this.parser.getParsedPath();this.scaleX=a,this.scaleY=b,c.forEach(function(a){a[1]=this._commandScalers[a[0].toUpperCase()].call(this,a[1])}.bind(this)),this.pathElement.setAttribute("d",this.parser.stringifyParsedPath(c))}})}),define.experiment.newClass("wysiwyg.viewer.components.svgshape.SvgPolygonParser.SvgShapeComponent.New",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils"]),b.methods({initialize:function(a){this.polygonElement=a},getParsedPoints:function(){var a,b=this.trim(this.polygonElement.getAttribute("points")).split(/[\s,]+/),c=[];for(a=0;a<b.length;a+=2)c.push([b[a],b[a+1]]);return c},stringifyPoints:function(a){var b="";
return a.forEach(function(a){b+=a.join(",")+" "}),b}})}),define.experiment.newClass("wysiwyg.viewer.components.svgshape.SvgPolygonScaler.SvgShapeComponent.New",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils"]),b.utilize(["wysiwyg.viewer.components.svgshape.SvgPolygonParser"]),b.methods({initialize:function(a){this.polygonElement=a,this.parser=new this.imports.SvgPolygonParser(this.polygonElement)},scale:function(a,b){var c=this.parser.getParsedPoints();c.forEach(function(c){c[0]=this.round(c[0]*a),c[1]=this.round(c[1]*b)}.bind(this)),this.polygonElement.setAttribute("points",this.trim(this.parser.stringifyPoints(c)))}})}),define.experiment.newClass("wysiwyg.viewer.components.svgshape.SvgPolylineParser.SvgShapeComponent.New",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils"]),b.methods({initialize:function(a){this.polylineElement=a},getParsedPolyline:function(){var a=this.polylineElement.getAttribute("points"),b=a.replace(/ /gi,",").split(","),c=[];return b.forEach(function(a,b,d){0===b%2&&c.push(a+" "+d[b+1])}),c},stringifyParsedPolyline:function(a){return a.join(",")}})}),define.experiment.newClass("wysiwyg.viewer.components.svgshape.SvgPolylineScaler.SvgShapeComponent.New",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils","wysiwyg.viewer.components.svgshape.traits.SvgShapeBasicScalers"]),b.utilize(["wysiwyg.viewer.components.svgshape.SvgPolylineParser"]),b.methods({initialize:function(a){this.polylineElement=a,this.parser=new this.imports.SvgPolylineParser(this.polylineElement)},scale:function(a,b){var c=this.parser.stringifyParsedPolyline(this.parser.getParsedPolyline());this.scaleX=a,this.scaleY=b,this.polylineElement.setAttribute("points",this._scaleMultiplePairStrings(c))}})}),define.experiment.newClass("wysiwyg.viewer.components.svgshape.SvgRectScaler.SvgShapeComponent.New",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils"]),b.methods({initialize:function(a){this.rectElement=a,this._resetRectOrigin()},_resetRectOrigin:function(){this.rectElement.setAttribute("x","0"),this.rectElement.setAttribute("y","0")},scale:function(a,b){var c=this.rectElement.getAttribute("width"),d=this.rectElement.getAttribute("height"),e=this.rectElement.getAttribute("rx"),f=this.rectElement.getAttribute("ry");c&&this.rectElement.setAttribute("width",a*parseInt(c,10)),d&&this.rectElement.setAttribute("height",b*parseInt(d,10)),e&&this.rectElement.setAttribute("rx",a*parseInt(e,10)),f&&this.rectElement.setAttribute("ry",a*parseInt(f,10))}})}),define.experiment.newClass("wysiwyg.viewer.components.svgshape.SvgScaler.SvgShapeComponent.New",function(a){var b=a;b.utilize(["wysiwyg.viewer.components.svgshape.SvgPathScaler","wysiwyg.viewer.components.svgshape.SvgPolygonScaler","wysiwyg.viewer.components.svgshape.SvgRectScaler","wysiwyg.viewer.components.svgshape.SvgCircleScaler","wysiwyg.viewer.components.svgshape.SvgEllipseScaler","wysiwyg.viewer.components.svgshape.SvgPolylineScaler","wysiwyg.viewer.components.svgshape.SvgLineScaler"]),b.methods({initialize:function(a){this.svgElement=a,this._setGroupElement(),this._initializeScalers(),this._setAspectRatio()},_setGroupElement:function(){if(this.groupElement=_(this.svgElement.childNodes).find(function(a){return"g"===a.nodeName}),!this.groupElement)throw new Error("Shape component skin must contain a single <g> element wrapping all other svg contents.")},_initializeScalers:function(){this.scalers=[],_(this.groupElement.childNodes).forEach(function(a){this._isValidSvgElement(a.nodeName)&&this.scalers.push(this._createScaler(a))}.bind(this))},_isValidSvgElement:function(a){return _(["path","polygon","rect","circle","ellipse","polyline","line"]).contains(a.toLowerCase())},_createScaler:function(a){var b=a.nodeName.toLowerCase();switch(b){case"path":return new this.imports.SvgPathScaler(a);case"polygon":return new this.imports.SvgPolygonScaler(a);case"rect":return new this.imports.SvgRectScaler(a);case"circle":return new this.imports.SvgCircleScaler(a);case"ellipse":return new this.imports.SvgEllipseScaler(a);case"polyline":return new this.imports.SvgPolylineScaler(a);case"line":return new this.imports.SvgLineScaler(a);default:throw new Error("Can't create a scaler for \""+b+'" element, because it is not implemented.')}},setSvgSize:function(a,b){this.svgElement.style.width=a+"px",this.svgElement.style.height=b+"px"},getActualDimensions:function(){var a=this.groupElement.getBBox();return{width:Math.round(a.width),height:Math.round(a.height),x:Math.round(a.x),y:Math.round(a.y)}},setGroupElementPosition:function(){var a=this.getActualDimensions();this.groupElement.setAttribute("transform","translate("+-1*a.x+","+-1*a.y+")")},scale:function(a,b){this.scalers.forEach(function(c){c.scale(a,b)})},_setAspectRatio:function(){var a=this.getActualDimensions();this.aspectRatio=a.width/a.height},getOriginalAspectRatio:function(){return this.aspectRatio}})}),define.experiment.newComponent("wysiwyg.viewer.components.svgshape.SvgShape.SvgShapeComponent.New",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils"]),b.utilize(["wysiwyg.viewer.components.svgshape.SvgScaler"]),b.propertiesSchemaType("SvgShapeProperties"),b.resources(["W.Theme","W.Config","W.Skins"]),b.binds(["_mediaGalleryCallback"]),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"SVGSHAPE_SELECT_SKIN",command:"WEditorCommands.OpenMediaFrame",commandParameter:{publicMediaFile:"shapes",i18nPrefix:"shape",selectionType:"single",callback:"_mediaGalleryCallback"}}]}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c)},_onRender:function(a){var b,c,d,e=a.data.invalidations,f=!1;e.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE])&&(f=!0,this._destroyScaler()),this._initializeScaler(),b=this.svgScaler.getActualDimensions(),c={width:parseInt(this.$view.style.minWidth,10),height:parseInt(this.$view.style.minHeight,10)},d=this.calculateScale(b,c),(1!==d.scaleX||1!==d.scaleY||f)&&(this.svgScaler.setSvgSize(c.width,c.height),this.svgScaler.scale(d.scaleX,d.scaleY),this.svgScaler.setGroupElementPosition())},_setSkinForStyleId:function(a,b){var c=Q.defer(),d=this.resources.W;return d.Skins.getSkin(b,function(b){var e=d.Theme._styleCache[a];e?(e.setSkin(b),setTimeout(function(){c.resolve()},300)):c.reject("skinParam mapper is not defined for styleId="+a)}),c.promise},_mediaGalleryCallback:function(a){var b="svg_"+a.fileName.replace(".js","")+".SvgShape",c=this.getStyle().getDataItem().get("id");this._setSkinForStyleId(c,b)},calculateScale:function(a,b){var c,d,e=this.getComponentProperty("aspectRatio"),f=this.svgScaler.getOriginalAspectRatio(),g=b.width/b.height;return c=a.width?e&&g>f?b.height*f/a.width:b.width/a.width:1,d=a.height?e&&f>g?b.width/f/a.height:b.height/a.height:1,{scaleX:this.round(c),scaleY:this.round(d)}},_initializeScaler:function(){this.svgElement||(this.svgElement=this.$view.getElementsByTagName("svg")[0]),this.svgScaler||(this.svgScaler=new this.imports.SvgScaler(this.svgElement))},_destroyScaler:function(){this.svgElement=null,this.svgScaler=null}})}),define.experiment.newClass("wysiwyg.viewer.components.svgshape.traits.SvgShapeBasicScalers.SvgShapeComponent.New",function(a){var b=a;b.methods({_scaleSingleValue:function(a,b){return this.round(parseFloat(a)*b)},_scaleSingleValueHorizontal:function(a){return this._scaleSingleValue(a,this.scaleX)},_scaleSingleValueVertical:function(a){return this._scaleSingleValue(a,this.scaleY)},_scalePairString:function(a){var b=a.split(/[\s,]+/);return this._scaleSingleValueHorizontal(b[0])+" "+this._scaleSingleValueVertical(b[1])},_scaleMultiplePairStrings:function(a){var b=a.split(",").map(function(a){return this._scalePairString(this.trim(a))}.bind(this));return b.join(",")}})}),define.experiment.newClass("wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils.SvgShapeComponent.New",function(a){var b=a;b.methods({trim:function(a){return a.replace(/^\s+|\s+$/g,"")},round:function(a){return Math.round(1e6*a)/1e6}})}),define.experiment.newClass("wysiwyg.viewer.components.traits.CustomPreviewBehavior.CustomPreviewBehavior.New",function(a){var b=a;b.resources(["W.Config","W.Viewer","W.Commands"]),b.methods({_isPreviewMode:function(){return!this.resources.W.Viewer.isPublicMode()},_overlayElementExists:function(){return!!this._overlayElement},_createOverlayElement:function(){this._overlayElement=new Element("A")},_createOverlayElementStyles:function(){var a=this.resources.W.Config.getServiceTopologyProperty("staticThemeUrlWeb")+"/transparent.gif";this._overlayElement.setStyles({position:"absolute",top:"0",left:"0",height:"100%",width:"100%",background:"transparent url("+a+") repeat top left;"})},_bindOverlayElementEvents:function(){this._overlayElement.addEvent("click",function(a){a.stopPropagation(),this.resources.W.Commands.executeCommand("socialWidget.interact",{component:this},this)}.bind(this))},_createClickOverlayForPreviewMode:function(){this._isPreviewMode()&&!this._overlayElementExists()&&(this._createOverlayElement(),this._createOverlayElementStyles(),this._bindOverlayElementEvents(),this.getViewNode().adopt(this._overlayElement))}})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.BetterPrefetch.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Viewer","W.Utils"])),c.methods({initialize:d.after(function(){this._TIME_BETWEEN_PAGES_RETRIEVAL=1e4,this._lazilyLoadedPage=0}),_loadAllPagesLazily:function(){var a=this._getNextUnloadedPage();a&&this._lazilyLoadedPage<5&&(this._lazilyLoadedPage++,this.loadPageById(a.pageId),W.Utils.callLater(this._loadAllPagesLazily,[],this,this._TIME_BETWEEN_PAGES_RETRIEVAL))},_loadSiteNewVersion:function(){this._loadAllPages(this._getPagesToLoad()),this.getMasterPageData(this._createMasterPage),this.resources.W.Viewer.addEvent("SiteReady",this.resources.W.Utils.callLater.bind(this.resources.W.Utils,this._loadAllPagesLazily,[],this,15e3))}})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.LazyPageBI.New",function(a,b){"use strict";var c=a,d=b;c.methods({initialize:d.after(function(){this._isPageRetrievalIsLazy={}}),_getErrorCallbackForUrl:function(a,b,c){if(1==a.length)return function(){c&&this._loadingPages.splice(this._loadingPages.indexOf(c.pageId),1),this._reportTotalFailure(c.pageId)}.bind(this);var d=a.clone();return d.splice(0,1),function(){LOG.reportError(wixErrors.SINGLE_PAGE_RETRIEVAL_ATTEMPT_FAILED,"PageManager","_requestPageJson",d[0]),this._requestPageJson(d,b,c)}.bind(this)},_reportTotalFailure:function(a){var b=wixErrors.ALL_PAGE_RETRIEVAL_ATTEMPTS_FAILED;this._isPageRetrievalIsLazy[a]&&(b=wixErrors.ALL_PAGE_RETRIEVAL_ATTEMPTS_FAILED_FOR_LAZY_PAGE_LOAD,delete this._isPageRetrievalIsLazy[a]),LOG.reportError(b,"PageManager","loadPageById")},_loadAllPagesLazily:function(){var a=this._getNextUnloadedPage();a&&(this._isPageRetrievalIsLazy[a.pageId]=!0,this.loadPageById(a.pageId),W.Utils.callLater(this._loadAllPagesLazily,[],this,this._TIME_BETWEEN_PAGES_RETRIEVAL))}})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.PageLoadReport.New",function(a,b){var c=a,d=b;c.methods({_loadSiteNewVersion:d.around(function(a){try{a()}catch(b){LOG.reportError(wixErrors.PAGE_FETCHING_ERROR,"PageManager","_loadSiteNewVersion")}}),_requestPageJson:function(a,b,c){var d=a[0];c?c.lastTriedUrl=d:this._sorryNadavToldMeToSaveThePageUrlHere=d;var e=b;b.wrapper||(new Date,e=function(){var a=c?c.lastTriedUrl:this._sorryNadavToldMeToSaveThePageUrlHere;this._logPageError("page loaded",a,c,e.initTime,200),b.apply(this,arguments)}.bind(this),e.wrapper=!0,e.initTime=new Date),this._logPageError("try page load",d,c,e.initTime),this._restClient.get(d,void 0,{onSuccess:e,onError:this._getErrorCallbackForUrl(a,e,c)})},_getErrorCallbackForUrl:function(a,b,c){var d=a[0];if(1==a.length)return function(a,e){c&&this._loadingPages.splice(this._loadingPages.indexOf(c.pageId),1),LOG.reportError(wixErrors.ALL_PAGE_RETRIEVAL_ATTEMPTS_FAILED,"PageManager","_requestPageJson"),this._logPageError("total fail",d,c,b.initTime,e,a)}.bind(this);var e=a.clone();return e.splice(0,1),function(a,f){LOG.reportError(wixErrors.SINGLE_PAGE_RETRIEVAL_ATTEMPT_FAILED,"PageManager","_requestPageJson",e[0]),this._logPageError("attempt fail",d,c,b.initTime,f,a),this._requestPageJson(e,b,c)}.bind(this)},_logPageError:function(a,b,c,d,e,f){var g=new Date,h=b.substr(7).substr(0,b.substr(7).indexOf("/")),g=d?g-d:"",i=c?c.pageId:"masterPage";deployStatus("pageLoad",{type:a,host:h,time:g,pageId:i,httpsStatus:e,errorDesc:f,sessionTime:LOG.getSessionTime()})}})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.PageManagerRefactor.New",function(a,b){var c=a,d=b;c.inherits("bootstrap.managers.BaseManager"),c.resources(["W.Utils"]),c.binds(["_createDataResolver","_createMasterPage","_createPageHandlers","_getInitialPagesIdsToLoad","_loadInitialPages","_onLoadSiteSuccess","_onLoadSiteFailed"]),c.utilize(["wysiwyg.viewer.managers.pages.data.DataResolverFactory","wysiwyg.viewer.managers.pages.PageHandler","wysiwyg.viewer.managers.pages.MasterPageHandler","wysiwyg.viewer.managers.pages.LazyPageLoader","wysiwyg.viewer.managers.pages.data.StructureDataResolver"]),c.statics({EVENTS:{SITE_LOADED:"siteLoaded"}}),c.methods({_getPagesList:d.remove(),_handleSinglePageData:d.remove(),getMainPage:d.remove(),getMasterPageData:d.remove(),getPageData:d.remove(),_requestPageJson:d.remove(),_getErrorCallbackForUrl:d.remove(),_buildComponentProperties:d.remove(),_addAnchors:d.remove(),_createElement:d.remove(),_createPageElements:d.remove(),createPage:d.remove(),_attachPageWhenReady:d.remove(),_setInitDataForPage:d.remove(),_setInitData:d.remove(),_attachPageContentToWixifiedPage:d.remove(),_attachPage:d.remove(),_attachMasterPage:d.remove(),_createSiteStructureNode:d.remove(),_getJsonForString:d.remove(),_createStubPage:d.remove(),_addPagesStubs:d.remove(),_loadSinglePage:d.remove(),_loadAllPages:d.remove(),_getPageDataById:d.remove(),_isOldPageVersion:d.remove(),_loadAllPagesLazily:d.remove(),_getNextUnloadedPage:d.remove(),_getPagesToLoad:d.remove(),_isPageReal:d.remove(),_loadSiteNewVersion:d.remove(),isReady:function(){return!0},clone:function(){return new this.$class},initialize:function(){this._loadSitePromise=!1,this._pageHandlers=[]},loadSite:function(){this._loadSitePromise||(this._loadSitePromise=Q.fcall(this._createDataResolver).then(this._createMasterPage).then(this._createPageHandlers).then(this._getInitialPagesIdsToLoad).then(this._loadInitialPages).then(this._onLoadSiteSuccess).fail(this._onLoadSiteFailed))},_createDataResolver:function(){this._dataResolver=(new this.imports.DataResolverFactory).getDataResolver()},getDataResolver:function(){return this._dataResolver},_createPageHandlers:function(){var a=this._dataResolver.getPagesIds();_.forEach(a,this._createSinglePageHandler.bind(this))},_createSinglePageHandler:function(a){var b=new this.imports.PageHandler(a,this._dataResolver);return this._pageHandlers[a]=b,b},_createMasterPage:function(){var a=new this.imports.MasterPageHandler(this._dataResolver),b=a.loadPage();return b},_getInitialPagesIdsToLoad:function(){var a=this._dataResolver.getMainPageId(),b=this._dataResolver.getPagesIds(),c=[],d=this.resources.W.Utils.hash.getHashParts(),e="zoom"===d.id?d.extData.match("([^/]+)/([^/]+)")[1]:d.id;return e&&_.contains(b,e)?c.push(e):a&&!_.contains(b,a)?c.push(a):c.push(b[0]),c},_loadInitialPages:function(a){var b=[];return _.forEach(a,function(a){var c=this.loadPage(a);b.push(c)}.bind(this)),Q.all(b)},loadPage:function(a){var b=this._pageHandlers[a]||this._createSinglePageHandler(a),c=b.loadPage();return c},_onLoadSiteFailed:function(a){console.log("Failed to load site",a)},_onLoadSiteSuccess:function(){this._dataResolver.isAllPagesDataLoaded()||(this._lazyPageLoader=new this.imports.LazyPageLoader(this._dataResolver),this._lazyPageLoader.start())},loadPageById:function(a,b,c){this.loadPage(a).then(b.bind(c))},isPageLoadingCompleted:function(){return this._loadSitePromise&&this._loadSitePromise.isFulfilled()},isPageLoaded:function(a){return this._pageHandlers[a]&&this._pageHandlers[a].isPageLoaded()}})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.ResponsiveDebug.New",function(a,b){var c=a,d=b;c.utilize(d.merge(["wysiwyg.viewer.responsive.ResponsiveAlgorithmAPI"])),c.resources(d.merge(["W.Theme"])),c.methods({initialize:d.after(function(){this._responsiveAlgorithmAPI=new this.imports.ResponsiveAlgorithmAPI}),_createMasterPage:function(a){var b=this._getJsonForString(a),c=b.data||b.payload.data;this._setInitData(c);var d=this._createSiteStructureNode(),e=b.structure||b.payload.structure,f=function(){if(this._responsiveAlgorithmAPI.modifyStylesToFitMobileLayout(),this._runResponsiveAlgorithm(e,"masterPage"),e.children.each(function(a){d.grab(this._createPageElements(a))}.bind(this)),this._attachMasterPage(d),this.fireEvent("MASTER_PAGE_WAS_LOADED"),this._addPagesStubs(),W.Config.mobileConfig.isMobile()){var a=new this.imports.MobileQuickActionsHandler;a.handleMobileQuickActions()}}.bind(this);this.resources.W.Theme.getOriginalFontSizes()?f():this.resources.W.Theme.addEvent("dataReady",f)},createPage:function(a){var b=this._getJsonForString(a),c=b.data||b.payload.data;this._setInitDataForPage(c);var d=b.structure||b.payload.structure,e=function(){this._runResponsiveAlgorithm(d,"page");var a=this._createPageElements(d);this._attachPageWhenReady(a,d.id)}.bind(this);this.resources.W.Theme.getOriginalFontSizes()?e():this.resources.W.Theme.addEvent("dataReady",e)},_runResponsiveAlgorithm:function(a,b){this.responsiveAlgorithmStringifiedJSONs=this.responsiveAlgorithmStringifiedJSONs||{};var c="page"==b?a.id:"masterPage";this.responsiveAlgorithmStringifiedJSONs[c]={beforeSerializedJSON:JSON.stringify(a),beforeJSON:JSON.parse(JSON.stringify(a))},"page"==b&&(this.responsiveAlgorithmStringifiedJSONs[c].title=W.Data.getDataByQuery(a.dataQuery).get("title")),this._responsiveAlgorithmAPI.convertStructureToMobileLayout(a,b),this.responsiveAlgorithmStringifiedJSONs[c].afterSerializedJSON=JSON.stringify(a),this.responsiveAlgorithmStringifiedJSONs[c].afterJSON=JSON.parse(JSON.stringify(a))},_debugGetPageAfter:function(a){return JSON.parse(this.responsiveAlgorithmStringifiedJSONs[a].jsonAfter)},_debugAddDataTextContentToDataMap:function(a,b){for(var c=W.Data.getDataByQuery(b).getData().text,d=/\"/gi,c=c.replace(d,"&@slashquote"),c=c;c.indexOf("\\")>-1;){var e=c.indexOf("\\");c=c.slice(0,e)+"&@slash"+c.slice(e+1)}a[b]=c},_debugGetAllTextDataQueries:function(){for(var a=document.querySelectorAll("[dataquery]"),b=[],c=0;c<a.length;c++){var d=a[c].getAttribute("dataquery");!W.Data.getDataByQuery(d)||"RichText"!=W.Data.getDataByQuery(d).get("type")&&"StyledText"!=W.Data.getDataByQuery(d).get("type")||b.push(d)}return b},debugGetStringOfTextDataMap:function(a,b){var c=this._debugGetAllTextDataQueries(),d={};void 0===a&&(a=0),void 0===b&&(b=c.length-1);for(var e=a;b>=e;e++)this._debugAddDataTextContentToDataMap(d,c[e]);var f=JSON.stringify(d);return f=this._debugEscapeSlashes(f),f=this._debugEscapeSingleQuotes(f)},_debugEscapeSlashes:function(a){for(;a.indexOf("\\")>-1;){var b=a.indexOf("\\");a=a.slice(0,b)+"&@slash"+a.slice(b+1)}return a},_debugEscapeSingleQuotes:function(a){for(;a.indexOf("'")>-1;){var b=a.indexOf("'");a=a.slice(0,b)+"&@singlequote"+a.slice(b+1)}return a},_debugUnescape:function(){for(var a='{"#ckfg":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_6&@slashquote><span class=&@slashquotecolor_13&@slashquote>Mild</span></span></p>&@slashn","#cu0v":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_6&@slashquote><span class=&@slashquotebold&@slashquote>About Scala</span></span></p>&@slashn","#c1ah4":"<p>&@slashn&@slasht<span class=&@slashquotefont_3&@slashquote><span class=&@slashquotecolor_13&@slashquote>From Java to Scala: A Case Study</span></span></p>&@slashn","#cv52":"<p>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotecolor_15&@slashquote>While the Java platform has gained notoriety in the last 15 years as a robust application platform with a thriving ecosystem and well-established practices, the Java language has had its share of criticism. Highly verbose, overly didactic, limited feature set; whichever flavor of criticism you prefer, it&@singlequotes patently obvious that Java is playing catch up to more modern languages with a less rigid evolution path.</span></span></p>&@slashn<p>&@slashn&@slasht<br>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotecolor_15&@slashquote>The language landscape today is vastly different than it had been five or ten years ago; a wide array of languages are available, designed to suit a variety of flavors: Groovy, Clojure, Scala, Gosu, Kotlin... which should you choose? This lecture focuses on one company&@singlequotes decision to focus on Scala, and presents a case study based on our experiences using Scala in practice, in the hope of providing much-needed real world context to assist your decision.</span></span></p>&@slashn","#csrn":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotebold&@slashquote>Tomer Gabel</span></span></p>&@slashn","#cghs":"<p>&@slashn&@slasht<span class=&@slashquotefont_0&@slashquote><span class=&@slashquotecolor_13&@slashquote>Csalapeno</span></span></p>&@slashn<p>&@slashn&@slasht<span class=&@slashquotefont_0&@slashquote><span class=&@slashquotecolor_13&@slashquote>scala with a kick!</span></span></p>&@slashn<p>&@slashn&@slasht<span class=&@slashquotefont_0&@slashquote><span class=&@slashquotecolor_13&@slashquote></span></span><span class=&@slashquotefont_0&@slashquote><span class=&@slashquotecolor_13&@slashquote>July 17th 2013</span></span></p>&@slashn","#csmd":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_6&@slashquote><span class=&@slashquotebold&@slashquote>Site updates</span></span></p>&@slashn","#c207v":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_6&@slashquote><span class=&@slashquotebold&@slashquote>Call for&nbsp;</span></span></p>&@slashn","#c1vfy":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_4&@slashquote><span class=&@slashquotecolor_13&@slashquote>Mild</span></span></p>&@slashn","#c1pkq":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_4&@slashquote><span class=&@slashquotecolor_18&@slashquote>Extra Spicy</span></span></p>&@slashn","#crju":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_6&@slashquote>Registration 9:00 - 10:00</span></p>&@slashn","#c1jd0":"<p>&@slashn&@slasht<span class=&@slashquotefont_3&@slashquote><span class=&@slashquotecolor_13&@slashquote>Database Access with Slick</span></span></p>&@slashn<p>&@slashn&@slasht&nbsp;</p>&@slashn","#c1m6j":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotebold&@slashquote>Stefan Zeiger</span></span></p>&@slashn","#c1va7":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_0&@slashquote><span class=&@slashquotecolor_1&@slashquote><span class=&@slashquotebold&@slashquote>Sponsors wanted!</span></span></span></p>&@slashn","#ctgx":"<p class=&@slashquotealignCenter&@slashquote>&@slashn&@slasht<a dataquery=&@slashquote#Linklut&@slashquote><span class=&@slashquotefont_1&@slashquote><span class=&@slashquotecolor_15&@slashquote>Sponsor&@singlequotes<br>&@slashn&@slashtGuide</span></span></a></p>&@slashn","#c1m9u":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_0&@slashquote><span class=&@slashquotecolor_1&@slashquote><span class=&@slashquotebold&@slashquote>Thank you!</span></span></span></p>&@slashn","#cywe":"<p class=&@slashquotealignCenter&@slashquote>&@slashn&@slasht<a dataquery=&@slashquote#Link24mi&@slashquote><span class=&@slashquotefont_1&@slashquote><span class=&@slashquotecolor_15&@slashquote>Speaker&@singlequotes</span></span></a><span class=&@slashquotefont_1&@slashquote></span><a dataquery=&@slashquote#Link24mi&@slashquote><span class=&@slashquotefont_1&@slashquote><span class=&@slashquotecolor_15&@slashquote><br>&@slashn&@slashtGuide</span></span></a></p>&@slashn","#cqmh":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotebold&@slashquote>Sagie Davidovich</span></span></p>&@slashn","#c17oo":"<p>&@slashn&@slasht<span class=&@slashquotefont_3&@slashquote><span class=&@slashquotecolor_13&@slashquote>Leveraging Scala&@singlequotes Typesystem for Better Code</span></span></p>&@slashn<p>&@slashn&@slasht&nbsp;</p>&@slashn","#cemk":"<p>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotecolor_15&@slashquote>Scala&@singlequotes type system is extremely powerful (actually, it&@singlequotes Turing complete). By understanding the tight interplay between implicit conversions and the type system, we can write very concise, yet generic and powerful code.</span></span></p>&@slashn<p>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotecolor_15&@slashquote><br>&@slashn&@slashtFor example, while in Java collecting all int values both from Map&lt;String,List&lt;Integer&gt;&gt; and Map&lt;String,Map&lt;String,Integer&gt;&gt; requires two separate functions or reflection based code which isn&@singlequotet type safe, in Scala it is quite easy to write a single piece of type safe code to accomplish this for arbitrary nestings of Map and List.</span></span></p>&@slashn<p>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotecolor_15&@slashquote><br>&@slashn&@slashtIn this talk we will show how to write Scala code able to leverage the information given by the type signatures, both for better APIs and for writing less code.</span></span></p>&@slashn","#c1eyu":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotebold&@slashquote>Ofer Ron</span></span></p>&@slashn","#c8yh":"<p>&@slashn&@slasht<span class=&@slashquotefont_9&@slashquote>Ofer Ron is a senior data scientist at LivePerson. He is the tech lead for LivePerson&@singlequotes research group which is responsible for designing and implementing various machine learning engines underlying LivePerson&@singlequotes products.</span></p>&@slashn<p>&@slashn&@slasht<span class=&@slashquotefont_9&@slashquote></span></p>&@slashn<p>&@slashn&@slasht<span class=&@slashquotefont_9&@slashquote>Ofer has been working with Scala for the past three years, both for computationally intensive tasks and for big data processing, using Scalding over Hadoop.<br>&@slashn&@slashtHe would never voluntarily go back to writing in Java.</span></p>&@slashn","#c13lp":"<p>&@slashn&@slasht<span class=&@slashquotefont_3&@slashquote><span class=&@slashquotecolor_13&@slashquote>Combining Java and Scala: The Best of Both Worlds</span></span></p>&@slashn<p>&@slashn&@slasht&nbsp;</p>&@slashn","#cxj6":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotebold&@slashquote>Yuval Sapir</span></span></p>&@slashn","#c6u8":"<p>&@slashn&@slasht<span class=&@slashquotefont_9&@slashquote>I&@singlequoteve been programming for over 20 years, most of them in Java. Currently I work at Yahoo! Tel-Aviv as a programmer. I&@singlequotem also part of the core team at GarageGeeks and one of the founders of GameIS, the Israeli digital game developers association.</span></p>&@slashn","#ck":"<p>&@slashn&@slasht<span class=&@slashquotefont_3&@slashquote><span class=&@slashquotecolor_13&@slashquote>Scala: The Multi-Paradigm Language for the Multi-Core Age</span></span></p>&@slashn","#c1dr":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotebold&@slashquote>Sagie Davidovich</span></span></p>&@slashn","#c1fi2":"<p>&@slashn&@slasht<span class=&@slashquotefont_3&@slashquote><span class=&@slashquotecolor_13&@slashquote>Tales about Scala Performance</span></span></p>&@slashn<p>&@slashn&@slasht&nbsp;</p>&@slashn","#czy7":"<p>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotecolor_15&@slashquote>Scala is an extremely powerful functional language. It compiles to bytecode and runs on top of the JVM. Over the years the JVM is has evolved into an amazing ecosystem, highly performant and with a vast range of tools for profiling and tuning of applications. That is a huge benefit for a programming language. When compared to Java scala is a more advanced language, code in Scala is more compact and readable. The immediate obvious question which comes to your mind is what price we pay in terms of performance. In this session I will compare performance of several constructs in Java and in Scala. I will discuss immutability and its effect on garbage collection. I will also show profiles of Scala programs and we will see how they are viewed in standard Java profilers.</span></span></p>&@slashn","#c154j":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotebold&@slashquote>Haim Yadid</span></span></p>&@slashn","#c95x":"<p>&@slashn&@slasht<span class=&@slashquotefont_9&@slashquote>I bring over 20 years of experience in various technology fields: software development, team management, software architecture, HPC and algorithmic research. Over the past seven years I have focused on Java platform performance optimization. In the last five years, I have been involved as a consultant in more than a dozen optimization projects. I bring nine years of experience working with Java, with in-depth understanding of the platform internals. In the last six months Scala has become my language of choice when coming to develop my own projects.</span></p>&@slashn<p>&@slashn&@slasht<span class=&@slashquotefont_9&@slashquote></span></p>&@slashn<p>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote>Mail:&nbsp;lifey@performize-it.com</span></p>&@slashn","#c1gwr":"<p>&@slashn&@slasht<span class=&@slashquotefont_3&@slashquote><span class=&@slashquotecolor_13&@slashquote>Introduction to Scala for C# developers</span></span></p>&@slashn","#c5b7":"<p>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotecolor_15&@slashquote>Its no secret that in Israel, C# is one of the leading languages for development. This stems from various reasons, ranging from the power of the language to the ubiquity of Microsofts technologies in government and defense organizations. When it first came out, C# was Microsofts answer to Java and the two were on-par. Since then, C# has grown leaps and bounds and Java, while still sitting on top of the powerful JVM with a huge, open ecosystem created over nearly two decades, was left behind. Developers looking to stop paying the Microsoft-tax were faced with a language that simply did not meet their expectations.</span></span></p>&@slashn<p>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotecolor_15&@slashquote></span></span></p>&@slashn<p>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotecolor_15&@slashquote>Scala is the one of the answers to this growing need for a new, modern language for the JVM.</span></span></p>&@slashn<p>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotecolor_15&@slashquote></span></span></p>&@slashn<p>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotecolor_15&@slashquote>This lecture will introduce the language, comparing its idioms to those of C#, and introduce you some of the tools and frameworks to get you started with it.</span></span></p>&@slashn","#cfn7":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotebold&@slashquote>Omer van Kloeten</span></span></p>&@slashn","#c4so":"<p>&@slashn&@slasht<span class=&@slashquotefont_9&@slashquote>Omer van Kloeten is the CTO of AppMyDay. He has been a professional software developer for over a dozen years. He has worked for years with C#, making a pit stop at Java and eventually finding his place with Scala.</span></p>&@slashn","#cgp6":"<p>&@slashn&@slasht<span class=&@slashquotefont_3&@slashquote><span class=&@slashquotecolor_13&@slashquote>Macro Writer&@singlequotes Guide: 2.10.x and Beyond</span></span></p>&@slashn","#cgqq":"<p>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotecolor_15&@slashquote>With compile-time metaprogramming facilities recently introduced in Scala 2.10, hackers all around the Scala ecosystem have been able to do cool things that have previously been impossible or notoriously hard to achieve. Language-integrated queries? Check. Transparent asynchronicity? Check. Strongly-typed actors? Check. Fast and boilerplate-free serialization? Check.</span></span></p>&@slashn<p>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotecolor_15&@slashquote></span></span></p>&@slashn<p>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotecolor_15&@slashquote>With more and more macros being written, there is a natural need to gather and systemize best practices in the Scala macroland. How does one modularize macros? How to make tree construction less verbose? What is hygiene and why should we care? When is it necessary to use resetAllAttrs and what to do if it does not work? This lecture will explain macro writing techniques that can be used today and outline the ones that will be available tomorrow.</span></span></p>&@slashn","#c9u5":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotebold&@slashquote>Eugene Burmako</span></span></p>&@slashn","#c1ysd":"<p>&@slashn&@slasht<span class=&@slashquotefont_9&@slashquote>Being a metaprogramming aficionado, I believe that metaprogramming can be applied to mainstream programming in a safe and disciplined way. Since fall 2011, as a member of the Scala team and Martin Oderskys PhD student, I am realizing this vision in the Scala macros project. Before joining EPFL I was experimenting with metaprogramming for CLR. My projects in this area include Relinq, a bidirectional LINQ to JavaScript transformer, and Conflux, a library that crosscompiles C# into CUDA.</span></p>&@slashn","#c1h5u":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_4&@slashquote><span class=&@slashquotebold&@slashquote><span class=&@slashquotecolor_18&@slashquote><span class=&@slashquotecolor_18&@slashquote>Scalapeo 2013 will take place at Google&@singlequotes </span></span><span class=&@slashquotecolor_18&@slashquote><a dataquery=&@slashquote#Linkih5&@slashquote><span class=&@slashquotecolor_18&@slashquote>Campus Tel-Aviv</span></a><span class=&@slashquotecolor_18&@slashquote></span></span></span></span></p>&@slashn","#c1uet":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotecolor_13&@slashquote>Electra Tower, 26th floor<br>&@slashn&@slashtYigal Alon 98<br>&@slashn&@slashtTel-Aviv</span></span></p>&@slashn","#c1w3f":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_6&@slashquote><span class=&@slashquotecolor_18&@slashquote>By train</span></span></p>&@slashn","#cd5x":"<p class=&@slashquotealignJustify&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotecolor_24&@slashquote>The easiest way to get to the conference is by train. Get off at the Tel-Aviv HaShalom train station (there&@singlequotes a conveniently located exit at the south end of the platform), head east on HaShalom street until the first intersection and turn right (southbound) on Yigal Alon street. Two minutes&@singlequote walk will bring your straight to the conference location.</span></span></p>&@slashn","#c1ibm":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_6&@slashquote><span class=&@slashquotecolor_18&@slashquote>By car</span></span></p>&@slashn","#cbi0":"<p class=&@slashquotealignJustify&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotecolor_24&@slashquote>Head to the Ayalon freeway (road 20) and get off at the HaShalom interchange exit direction eastbound (towards Giv&@singlequoteatayim). Turn right on the first intersection southbound on Yigal Alon street and proceed about 200 meters. The conference location is on your left.<br>&@slashn&@slashtWe regrettably cannot offer free parking, however there are plenty of paid parking lots in the vicinity, including at the Electra Tower itself (entrance via HaSolelim St.), at the Azrieli Center or up to road towards the Yad Eliahu stadium.</span></span></p>&@slashn","#c1ml3":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_6&@slashquote><span class=&@slashquotecolor_18&@slashquote>By bus</span></span></p>&@slashn","#c1b7c":"<p class=&@slashquotealignJustify&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotecolor_24&@slashquote>While few busses go directly through the conference location, it is located a mere minutes&@singlequote walking distance from the Azrieli Center and the HaShalom train station. You should check the Israeli bus information </span><span class=&@slashquotecolor_19&@slashquote>websites</span><span class=&@slashquotecolor_24&@slashquote> for lines and times.</span></span></p>&@slashn","#c1dru":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_6&@slashquote>If you wish to contact the organizing team for any reason</span></p>&@slashn","#cn0f":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_4&@slashquote><span class=&@slashquotecolor_1&@slashquote><span class=&@slashquotebold&@slashquote>Tomer Gabel</span></span></span></p>&@slashn","#c1pve":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote>main organizer</span></p>&@slashn","#c21v3":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_10&@slashquote><span class=&@slashquotebold&@slashquote><span class=&@slashquotecolor_1&@slashquote>+972-54-7233626</span></span></span></p>&@slashn","#cr6q":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_10&@slashquote><span class=&@slashquotebold&@slashquote><span class=&@slashquotecolor_1&@slashquote>tomer@tomergabel.com</span></span></span></p>&@slashn","#cnqq":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_4&@slashquote><span class=&@slashquotecolor_1&@slashquote><span class=&@slashquotebold&@slashquote>Shai Yallin</span></span></span></p>&@slashn","#c1mum":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote>co-organizer</span></p>&@slashn","#cb1c":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_10&@slashquote><span class=&@slashquotebold&@slashquote><span class=&@slashquotecolor_1&@slashquote>+972-54-4840868</span></span></span></p>&@slashn","#c1p1l":"<p class=&@slashquotealignCenter&@slashquote style=&@slashquote&@slashquote>&@slashn&@slasht<span class=&@slashquotefont_10&@slashquote><span class=&@slashquotebold&@slashquote><span class=&@slashquotecolor_1&@slashquote>shai.yallin@gmail.com</span></span></span></p>&@slashn","#c1aqz":"<p>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotecolor_1&@slashquote>&nbsp;Scalapeo 2013</span></span></p>&@slashn","#c5wh":"<p>&@slashn&@slasht<span class=&@slashquotefont_8&@slashquote><span class=&@slashquotecolor_1&@slashquote>Sponsored by:</span></span></p>&@slashn"}',b=JSON.parse(a),c=_.keys(b),d=0;d<c.length;d++){var e=b[c[d]];
e=e.replace(/&@singlequote/gi,"'"),e=e.replace(/&@slashquote/gi,'\\"'),e=e.replace(/&@slash/gi,"\\"),b[c[d]]=e}return b}})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.ViewerRefactor.New",function(a,b){var c=a,d=b;c.utilize(["wysiwyg.viewer.managers.pages.PageHandler","wysiwyg.viewer.managers.pages.MasterPageHandler","wysiwyg.viewer.managers.pages.LazyPageLoader","wysiwyg.viewer.managers.pages.data.StructureDataResolver"]),c.binds(["_startLoadingData","_createMasterPage","_createPageHandlers","_getInitialPagesIdsToLoad","_loadInitialPages","_onLoadSiteSuccess","_onLoadSiteFailed"]),c.methods({initialize:function(a,b,c){this._viewerName=a,this._idPrefix=b,this._dataResolver=c,this._loadSitePromise=!1,this._pageHandlers=[],this._masterPageHandler=null},loadSite:function(){this._loadSitePromise||(this._loadSitePromise=this._createMasterPage().then(this._createPageHandlers).then(this._getInitialPagesIdsToLoad).then(this._loadInitialPages).then(this._onLoadSiteSuccess).fail(this._onLoadSiteFailed))},_startLoadingData:function(){this._dataResolver.startLoading()},_createSinglePageHandler:function(a){var b=new this.imports.PageHandler(a,this._dataResolver,this._viewerName,this._idPrefix);return this._pageHandlers[a]=b,b},_createMasterPage:function(){this._masterPageHandler=new this.imports.MasterPageHandler(this._dataResolver,this._viewerName,this._idPrefix);var a=this._masterPageHandler.loadPage();return a},_onLoadSiteSuccess:function(){var a=this._masterPageHandler.getPageRootNode();this.fireEvent(this.EVENTS.SITE_LOADED,a),this._startPageLazyLoading()},_startPageLazyLoading:function(){this._dataResolver.isAllPagesDataLoaded()||(this._lazyPageLoader=new this.imports.LazyPageLoader(this._dataResolver),this._lazyPageLoader.start())},_createDataResolver:d.remove()})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.WixAppsPage.New",function(a,b){var c=a;c.methods({_addPagesStubs:function(){Object.each(this._getPagesList().pages,function(a){this._createStubPageAsync(a,function(a){$("SITE_PAGES").grab(a)})}.bind(this))},_createStubPageAsync:function(a,b){W.Data.getDataByQuery("#"+a.pageId,function(c){var d=c.getData().type,e=this._createStubPage(a,d);b(e)}.bind(this))},_createStubPage:function(a,b){var c=new Element("div");return c.set({id:a.pageId,comp:this._getPageFullQualifier(b),skin:"mobile.core.skins.InlineSkin",dataQuery:"#"+a.pageId}),c},_getPageFullQualifier:function(a){return pageQ={Page:"mobile.core.components.Page",AppPage:"wixapps.integration.components.AppPage"},pageQ[a]}})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.NewFetchPolicy.New",function(a,b){"use strict";var c=a,d=b;c.methods({initialize:d.after(function(){this._loadedPages=[],this._loadingPages=[],this._loadingPagesTrialCounter={},this._getPagesList()&&this._getPagesList().pages.each(function(a){this._loadingPagesTrialCounter[a.pageId]=!1}.bind(this)),this._callBacksForPageCreation={}}),_cratePageRequesters:function(){var a=this._getPagesList().pages;a.forEach(function(a){var b=a.urls.map(function(a){return resource.url(a,this._getRequestMethod(a),this._shouldLoadOnce(a))},this);define.resource(this._getResourceIdFromPageID(a.pageId)).withUrls(b).withTrials(3).withTimeBetween(3e3)},this);var b=this._getPagesList().masterPage.map(function(a){return resource.url(a,this._getRequestMethod(a),this._shouldLoadOnce(a))},this);define.resource(this._getResourceIdFromPageID("master")).withUrls(b).withTrials(3).withTimeBetween(3e3)},_getResourceIdFromPageID:function(a){return"pages."+a},_isStaticPage:function(a){return!~a.indexOf("archive.")},_getRequestMethod:function(a){return this._isStaticPage(a)?"cors":"jsonp"},_shouldLoadOnce:function(a){return!!this._isStaticPage(a)},_loadSiteNewVersion:d.before(function(){this._cratePageRequesters()}),_reportTotalFailure:function(){LOG.reportError(wixErrors.ALL_PAGE_RETRIEVAL_ATTEMPTS_FAILED,"PageManager","loadPageById")},loadPageById:function(a,b,c){this._callBacksForPageCreation[a]={method:b,scope:c};var d=function(a){a.startContentCreation||(a.startContentCreation=!0,this.createPage(a))}.bind(this);this._loadingPagesTrialCounter[a]=!0,resource.getResourceValue(this._getResourceIdFromPageID(a),d,this._reportTotalFailure.bind(this,a))},_getNextUnloadedPage:function(){return this._getPagesList().pages.first(function(a){return!this.isPageLoaded(a.pageId)&&!this._loadingPagesTrialCounter[a.pageId]}.bind(this))},getMasterPageData:function(a){resource.getResourceValue(this._getResourceIdFromPageID("master"),a,this._reportTotalFailure)},_attachPageWhenReady:function(a,b){$(b)?(this._attachPage(a,b),this._loadedPages.push(b),W.Utils.callLater(this._callBacksForPageCreation[b].method,[],this._callBacksForPageCreation[b].scope,10),this.fireEvent("PAGE_LOADED",b)):W.Utils.callLater(this._attachPageWhenReady,[a,b],this,10)}})}),define.experiment.Class("wysiwyg.viewer.managers.SiteMembersManager.SMForgot_Password.New",function(a,b){var c=a,d=b;c.statics({AUTH_STATES:{AUTH:"auth token and cookie exist",NO_AUTH_WITH_COOKIE:"no auth token, cookie exist",NO_AUTH_WITHOUT_COOKIE:"no auth token, cookie doesnt exist"},INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",UPDATE_USER:"UPDATE"},API_ERRORS:{API_NOT_LOADED:"Site Members API was not loaded",TOKEN_IS_INVALID:"Authentication Token is invalid"},RESET_PASSWORD_KEY_PARAMETER:"forgotPasswordToken"}),c.methods({initialize:d.after(function(){var a=this;this.resources.W.Viewer.addEvent("SiteReady",function(){a._showPasswordResetIfNeeded()})}),_showPasswordResetIfNeeded:function(){var a=this._getCurrentSearchURL();if(this._isResetPasswordRequested(a)&&this._isViewerMode()){var b=this;this.resource.getResourceValue("W.SiteMembers",function(c){var d=b._getResetPasswordIdFromURL(a);c.openSiteMembersPopup({intent:"RESETPASSWORD",disableCancel:!0,resetPassKey:d})})}},_getCurrentSearchURL:function(){return window.location.search},sendUserPasswordResetEmail:function(a,b,c){var d=this._getReturnUrl();this._api.sendForgotPasswordMail(a,d,b,c)},_getReturnUrl:function(){var a=this._getLocationUrl();return a=encodeURIComponent(a)},_getLocationUrl:function(){return window.location.href},resetPassword:function(a,b,c){var d=this._getCurrentSearchURL(),e=this._getResetPasswordIdFromURL(d);this._api.resetMemberPassword(e,a,b,c)},_isResetPasswordRequested:function(a){return a.indexOf(this.RESET_PASSWORD_KEY_PARAMETER)>=0},_getResetPasswordIdFromURL:function(a){return W.Utils.getQueryParam(this.RESET_PASSWORD_KEY_PARAMETER,a)},_isViewerMode:function(){return"site"===window.viewMode}})}),define.experiment.Class("wysiwyg.viewer.managers.SiteMembersManager.SMOwnerLogoutFix.New",function(a,b){var c=a;c.resources(["W.Viewer","W.Utils"]),c.statics({AUTH_STATES:{AUTH:"auth token and cookie exist",NO_AUTH_WITH_COOKIE:"no auth token, cookie exist",NO_AUTH_WITHOUT_COOKIE:"no auth token, cookie doesnt exist"},INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",UPDATE_USER:"UPDATE"},API_ERRORS:{API_NOT_LOADED:"Site Members API was not loaded",TOKEN_IS_INVALID:"Authentication Token is invalid"},OWNER_LOGOUT_ACTION:{TITLE:"Logout failure",MESSAGE:"You are the owner of this website, and are logged in on Wix.com. Please log out of Wix.com to test the Site Members feature."},WIX_USER_COOKIE_NAME:"wixClient"}),c.methods({logout:function(){return this._isOwnerLoggedIn()?(this._informSiteOwnerToLogout(),!1):(this._logoutSiteMember(),!0)},_logoutSiteMember:function(){return this._apiReady?(delete this._token,this._api.logout()):void 0},_informSiteOwnerToLogout:function(){var a=this.OWNER_LOGOUT_ACTION.TITLE,b=this.OWNER_LOGOUT_ACTION.MESSAGE;W.MessagesController.showMessage(a,b,function(){})},_isOwnerLoggedIn:function(){return this.resources.W.Utils.cookies.hasCookie(this.WIX_USER_COOKIE_NAME)&&this._isSiteBelongToUser()},_isSiteBelongToUser:function(){var a=null,b=function(b){a=b};return this.getMemberDetails(b,function(){}),a&&a.owner===!0}})}),define.experiment.Class("wysiwyg.viewer.managers.SiteMembersManager.SMMemberAccessLimit.New",function(a,b){var c=a;c.resources(["W.Viewer","W.Utils"]),c.statics({USER_STATUS:{ACTIVE:"ACTIVE"},COOKIE_CHECK_INTERVAL_IN_MS:100}),c.methods({getMemberDetails:function(a,b){var c=this._isMemberActiveAndCall(a);b||(b=c),this._memberDetails?c(this._memberDetails):this._apiReady?this._token?this._api.getMemberDetails(this._token,c,b):b&&b({code:"TOKEN_IS_INVALID",description:this.API_ERRORS.TOKEN_IS_INVALID}):b&&b({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},_isMemberActiveAndCall:function(a){var b=this;return function(c){c&&b._isInvalidUserAccess(c)?b._handleInvalidUserAccess(c):c&&c.status?c.status!==b.USER_STATUS.ACTIVE?b._logoutAndRefresh():a&&a(c):b.logout()}},_isInvalidUserAccess:function(a){var b=["-19980","-19984","-19999"],c=String(a.errorCode);return b.indexOf(c)>=0},_handleInvalidUserAccess:function(a){var b=String(a.errorCode);"-19980"===b?this._refreshPage():"-19984"===b?this._logoutAndRefresh():"-19999"===b&&this._logoutAndRefresh()},_logoutAndRefresh:function(){this.logout(),this._checkIfLogoutAndRefresh()},_checkIfLogoutAndRefresh:function(){this._hasSiteMemberSessionCookie()?this.resources.W.Utils.callLater(this._checkIfLogoutAndRefresh,null,this,this.COOKIE_CHECK_INTERVAL_IN_MS):this._refreshPage()},_hasSiteMemberSessionCookie:function(){return this._api.isSessionValid()},_refreshPage:function(){location.reload()}})}),define.experiment.newClass("wysiwyg.viewer.managers.pages.LazyPageLoader.PageManagerRefactor.New",function(a,b){"use strict";var c=a;c.binds(["_loadPageLazy","_loadNextPage"]),c.statics({FirstLazyPageLoadDelay:1e4,NextLazyPageLoadDelay:3e3,MaxNumberOfPagesToLoad:5}),c.methods({initialize:function(a){this._dataResolver=a,this._numberOfPagesToLoad=0},start:function(){Q.delay(this.FirstLazyPageLoadDelay).then(this._loadPageLazy)},_loadPageLazy:function(){if(!this._dataResolver.isAllPagesDataLoaded()){var a=_.first(this._dataResolver.getPagesIdsToLoad());this._dataResolver.getPageData(a).then(this._loadNextPage).fail(this._loadNextPage),this._numberOfPagesToLoad++}},_loadNextPage:function(){this._numberOfPagesToLoad<this.MaxNumberOfPagesToLoad&&Q.delay(this.NextLazyPageLoadDelay).then(this._loadPageLazy)}})}),define.experiment.newClass("wysiwyg.viewer.managers.pages.MasterPageHandler.PageManagerRefactor.New",function(a,b){var c=a;c.inherits("wysiwyg.viewer.managers.pages.PageHandler"),c.binds(["_getPageData","_setPageData","_createPageStructure","_createMasterPageComponents","_createPagesStubs","_attachPage"]),c.methods({initialize:function(a){this._dataResolver=a},loadPage:function(){return this.masterPromise||(this.masterPromise=Q.fcall(this._getPageData).then(this._setPageData).then(this._createPageStructure).then(this._createMasterPageComponents).then(this._createPagesStubs).then(this._attachPage)),this.masterPromise},_getPageData:function(){return this._dataResolver.getMasterPageData()},_createPageStructure:function(){var a=document.createElement("div");return this._setComponentAttributes(a,{id:"SITE_STRUCTURE",comp:"wysiwyg.viewer.components.WSiteStructure",skin:"mobile.core.skins.InlineSkin","class":"SITE_STRUCTURE"}),a},_createMasterPageComponents:function(a){return _.forEach(this._pageData.structure.children,this._createPageComponents.bind(this,a)),a},_createPagesStubs:function(a){var b=a.querySelector("#SITE_PAGES");return _.forEach(this._dataResolver.getPagesIds(),this._createStubPage.bind(this,b)),a},_createStubPage:function(a,b){var c=document.createElement("div"),d=this.resources.W.Data.getDataByQuery("#"+b),e=d&&"AppPage"===d.getData().type?"wixapps.integration.components.AppPage":"mobile.core.components.Page";this._setComponentAttributes(c,{id:b,comp:e,skin:"mobile.core.skins.InlineSkin",stub:!0,dataQuery:"#"+b}),a.appendChild(c)},_attachPage:function(a){var b=this._getSiteNode();b.insertBefore(a,b.firstChild)},_getSiteNode:function(){return document.body}})}),define.experiment.Class("wysiwyg.viewer.managers.pages.MasterPageHandler.ViewerRefactor.New",function(a,b){var c=a;c.methods({initialize:function(a,b,c){this.parent("MASTER_PAGE",a,b,c)},_createPageStructure:function(){this._rootNode=document.createElement("div");var a={id:this.getCompDomId("SITE_STRUCTURE"),comp:"wysiwyg.viewer.components.WSiteStructure",skin:"mobile.core.skins.InlineSkin","class":"SITE_STRUCTURE"};return this._idPrefix&&(a.idprefix=this._idPrefix),this._setComponentAttributes(this._rootNode,a),this._rootNode},_createMasterPageComponents:function(a){var b=this._pageData.structure[this._dataResolver.getMasterChildrenPropertyName(this._viewerName)];return _.forEach(b,this._createPageComponents.bind(this,a)),a},_createPagesStubs:function(a){var b=a.querySelector("#"+this.getCompDomId("SITE_PAGES"));return _.forEach(this._dataResolver.getPagesIds(),this._createStubPage.bind(this,b)),a},_createStubPage:function(a,b){var c=document.createElement("div"),d=this.resources.W.Data.getDataByQuery("#"+b),e=d&&"AppPage"===d.getData().type?"wixapps.integration.components.AppPage":"mobile.core.components.Page",f={id:this.getCompDomId(b),comp:e,skin:"mobile.core.skins.InlineSkin",stub:!0,dataQuery:"#"+b};this._idPrefix&&(f.idprefix=this._idPrefix),this._setComponentAttributes(c,f),a.appendChild(c)}})}),define.experiment.Class("wysiwyg.viewer.managers.pages.PageHandler.EditorScripting.New",function(a,b){var c=a,d=b;c.methods({_createComponent:d.after(function(a){a.behaviors&&resource.getResourceValue("W.ScriptingManager",function(b){b.registerScript(a.componentName||a.id,a.behaviors)})}),_buildComponentProperties:d.around(function(a,b){var c=a();return b.componentName&&(c.compName=b.componentName),c})})}),define.experiment.newClass("wysiwyg.viewer.managers.pages.PageHandler.PageManagerRefactor.New",function(a,b){"use strict";var c=a;c.resources(["W.Data","W.ComponentData","W.Theme","dataFixer"]),c.inherits("bootstrap.utils.Events"),c.binds(["_getPageData","_setPageData","_createPageStructure","_attachPage"]),c.methods({initialize:function(a,b){this._pageId=a,this._dataResolver=b,this._isPageLoaded=!1},loadPage:function(){var a;return this._isStubPage()?a=Q.fcall(this._getPageData).then(this._setPageData).then(this._createPageStructure).then(this._attachPage):(this._isPageLoaded=!0,a=Q()),a},_isStubPage:function(){var a=document.getElementById(this._pageId);return a&&a.getAttribute("stub")},isPageLoaded:function(){return this._isPageLoaded},_getPageData:function(){return this._dataResolver.getPageData(this._pageId)},_setPageData:function(a){return this._pageData=a,this._pageData},_createPageStructure:function(a){var b=a.structure,c=this._createComponent(b);return _.forEach(b.components,this._createPageComponents.bind(this,c)),c},_createPageComponents:function(a,b){var c=this._createComponent(b);return _.forEach(b.components,this._createPageComponents.bind(this,c)),a.appendChild(c),c},_createComponent:function(a){var b=document.createElement("div");return this._setComponentProperties(b,a),this._addComponentAnchors(a),b},_buildComponentProperties:function(a){var b={id:a.id,comp:a.componentType,skin:"wysiwyg.viewer.components.PagesContainer"===a.componentType?"wysiwyg.viewer.skins.screenwidthcontainer.BlankScreen":a.skin,styleId:a.styleId};return a.dataQuery&&(b.dataQuery=0!==a.dataQuery.indexOf("#")?"#"+a.dataQuery:a.dataQuery),a.propertyQuery&&(b.propertyQuery=0!==a.propertyQuery.indexOf("#")?"#"+a.propertyQuery:a.propertyQuery),a.layout&&(b.width=a.layout.width,b.height=a.layout.height,b.x=a.layout.x,b.y=a.layout.y),b},_setComponentProperties:function(a,b){if(b){var c=this._buildComponentProperties(b);this._setComponentAttributes(a,c)}},_setComponentAttributes:function(a,b){_.forEach(b,function(b,c){a.setAttribute(c,b)})},_addComponentAnchors:function(a){if(a&&a.id&&a.layout&&a.layout.anchors){var b={};b[a.id]=a.layout.anchors,W.Layout.appendSavedAnchor(b)}},_attachPage:function(a){var b=document.getElementById(this._pageId);b.$logic?this._attachPageContentToWixifiedPage(b,a):b.parentNode.replaceChild(a,b),this._isPageLoaded=!0},_attachPageContentToWixifiedPage:function(a,b){var c=a.getLogic(),d=c.getInlineContentContainer();_.forEach(_.toArray(d.childNodes),function(a){d.removeChild(a)}),_.forEach(_.toArray(b.childNodes),function(a){d.appendChild(a)}),b.getAttribute("styleId")!==a.getAttribute("styleId")?(a.setAttribute("styleId",b.getAttribute("styleId")),this.resources.W.Theme.getStyle(b.getAttribute("styleId"),function(a){c.setStyle(a)},b.getAttribute("skin"))):a.getAttribute("skin")!==b.getAttribute("skin")&&(a.setAttribute("skin",b.getAttribute("skin")),this.resources.W.Skins.getSkin(b.getAttribute("skin"),function(a){var b=new a;c.setSkin(b)})),b.getAttribute("dataQuery")!==a.getAttribute("dataQuery")&&(a.setAttribute("dataQuery",b.getAttribute("dataQuery")),c.setDataByQuery(b.getAttribute("dataQuery"),function(){})),b.getAttribute("propertyQuery")!==a.getAttribute("propertyQuery")&&(a.setAttribute("propertyQuery",b.getAttribute("propertyQuery")),this.resources.W.Data.getDataByQuery(b.getAttribute("propertyQuery"),c.setComponentProperties))}})}),define.experiment.Class("wysiwyg.viewer.managers.pages.PageHandler.RotateImage.New",function(a,b){"use strict";var c=a;c.methods({_setComponentProperties:function(a,b){if(b){var c={id:this.getCompDomId(b.id),comp:b.componentType,skin:"wysiwyg.viewer.components.PagesContainer"===b.componentType?"wysiwyg.viewer.skins.screenwidthcontainer.BlankScreen":b.skin,styleId:b.styleId};this._idPrefix&&(c.idprefix=this._idPrefix),b.dataQuery&&(c.dataQuery=0!==b.dataQuery.indexOf("#")?"#"+b.dataQuery:b.dataQuery),b.propertyQuery&&(c.propertyQuery=0!==b.propertyQuery.indexOf("#")?"#"+b.propertyQuery:b.propertyQuery),b.layout&&(c.width=b.layout.width,c.height=b.layout.height,c.x=b.layout.x,c.y=b.layout.y,c.scale=b.layout.scale||1,c.angle=b.layout.angle||0),this._setComponentAttributes(a,c)}}})}),define.experiment.Class("wysiwyg.viewer.managers.pages.PageHandler.ViewerRefactor.New",function(a,b){"use strict";var c=a;c.methods({initialize:function(a,b,c,d){this._pageId=a,this._dataResolver=b,this._isPageLoaded=!1,this._rootNode=null,this._viewerName=c,this._idPrefix=d||""},getPageRootNode:function(){return this._rootNode||(this._rootNode=document.getElementById(this.getCompDomId(this._pageId))),this._rootNode},getCompDomId:function(a){return this._idPrefix+a},_isStubPage:function(){var a=this.getPageRootNode();return a&&a.getAttribute("stub")},_createPageStructure:function(a){var b=a.structure,c=this._createComponent(b),d=b[this._dataResolver.getPageComponentsPropertyName(this._viewerName)];return _.forEach(d,this._createPageComponents.bind(this,c)),c},_setComponentProperties:function(a,b){if(b){var c={id:this.getCompDomId(b.id),comp:b.componentType,skin:"wysiwyg.viewer.components.PagesContainer"===b.componentType?"wysiwyg.viewer.skins.screenwidthcontainer.BlankScreen":b.skin,styleId:b.styleId};this._idPrefix&&(c.idprefix=this._idPrefix),b.dataQuery&&(c.dataQuery=0!==b.dataQuery.indexOf("#")?"#"+b.dataQuery:b.dataQuery),b.propertyQuery&&(c.propertyQuery=0!==b.propertyQuery.indexOf("#")?"#"+b.propertyQuery:b.propertyQuery),b.layout&&(c.width=b.layout.width,c.height=b.layout.height,c.x=b.layout.x,c.y=b.layout.y,c.scale=b.layout.scale||1),this._setComponentAttributes(a,c)}},_addComponentAnchors:function(a){if(a&&a.id&&a.layout&&a.layout.anchors){var b={},c=this.getCompDomId(a.id);b[c]=a.layout.anchors,_.forEach(b[c],function(a){a.targetComponent=this.getCompDomId(a.targetComponent)},this),W.Layout.appendSavedAnchor(b)}},_attachPage:function(a){var b=this.getPageRootNode();b.$logic?this._attachPageContentToWixifiedPage(b,a):b.parentNode.replaceChild(a,b),this._isPageLoaded=!0}})}),define.experiment.newClass("wysiwyg.viewer.managers.pages.data.DataResolverFactory.PageManagerRefactor.New",function(a,b){"use strict";var c=a;c.utilize(["wysiwyg.viewer.managers.pages.data.LocalDataResolver","wysiwyg.viewer.managers.pages.data.RemoteDataResolver","wysiwyg.viewer.managers.pages.data.StructureDataResolver"]),c.methods({initialize:function(){},getDataResolver:function(){var a;return window.publicModel?a=new this.imports.RemoteDataResolver(window.publicModel):window.siteAsJson?a=new this.imports.LocalDataResolver(window.siteAsJson):window.wixData&&(a=new this.imports.StructureDataResolver),a}})}),define.experiment.newClass("wysiwyg.viewer.managers.pages.data.LocalDataResolver.PageManagerRefactor.New",function(a,b){"use strict";var c=a;c.resources(["W.Data","W.ComponentData","W.Theme","dataFixer"]),c.methods({initialize:function(a){this._siteData=a,this._pagesData=[],this._pageIds=[],this._pagesIdsToLoad=[],this._preparePageData()},_preparePageData:function(){this._setData(this._siteData.masterPage.data),_.forEach(this._siteData.pages,function(a){var b=a.structure.id;this._pageIds.push(b),this._pagesData[b]=a,this._setData(a.data)},this)},_setData:function(a){var b=this.resources.dataFixer.fix(a);return this.resources.W.Data.addDataItemsForPage(b.document_data),this.resources.W.ComponentData.addDataItemsForPage(b.component_properties),this.resources.W.Theme.addDataItemsForPage(b.theme_data),this._pageData},getPagesIds:function(){return this._pageIds},isPageLoaded:function(a){return void 0!==this._pagesData[a]},isAllPagesDataLoaded:function(){return 0===this._pagesIdsToLoad.length},getPagesIdsToLoad:function(){return this._pagesIdsToLoad},getMasterPageData:function(){return Q(this._siteData.masterPage)},getMainPageId:function(){return null},getPageData:function(a){return Q(this._pagesData[a])},getDataById:function(a){return this._pagesData[a]}})}),define.experiment.Class("wysiwyg.viewer.managers.pages.data.LocalDataResolver.ViewerRefactor.New",function(a,b){"use strict";var c=a,d=b;c.resources(d.merge(["W.Commands"])),c.methods({_preparePageData:function(){this._siteData.masterPage=this._fixPageData(this._siteData.masterPage),this._setData(this._siteData.masterPage.data),_.forEach(this._siteData.pages,function(a){a=this._fixPageData(a);var b=a.structure.id;this._pageIds.push(b),this._pagesData[b]=a,this._setData(a.data)},this)},_fixPageData:function(a){return this.resources.dataFixer.FixPageJson(a)},_setData:function(a){return this.resources.W.Data.addDataItemsForPage(a.document_data),this.resources.W.ComponentData.addDataItemsForPage(a.component_properties),this.resources.W.Theme.addDataItemsForPage(a.theme_data),this._pageData},setViewerStructure:function(a,b){this._siteData.masterPage.structure[this.getMasterChildrenPropertyName(a)]=b.masterPage.children,_.forEach(b.pages,function(b){var c=b.id;this._pagesData[c].structure[this.getPageComponentsPropertyName(a)]=b.components},this)},addPage:function(a){this._pageIds.push(a.id),this._pagesData[a.id]={structure:a}},removePage:function(a){var b=a.getComponentId();this._pagesData[b]=null,delete this._pagesData[b],this._pageIds.splice(_.indexOf(this._pageIds,b),1)},isStructureExists:function(a){var b=this.getMasterChildrenPropertyName(a);return this.getMasterPageData().then(function(a){return a.structure[b]&&!_.isEmpty(a.structure[b])})},_getSerializedStructureForSingleView_:function(a){var b=this._getPagesStructuresForSingleView(a),c=this._getMasterStructureForSingleView(a),d=b&&c&&!_.isEmpty(c.children),e=null;return d&&(e={pages:b,masterPage:c}),e},_getMasterStructureForSingleView:function(a){var b=this._siteData.masterPage.structure;return b[this.getMasterChildrenPropertyName(a)]?this._getPageStructureForSingleView(b,a,this.getMasterChildrenPropertyName.bind(this)):null},_getPagesStructuresForSingleView:function(a){var b={},c=!1;return _.forEach(this._pageIds,function(d){var e=this._pagesData[d]&&this._pagesData[d].structure||null;e&&e[this.getPageComponentsPropertyName(a)]?(c=!0,b[d]=this._getPageStructureForSingleView(e,a,this.getPageComponentsPropertyName.bind(this))):b[d]=null},this),c?b:null},_getPageStructureForSingleView:function(a,b,c){var d=_.cloneDeep(a);return d[c("DESKTOP")]=d[c(b)],_.forOwn(Constants.ViewerTypesParams.SERVER_JSON_PREFIX,function(a,b){a&&delete d[c(b)]},this),d},getPageComponentsPropertyName:function(a){var b=Constants.ViewerTypesParams.SERVER_JSON_PREFIX[a];return b&&b.length>0?b+"Components":"components"},getMasterChildrenPropertyName:function(a){var b=Constants.ViewerTypesParams.SERVER_JSON_PREFIX[a];return b&&b.length>0?b+"Components":"children"}})}),define.experiment.newClass("wysiwyg.viewer.managers.pages.data.RemoteDataResolver.PageManagerRefactor.New",function(a,b){var c=a;c.inherits("wysiwyg.viewer.managers.pages.data.LocalDataResolver"),c.methods({initialize:function(a){this.parent(a),this._deferredRequests=[],this._pagesIdsToLoad=_.clone(this._pageIds),this._failedPagesIdsToLoad=[]},_preparePageData:function(){_.forEach(this._siteData.pageList.pages,function(a){this._pageIds.push(a.pageId);var b=a.urls.map(function(a){return resource.url(a,this._getRequestMethod(a),this._shouldLoadOnce(a))},this);define.resource(this._getResourceIdFromPageID(a.pageId)).withUrls(b).withTrials(3).withTimeBetween(3e3)},this);var a=this._siteData.pageList.masterPage.map(function(a){return resource.url(a,this._getRequestMethod(a),this._shouldLoadOnce(a))},this);define.resource(this._getResourceIdFromPageID("master")).withUrls(a).withTrials(3).withTimeBetween(3e3)},_getResourceIdFromPageID:function(a){return"pages."+a},_isStaticPage:function(a){return!~a.indexOf("archive.")},_getRequestMethod:function(a){return this._isStaticPage(a)?"cors":"jsonp"},_shouldLoadOnce:function(a){return!!this._isStaticPage(a)},getMasterPageData:function(){return this.getPageData("master")},getMainPageId:function(){return this._siteData.pageList.mainPageId},getPageData:function(a){var b;if(this._pagesData[a])b=Q(this._pagesData[a]);else if(this._deferredRequests[a])b=this._deferredRequests[a].promise;else{var c=Q.defer();resource.getResourceValue(this._getResourceIdFromPageID(a),this._onGetResourceSuccess.bind(this,a,c),this._onGetResourcesFailure.bind(this,a,c)),this._deferredRequests[a]=c,b=c.promise}return b},_onGetResourceSuccess:function(a,b,c){this._handleGetPageResource(a),this._pagesData[a]=c,this._setData(c.data),b.resolve(c)},_onGetResourcesFailure:function(a,b){LOG.reportError(wixErrors.ALL_PAGE_RETRIEVAL_ATTEMPTS_FAILED,"PageManager","loadPageById"),this._handleGetPageResource(a),this._failedPagesIdsToLoad.push(a),b.reject(new Error("Failed to get json page "+a))},_handleGetPageResource:function(a){this._deferredRequests[a]=null,delete this._deferredRequests[a],this._pagesIdsToLoad=_.without(this._pagesIdsToLoad,a)}})}),define.experiment.Class("wysiwyg.viewer.managers.pages.data.RemoteDataResolver.ViewerRefactor.New",function(a,b){var c=a;c.methods({_onGetResourceSuccess:function(a,b,c){this._handleGetPageResource(a),this._pagesData[a]=c,this._fixPageData(c),this._setData(c.data),b.resolve(c)}})}),define.experiment.newClass("wysiwyg.viewer.managers.pages.data.StructureDataResolver.PageManagerRefactor.New",function(a,b){"use strict";var c=a;c.inherits("wysiwyg.viewer.managers.pages.data.LocalDataResolver"),c.methods({_preparePageData:function(){var a=document.getElementById("SITE_STRUCTURE");if(a){var b=this._createSiteDataComponents(a),c=_.find(b.components,{id:"PAGES_CONTAINER"}),d=_.find(c.components,{id:"SITE_PAGES"}),e=d.components;d.components=[],this._siteData={masterPage:{structure:{children:b.components}},pages:[]},_.forEach(e,function(a){var b=a.id;this._pageIds.push(b);var c={structure:a};this._pagesData[b]=c,this._siteData.pages.push(c)}.bind(this)),this._setData(window.wixData),a.parentNode.removeChild(a),window.wixData=null,window.anchors=null}},_createSiteDataComponents:function(a){var b={id:a.getAttribute("id"),skin:a.getAttribute("skin"),componentType:a.getAttribute("comp"),styleId:a.getAttribute("styleId"),dataQuery:a.getAttribute("dataQuery"),layout:{width:a.getAttribute("width"),height:a.getAttribute("height"),x:a.getAttribute("x"),y:a.getAttribute("y"),anchors:window.anchors[a.getAttribute("id")]},propertyQuery:a.getAttribute("propertyQuery"),components:[]};return _.forEach(a.children,function(a){b.components.push(this._createSiteDataComponents(a))}.bind(this)),b}})}),define.experiment.Class("wysiwyg.viewer.managers.pages.data.StructureDataResolver.ViewerRefactor.New",function(a,b){"use strict";var c=a;c.methods({_preparePageData:function(){var a=document.getElementById("SITE_STRUCTURE");if(a){var b=this._createSiteDataComponents(a),c=_.find(b.components,{id:"PAGES_CONTAINER"}),d=_.find(c.components,{id:"SITE_PAGES"}),e=d.components;d.components=[],this._siteData={masterPage:{structure:{children:b.components},data:window.wixData},pages:[]},this._fixPageData(this._siteData.masterPage),_.forEach(e,function(a){var b=a.id;this._pageIds.push(b);var c={structure:a};this._fixPageData(c),this._pagesData[b]=c,this._siteData.pages.push(c)}.bind(this)),this._setData(window.wixData),a.parentNode.removeChild(a),window.wixData=null,window.anchors=null}}})}),define.experiment.component("tpa.viewer.components.TPAModal.EditorScripting.New",function(a){var b=a;b.methods({getAcceptableDataTypes:function(){return this._appData?["TPAWidget","TPA"]:[""]},_getUrl:function(){var a=this._url;return a||(a=this._appData?W.TPA.getURLBuilder().buildStateLessUrl(this._rawUrl,["instance","section-url","target","viewMode","locale","cacheKiller"],this,this._appData):this._rawUrl),a}})}),define.experiment.component("tpa.viewer.components.TPAPopup.EditorScripting.New",function(a){var b=a;b.methods({getAcceptableDataTypes:function(){return this._appData?["TPAWidget","TPA"]:[""]},_getUrl:function(){var a=this._url;return a||(a=this._appData?W.TPA.getURLBuilder().buildStateLessUrl(this._rawUrl,["instance","section-url","target","viewMode","locale","cacheKiller"],this,this._appData):this._rawUrl),a}})}),define.experiment.Class("wysiwyg.viewer.utils.MobileQuickActionsHandler.QuickActionsMenus.New",function(a){var b=a;b.binds(["_navigateToPage","_createNavItemsFromDataItems","_createSingleNavItem"]),b.methods({_removePreloader:function(){var a=document.getElementById("viewer_preloader");a&&document.body.removeChild(a)},_addNavigation:function(){var a=document.getElementById("quick-actions");if(a){var b=document.getElementById("quick-actions-pages-button");if(b){this._pagesMap={},this.resources.W.Commands.registerCommandAndListener("WViewerCommands.SelectedPageChanged",this,this._onSelectedPageChanged);var c=document.getElementById("qa-drop-up-pages").querySelector(".quick-actions-drop-up-title"),d=document.getElementById("qa-drop-up-pages-list");this.resources.W.Data.getDataByQuery("#MAIN_MENU",function(a){var b="Pages";c.innerHTML=b;var e=a.getItems();this._createNavItemsFromDataItems(d,e,0),this._addGapElement(d)}.bind(this)),b.className=b.className.replace("disabled","")}}},_addGapElement:function(a){if(a){var b=document.createElement("li");b.className="quick-actions-drop-up-ugly-clearfix",a.appendChild(b)}},_createSingleNavItem:function(a,b,c){for(var d=this._navigateToPage,e=this._hideMenu,f=">  ",g="",h=0;c>h;h++)g+=f;var i=document.createElement("li"),j=b.get("refId");this._pagesMap[j]=i,i.innerHTML="<a href='#'></a>",a.appendChild(i),this.resources.W.Data.getDataByQuery(j,function(f){var h=f.get("hidePage");if(h)a.removeChild(i);else{var k=f.get("title");i.firstChild.innerHTML=g+k;var l=b.get("items");l&&l.length>0&&this._createNavItemsFromDataItems(a,l,c+1,i),j&&0===j.indexOf("#")&&(j=j.substr(1)),i.addEventListener("click",function(a){e(),d(j),a.stopPropagation(),a.preventDefault()})}}.bind(this))},_onSelectedPageChanged:function(a){var b=this._pagesMap[this._currentPage];b&&b.removeClass("quick-actions-drop-up-selected"),this._currentPage="#"+a;var c=this._pagesMap[this._currentPage];c.addClass("quick-actions-drop-up-selected")},_hideMenu:function(){var a="quick-actions-drop-up-wrapper-open",b=document.getElementById("qa-drop-up-pages");b.removeClass(a)},_navigateToPage:function(a){W.Viewer.goToPage(a)}})});
/*
//@ sourceMappingURL=viewerExperiments.map.js
*/