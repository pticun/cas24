define.dataSchema("AccordionProperties",{titleFont:{langsKey:"System.font",type:"string","default":"arial","enum":["arial","arialBlack","comicSansMS","courierNew","georgia","impact","lucidaConsole","lucidaSansConsole","palatinoLinotype","tahoma","timesNewRoman","verdana"]},descFont:{langsKey:"System.font",type:"string","default":"arial","enum":["arial","arialBlack","comicSansMS","courierNew","georgia","impact","lucidaConsole","lucidaSansConsole","palatinoLinotype","tahoma","timesNewRoman","verdana"]},alignText:{type:"string","default":"left","enum":["left","center","right"]},textMode:{langsKey:"System.textMode",type:"string","default":"titleAndDescription","enum":["titleAndDescription","titleOnly","descriptionOnly","noText"]}}),define.dataSchema("ImpressProperties",{bcgColor1:{type:"string","default":"red"},bcgColor2:{type:"string","default":"pink"},bcgColor3:{type:"string","default":"gray"},bcgColor4:{type:"string","default":"yellow"},bcgColor5:{type:"string","default":"white"},font:{langsKey:"System.font",type:"string","default":"arial","enum":["arial","arialBlack","comicSansMS","courierNew","georgia","impact","lucidaConsole","lucidaSansConsole","palatinoLinotype","tahoma","timesNewRoman","verdana"]},fontSize:{type:"number","default":"15"},fontSizeSubTitle:{type:"number","default":"13"},fontColor:{type:"string","default":"black"},btnBcgColor:{type:"string","default":"#d3d3d3"},btnTextColor:{type:"string","default":"black"},hoverArrowBcgColor:{type:"string","default":"#C0C0C0"},hoverArrowOpacity:{type:"number","default":.5,description:"Hover opacity",minimum:0,maximum:1}}),define.dataSchema("MasonryProperties",{font:{langsPrefix:"System",type:"string","default":"arial","enum":["arial","arialBlack","comicSansMS","courierNew","georgia","impact","lucidaConsole","lucidaSansConsole","palatinoLinotype","tahoma","timesNewRoman","verdana"]},galleryImageOnClickAction:{langsPrefix:"System",type:"string","default":"disabled","enum":["disabled","zoomMode","goToLink"]},numCols:{type:"number","default":3,description:"Number of columns",minimum:1,maximum:10},margin:{type:"number","default":25,description:"Margin around each item",minimum:0,maximum:100},textMode:{langsPrefix:"System",type:"string","default":"titleAndDescription","enum":["titleAndDescription","titleOnly","descriptionOnly","noText"]},alignText:{type:"string","default":"left","enum":["left","center","right"]},boxShadowIsOn:{type:"boolean","default":!0},boxShadow:{type:"string","default":"1px 1px 1px 0px rgba(0,0,0,0.14)"}}),define.dataSchema("StripProperties",{font:{langsPrefix:"System",type:"string","default":"arial","enum":["arial","arialBlack","comicSansMS","courierNew","georgia","impact","lucidaConsole","lucidaSansConsole","palatinoLinotype","tahoma","timesNewRoman","verdana"]},textMode:{langsPrefix:"System",type:"string","default":"titleAndDescription","enum":["titleAndDescription","titleOnly","descriptionOnly","noText"]},alignText:{type:"string","default":"left","enum":["left","center","right"]},autoplayInterval:{type:"number","default":"5",minimum:0,maximum:30,description:"Autplay interval"},autoplay:{type:"boolean","default":!1,description:""},transDuration:{type:"number",minimum:0,maximum:5,"default":1,description:"Duration of the transition in sec"},transition:{langsPrefix:"System",type:"string","default":"none","enum":["none","crossFade","slide","scroll"]}}),define.dataSchema("StripSliderProperties",{margin:{type:"number","default":5,description:"Margin around each item",minimum:0,maximum:10},componentScale:{type:"string","default":"Go to link","enum":["16:9","4:3","1:1"]},showThumbnails:{type:"boolean","default":!0},autoplay:{type:"boolean","default":!0},autoplayInterval:{type:"number","default":5,minimum:0,maximum:30}}),define.dataSchema("TPA",{applicationId:{type:"string","default":"",description:"application ID"},appDefinitionId:{type:"string","default":"",description:"application Definition Id"}}),define.dataSchema("CustomProperties",function(){return{properties:"object"}}),define.dataSchema("TPAGluedProperties",{placement:{type:"string","default:":"BOTTOM_RIGHT",description:"widget placement"},verticalMargin:{type:"string","default:":"",description:"widget vertical margin"},horizontalMargin:{type:"string","default:":"",description:"widget horizontal margin"}}),define.dataSchema("TPAWidget",{"extends":"TPA",widgetId:{type:"string","default":"",description:"some amazing description"}}),define.dataSchema("ThumbnailsProperties",{font:{langsPrefix:"System",type:"string","default":"arial","enum":["arial","arialBlack","comicSansMS","courierNew","georgia","impact","lucidaConsole","lucidaSansConsole","palatinoLinotype","tahoma","timesNewRoman","verdana"]},cropAndFitStage:{langsPrefix:"System",type:"string","default":"crop","enum":["crop","fit"]},componentScale:{type:"string","default":"4:3","enum":["16:9","4:3","1:1"]},margin:{type:"number","default":5,description:"Margin around each item",minimum:0,maximum:100},textMode:{langsPrefix:"System",type:"string","default":"titleAndDescription","enum":["titleAndDescription","titleOnly","descriptionOnly","noText"]},arrowMode:{type:"boolean","default":!0},alignText:{type:"string","default":"left","enum":["left","center","right"]},autoplayInterval:{type:"number","default":"5",minimum:0,maximum:30,description:"Autplay interval"},autoplay:{type:"boolean","default":!1,description:""},transDuration:{type:"number",minimum:0,maximum:5,"default":1,description:"Duration of the transition in sec"},transition:{langsPrefix:"System",type:"string","default":"none","enum":["none","crossFade","slide","scroll","zoom","random"]}}),define.experiment.newDataSchema("TPALinkedinFollowProperties.LinkedinFollow.New",function(){return{companyName:{type:"string","default":"Wix.com",description:"the name of the company in linkedin"},dataId:{type:"number","default":97250,description:"the id of the company in linkedin"},language:{type:"string","enum":["en_US","fr_FR","ru_RU"],"default":"en_US",description:"the position of the follow counter around the button"},dataCounter:{type:"string","enum":["top","right","none"],"default":"top",description:"the position of the follow counter around the button"}}}),define.experiment.Class("tpa.common.managers.TPAManager.ActivityReporter",function(a,b){a.methods({initialize:b.after(function(){this._registerCommands(),this._activities={};var a=this;this.resource.getResources(["W.Classes"],function(b){a._classManager=b.W.Classes})}),_registerCommands:function(){var a=this.resources.W.Commands;a.registerCommandAndListener("WViewerCommands.Activity.Report",this,this._reportActivityHandler),a.registerCommandAndListener("WViewerCommands.Activity.Register",this,this._registerActivityHandler)},_reportActivityHandler:function(a){var b=this._activities[a.name];b&&this._classManager.getClass(b,function(b){var c=new b(a.fields);c.report()})},_registerActivityHandler:function(a){a&&a.name&&a.className&&(this._activities[a.name]=a.className)}})}),define.experiment.Class("tpa.common.managers.TPAManager.DynamicCSM",function(a,b){a.utilize(b.merge(["core.managers.serverfacade.RESTClient"])),a.methods({initialize:b.after(function(){var a=this.imports.RESTClient;this._restClient=new a,this._startSpecLoad()}),_loadClientSpecMap:function(a,b){if(this.resources.W.Config.isPublicMode()){this._isReady=!1;var c=location.origin+location.pathname;this._restClient.get(c+"/_api/dynamicmodel",null,{onSuccess:function(b){a(b)},onError:function(){b()}})}},_startSpecLoad:function(){var a=1e3,b=this,c=setTimeout(function(){b._isReady=!0,b.CSMError="TimeOutError"},a),d=function(a){clearTimeout(c),b._setClientSpecMap(a),b._isReady=!0},e=function(){b._isReady=!0,clearTimeout(c),b.CSMError="Second load failed"},f=function(){b.CSMError="First load failed",b._loadClientSpecMap(d,e),console.log("onErrorCallback")};this._loadClientSpecMap(d,f)},_setClientSpecMap:function(a){this._hs=a.hs,rendererModel.origClientSpecMap=rendererModel.clientSpecMap,rendererModel.clientSpecMap=a.clientSpecMap},getHS:function(){return this._hs||"NO_HS"},isReady:function(){return this._isReady}})}),define.resource("experimentDescriptors.activityreporter",{createTime:"2000-01-01T00:05:00",owner:"Gilo",description:"Client Activity Hub",tags:["viewer"]}),define.resource("experimentDescriptors.dynamiccsm",{createTime:"2000-01-01T00:05:00",owner:"Gilo",description:"loading client spec model using ajax",tags:["viewer"]}),define.resource("experimentDescriptors.masonrybtn",{createTime:"2000-01-01T00:05:00",owner:"Gilo",description:"masonry panel button",tags:["editor"]}),define.resource("experimentDescriptors.stripbtn",{createTime:"2000-01-01T00:05:00",owner:"Gilo",description:"strip panel button",tags:["editor"]}),define.resource("experimentDescriptors.tpabenefitsmodal",{createTime:"2000-01-01T00:05:00",owner:"Mayah",description:"package picker for apps",tags:["editor"]}),define.resource("experimentDescriptors.thumbnailsbtn",{createTime:"2000-01-01T00:05:00",owner:"Gilo",description:"thumbnails panel button",tags:["editor"]}),define.Class("tpa.common.managers.PixelTracker",function(a){"use strict";a.binds(["sendPixelRequest"]),a.utilize(["bootstrap.utils.Que"]),a.methods({initialize:function(a,b){this.getUrls=a,this.image=document.createElement("img"),this._useCacheKiller=b?!1:!0,this.que=new this.imports.Que({outputRate:100,outputChankSize:1,processContext:this,onprocess:function(a){this.sendPixelRequest(a)}})},_buildUrl:function(a,b){return a+=~a.indexOf("?")?"&":"?",a+=b||"",a+=this._calcCacheKiller(a),a.replace(/&&/g,"&").replace("?&","?").replace(/\?$/,"")},_calcCacheKiller:function(){return this._useCacheKiller?"&ck="+(+new Date).toString(36):""},_getUrls:function(a){return this.getUrls?this.getUrls(a):[]},sendAll:function(a){this.que.add.apply(this.que,this._getUrls(a))},sendPixelRequest:function(a,b){return a?(this.image.src=this._buildUrl(a,b),this.image.src):!1}})}),define.Class("tpa.common.managers.TPAManager",function(a){var b=a;b.inherits("bootstrap.managers.BaseManager"),b.utilize(["tpa.common.managers.URLBuilder","tpa.common.managers.TPAComponentRegistrar","tpa.common.managers.PixelTracker"]),b.resources(["scriptLoader","W.Commands","W.CommandsNew","W.Utils","W.Config"]),b.binds(["_onAppAvailableTimeoutExpires","_getCompById"]),b.statics({TPA_MESSAGE:"TPA",TPA_MESSAGE2:"TPA2",TPA_RESPONSE:"TPA_RESPONSE",APP_MARKET_MESSAGE:"APP_MARKET",APP_MARKET_URL:"http://market.apps.wix.com",PINGPONG_PREFIX:"pingpong:",LOAD_TIMEOUT:20,MessageTypes:{CHANGE_APP_SIZE:"changeAppSize",RESIZE_WINDOW:"resizeWindow",SET_WINDOW_PLACEMENT:"setWindowPlacement",GET_WINDOW_PLACEMENT:"getWindowPlacement",REFRESH_APP:"refreshApp",APP_IS_ALIVE:"appIsAlive",APP_STATE_CHANGED:"appStateChanged",CLOSE_POPUP:"closePopup",CLOSE_WINDOW:"closeWindow",OPEN_POPUP:"openPopup",OPEN_RELATIVE_POPUP:"openRelativePopup",OPEN_MODAL:"openModal",OPEN_MEDIA_DIALOG:"openMediaDialog",OPEN_BILLING_PAGE:"openBillingPage",GET_SITE_PAGES:"getSitePages",GET_SITE_COLORS:"getSiteColors",NAVIGATE_TO_PAGE:"navigateToPage",POST_MESSAGE:"postMessage",SM_REQUEST_LOGIN:"pingpong:smRequestLogin",SM_CURRENT_MEMBER:"pingpong:smCurrentMember",SITE_INFO:"pingpong:siteInfo",EVENT_LISTENER_ADDED:"pingpong:addEventListener",SM_REQUEST_LOGIN_2:"smRequestLogin",SM_CURRENT_MEMBER_2:"smCurrentMember",SITE_INFO_2:"siteInfo",SCROLL_TO:"scrollTo",SCROLL_BY:"scrollBy",HEIGHT_CHANGED:"heightChanged",APP_SETTINGS_CHANGED:"appSettingsChanged",APP_SETTINGS_CLOSE:"appSettingsClose",APP_SHOW_POPUP:"appShowPopup"}}),b.methods({initialize:function(){this._setAppMarketUrl(),this._urlBuilder=new this.imports.URLBuilder,this._componentRegistrar=new this.imports.TPAComponentRegistrar;var a=this;this._addPostMessageCallback(function(b){a.handlePostMessage(b,a._getCompById)}),this._testAppsDefIds=this._getTestAppsDefIds(),this.resources.W.Config.isPublicMode()&&this._registerPixelTrackerEvents()},_getCompById:function(a){if(this.resources.W.Config.isEditorMode()){var b=$(a);return b&&b.$logic}return this.getViewer().getCompLogicById(a)},getHS:function(){return""},_registerPixelTrackerEvents:function(){var a=this;resource.getResourceValue("W.Viewer",function(b){function c(a){var b,c=[],e=window.rendererModel.clientSpecMap||{};for(var f in e)b=d(e[f],a),b&&c.push(b);return c}function d(a,b){if(!a.pixelUrl)return"";var c=~a.pixelUrl.indexOf("?")?"&":"?";return"&"!==b.charAt(0)&&(b="&"+b),a.pixelUrl+c+"instance="+a.instance+b}a.pixelTracker=new a.imports.PixelTracker(c),b.addEvent("SiteReady",function(){a.resources.W.Utils.hash.addEvent("change",function(b){b.isForSureAfterChange&&a.pixelTracker.sendAll("page="+window.location.href)})})})},_setAppMarketUrl:function(){if(window.serviceTopology.baseDomain){var a=window.serviceTopology.baseDomain.indexOf("wixpress")>1;a&&window.serviceTopology.baseDomain.indexOf("burger")>-1&&(this.APP_MARKET_URL="http://market.burger.wixpress.com")}},isReady:function(){return!0},getViewer:function(){return this.resources.W.Config.isEditorMode()?W.Preview.getPreviewManagers().Viewer:this.injects().Viewer},isMobileReady:function(){return!1},getAppMarketData:function(a,b){var c=this,d=this.getViewer(),e=d.getAppDataHandler().getAppDataByAppDefinitionId(a);e.marketData?b(e.marketData):c.resources.scriptLoader.loadResource({url:c.APP_MARKET_URL+"/api/market/app/"+a,usePlugin:"json"},{onLoad:function(a){c._setAppMarketingData(e,a),b(e.marketData)},onFailed:function(){b(null)}})},_setAppMarketingData:function(a,b){a.marketData=b},_addPostMessageCallback:function(a){this._callbacks=this._callbacks||[],this._callbacks.push(a),window.addEventListener?window.addEventListener("message",a,!1):window.attachEvent&&window.attachEvent("onmessage",a)},handlePostMessage:function(a,b){if("string"==typeof a.data){var c="";try{c=JSON.parse(a.data)}catch(d){return}var e=c.type;c&&c.intent&&(c.intent===this.TPA_MESSAGE&&e?this._handleTPAMessage(c,e,b):c.intent===this.APP_MARKET_MESSAGE?this._handleAppMarketMessage(c):c.intent===this.TPA_MESSAGE2&&e&&this._handleTPAMessage2(c,e,b))}},_handleTPAMessage2:function(a,b,c){var d=a.compId,e=c(d);if(e)if(Object.contains(this.MessageTypes,b)){var f=this._getHandlerFunctionName(b),g=e[f];g?g.apply(e,[{msgData:a.data,callback:function(c){var f=e.getIFrame();f.contentWindow.postMessage(JSON.stringify({intent:this.TPA_RESPONSE,compId:d,callId:a.callId,type:b,res:c,status:!0}),"*")}.bind(this)}]):LOG.reportError("Handler function not found - "+b,"tpa.viewer.managers.TPA","handlePostMessage2")}else LOG.reportError("Unknown post message type - "+b,"tpa.viewer.managers.TPA","handlePostMessage")},_handleTPAMessage:function(a,b,c){var d=a.compId,e=c(d);if(e)if(Object.contains(this.MessageTypes,b)){var f=this._getHandlerFunctionName(b),g=e[f];g?this._isPingPongMessage(b)?g.apply(e,[{msgData:a.data,callback:function(a){var c=e.getIFrame();c.contentWindow.postMessage(JSON.stringify({intent:this.TPA_MESSAGE,compId:d,type:b,data:a}),"*")}.bind(this)}]):g.apply(e,[a.data]):LOG.reportError("Handler function not found - "+b,"tpa.viewer.managers.TPA","handlePostMessage")}else LOG.reportError("Unknown post message type - "+b,"tpa.viewer.managers.TPA","handlePostMessage")},_handleAppMarketMessage:function(a){switch(a.cmd){case"ADD_APP_TO_SITE":this.resources.W.Commands.executeCommand("WEditorCommands.AddApp",a.params,this),this.resources.W.Commands.executeCommand(Constants.EditorUI.CLOSE_PANEL);break;case"ADD_COMPONENT_TO_SITE":a.params&&"addLoginButton"===a.params.compType?this.resources.W.Commands.executeCommand("WEditorCommands.AddSMDependantComponent",{compType:"addLoginButton",styleId:""},this):this.resources.W.CommandsNew.executeCommand("WEditorCommands.AddComponent",a.params,this),this.resources.W.Commands.executeCommand(Constants.EditorUI.CLOSE_PANEL);break;case"OPEN_MARKET_POPUP":this.resources.W.Commands.executeCommand("WEditorCommands.openMarketPopup",a.params,this);break;case"CLOSE_MARKET_POPUP":this.resources.W.Commands.executeCommand("WEditorCommands.closeMarketPopup",a.params,this);break;case"GET_INSTALLED_APPS":var b=W.Preview.getPreviewManagers().Viewer.getAppDataHandler().getAppsData(),c={eventType:"ON_COMMAND_RESPONSE",callerId:a.id,params:b};this._marketPanelWindow.postMessage(JSON.stringify(c),this.APP_MARKET_URL);break;case"GET_TEST_APPS":this.getTestApps(function(b){var c={eventType:"ON_COMMAND_RESPONSE",callerId:a.id,params:b};this._marketPanelWindow.postMessage(JSON.stringify(c),this.APP_MARKET_URL)}.bind(this))}},setMarketPanelWindow:function(a){this._marketPanelWindow=a},_getHandlerFunctionName:function(a){return this._isPingPongMessage(a)&&(a=a.replace(this.PINGPONG_PREFIX,"")),"handle"+a.capitalize()},_isPingPongMessage:function(a){return 0===a.indexOf(this.PINGPONG_PREFIX)},getURLBuilder:function(){return this._urlBuilder},getComponentRegistrar:function(){return this._componentRegistrar},getSectionURL:function(a){var b=this._componentRegistrar.getPageId(a);if(null===b)return null;var c=W.Data.getDataByQuery("#"+b),d=c&&c.get("title");this.getPageState(b);var e=this.resources.W.Config.isPublicMode(),f=location.href.replace(location.hash,"");f=e?window.publicModel&&window.publicModel.externalBaseUrl||f:f;var g=f+"#!"+this.injects().Utils.hash.getHashPartsString(b,d);return g="/"==g.charAt(g.length-1)?g:g+"/"},_getTestAppsDefIds:function(){var a=[],b=W.Utils.getQueryParam("appDefinitionId");b&&a.push(b);var c=window.editorModel&&window.editorModel.runningApps||{},d="~";return Object.each(c,function(b,c){if("ON"==b.toUpperCase()){var e=c.lastIndexOf(d),f=e+1;if(c.length>f||e>0){var g=c.substr(f);a.push(g.trim())}}}.bind(this)),a},getTestApps:function(a){a(this._testAppsDefIds)},reportLoadStart:function(a){this._waitForAppAlive(a)},_waitForAppAlive:function(a){a.isAppAlive()||a.callLater(this._onAppAvailableTimeoutExpires,[a],1e3*this.LOAD_TIMEOUT)},_onAppAvailableTimeoutExpires:function(a){a.isAppAlive()||a.onError()},setPageState:function(a,b){this._stateByPage||(this._stateByPage={}),this._stateByPage[a]=b},getPageState:function(a){var b=this._stateByPage&&this._stateByPage[a];return b||""},getAppDefinitionId:function(a){var b=W.Preview.getPreviewManagers().Viewer.getAppDataHandler().getAppData(a);return b.appDefinitionId},getAppData:function(a){return W.Preview.getPreviewManagers().Viewer.getAppDataHandler().getAppData(a)},dispose:function(){for(var a;this._callbacks&&this._callbacks.length;)a=this._callbacks.pop(),window.removeEventListener?window.removeEventListener("message",a):window.detachEvent&&window.detachEvent("onmessage",a);this.parent()},postMessageEvent:function(a,b){var c=b||this._marketPanelWindow,d=location.protocol+"//"+location.host,e={eventType:a,origin:d};c.postMessage(JSON.stringify(e),this.APP_MARKET_URL)},clone:function(a){return this.parent(a)}})}),define.Class("tpa.common.managers.TPAComponentRegistrar",function(a){var b=a;b.resources(["W.Data"]),b.statics({SECTION:"section",WIDGETS:"widgets",SECTION_PAGE_ID:"pageId",APPLICATION_ID_KEY:"tpaApplicationId"}),b.methods({initialize:function(){this._componentsByType={},this._componentsByCompId={}},register:function(a,b){b=a.getApplicationId()||b;var c=this._getDataObjectByApplicationId(b);if(a&&"tpa.viewer.components.TPASection"==a.getOriginalClassName())c[this.SECTION]=a;else{var d=this._getWidgets(b);d.push(a)}this._componentsByCompId[a.getComponentId()]=a},unregister:function(a,b){b=a.getApplicationId()||b;var c=this._getDataObjectByApplicationId(b);if(a&&"tpa.viewer.components.TPASection"==a.getOriginalClassName())delete c[this.SECTION];else{var d=this._getWidgets(b),e=d.indexOfByPredicate(function(b){return b===a}.bind(this));d.splice(e,1)}delete this._componentsByCompId[a.getComponentId()]},getPageId:function(a){var b=this.resources.W.Data.getDataMap(),c=Object.filter(b,function(b){return"Page"==b.get("type")&&b.get(this.APPLICATION_ID_KEY)==a}.bind(this)),d=Object.values(c);return d.length>0?d[0].get("id")||null:null},_getDataObjectByApplicationId:function(a){return this._componentsByType[a]||(this._componentsByType[a]={}),this._componentsByType[a]},_getByApplicationId:function(a){var b=[].concat(this._getWidgets(a)),c=this.getSection(a);return c&&b.push(c),b},each:function(a,b){var c=this._getByApplicationId(a);Array.each(c,function(a){b(a)})},_getWidgets:function(a){var b=this._getDataObjectByApplicationId(a);return b[this.WIDGETS]||(b[this.WIDGETS]=[]),b[this.WIDGETS]},getSection:function(a){var b=this._getDataObjectByApplicationId(a);return b[this.SECTION]},getComponents:function(){return this._componentsByCompId}})}),define.Class("tpa.common.managers.URLBuilder",function(a){var b=a;b.resources(["W.Utils","W.Config"]),b.methods({buildStateLessUrl:function(a,b,c,d){return this._buildUrlInternal(a,b,c,d)},buildStateFullUrl:function(a,b,c,d){var e=this._getCurrentState(c);return e&&(a=this._returnUrlWithSlash(a)+e),this._buildUrlInternal(a,b,c,d)},_returnUrlWithSlash:function(a){return"/"===a[a.length-1]?a:a+"/"},_buildUrlInternal:function(a,b,c,d){if(!a)return null;var e=a,f=[],g=e;return e+=String.contains(e,"?")?"&":"?",-1===b.indexOf("compId")&&b.push("compId"),Array.each(b,function(a){var b=this._getValue(g,c,d,a);(b||0===b)&&f.push(a+"="+encodeURIComponent(b))}.bind(this)),e+f.join("&")},_getCacheKiller:function(){return(new Date).getTime().toString()},_getCurrentState:function(a){var b=this.resources.W.Utils.hash.getHashParts(location.hash),c=a._appData.sectionDefaultPage;return b.extData?b.extData:c?c:""},_getValue:function(a,b,c,d){var e;switch(d){case"instance":return c.instance;case"section-url":return e=b.getSectionURL(),!e||this.resources.W.Config.isPublicMode()?e:a;case"target":return e=b.getSectionURL(),this.resources.W.Config.isPublicMode()?e?"_top":null:"_self";case"width":return b.getWidth();case"locale":return this.resources.W.Config.getLanguage();case"viewMode":var f;return f=this.resources.W.Config.isPublicMode()?"site":this.resources.W.Config.isEditorMode()?"PREVIEW"===this.injects().Editor.getEditMode()?"preview":"editor":this.resources.W.Config.isPreviewMode()?"PREVIEW"===this.injects().Viewer.getEditorMode()?"preview":"editor":"error";case"origCompId":return this.injects().Editor.getEditedComponent().getComponentId();case"compId":return b.getComponentId();case"deviceType":return"mobile";case"cacheKiller":return this._getCacheKiller()}}})}),define.Class("tpa.common.traits.TPAHandlersBase",function(a){var b=a;b.resources(["W.Config","W.Commands","W.Utils","W.Data"]),b.methods({_appIsAlive:!1,initialize:function(){return this._changeSize?(this._isAliveTime=0,this._isAliveCounter=0,void 0):new Error("Must... Implement... _changeSize...")},getViewer:function(){return this.resources.W.Config.isEditorMode()?W.Preview.getPreviewManagers().Viewer:this.injects().Viewer},handleAppIsAlive:function(a){this._appIsAlive=!0,this._isAliveTime=new Date,this._isAliveCounter++,this.version=a&&a.version||"unknown"},handleSiteInfo:function(a){var b=this._getSiteSEOParams();b.pageTitle=this._getCurrentPageName(),b.referer=document.referrer,b.url=location.href,b.baseUrl=this._getSiteBaseUrl(),a.callback(b)},_getSitePages:function(a){for(var b=[],c=0,d=a.length;d>c;c++){for(var e=this._getPageInfo(a[c]),f=a[c].get("items"),g=0,h=f.length;h>g;g++){var i=this._getPageInfo(f[g]);e.subPages=e.subPages||[],e.subPages.push(i)}b.push(e)}return b},_getPageInfo:function(a){var b={},c=a.get("refId"),d=this._datam.getDataByQuery(c);return b.title=d.get("title")||"",b.id=0===c.indexOf("#")?c.substr(1):c,b.hide=d.get("hidePage")||!1,b},getTPAViewMode:function(){var a;return a=this.resources.W.Config.isPublicMode()?"site":this.resources.W.Config.isEditorMode()?"editor":this.resources.W.Config.isPreviewMode()?"preview":"error"},_getSiteSEOParams:function(){var a=this.getTPAViewMode();switch(a){case"editor":return this._getSiteSEOParamsInEditMode();case"preview":return this._getSiteSEOParamsInPreviewMode();case"site":return this._getSiteSEOParamsInViewMode()}return{}},_getSiteBaseUrl:function(){var a=location.protocol+"//"+location.host+location.pathname;return"editor"==this.getTPAViewMode()?a=window.parent.W.Config.siteNeverSavedBefore()?"":this.resources.W.Config.getUserPublicUrl():"preview"==this.getTPAViewMode()&&(a=window.parent.W.Config.siteNeverSavedBefore()?"":window.parent.W.Config.getUserPublicUrl()||""),a},_getMetadataParameter:function(a,b){var c=$$("meta["+(b||"name")+"='"+a+"']"),d="";if(c&&c.length>0){var e=c.get("content");e.length>0&&(d=e[0])}return d},_getSiteSEOParamsInViewMode:function(){var a=$$("title");return a=a&&a[0]&&a[0].text,{siteTitle:a||"",siteDescription:this._getMetadataParameter("description")||"",siteKeywords:this._getMetadataParameter("keywords")||""}},_getSiteSEOParamsInPreviewMode:function(){var a=window.parent.W.Data.getDataByQuery("#SITE_SETTINGS"),b=a.getData()||{};return{siteTitle:b.siteTitleSEO||"",siteDescription:b.siteDescriptionSEO||"",siteKeywords:b.keywordsSEO||""}},_getSiteSEOParamsInEditMode:function(){var a=this.resources.W.Data.getDataByQuery("#SITE_SETTINGS"),b=a.getData()||{};return{siteTitle:b.siteTitleSEO||"",siteDescription:b.siteDescriptionSEO||"",siteKeywords:b.keywordsSEO||""}},_getCurrentPageName:function(){var a=null;try{var b=this.getViewer().getCurrentPageNode().getLogic().getDataItem();a=b.getData()}catch(c){return""}return a&&a.title||""}})});